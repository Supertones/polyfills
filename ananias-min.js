/// ananias-min.js
(function(){

(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
module.exports={init:function(e){this.gameController=e},achieve:function(e){var t=this.gameController.player;if(!t.stats.challenges.achieved[e]){var i=this.CHALLENGES[e];if(i){this.gameController.holdEnablingPlayerAction=!0,this.gameController.disablePlayerAction();var n=this.gameController;this.gameController.alert(i.name+": "+i.description,"Challenge Completed!",function(){n.holdEnablingPlayerAction=!1,n.enablePlayerAction()})}if(t.stats.challenges.achieved[e]=!0,window.greenworks)window.greenworks.activateAchievement(e,function(){},function(e){alert("Error "+e)})}},increaseStat:function(e,t){t||(t=1)},CHALLENGES:{ASSAULT:{name:"Assault",index:0,description:"Kill 100 enemies"},FLINTSTONE:{name:"Flintstone",index:1,description:"Collect 20 pebbles on inventory"},BRAVE_CHAMO:{name:"Brave Chamo",index:2,description:"Complete 5 levels playing start to end without armor"},THAT_COMES_HANDY:{name:"That comes handy...",index:3,description:"Kill 50 enemies with bare hands"},CARETAKER:{name:"Caretaker",index:4,description:"Keep your starter pet alive up to level 10"},SHEPHERD:{name:"Shepherd",index:5,description:"Keep your starter sheep alive up to level 5"},DIE_HARD:{name:"Die Hard",index:6,description:"Complete 5 levels without healing"},DUNGEON_EXPLORER:{name:"Dungeon Explorer",index:7,description:"Explore 10 levels completely"},BREAKING_STEREOTYPES:{name:"Breaking stereotypes",index:8,description:"Kill 30 monsters in melee with combat = 1"},BURNING_STEREOTYPES:{name:"Burning stereotypes",index:9,description:"Kill 30 monsters with < 3 magic power"},I_GOTTA_BE_THE_VERY_BEST:{name:"I gotta be the very best",index:10,description:"Have your pet kill 50 monsters"},DUNGEON_DIVER:{name:"Dungeon diver",index:11,description:"Take no damage for 5 levels"},SWORD_COLLECTOR:{name:"Sword collector",index:12,description:"Collect 10 swords on inventory"},SUPER_SHEPHERD:{name:"Super Shepherd",index:13,description:"Keep your starter sheep alive up to level 10"},DIE_HARD_II:{name:"Die Hard II",index:14,description:"Complete 10 levels without healing"},MASSACRE:{name:"Massacre",index:15,description:"Kill 200 enemies"},LEGENDARY_SHEPHERD:{name:"Legendary Shepherd",index:16,description:"Keep your starter sheep alive up to level 15"},GENOCIDE:{name:"Genocide",index:17,description:"Kill 400 enemies"},WAS_THIS_SUPPOSED_TO_BE_HARD:{name:"Was this supposed to be hard?",index:18,description:"Finish the game in less than 30 minutes"}},ENVIRONMENT_ACHIEVEMENTS:{TEMPLE:"DISCOVER_THE_RUINS_OF_ANANIAS",CAVERNS:"DISCOVER_THE_CAVERNS_OF_CHAOS",LAGOON:"DISCOVER_THE_UNDERGROUND_LAGOON",CRYSTAL:"DISCOVER_THE_CRYSTAL_CAVERNS",LAIR:"DISCOVER_THE_LAIR_OF_THE_ANCIENTS",ABYSS:"DISCOVER_THE_DARKNESS_ABYSS",YENDOR:"BACK_TO_THE_ROOTS"},challengePending:function(e){var t=this.gameController.player;return!t.stats.challenges.achieved[e]&&!t.stats.challenges.failed[e]},failChallenge:function(e){this.gameController.player.stats.challenges.failed[e]=!0},increaseChallengeCounter:function(e){var t=this.gameController.player;t.stats.challenges.counters[e]||(t.stats.challenges.counters[e]=0),t.stats.challenges.counters[e]++},getCounter:function(e){return this.gameController.player.stats.challenges.counters[e]},achieveNewLevel:function(e){var t=this.ENVIRONMENT_ACHIEVEMENTS[e];t&&this.achieve(t);var i=this.gameController.player;this.challengePending("BRAVE_CHAMO")&&(i.stats.conducts.noArmorUsed?(this.increaseChallengeCounter("BRAVE_CHAMO"),6===this.getCounter("BRAVE_CHAMO")&&this.achieve("BRAVE_CHAMO")):this.failChallenge("BRAVE_CHAMO")),this.challengePending("DUNGEON_EXPLORER")&&(i.stats.conducts.noRoomUnexplored?(this.increaseChallengeCounter("DUNGEON_EXPLORER"),11===this.getCounter("DUNGEON_EXPLORER")&&this.achieve("DUNGEON_EXPLORER")):this.failChallenge("DUNGEON_EXPLORER")),this.challengePending("CARETAKER")&&(i.pet&&i.pet.isStarter?10===this.gameController.depth&&this.achieve("CARETAKER"):this.failChallenge("CARETAKER")),"SHEPHERD"===i.classCode&&(this.challengePending("SHEPHERD")&&(i.pet&&i.pet.isStarter?5===this.gameController.depth&&this.achieve("SHEPHERD"):this.failChallenge("SHEPHERD")),this.challengePending("SUPER_SHEPHERD")&&(i.pet&&i.pet.isStarter?10===this.gameController.depth&&this.achieve("SUPER_SHEPHERD"):this.failChallenge("SUPER_SHEPHERD")),this.challengePending("LEGENDARY_SHEPHERD")&&(i.pet&&i.pet.isStarter?15===this.gameController.depth&&this.achieve("LEGENDARY_SHEPHERD"):this.failChallenge("LEGENDARY_SHEPHERD"))),this.challengePending("DIE_HARD")&&6===this.gameController.depth&&this.achieve("DIE_HARD"),this.challengePending("DIE_HARD_II")&&11===this.gameController.depth&&this.achieve("DIE_HARD_II"),this.challengePending("DUNGEON_DIVER")&&6===this.gameController.depth&&this.achieve("DUNGEON_DIVER")},WIN_ACHIEVEMENTS:{KNIGHT:"HERO_OF_CHIVALRY",ARCHER:"HERO_OF_ARCHERY",ALCHEMIST:"HERO_OF_ALCHEMY",ARCANE:"HERO_OF_WIZARDRY",SLAYER:"HERO_OF_HACKN_SLASH",BARBARIAN:"HERO_OF_SOUL",AILORUS:"HERO_OF_THE_MIND",DUMERIL:"HERO_OF_THE_ELEMENTS",SHEPHERD:"HERO_OF_HUMILITY"},achieveWin:function(e){this.increaseStat("WINS");var t=this.WIN_ACHIEVEMENTS[e.classCode];t&&this.achieve(t),Math.floor(e.stats.gameplaySeconds/60)<=29&&this.achieve("WAS_THIS_SUPPOSED_TO_BE_HARD")},doDie:function(){this.increaseStat("DEATHS");var e=this.gameController.player;0===Math.floor(e.stats.gameplaySeconds/60)&&this.achieve("OH_WELL"),0===e.kills&&this.achieve("ARE_YOU_THERE")},achievePickup:function(e,t){20===t.countItemsByCode("pebbles")&&this.achieve("FLINTSTONE"),10===t.countItemsByType("SWORD")&&this.achieve("SWORD_COLLECTOR"),e.alreadyPickedUp||"applySpirit"===e.onUse&&this.increaseStat("REAGENT_COLLECTOR")},achievePetKill:function(){this.challengePending("I_GOTTA_BE_THE_VERY_BEST")&&(this.increaseChallengeCounter("I_GOTTA_BE_THE_VERY_BEST"),50===this.getCounter("I_GOTTA_BE_THE_VERY_BEST")&&this.achieve("I_GOTTA_BE_THE_VERY_BEST"))},achieveKill:function(e){var t=this.gameController.player;this.increaseStat("KILLS"),"ORC"===e.race.code&&this.increaseStat("ORC_KILLS"),-1!==e.race.code.indexOf("DRACONIAN")&&this.increaseStat("DRACONIAN_KILLS"),-1!==e.race.code.indexOf("SHERTUL")&&this.increaseStat("SHERTUL_KILLS"),"TRIDUDE"===e.race.code&&this.increaseStat("TRIDUDE_KILLS"),100===t.kills?this.achieve("ASSAULT"):200===t.kills?this.achieve("MASSACRE"):400===t.kills&&this.achieve("GENOCIDE"),"AILORUS"===t.classCode||t.currentWeapon||(t.stats.challenges.counters.THAT_COMES_HANDY||(t.stats.challenges.counters.THAT_COMES_HANDY=0),t.stats.challenges.counters.THAT_COMES_HANDY++,50===t.stats.challenges.counters.THAT_COMES_HANDY&&this.achieve("THAT_COMES_HANDY")),this.challengePending("BREAKING_STEREOTYPES")&&("melee"!==t.latestAttackType&&"kick"!==t.latestAttackType&&"punch"!==t.latestAttackType||1===t.attack.current&&(this.increaseChallengeCounter("BREAKING_STEREOTYPES"),30===this.getCounter("BREAKING_STEREOTYPES")&&this.achieve("BREAKING_STEREOTYPES"))),this.challengePending("BURNING_STEREOTYPES")&&("wand"!==t.latestAttackType&&"magicSpell"!==t.latestAttackType||t.magicPower.current<=3&&(this.increaseChallengeCounter("BURNING_STEREOTYPES"),30===this.getCounter("BURNING_STEREOTYPES")&&this.achieve("BURNING_STEREOTYPES")))},doHealing:function(){this.challengePending("DIE_HARD")&&this.failChallenge("DIE_HARD"),this.challengePending("DIE_HARD_II")&&this.failChallenge("DIE_HARD_II")},doTakeDamage:function(){this.challengePending("DUNGEON_DIVER")&&this.failChallenge("DUNGEON_DIVER")}};

},{}],2:[function(require,module,exports){
var Material=require("./Material.enum"),ActionValidator={attackSelf:function(e,r,n){return r!=e||(e.gameController.showTextBy(e,"Cast on other!"),e.gameController.showMessageInPanel("This spell should not be cast on yourself, select another target."),!1)},wield:function(e,r,n){if(r.currentWeapon&&r.currentWeapon==n){if(!e.canPickUp(n))return e.gameController.showTextBy(r,"Inventory Full."),e.gameController.showMessageInPanel("You can't carry more items."),!1}else if(n.features.twoHanded&&!r.canWieldTwoHanded())return e.gameController.showTextBy(e,"Two handed"),e.gameController.showMessageInPanel("You need two free hands to wield this weapon."),!1;return!!r.canWield(n)||(e.gameController.showTextBy(e,"How?"),e.gameController.showMessageInPanel("You don't know how to use this weapon."),!1)},wear:function(e,r,n){var o=null;switch(n.features.wearLocation){case"body":o=r.currentArmor;break;case"arms":o=r.currentArmwear;break;case"legs":o=r.currentLegwear;break;case"foot":o=r.currentFootwear}if(o&&o==n){if(!e.canPickUp(n))return e.gameController.showTextBy(r,"Inventory Full."),e.gameController.showMessageInPanel("You can't carry more items."),!1}else if(!r.canWearArmor(n))return e.gameController.showTextBy(r,"Too heavy."),e.gameController.showMessageInPanel("You can't wear this piece of armor."),!1;return!0},wearAsHelmet:function(e,r,n){if(r.currentHelmet&&r.currentHelmet==n){if(!e.canPickUp(n))return e.gameController.showTextBy(r,"Inventory Full."),e.gameController.showMessageInPanel("You can't carry more items."),!1}else if(!r.canWearHelmet(n))return e.gameController.showTextBy(r,"Can't."),e.gameController.showMessageInPanel("You can't wear this piece of headgear."),!1;return!0},wearAsShield:function(e,r,n){if(r.currentShield&&r.currentShield==n){if(!e.canPickUp(n))return e.gameController.showTextBy(r,"Inventory Full."),e.gameController.showMessageInPanel("You can't carry more items."),!1}else{if(r.currentWeapon&&r.currentWeapon.features.twoHanded)return e.gameController.showTextBy(e,"Two handed"),e.gameController.showMessageInPanel("You need two free hands to wield your weapon."),!1;if(!r.canWearShield(n))return e.gameController.showTextBy(r,"Can't."),e.gameController.showMessageInPanel("You can't wear this shield."),!1}return!0},enchant:function(e,r){return!(!r.currentWeapon||"WAND"!==r.currentWeapon.type)||(e.gameController.showTextBy(r,"Need a wand"),e.gameController.showMessageInPanel("You need to be wielding a wand to use this spell."),!1)},stopBleeding:function(e,r){return r===e||r.race.material===Material.FLESH||(e.gameController.showTextBy(r,"Can't."),e.gameController.showMessageInPanel("The "+r.getDescription()+" can't be bandaged."),!1)},recoverFullHealth:function(e,r,n){return!!n.features.isSpell||(r===e||r.race.material===Material.FLESH||(e.gameController.showTextBy(r,"Can't."),e.gameController.showMessageInPanel("The potion won't have any effect on the "+r.getDescription()),!1))},recoverHealth:function(e,r,n){return!!n.features.isSpell||(r===e||r.race.material===Material.FLESH||(e.gameController.showTextBy(r,"Can't."),e.gameController.showMessageInPanel("The potion won't have any effect on the "+r.getDescription()),!1))},charm:function(e,r){return e.canCharm(r)},inflictStatus:function(e,r,n){if(r==e)return e.gameController.showTextBy(e,"Cast on other!"),e.gameController.showMessageInPanel("This spell should not be cast on yourself, select another target."),!1;switch(n.features.inflictedStatus){case"charm":if(!e.canCharm(r))return!1}return!0},darkEvolve:function(e,r){return e.canEvolve(!0,r)},lightEvolve:function(e,r){return e.canEvolve(!1,r)},transmute:function(e){return e.canTransmute()},applySpirit:function(e,r,n){return e.canDoChemistry(n)},enchantWeapon:function(e,r){return!!r.currentWeapon||(e.gameController.showTextBy(r,"Need a weapon"),e.gameController.showMessageInPanel("You need to wield a weapon in order to enchant it."),!1)},enchantArmor:function(e,r){return!!r.currentArmor||(e.gameController.showTextBy(r,"Need an armor"),e.gameController.showMessageInPanel("You need to wear an armor in order to enchant it."),!1)},repairArmor:function(e,r){return!!r.currentArmor||(e.gameController.showTextBy(r,"Need an armor"),e.gameController.showMessageInPanel("You need to wear an armor in order to repair it."),!1)},polymorph:function(e,r){return e.canPolymorph(r)},repairWeapon:function(e,r){return r.currentWeapon?r.currentWeapon.features.usesArrows?(e.gameController.showTextBy(r,"Won't work..."),e.gameController.showMessageInPanel("This weapon uses ammunition, it cannot be repaired."),!1):"WAND"!==r.currentWeapon.type||(e.gameController.showTextBy(r,"Won't work..."),e.gameController.showMessageInPanel("Magic wands cannot be repaired."),!1):(e.gameController.showTextBy(r,"Need a weapon"),e.gameController.showMessageInPanel("Wear a weapon in order to repair it."),!1)},repairWeaponOfType:function(e,r,n){return!(!r.currentWeapon||r.currentWeapon.getSubtype()!==n.features.repairWeaponType)||(e.gameController.showTextBy(r,"Won't Work..."),e.gameController.showMessageInPanel("This spell doesn't work in this class of weapons."),!1)},reloadWeapon:function(e,r,n){var o=n.features&&("explode"===n.features.onThrow||"damage"===n.features.onThrow);return r.currentWeapon?r.currentWeapon.type===n.features.reloadWeaponType||(e.gameController.showTextBy(r,"Need a "+r.currentWeapon.TYPE_NAMES(n.features.reloadWeaponType)),o?e.gameController.showMessageInPanel("Wield a "+r.currentWeapon.TYPE_NAMES(n.features.reloadWeaponType)+" or throw the item at an enemy."):e.gameController.showMessageInPanel("Wield a "+r.currentWeapon.TYPE_NAMES(n.features.reloadWeaponType)+" first in order to load it."),!1):(e.gameController.showTextBy(r,"Need a weapon"),o?e.gameController.showMessageInPanel("Wield a weapon to load or throw the item at an enemy."):e.gameController.showMessageInPanel("Wield a weapon first in order to load it."),!1)},magicAttack:function(e,r){return r!=e||(e.gameController.showTextBy(e,"Cast on other!"),e.gameController.showMessageInPanel("This spell should not be cast on yourself, select another target."),!1)}};module.exports=ActionValidator;

},{"./Material.enum":19}],3:[function(require,module,exports){
function Ananias(e){setup.isCocoon="COCOON"===e.deployType,setup.isItch="ITCH"===e.deployType,setup.isNode="NODE"===e.deployType,setup.displayMode=e.displayMode,setup.deployType=e.deployType;var i=!1;void 0!==e.forceSoundDisabled&&(i=e.forceSoundDisabled),setup.isCocoon?(Ananias.initializeCocoon(),setup.dontScale=!1):setup.dontScale="true"===getParameterByName("noScale"),setup.isNode&&(Ananias.initNodeWebkit(),Ananias.initGreenworks());var s=new Storage;s.getItem("preferences")?(this.preferences=JSON.parse(s.getItem("preferences")),i?this.preferences.soundEnabled=!1:void 0===this.preferences.soundEnabled&&(this.preferences.soundEnabled=!0)):this.preferences={soundEnabled:!i,musicEnabled:!0,sfxEnabled:!0},s.setItem("preferences",JSON.stringify(this.preferences)),setup.soundsDisabled=!this.preferences.soundEnabled,setup.isGold=!1;var a=document.domain;this.isMobile=!0;var t="DEV"===e.deployType;setup.devMode=t,t||setup.isCocoon||setup.isNode||"ananiasgame.com"===a||"www.ananiasgame.com"===a||-1!=a.indexOf("gamejolt.net")||"uploads.ungrounded.net"===a||(setup.isGold?(alert("This site is NOT authorized to distribute this game. Redirecting you to the official website"),window.location="http://ananiasgame.com"):alert("WARNING: You are playing Ananias from an unauthorized website ("+a+"), please visit ananiasgame.com to keep up to date and support its development!")),!setup.isCocoon&&window.matchMedia&&(this.isMobile=window.matchMedia("only screen and (max-width: 760px)").matches),(setup.isItch||setup.isNode)&&(this.isMobile=!1);var o=null;setup.isNode?setup.displayMode="DESKTOP":setup.displayMode||(this.isMobile?setup.displayMode="PORTRAIT":setup.displayMode="DESKTOP"),"HD"===setup.displayMode?o=new Phaser.Game(1920,1080,Phaser.AUTO,"phaser-game",null,!1,!1):"DESKTOP"===setup.displayMode?o=new Phaser.Game(640,360,Phaser.AUTO,"phaser-game",null,!1,!1):"PHONE"===setup.displayMode?o=new Phaser.Game(320,192,Phaser.AUTO,"phaser-game",null,!1,!1):"TABLET"===setup.displayMode?o=new Phaser.Game(512,320,Phaser.AUTO,"phaser-game",null,!1,!1):"PORTRAIT"===setup.displayMode?o=new Phaser.Game(320,576,Phaser.AUTO,"phaser-game",null,!1,!1):"TRAILER"===setup.displayMode&&(o=new Phaser.Game(416,240,Phaser.AUTO,"phaser-game",null,!1,!1)),o.state.add("Boot",Ananias.Boot),o.state.add("Preloader",Ananias.Preloader),o.state.add("Game",Ananias.Game),o.state.start("Boot")}Ananias.initNodeWebkit=function(){var e=ngui.Window.get();e.show(),e.maximize()},Ananias.initGreenworks=function(){var e=window.greenworks;e&&(e.initAPI()||alert("Error on initializing Steam API"))},Ananias.initializeCocoon=function(){};var setup={isLandscape:!1,soundsDisabled:!1};module.exports=Ananias,"undefined"!=typeof window&&(window.Ananias=Ananias);var GameController=require("./GameController.class"),Storage=require("./Storage.class");Ananias.Boot=function(){},Ananias.Boot.prototype={getRatio:function(e,i,s){var a=navigator.isCocoonJS?window.innerWidth:i,t=navigator.isCocoonJS?window.innerHeight:s,o=window.devicePixelRatio,n=(a*=o)/i,l=(t*=o)/s,r={x:1,y:1};switch(e){case"all":r.x=n>l?l:n,r.y=n>l?l:n;break;case"fit":r.x=n>l?n:l,r.y=n>l?n:l;break;case"fill":r.x=n,r.y=l}return r},preload:function(){this.load.image("background","img/background.png"),this.load.image("preloaderBar","img/preloaderBar.png")},create:function(){if(this.input.maxPointers=1,navigator.isCocoonJS){var e=this.getRatio("all",320,512);this.game.world.scale.x=e.x,this.game.world.scale.y=e.y,this.game.world.updateTransform(),this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0}else this.game.device.desktop?(setup.dontScale||(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL),this.scale.pageAlignHorizontally=!0):(setup.dontScale||(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0);this.state.start("Preloader")}},Ananias.Preloader=function(){this.background=null,this.preloadBar=null,this.ready=!1},Ananias.Preloader.prototype={preload:function(){"DESKTOP"===setup.displayMode||"HD"===setup.displayMode?(this.background=this.add.image(0,0,"background"),this.preloadBar=this.add.image(125,80,"preloaderBar"),this.add.text(125,160,"Loading...",{font:"16px PixelFont",fill:"#ffffff"})):"PHONE"===setup.displayMode||"TRAILER"===setup.displayMode?(this.background=this.add.image(0,0,"background"),this.preloadBar=this.add.image(29,32,"preloaderBar"),this.add.text(29,110,"Loading...",{font:"16px PixelFont",fill:"#ffffff"})):"TABLET"===setup.displayMode?(this.background=this.add.image(0,0,"background"),this.preloadBar=this.add.image(29,32,"preloaderBar"),this.add.text(29,110,"Loading...",{font:"16px PixelFont",fill:"#ffffff"})):"PORTRAIT"===setup.displayMode&&(this.background=this.add.image(0,0,"background"),this.preloadBar=this.add.image(29,32,"preloaderBar"),this.add.text(29,110,"Loading...",{font:"16px PixelFont",fill:"#ffffff"})),this.load.setPreloadSprite(this.preloadBar),Ananias.loadErrors=[],this.load.onFileError.add(function(e,i){Ananias.loadErrors.push({key:e,file:i})},this),this.load.spritesheet("intro-1","img/intro-1.png",320,150),this.load.spritesheet("intro-2","img/intro-2.png",320,150),this.load.image("intro-map","img/intro-map.png"),this.load.image("intro-serpent","img/snake-intro.png"),this.load.spritesheet("intro-3","img/intro-3.png",320,150),this.load.spritesheet("fire","img/fire.png",37,39),this.load.spritesheet("temple-floor","img/temple-floor.png",32,32),this.load.spritesheet("temple-wall","img/temple-wall.png",32,32),this.load.spritesheet("temple-tombs","img/temple-tombs.png",32,32),this.load.spritesheet("temple-wall-books","img/temple-wall-books.png",32,32),this.load.spritesheet("temple-candles","img/temple-candles.png",32,32),this.load.spritesheet("temple-torch","img/temple-torch.png",32,32),this.load.spritesheet("caverns-floor","img/caverns-floor.png",32,32),this.load.spritesheet("caverns-wall","img/caverns-wall.png",32,32),this.load.spritesheet("caverns-torch","img/caverns-torch.png",32,32),this.load.spritesheet("lagoon-floor","img/lagoon-floor.png",32,32),this.load.spritesheet("lagoon-wall","img/lagoon-water.png",32,32),this.load.spritesheet("lagoon-puddles","img/lagoon-puddles.png",32,32),this.load.spritesheet("crystal-floor","img/crystal-floor.png",32,32),this.load.spritesheet("crystal-wall","img/crystal-wall.png",32,32),this.load.spritesheet("abyss-floor","img/abyss-floor.png",32,32),this.load.spritesheet("abyss-wall","img/abyss-wall.png",32,32),this.load.spritesheet("abyss-corridor","img/abyss-corridor.png",32,32),this.load.spritesheet("abyss-flame","img/abyss-flame.png",32,32),this.load.spritesheet("abyss-floating","img/abyss-floating.png",32,32),this.load.spritesheet("lair-floor","img/lair-floor.png",32,32),this.load.spritesheet("lair-wall","img/lair-wall.png",32,32),this.load.spritesheet("yendor","img/yendor.png",32,32),this.load.spritesheet("intros","img/intros.png",160,64),this.load.spritesheet("animations","img/animations.png",16,16),this.load.spritesheet("explosion","img/explosion.png",64,64),this.load.spritesheet("explosion-acid","img/explosion-acid.png",64,64),this.load.spritesheet("explosion-holy","img/explosion-holy.png",64,64),this.load.spritesheet("explosion-ice","img/explosion-ice.png",64,64),this.load.image("blank","img/blank.png"),this.load.image("dialogMask","img/dialogMask.png"),this.load.image("mapScroll","img/mapScroll.png"),this.load.image("splashImage","img/splashImage.png"),this.load.image("lowerBar","img/lowerBar.png"),"DESKTOP"===setup.displayMode||"HD"===setup.displayMode?(this.load.image("uiOverlay-desktop","img/uiOverlay-desktop.png"),this.load.image("angelsFrame","img/angelsFrame.png"),this.load.image("title","img/title.png"),this.load.spritesheet("title-characters","img/title-characters.png",512,256),this.load.image("dialog","img/dialog-big.png"),this.load.image("dialog-v","img/dialog-big-v.png"),this.load.image("inspectorScroll","img/inspectorScroll-big.png"),this.load.image("logo-big","img/logo-big.png")):"PHONE"===setup.displayMode||"TRAILER"===setup.displayMode?(this.load.image("title-chibi","img/title-chibi.png"),this.load.image("menu-chibi","img/menu-chibi.png"),this.load.image("angelsFrame","img/angelsFrame-small.png"),this.load.spritesheet("horizontalButton48-96","img/hButton48-96.png",96,48),this.load.spritesheet("horizontalButton48-128","img/hButton48-128.png",128,48),this.load.image("dialog","img/dialog.png"),this.load.image("inspectorScroll","img/inspectorScroll.png")):"TABLET"===setup.displayMode?(this.load.image("uiOverlay-landscape","img/uiOverlay-landscape.png"),this.load.image("title-tablet","img/title-tablet.png"),this.load.image("dialog","img/dialog-big.png"),this.load.image("inspectorScroll","img/inspectorScroll-big.png")):"PORTRAIT"===setup.displayMode&&(this.load.image("uiOverlay-portrait","img/uiOverlay-portrait.png"),this.load.image("title-portrait","img/title-portrait.png"),this.load.image("dialog","img/dialog.png"),this.load.image("inspectorScroll","img/inspectorScroll.png")),this.load.image("graveyard","img/graveyard.png"),this.load.image("logo","img/logo.png"),this.load.image("fellowshipClasses","img/fellowshipClasses.png"),this.load.image("cardBground","img/cardBground.png"),this.load.image("dungeonEntrance","img/dungeonEntrance.png"),this.load.image("dungeonEntrance2","img/dungeonEntrance2.png"),this.load.spritesheet("cards64","img/cards64.png",64,64),this.load.spritesheet("bodies-base","img/bodies-base.png",32,32),this.load.spritesheet("portrait-base","img/portrait-base.png",48,48),this.load.spritesheet("bodies-hair","img/bodies-hair.png",32,32),this.load.spritesheet("portrait-hair","img/portrait-hair.png",48,48),this.load.spritesheet("tileset64","img/tileset64.png",64,64),this.load.spritesheet("tileset32","img/tileset.png",32,32),this.load.spritesheet("monsters","img/monsters.png",32,32),this.load.spritesheet("tileset16","img/tileset16.png",16,16),this.load.spritesheet("scratches","img/scratches.png",32,11),this.load.spritesheet("items-detail","img/items-detail.png",32,32),this.load.spritesheet("items-worn","img/items-worn.png",32,32),this.load.spritesheet("items-ground","img/items-ground.png",32,32),this.load.spritesheet("wearables-worn","img/wearables-worn.png",32,32),this.load.spritesheet("wearables-ground","img/wearables-ground.png",32,32),this.load.spritesheet("items-misc","img/items-misc.png",32,32),this.load.spritesheet("items-icons","img/items-icons.png",16,16),this.load.spritesheet("spells","img/spells.png",32,32),this.load.spritesheet("terrain32","img/terrain.png",32,32),this.load.spritesheet("tileset48-96","img/tileset48-96.png",48,96),this.load.spritesheet("misc64-96","img/misc64-96.png",64,96),this.load.spritesheet("misc38","img/misc38.png",38,38),this.load.spritesheet("helpImages","img/helpImages.png",128,128),this.load.spritesheet("animations32","img/animations32.png",32,32),this.load.spritesheet("horizontalButton","img/hButton.png",256,64),this.load.spritesheet("horizontalButton48","img/hButton48.png",192,48),this.load.spritesheet("tileset96","img/tileset96.png",96,96),setup.soundsDisabled||(this.load.audio("sfx-beep","sfx/beep.wav"),this.load.audio("sfx-hit","sfx/hit.wav"),this.load.audio("sfx-potion","sfx/potion.wav"),this.load.audio("sfx-punch","sfx/punch.wav"),this.load.audio("sfx-shoot","sfx/shoot.wav"),this.load.audio("sfx-slash-1","sfx/slash-1.wav"),this.load.audio("sfx-slash-2","sfx/slash-2.wav"),this.load.audio("sfx-slash-3","sfx/slash-3.wav"),this.load.audio("sfx-spell","sfx/spellEnergy.wav"),this.load.audio("sfx-tap","sfx/tap.wav"),this.load.audio("sfx-step","sfx/step.wav"),this.load.audio("sfx-death","sfx/death.wav"),this.load.audio("sfx-break","sfx/break.wav"),this.load.audio("sfx-explosion","sfx/explosion.wav"),this.load.audio("sfx-magic","sfx/spell.wav"))},create:function(){if(this.preloadBar.cropEnabled=!1,"DEV"!==setup.deployType&&Ananias.loadErrors.length>0){for(var e=!0,i=0;i<Ananias.loadErrors.length;i++)if(0!==Ananias.loadErrors[i].key.indexOf("sfx")){e=!1;break}setup.isCocoon||setup.isNode?e?alert("Sound effects could not be loaded. Please try reopening the game."):alert("Some resources could not be loaded. Please try reopening the game."):e?(alert("Sound effects could not be loaded. This often happens because of firewall restrictions when trying to play the browser version. Please download the game from www.ananiasgame.com if you want to play using sounds, or try accessing from a different location."),Ananias.loadErrors=[]):alert("Some resources could not be loaded. This often happens because of firewall restrictions when trying to play the browser version. Please download the game from www.ananiasgame.com, refresh the page or try accessing from a different location.")}this.state.start("Game")}},Ananias.Game=function(e){},Ananias.Game.prototype={create:function(){setup.isDesktop="DESKTOP"===setup.displayMode||"HD"===setup.displayMode,setup.version=Ananias.version,setup.incrementalVersion=Ananias.incrementalVersion;var e=new GameController(this.game,setup);if(e.initialize(),"PROD"===setup.deployType&&Ananias.loadErrors.length>0){for(var i="",s=0;s<Ananias.loadErrors.length;s++)i+="key: "+Ananias.loadErrors[s].key+"\n";e.assetLoadingErrors=!0,i+=e.gatherEnvironmentData(),e.communityClient.mailDevteam("Ananias "+Ananias.version+" Load Error",i)}}},Ananias.version="2.5.1",Ananias.incrementalVersion=200501;

},{"./GameController.class":13,"./Storage.class":33}],4:[function(require,module,exports){
var ArrayUtils={pickRandomElementsFrom:function(r,t){return ArrayUtils.shuffle(r).slice(-t)},trim:function(r,t){return r.slice(0,t)},shuffle:function(r){var t,n,e=r.length;if(e)for(;--e;)t=r[n=Math.floor(Math.random()*(e+1))],r[n]=r[e],r[e]=t;return r}};module.exports=ArrayUtils;

},{}],5:[function(require,module,exports){
module.exports={BITE:"BITE",BLUNT:"BLUNT",PIERCING:"PIERCING",SLASHING:"SLASHING",CHOPPING:"CHOPPING"};

},{}],6:[function(require,module,exports){
var circular=require("circular-functions");function Cell(i,l){this._c=circular.register("Cell"),l&&(this.id=i,this.isSolid=l.isSolid,this.isWall=l.isWall,this.isWallForClearing=l.isWallForClearing,this.isFloor=l.isFloor,this.isDepressed=l.isDepressed,this.tileCount=l.tileCount,this.spriteId=l.spriteId,this.metaSpriteId=l.metaSpriteId,this.tileIndex=l.tileIndex,this.isAnimated=l.isAnimated,this.minimapFill=l.minimapFill,this.paintTop=l.paintTop,this.contrastMinimapFill=l.contrastMinimapFill)}circular.registerClass("Cell",Cell),module.exports=Cell,Cell.prototype={equals:function(i){return i.id==this.id}};

},{"circular-functions":43}],7:[function(require,module,exports){
var Cell=require("./Cell.class");module.exports={FLOOR:new Cell("FLOOR",{isWallForClearing:!0,isFloor:!0,minimapFill:"rgba(170, 136, 52, 1)",contrastMinimapFill:"rgba(104, 84, 31, 1)"}),WALL:new Cell("WALL",{isWallForClearing:!0,isWall:!0,isSolid:!0,minimapFill:"rgba(104, 84, 31, 1)",paintTop:!0}),WALL_BOOK:new Cell("WALL_BOOK",{isWallForClearing:!0,spriteId:"temple-wall-books",tileCount:11,isSolid:!0,minimapFill:"rgba(104, 84, 31, 1)",paintTop:!0}),TORCH:new Cell("TORCH",{isWallForClearing:!0,isSolid:!0,isAnimated:!0,paintTop:!0,minimapFill:"rgba(104, 84, 31, 1)"}),CANDLES:new Cell("CANDLES",{isWallForClearing:!0,isSolid:!0,spriteId:"temple-candles",isAnimated:!0,paintTop:!0,minimapFill:"rgba(104, 84, 31, 1)"}),TOMB:new Cell("TOMB",{isWallForClearing:!0,isSolid:!0,spriteId:"temple-tombs",tileCount:24,paintTop:!0,minimapFill:"rgba(104, 84, 31, 1)"}),CORRIDOR:new Cell("CORRIDOR",{minimapFill:"rgba(170, 136, 52, 1)",contrastMinimapFill:"rgba(104, 84, 31, 1)"}),PUDDLE:new Cell("PUDDLE",{spriteId:"lagoon-puddles",tileCount:24,minimapFill:"rgba(44,106,145, 1)"}),HEALING_POND:new Cell("HEALING_POND",{isSolid:!1,minimapFill:"rgba(44,106,145, 1)"}),STAIRS:new Cell("STAIRS",{metaSpriteId:"stairs",minimapFill:"rgba(255, 0, 0, 1)"}),DOOR:new Cell("DOOR",{isSolid:!1,minimapFill:"rgba(170, 136, 52, 1)",contrastMinimapFill:"rgba(0, 0, 0, 1)"}),ITEM:new Cell("ITEM",{minimapFill:"rgba(255, 255, 0, 1)"}),VOID:new Cell("VOID",{isSolid:!0,spriteId:"blank"}),LAGOON:new Cell("LAGOON",{isWallForClearing:!1,isWall:!0,isSolid:!0,isDepressed:!0,paintTop:!0}),POOL1_1:new Cell("POOL1_1",{spriteId:"terrain32",tileIndex:0,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL1_2:new Cell("POOL1_2",{spriteId:"terrain32",tileIndex:1,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL1_3:new Cell("POOL1_3",{spriteId:"terrain32",tileIndex:2,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_4:new Cell("POOL_4",{spriteId:"terrain32",tileIndex:3,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_6:new Cell("POOL_6",{spriteId:"terrain32",tileIndex:4,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_7:new Cell("POOL_7",{spriteId:"terrain32",tileIndex:5,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_8:new Cell("POOL_8",{spriteId:"terrain32",tileIndex:6,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_9:new Cell("POOL_9",{spriteId:"terrain32",tileIndex:7,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL2_1:new Cell("POOL2_1",{spriteId:"terrain32",tileIndex:8,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL2_2_1:new Cell("POOL2_2_1",{spriteId:"terrain32",tileIndex:9,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL2_2_2:new Cell("POOL2_2_2",{spriteId:"terrain32",tileIndex:10,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL2_3:new Cell("POOL2_3",{spriteId:"terrain32",tileIndex:11,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_5_1:new Cell("POOL_5_1",{spriteId:"terrain32",tileIndex:12,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_5_2:new Cell("POOL_5_2",{spriteId:"terrain32",tileIndex:13,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),POOL_5_3:new Cell("POOL_5_3",{spriteId:"terrain32",tileIndex:14,isSolid:!0,isDepressed:!0,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_1:new Cell("PUDDLE_1",{spriteId:"terrain32",tileIndex:16,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_2:new Cell("PUDDLE_2",{spriteId:"terrain32",tileIndex:17,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_3:new Cell("PUDDLE_3",{spriteId:"terrain32",tileIndex:18,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_4:new Cell("PUDDLE_4",{spriteId:"terrain32",tileIndex:19,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_6:new Cell("PUDDLE_6",{spriteId:"terrain32",tileIndex:20,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_7:new Cell("PUDDLE_7",{spriteId:"terrain32",tileIndex:21,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_8:new Cell("PUDDLE_8",{spriteId:"terrain32",tileIndex:22,minimapFill:"rgba(44,106,145, 1)"}),PUDDLE_9:new Cell("PUDDLE_9",{spriteId:"terrain32",tileIndex:23,minimapFill:"rgba(44,106,145, 1)"}),getDescription:function(e,i){switch(e){case"temple-wall":if(i>=72&&i<80)return"This wall is stained with blood.";break;case"crystal-wall":return i%8>=2&&(i%8!=6||i>32)?"There are huge green crystals embedded into the rock here.":"This rock has some tiny green crystals on it.";case"lair-wall":return"This wall is soft to the touch, it feels like you are inside a living being.";case"temple-tombs":return i>=6&&i<=8||15==i?"There are some ages old bones in this open crypt.":1==i||5==i?"There's a hole in the walls here.":0!=i&&4!=i&&(i>=18&&i<=20?"There is a heavy stone coffin in this tomb":3==i?"This tomb has been sealed with bricks.":"This tomb is empty.");case"temple-wall-books":return"There are some ancient books and scrolls here.";case"temple-candles":return"There are some lit candles in this tomb.";case"terrain32":if(i<=14)return"A pool of water, you don't dare jumping on it.";if(i>=48&&i<=57)return"A huge boulder, you cannot move it.";switch(i){case 71:return"A hot furnace shining with fiery heat.";case 74:return"This furnance fire has been extinguished long ago.";case 80:case 81:case 82:return"An addorned tombstone without any writings.";case 83:case 84:case 85:return"A ruined tombstone.";case 86:case 87:return"A massive addorned cube of stone.";case 88:return"An empty well.";case 89:return"This looks like an altar for arcane rituals.";case 90:return"This looks like an altar for arcane rituals, it's covered in blood.";case 96:return"An empty bookshelf.";case 97:case 100:return"There are some parchments in this bookshelf.";case 98:case 99:case 102:case 103:return"This bookshelf is ruined";case 101:return"There are some ancient books in this bookshelf";case 104:case 105:return"A plain wooden table.";case 106:case 107:case 108:return"Looks like a denizen of the place was having dinner here.";case 109:case 110:return"A ruined table.";case 111:return"There is a full alchemy set in this table."}}return!1},activateFlameSprite:function(e,i){e.animations.add("shine"),e.animations.play("shine",8,!0),e.inputEnabled=!0,e.examineText="This magic purple flame floats over a stone pedestal.",e.events.onInputDown.add(i.examineFeatureBridge,i)}};

},{"./Cell.class":6}],8:[function(require,module,exports){
var Util=require("./Util"),md5=require("md5");function CommunityClient(e){this.gameController=e,this.apiPath="http://games.slashware.net:3000/ananias/",this.socketEndpoint="http://games.slashware.net:3001/"}CommunityClient.prototype={isEnabled:function(){return this.token},newLevelEvent:function(e,t,s){var n="",o="%(playerName)s's "+e+" "+(n="string"==typeof t?"enters the "+t:"reaches level "+t);s<10?o="%(playerName)s's "+e+" painfully "+n:s<30&&(o="%(playerName)s's "+e+" barely "+n),this._sendEvent("newLevel",o)},getDescription:function(e){if(0==e.length)return"";var t="a";switch(e.charAt(0)){case"a":case"A":case"e":case"E":case"i":case"I":case"o":case"O":case"u":case"U":t+="n"}return t+" "+e},deathEvent:function(e,t,s){var n="%(playerName)s's "+e+" was killed by "+this.getDescription(s)+" at level "+t;this._sendEvent("died",n)},deathEventAccident:function(e,t,s){var n="%(playerName)s's "+e+" died by "+s+" at level "+t;this._sendEvent("died",n)},winEvent:function(e){var t="%(playerName)s's "+e+" recovered the ring of Ananias!";this._sendEvent("won",t)},killEvent:function(e,t){var s="%(playerName)s's "+e+" killed "+this.getDescription(t);this._sendEvent("kill",s)},itemEvent:function(e,t){var s="%(playerName)s's "+e+" got "+this.getDescription(t);this._sendEvent("item",s)},playerEvent:function(e,t){var s="%(playerName)s"+t;this._sendEvent(e,s)},_sendEvent:function(e,t){if(this.gameController.logEvent(e+" "+t),this.isEnabled()){var s={token:this.token,type:e,text:t};this._socketEmit("event",s)}},consumeMessages:function(e){this.isEnabled()||callback([]),this._doRequest("GET","messages?token="+this.token,e)},startGame:function(){if(this.isEnabled()){var e=this.gameController;e.gameOn=!1,this._doRequest("POST","startGame/?token="+this.token,!1,function(t,s){e.gameOn=!0,e.popMessage()})}},saveScore:function(e){e.gameVersion=this.gameController.version+"",e.hash=this.getHash(e),this._doRequest("POST","score?token="+this.token,!1,!1,e)},recoverPassword:function(e,t){var s={email:e};this._doRequest("POST","recoverPassword",t,!1,s)},shareCharacter:function(e,t){for(var s=0,n=0;n<e.stats.perLevel.length;n++)e.stats.perLevel[n].exploredRooms==e.stats.perLevel[n].totalRooms&&s++;e.stats.exploredLevelsCompletely=s;var o=[];for(var a in e.stats.killMap)o.push({count:e.stats.killMap[a],raceName:this.gameController.monsterFactory.getRace(a).name});var i={playerClass:e.className,gender:e.isMale?"male":"female",level:e.powerLevel,depth:e.gameController.depth,deathCause:e.deathReason,conducts:Util.toArray(e.stats.conducts),gameTime:e.stats.gameplaySeconds,killedTotal:e.kills,deathsByRace:o,passiveSkills:e.getPassiveSkillsList(),combatSkill:e.attack.current,magicSkill:e.magicPower.current,hits:e.stats.hits,misses:e.stats.misses,exploredLevelsCompletely:e.stats.exploredLevelsCompletely,hardcoreMode:e.hardcoreMode,clientVersion:this.gameController.version,playerName:e.characterName};i.hash=this.getPlayerHash(i),this._doRequest("POST","mortem?token="+this.token,t,!1,i)},getStatus:function(e){this._doRequest("GET","status",e,!1,!1,!0)},tryAutoLogin:function(e,t){var s={loginKey:e.loginKey};this._doRequest("POST","authToken/"+e.username,t,function(e,t){e.token=t.token,e.playerPIN=t.pin,e._socketEmit("register",t.name)},s,!0)},mailDevteam:function(e,t){this._doRequest("POST","mailDevTeam?secret=chocobrownieMini",!1,!1,{subject:e,message:t},!0)},signup:function(e,t){this._doRequest("POST","player",t,function(e,t){e.token=t.token,e.playerPIN=t.pin,e._socketEmit("register",t.name)},e)},addStatueToPlayer:function(e,t){this._doRequest("POST","statue?token="+this.token,!1,!1,{hash:this.generateStatueHash(e,this.token),statueIndex:e,gameVersion:this.gameController.version})},getScores:function(e,t,s,n){this._doRequest("GET","scores?type="+e+"&version="+t+"&token="+this.token+"&hardcoreMode="+s,n)},getStatues:function(e){this._doRequest("GET","statues?&token="+this.token,e)},connect:function(e,t,s){this._doRequest("POST","authToken/"+e,s,function(e,t){e.token=t.token,e.playerPIN=t.pin,e._socketEmit("register",t.name)},t)},logout:function(e){this._doRequest("DELETE","authToken/?token="+this.token,e,function(e,t){e.token=!1,e.playerPIN=!1,e._socketEmit("unregister")})},getPlayerInfo:function(e,t){this._doRequest("GET","player/"+e,t)},getProfile:function(e){this._doRequest("GET","profile/?token="+this.token,e)},addFriend:function(e,t){this._doRequest("POST","friendship/"+e+"?token="+this.token,t)},_connect:function(){var e;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new window.ActiveXObject("Microsoft.XMLHTTP")),e},_socketEmit:function(e,t){if(!this.socket){this.socket=io(this.socketEndpoint);var s=this.gameController;this.socket.on("event",function(e){s.messagesStack.push(e)})}this.socket.emit(e,t)},_doRequest:function(e,t,s,n,o,a){var i=this,r=this._connect();r.onreadystatechange=function(){if(4==r.readyState){a||i._hidePleaseWait();try{if(0==r.status)a||i.gameController.alert("Unable to connect to game server, please check your internet connection.","Error"),s&&s.error();else if(500!=r.status&&r.responseText&&""!=r.responseText.trim()){var e=r.responseText,t=JSON.parse(e);t.success?(n&&n(i,t),s&&s.ok(t)):(console.log(t),i.gameController.alert(t.statusMessage,"Error"),s&&s.error())}else a||i.gameController.alert("Something is not working in Ananias servers, we are probably fixing it right now.","Whoops!"),s&&s.error()}catch(e){i.gameController.alert("Something is not working in Ananias servers, we are probably fixing it right now.","Whoops!"),s&&s.error()}}},r.open(e,this.apiPath+t,!0),r.timeout=1e4,r.setRequestHeader("Content-Type","application/json"),a||this._showPleaseWait();try{o?r.send(JSON.stringify(o)):r.send()}catch(e){a||this._hidePleaseWait(),i.gameController.alert("Something is not working in Ananias servers, we are probably fixing it right now.","Whoops!"),console.log(e),s&&s.error()}},getHash:function(e){var t=e.className+"-"+e.characterSex+"-"+e.depth+"-"+e.kills+"-"+e.won+"-"+e.gameVersion+"galletaConMiel"+(e.hardcoreMode?"hardcore":"normal");return this._generateHashFromString(t)},getPlayerHash:function(e){var t="";t+=e.playerClass+"-",t+=e.gender+"-",t+=e.level+"-",t+=e.depth+"-",t+=e.deathCause+"-";for(var s=0;s<e.conducts.length;s++)t+=e.conducts[s].key+"-"+e.conducts[s].value+"-";t+=e.gameTime+"-",t+=e.killedTotal+"-";for(s=0;s<e.deathsByRace.length;s++)t+=e.deathsByRace[s].key+"-"+e.deathsByRace[s].value+"-";for(s=0;s<e.passiveSkills.length;s++)t+=e.passiveSkills[s]+"-";return t+=e.combatSkill+"-",t+=e.magicSkill+"-",t+=e.hits+"-",t+=e.misses+"-",t+=e.playerName+"-",t+=e.exploredLevelsCompletely+"-",t+=e.clientVersion+"-",t+="somedayIllFinishExpedition",t+=e.hardcoreMode?"hardcore":"normal",this._generateHashFromString(t)},generateStatueHash:function(e,t){var s=13*e+"-j"+2*e+"-ys-"+t;return this._generateHashFromString(s)},_generateHashFromString:function(e){return md5(e)},_showPleaseWait:function(){this.gameController.dialog.show("Please wait","Obtaining information from Server",[],!1)},_hidePleaseWait:function(){this.gameController.dialog.hide()}},module.exports=CommunityClient;

},{"./Util":36,"md5":47}],9:[function(require,module,exports){
var circular=require("circular-functions");function DungeonBuilder(e,t){this.preLevel=null,this.mask=null,this.preLevelB=null,this.maskB=null,this.corridorTip=null,this.monsterFactory=e,this.itemFactory=t,this.npcBuilder=new NPCBuilder}module.exports=DungeonBuilder;var Level=require("./Level.class.js"),NPCBuilder=require("./NPCBuilder.class.js"),Room=require("./Room.class.js"),CellType=require("./CellType.enum"),Util=require("./Util.js");DungeonBuilder.prototype.createLevel=function(e,t){this.player=t,this.gameController=t.gameController;var r="",i=this.gameController.ui.levelGen.baseRooms;r=e>25?"YENDOR":e>20?"ABYSS":e>16?"LAIR":e>12?"CRYSTAL":e>8?"LAGOON":e>4?"CAVERNS":e>1?"TEMPLE":"CAVERNS",i+=chance(50)?1:-1;for(var o=null;!o;)o=this.generateMap(i,48,48,!0,r,e);for(this.addNPCs(e);;){var a=randomElementOf(this.level.rooms);if(!a.isDungeonEntrance){var s=a.getFreePlace();if(s){a.addItem(this.itemFactory.getRune(),s);break}}}this.itemFactory.calculateRarityOffsets(e);var n=this.addCritters(e);return e<=25&&(this.addItems(e,n),this.addItemToEmptyRooms()),o.isWallLess="ABYSS"==r||"LAGOON"==r,o.isRetro="YENDOR"==r,o},DungeonBuilder.prototype.addItemToEmptyRooms=function(){for(var e=0;e<this.level.rooms.length;e++){var t=this.level.rooms[e];if(1==t.portals.length&&!t.hasPond&&0==t.items.length&&t.monsters.length>0){var r=t.getFreePlace();r&&t.addItem(this.itemFactory.getAnItem(),r)}}},DungeonBuilder.prototype.addNPCs=function(e){for(var t=this.npcBuilder.getLevelNPCs(e),r=0;r<t.length;r++){for(var i=t[r],o=randomElementOf(this.level.rooms);o.boss||o.isStart;)o=randomElementOf(this.level.rooms);var a=o.getFreePlace();o.hasNPC=!0;var s=this.monsterFactory.createMonster(this.player,i.race,e,!0);s.isNPC=!0,o.addEnemy(s,a);for(var n=0;n<i.spawns.length;n++)if(i.spawns[n].level==e){s.npcInfo=i.spawns[n],s.npcInfo._c=circular.setSafe();break}s.npcInfo.name=i.name,s.stayInRoom=!i.followPlayer}},DungeonBuilder.prototype.addCritters=function(e){var t=chance(80),r=0,i=rand(10,15)+Math.floor(e/2);this.gameController.player.hardcoreMode&&(i*=2);var o=null;o=e<26?this.monsterFactory.getEcosystem(e):this.monsterFactory.getOpenEcosystem();for(var a=0;a<i;a++){var s=randomElementOf(this.level.rooms);if(s.hasNPC||s.isDungeonEntrance)a--;else{var n=s.getFreePlace();if(s.isStart)if(distance(s.startingPosition.x,s.startingPosition.y,n.x,n.y)<4){a--;continue}var l=randomElementOf(o);if(e<26&&chance(5)){var h=e+rand(2,6);h>25&&(h=25),l=randomElementOf(this.monsterFactory.getEcosystem(h))}if(this.monsterFactory.canCreate(this.player,l,t)){var y=this.monsterFactory.createMonster(this.player,l,e,!1);if(y.race.features.unique&&(t=!1),s.addEnemy(y,n),y.race.features.guardItems&&!s.getItem(n.x,n.y)&&(s.addItem(this.itemFactory.getAnItem(),n,!0),r++),y.race.features.packGenerated&&!s.isStart)for(var d=rand(1,2),c=0;c<d;c++)s.addEnemy(this.monsterFactory.createMonster(this.player,l,e,!1))}else a--}}var m=null;if(25==e?m="SLASH":20==e?m="DEMON_GUARDIAN":16==e?m="OPHIDIAN_GUARDIAN":12==e?m="MERMAID_QUEEN":8==e?m="LIZARD":4==e&&(m="RAT_DEMON"),null==m){for(a=0;a<o.length;a++)if(this.monsterFactory.getRace(o[a]).features.guardExit){this.exitRoom.addEnemy(this.monsterFactory.createMonster(this.player,o[a],e,!1),this.exitRoom.exit);break}}else{m=this.monsterFactory.createMonster(this.player,m,e,!1);this.exitRoom.addEnemy(m,this.exitRoom.exit),this.exitRoom.boss=m}return r},DungeonBuilder.prototype.addItems=function(e,t){t||(t=0);var r=rand(4,6);(r-=t)<0&&(r=0);for(var i=0;i<r;i++){if((a=randomElementOf(this.level.rooms)).isDungeonEntrance)i--;else(s=a.getFreePlace())&&a.addItem(this.itemFactory.getAnItem(),s)}var o=rand(0,2);for(i=0;i<2+o;i++){var a,s;(s=(a=randomElementOf(this.level.rooms)).getFreePlace())&&a.addItem(this.itemFactory.getAnItem("organicItem"),s,!0)}if(s=(a=randomElementOf(this.level.rooms)).getFreePlace()){var n=this.itemFactory.getAnItem("spawnedAmmo");n&&(n.quantity=rand(3,6),a.addItem(n,s,!0))}},DungeonBuilder.prototype._getLevelSpecs=function(e){var t={consecutiveCorridors:{min:1,max:2},corridorSize:{min:2,max:5}};return"CAVERNS"!==e&&"CRYSTAL"!==e&&"LAGOON"!==e||(t.corridorSize={min:2,max:3},t.consecutiveCorridors={min:1,max:1},t.isCaveRooms=!0),t},DungeonBuilder.prototype._getRoomSpecs=function(e){var t={};t.maxWidth=this.gameController.ui.levelGen.roomBounds.width,t.maxHeight=this.gameController.ui.levelGen.roomBounds.height,this.shrinkRooms>0&&(t.maxWidth-=this.shrinkRooms,t.maxHeight-=this.shrinkRooms),t.minWidth=t.maxWidth-2,t.minHeight=t.maxHeight-2,t.minWidth<5&&(t.minWidth=5),t.minHeight<5&&(t.minHeight=5),t.maxWidth<t.minWidth&&(t.maxWidth=t.minWidth),t.maxHeight<t.minHeight&&(t.maxHeight=t.minHeight);var r="CAVERNS"===e||"CRYSTAL"===e||"LAGOON"===e,i="TEMPLE"===e||"CAVERNS"===e||"CRYSTAL"===e&&chance(10);if(t.isCircle=chance(20),t.wallTile=CellType.WALL,t.cleanRoom=!0,chance(r?70:30)?(t.type="CAVE",t.addCrosses=!0):t.type="BASIC_ROOM","TEMPLE"===e||"LAIR"===e||("ABYSS"===e?(t.isCircle=!1,t.cleanRoom=!1,t.type="BASIC_ROOM",t.addCrosses=!1):"LAGOON"===e&&(t.wallTile=CellType.LAGOON,t.cleanRoom=!1)),i&&("TEMPLE"===e&&chance(20)&&(t.addPuddle=!0),"BASIC_ROOM"===t.type&&!t.isCircle)){if(chance(70))switch(rand(0,4)){case 0:t.addColumns=!0;break;case 1:t.addPool=!0;break;case 2:t.library=!0;break;case 3:t.forge=!0;break;case 4:t.graveyard=!0,t.addPuddle=!1}"TEMPLE"!==e&&(t.addColumns=!1,t.addPool=!1)}return t},DungeonBuilder.prototype._getEntranceRoomSpecs=function(){var e={};return e.minWidth=this.gameController.ui.levelGen.roomBounds.width,e.maxWidth=this.gameController.ui.levelGen.roomBounds.width,e.minHeight=this.gameController.ui.levelGen.roomBounds.height,e.maxHeight=this.gameController.ui.levelGen.roomBounds.height,e.isCircle=!1,e.wallTile=CellType.WALL,e.cleanRoom=!0,e.type="BASIC_ROOM",e.northExit=!0,e.dungeonEntrance=!0,e},DungeonBuilder.prototype.generateMap=function(e,t,r,i,o,a){this.level=new Level;var s,n=e;this.preLevel=new Array(t),this.mask=new Array(t),this.preLevelB=new Array(t),this.maskB=new Array(t),this.shrinkRooms=0,this.shrinkRoomsTolerance=2;for(var l=!1,h=!1,y=0,d=this._getLevelSpecs(o),c=!1;!l;){for(var m=0;m<t;m++)for(var u=0;u<r;u++)this.preLevel[m]||(this.preLevel[m]=new Array,this.mask[m]=new Array),this.preLevel[m][u]=CellType.WALL,this.mask[m][u]=!1;if(1===a){var x={x:this.getLevelWidth()/2-Math.floor(this.gameController.ui.levelGen.roomBounds.width/2),y:this.getLevelHeight()-this.gameController.ui.levelGen.roomBounds.height-2},p=this._getEntranceRoomSpecs(o),f=this.gameController.ui.levelGen.roomBounds.width%2==0?this.gameController.ui.levelGen.roomBounds.width-1:this.gameController.ui.levelGen.roomBounds.width;(c=this.carveRoom(x,"UP",f+4,this.gameController.ui.levelGen.roomBounds.height-1,o,p)).startingPosition={_c:circular.setSafe(),x:Math.ceil(this.gameController.ui.levelGen.roomBounds.width/2)+1,y:3},c.isBorderless=!0,c.isDungeonEntrance=!0,l=!0}else{x={x:this.getLevelWidth()/2,y:this.getLevelHeight()/2};for(var v=0,g=!1;!h;){v=randomElementOf(DIRECTIONS);p=this._getRoomSpecs(o);var C=rand(p.minWidth,p.maxWidth),O=rand(p.minHeight,p.maxHeight);if(p.isCircle)(S=Util.lesser(C,O))%2==0&&S--,O=S,C=S;if(this.carveRoom(x,v,C,O,o,p))0===--n&&(g=!0),l=!0,h=!0;else if(++y>50)return y=0,!1}}h=!1,this.save();for(var L=!1,T=0,R=null;!g;){(null==R||d.isCaveRooms||R.hotspots.length<5||chance(10))&&(R=randomElementOf(this.level.rooms));for(var k=x=randomElementOf(R.hotspots),E=rand(d.consecutiveCorridors.min,d.consecutiveCorridors.max),A=0;A<E&&!L;){var B=rand(d.corridorSize.min,d.corridorSize.max);if((v=x.direction)||(v=randomElementOf(DIRECTIONS)),this.carveCorridor(x,v,B))A++,x=this.corridorTip;else{if(++T>2e3)return!1;L=!0}}if(L)this.rollBack(),L=!1;else{var S;p=this._getRoomSpecs(o),C=rand(p.minWidth,p.maxWidth),O=rand(p.minHeight,p.maxHeight);if(this.gameController.ui.levelGen.dontShrink||C!==p.maxWidth&&O!==p.maxHeight||(this.shrinkRoomsTolerance--,0===this.shrinkRoomsTolerance&&(this.shrinkRoomsTolerance=2,this.shrinkRooms++)),p.isCircle)(S=Util.lesser(C,O))%2==0&&S--,O=S,C=S;var P=x,D=o;chance(50)&&1==a&&(D="TEMPLE");var b=this.carveRoom(x,v,C,O,D,p);if(b)this.save(),0===--n&&(g=!0,l=!0),h=!0,this.linkRooms(R,k,b,P);else if(this.rollBack(),++y>100)return y=0,!1;h=!1}}}s=this.preLevel;var I={x:0,y:0},w={x:0,y:0};if(i)for(;;){c||(c=randomElementOf(this.level.rooms));var _=randomElementOf(this.level.rooms);if(!(distance(c.x,c.y,_.x,_.y)<t/4)&&(I=c.getFreePlace(),w=_.getFreePlace(),I&&w)){s[w.x+_.x][w.y+_.y]=CellType.STAIRS,c.isStart=!0,c.startingPosition||(c.startingPosition={_c:circular.setSafe(),x:I.x,y:I.y}),_.isExit=!0,_.exit={_c:circular.setSafe(),x:w.x,y:w.y},_.map[_.exit.x][_.exit.y]=CellType.STAIRS,_.removeGarbage(_.exit.x,_.exit.y),this.entranceRoom=c,this.exitRoom=_;break}}else for(;;){if(I=(R=randomElementOf(this.level.rooms)).getFreePlace()){R.isStart=!0,R.startingPosition={_c:circular.setSafe(),x:I.x,y:I.y},this.entranceRoom=R;break}}for(y=0;y<this.level.rooms.length;y++)this.level.rooms[y].cleanRoom&&this._cleanRoom(this.level.rooms[y]);var M=t+1,F=r+1,W=-1,N=-1;for(m=0;m<t;m++)for(u=0;u<r;u++)this.preLevel[m][u].equals(CellType.WALL)||(m>W&&(W=m),u>N&&(N=u),m<M&&(M=m),u<F&&(F=u));return this.level.map=this.preLevel,this.level.environment=o,this.level.bounds={_c:circular.setSafe(),x:{from:M,to:W,range:W-M},y:{from:F,to:N,range:N-F}},this.level},DungeonBuilder.prototype._cleanRoom=function(e){for(var t=e.x;t<e.x+e.width;t++)for(var r=e.y;r<e.y+e.height;r++){var i=t-e.x,o=r-e.y;e.map[i][o].equals(CellType.WALL)&&i>0&&o>0&&i<e.width-1&&o<e.height-1&&0==this._getWallTilesAround(e,i,o)&&(this.preLevel[t][r]=CellType.FLOOR,e.map[t-e.x][r-e.y]=CellType.FLOOR)}for(t=e.x;t<e.x+e.width;t++)for(r=e.y;r<e.y+e.height;r++){i=t-e.x,o=r-e.y;e.map[i][o].isWallForClearing&&0==this._getFloorTilesAround(e,i,o)&&(this.preLevel[t][r]=CellType.VOID,e.map[t-e.x][r-e.y]=CellType.VOID)}},DungeonBuilder.prototype.getLevelWidth=function(){return this.preLevel.length},DungeonBuilder.prototype.getLevelHeight=function(){return this.preLevel[0].length},DungeonBuilder.prototype.isValid=function(e,t){return e>0&&t>0&&e<this.getLevelWidth()&&t<this.getLevelHeight()},DungeonBuilder.prototype.printMap=function(){console.log("Map");for(var e=0;e<this.getLevelHeight();e++){for(var t="",r=0;r<this.getLevelWidth();r++)t+=this.preLevel[r][e].isWall?"#":".";console.log(e+":"+t)}console.log("Mask");for(e=0;e<this.getLevelHeight();e++){for(t="",r=0;r<this.getLevelWidth();r++)t+=this.mask[r][e]?"*":"-";console.log(e+":"+t)}},DungeonBuilder.prototype.carveRoom=function(e,t,r,i,o,a){var s=a.isCircle,n=0,l={x:0,y:0};switch(t){case"UP":n=s?Math.floor(r/2):rand(1,r-2),l.x=e.x-n,l.y=e.y-i+1;break;case"DOWN":n=s?Math.floor(r/2):rand(1,r-2),l.x=e.x-n,l.y=e.y;break;case"LEFT":n=s?Math.floor(i/2):rand(1,i-2),l.x=e.x-r+1,l.y=e.y-n;break;case"RIGHT":n=s?Math.floor(i/2):rand(1,i-2),l.x=e.x,l.y=e.y-n}a.northExit&&(l.x=e.x,l.y=e.y);for(var h=l.x;h<l.x+r;h++)for(var y=l.y;y<l.y+i;y++)if(!this.isValid(h,y)||this.mask[h][y])return!1;var d=null;if("BASIC_ROOM"==a.type?d=this.carveBasicRoom(l,r,i,o,a):"CAVE"==a.type&&(d=this.carveCave(e,l,r,i,o,a)),!this.level.hasPond&&chance(1)&&"YENDOR"!=o){var c=d.getFreePlace();c&&(d.map[c.x][c.y]=CellType.HEALING_POND,d.pondPosition={_c:circular.setSafe(),x:c.x,y:c.y},d.removeGarbage(c.x,c.y),d.hasPond=!0,this.level.hasPond=!0)}return d.environmentSubset||(d.environmentSubset=rand(0,4)),a.graveyard&&(d.environmentSubset=5),this.level.addRoom(d),d.cleanRoom=a.cleanRoom,d.environment=o,d},DungeonBuilder.prototype.carveFixedRoom=function(e,t,r,i,o,a){var s=a.isCircle,n=0,l={x:0,y:0};switch(t){case"UP":n=s?Math.floor(r/2):rand(1,r-2),l.x=e.x-n,l.y=e.y-i+1;break;case"DOWN":n=s?Math.floor(r/2):rand(1,r-2),l.x=e.x-n,l.y=e.y;break;case"LEFT":n=s?Math.floor(i/2):rand(1,i-2),l.x=e.x-r+1,l.y=e.y-n;break;case"RIGHT":n=s?Math.floor(i/2):rand(1,i-2),l.x=e.x,l.y=e.y-n}a.northExit&&(l.x=e.x,l.y=e.y);for(var h=l.x;h<l.x+r;h++)for(var y=l.y;y<l.y+i;y++)if(!this.isValid(h,y)||this.mask[h][y])return!1;var d=this.carveTestRoom(e,l,r,i,o,a);return d.environmentSubset||(d.environmentSubset=rand(0,4)),this.level.addRoom(d),d.cleanRoom=!0,d.environment=o,d},DungeonBuilder.prototype.carveTestRoom=function(e,t,r,i,o,a){var s=new Room;s.x=t.x,s.y=t.y;var n=new Array;a.northExit&&s.hotspots.push({x:t.x+Math.floor(r/2),y:t.y,direction:"UP"});for(var l=t.x;l<t.x+r;l++){n[l-t.x]=new Array;for(var h=t.y;h<t.y+i;h++){if(this.mask[l][h]=!0,l==t.x||l==t.x+r-1||h==t.y||h==t.y+i-1){if(l>t.x+1&&l<t.x+r-2||h>t.y+1&&h<t.y+i-2){var y=null;l==t.x?y="LEFT":l==t.x+r-1?y="RIGHT":h==t.y?y="UP":h==t.y+i-1&&(y="DOWN"),a.northExit||s.hotspots.push({x:l,y:h,direction:y})}n[l-t.x][h-t.y]=CellType.WALL}else this.preLevel[l][h]=CellType.FLOOR,n[l-t.x][h-t.y]=CellType.FLOOR}}for(var d=rand(3,10),c=0;c<d;c++){var m=rand(1,r-1),u=rand(1,i-2);n[m][u]=CellType.WALL,n[m][u+1]=CellType.WALL}return s.setMap(n),s},DungeonBuilder.prototype.carveBasicRoom=function(e,t,r,i,o){var a=o.isCircle,s=(o.addColumns,new Room);s.x=e.x,s.y=e.y;var n=new Array,l=0;a&&(l=Math.floor(t/2),s.hotspots.push({x:e.x,y:e.y+l,direction:"LEFT"}),s.hotspots.push({x:e.x+t-1,y:e.y+l,direction:"RIGHT"}),s.hotspots.push({x:e.x+l,y:e.y,direction:"UP"}),s.hotspots.push({x:e.x+l,y:e.y+r-1,direction:"DOWN"})),o.northExit&&s.hotspots.push({x:e.x+Math.floor(t/2),y:e.y,direction:"UP"});for(var h=e.x;h<e.x+t;h++){n[h-e.x]=new Array;for(var y=e.y;y<e.y+r;y++){this.mask[h][y]=!0;var d=!1,c=!1;if(a){var m=distance(h,y,e.x+l,e.y+l);m>=l+1?c=!0:Math.round(m)>=l&&(d=!0)}else d=h==e.x||h==e.x+t-1||y==e.y||y==e.y+r-1;if(d){if(!a&&(h>e.x+1&&h<e.x+t-2||y>e.y+1&&y<e.y+r-2)){var u=null;h==e.x?u="LEFT":h==e.x+t-1?u="RIGHT":y==e.y?u="UP":y==e.y+r-1&&(u="DOWN"),o.northExit||s.hotspots.push({x:h,y:y,direction:u})}n[h-e.x][y-e.y]=CellType.WALL,"TEMPLE"===i?o.library?chance(20)?n[h-e.x][y-e.y]=CellType.WALL_BOOK:chance(10)&&(n[h-e.x][y-e.y]=CellType.TORCH):o.graveyard?chance(30)?n[h-e.x][y-e.y]=CellType.TOMB:chance(10)&&(n[h-e.x][y-e.y]=CellType.TORCH):chance(5)?n[h-e.x][y-e.y]=CellType.TORCH:chance(5)&&(n[h-e.x][y-e.y]=CellType.CANDLES):"CAVERNS"===i?chance(5)&&(n[h-e.x][y-e.y]=CellType.TORCH):"ABYSS"===i&&(n[h-e.x][y-e.y]=CellType.VOID)}else c?(this.preLevel[h][y]=CellType.WALL,n[h-e.x][y-e.y]=CellType.WALL):(this.preLevel[h][y]=CellType.FLOOR,n[h-e.x][y-e.y]=CellType.FLOOR)}}if("TEMPLE"===i&&t>5&&r>5&&(o.addPool||o.addPuddle)){var x={};x.width=rand(2,t-4),x.width<2&&(x.width=2),x.height=rand(2,r-4),x.height<2&&(x.height=2),x.x=2+rand(0,t-x.width-4),x.y=2+rand(0,r-x.height-4),o.addPool?this._renderPool(n,x):(this._renderPuddle(n,x),s.environmentSubset=4)}if(!o.dungeonEntrance)for(h=e.x;h<e.x+t;h++)for(y=e.y;y<e.y+r;y++)if(!n[h-e.x][y-e.y].isSolid&&("TEMPLE"===i&&chance(10)&&s.addGarbage(h-e.x,y-e.y,rand(0,5)),!a&&h>e.x+1&&h<e.x+t-2&&y>e.y+1&&y<e.y+r-2))if(o.addColumns&&y>e.y+2&&chance(20)&&s.addColumn(h-e.x,y-e.y),o.library){if(chance(80)&&y%2==1){var p=!1;chance(50)&&(p=this.getSpecialBookDescription()),s.addObstacle(h-e.x,y-e.y,96+rand(0,7),"bookshelf",!0,p)}}else if(o.forge)!s.hasFurnace&&chance(10)&&(chance(50)?s.addObstacle(h-e.x,y-e.y,[71,72,73,72],"furnace",!1):s.addObstacle(h-e.x,y-e.y,74,"furnace",!1),s.hasFurnace=!0);else if(o.graveyard){if(chance(40))switch(rand(0,2)){case 0:var f=this.getSpecialTombDescription();s.addObstacle(h-e.x,y-e.y,80+rand(0,5),"tomb",!1,f);break;case 1:s.hasMonument||(s.addObstacle(h-e.x,y-e.y,86+rand(0,1),"monument",!0),s.hasMonument=!0);break;case 2:s.hasAltar||(s.addObstacle(h-e.x,y-e.y,89+rand(0,1),"altar",!1),s.hasAltar=!0)}}else{if("TEMPLE"===i){if(chance(10))switch(rand(0,2)){case 0:s.addObstacle(h-e.x,y-e.y,48+rand(0,9),"boulder",!1);break;case 1:s.addObstacle(h-e.x,y-e.y,104+rand(0,7),"table",!1);break;case 2:s.hasWell?s.addObstacle(h-e.x,y-e.y,48+rand(0,9),"boulder",!1):(s.addObstacle(h-e.x,y-e.y,88,"well",!1),s.hasWell=!0)}}else"CAVERNS"!=i&&"CRYSTAL"!=i&&"LAGOON"!=i||chance(10)&&s.addObstacle(h-e.x,y-e.y,48+rand(0,9),"boulder",!1)}return s.setMap(n),s},DungeonBuilder.prototype.carveCave=function(e,t,r,i,o,a){var s=a.wallTile,n={x:e.x,y:e.y},l=new Room;l.x=t.x,l.y=t.y;for(var h=new Array,y=new Array;0==y.length;){if(e.x!=t.x&&chance(50)){var d={x:t.x,y:t.y+rand(2,i-2),direction:"LEFT"};l.hotspots.push(d),y.push({x:d.x+1,y:d.y})}if(e.x!=t.x+r-1&&chance(50)){d={x:t.x+r-1,y:t.y+rand(2,i-2),direction:"RIGHT"};l.hotspots.push(d),y.push({x:d.x-1,y:d.y})}if(e.y!=t.y&&chance(50)){d={x:t.x+rand(2,r-2),y:t.y,direction:"UP"};l.hotspots.push(d),y.push({x:d.x,y:d.y+1})}if(e.y!=t.y+i-1&&chance(50)){d={x:t.x+rand(2,r-2),y:t.y+i-1,direction:"DOWN"};l.hotspots.push(d),y.push({x:d.x,y:d.y-1})}}e.x==t.x?n.x++:e.x==t.x+r-1?n.x--:e.y==t.y?n.y++:e.y==t.y+i-1&&n.y--;for(var c={x:t.x+Math.round(r/2),y:t.y+Math.round(i/2)},m=t.x;m<t.x+r;m++){h[m-t.x]=new Array;for(var u=t.y;u<t.y+i;u++)this.mask[m][u]=!0,h[m-t.x][u-t.y]=s}y.push(n);for(var x=0;x<y.length;x++)for(var p=Util.line(y[x],c),f=0;f<p.length;f++){m=p[f].x,u=p[f].y;if(this.preLevel[m][u]=CellType.FLOOR,h[m-t.x][u-t.y]=CellType.FLOOR,a.addCrosses){var v=m+1,g=u;this._tryAddCross(t,r,i,v,g,h),v=m-1,g=u,this._tryAddCross(t,r,i,v,g,h),v=m,g=u+1,this._tryAddCross(t,r,i,v,g,h),v=m,g=u-1,this._tryAddCross(t,r,i,v,g,h)}}return l.setMap(h),l},DungeonBuilder.prototype._tryAddCross=function(e,t,r,i,o,a){chance(60)&&i>e.x&&i<e.x+t-1&&o>e.y&&o<e.y+r-1&&(this.preLevel[i][o]=CellType.FLOOR,a[i-e.x][o-e.y]=CellType.FLOOR)},DungeonBuilder.prototype._getFloorTilesAround=function(e,t,r){var i=0;return e.isValidIncludingBorders(t-1,r)&&!e.map[t-1][r].isSolid&&i++,e.isValidIncludingBorders(t+1,r)&&!e.map[t+1][r].isSolid&&i++,e.isValidIncludingBorders(t,r-1)&&!e.map[t][r-1].isSolid&&i++,e.isValidIncludingBorders(t,r+1)&&!e.map[t][r+1].isSolid&&i++,e.isValidIncludingBorders(t-1,r-1)&&!e.map[t-1][r-1].isSolid&&i++,e.isValidIncludingBorders(t+1,r+1)&&!e.map[t+1][r+1].isSolid&&i++,e.isValidIncludingBorders(t+1,r-1)&&!e.map[t+1][r-1].isSolid&&i++,e.isValidIncludingBorders(t-1,r+1)&&!e.map[t-1][r+1].isSolid&&i++,i},DungeonBuilder.prototype._getWallTilesAround=function(e,t,r){var i=0;return e.isValidIncludingBorders(t,r-1)&&e.map[t][r-1].isSolid&&i++,e.isValidIncludingBorders(t,r+1)&&e.map[t][r+1].isSolid&&i++,i},DungeonBuilder.prototype._renderPool=function(e,t){for(var r=t.height,i=t.width,o=0==rand(0,1)?"POOL1_":"POOL2_",a=t.x;a<t.x+i;a++)for(var s=t.y;s<t.y+r;s++)if(s==t.y)a==t.x?e[a][s]=CellType[o+"1"]:a==t.x+i-1?e[a][s]=CellType[o+"3"]:e[a][s]="POOL2_"===o?CellType[o+"2_"+(chance(50)?"1":"2")]:CellType.POOL1_2;else if(s==t.y+r-1)a==t.x?e[a][s]=CellType.POOL_7:a==t.x+i-1?e[a][s]=CellType.POOL_9:e[a][s]=CellType.POOL_8;else if(a==t.x)e[a][s]=CellType.POOL_4;else if(a==t.x+i-1)e[a][s]=CellType.POOL_6;else switch(rand(0,2)){case 0:e[a][s]=CellType.POOL_5_1;break;case 1:e[a][s]=CellType.POOL_5_2;break;case 2:e[a][s]=CellType.POOL_5_3}},DungeonBuilder.prototype._renderPuddle=function(e,t){for(var r=t.height,i=t.width,o=t.x;o<t.x+i;o++)for(var a=t.y;a<t.y+r;a++)if(a==t.y)o==t.x?e[o][a]=CellType.PUDDLE_1:o==t.x+i-1?e[o][a]=CellType.PUDDLE_3:e[o][a]=CellType.PUDDLE_2;else if(a==t.y+r-1)o==t.x?e[o][a]=CellType.PUDDLE_7:o==t.x+i-1?e[o][a]=CellType.PUDDLE_9:e[o][a]=CellType.PUDDLE_8;else if(o==t.x)e[o][a]=CellType.PUDDLE_4;else if(o==t.x+i-1)e[o][a]=CellType.PUDDLE_6;else switch(rand(0,2)){case 0:e[o][a]=CellType.POOL_5_1;break;case 1:e[o][a]=CellType.POOL_5_2;break;case 2:e[o][a]=CellType.POOL_5_3}},DungeonBuilder.prototype.carveCorridor=function(e,t,r){var i={x:0,y:0};switch(t){case"UP":i.x=e.x,i.y=e.y-r+1;break;case"DOWN":i.x=e.x,i.y=e.y;break;case"LEFT":i.x=e.x-r+1,i.y=e.y;break;case"RIGHT":i.x=e.x,i.y=e.y}if("UP"===t||"DOWN"===t){for(var o=i.y-1;o<i.y+r+1;o++)if(!this.isValid(i.x,o)||!this.isValid(i.x-1,o)||!this.isValid(i.x+1,o))return!1;for(o=i.y+1;o<i.y+r-1;o++)if(this.mask[i.x][o]||this.mask[i.x-1][o]||this.mask[i.x+1][o])return!1;for(o=i.y;o<i.y+r;o++)this.preLevel[i.x][o]=CellType.CORRIDOR,this.mask[i.x-1][o]=!0,this.mask[i.x][o]=!0,this.mask[i.x+1][o]=!0;"UP"==t?(this.mask[i.x-1][i.y+r]=!0,this.mask[i.x][i.y+r]=!0,this.mask[i.x+1][i.y+r]=!0,this.corridorTip={x:i.x,y:i.y},this.mask[i.x-1][i.y]=!1,this.mask[i.x][i.y]=!1,this.mask[i.x+1][i.y]=!1,this.mask[i.x-1][i.y+1]=!1,this.mask[i.x+1][i.y+1]=!1):(this.mask[i.x-1][i.y-1]=!0,this.mask[i.x][i.y-1]=!0,this.mask[i.x+1][i.y-1]=!0,this.corridorTip={x:i.x,y:i.y+r-1},this.mask[i.x-1][i.y+r-1]=!1,this.mask[i.x][i.y+r-1]=!1,this.mask[i.x+1][i.y+r-2]=!1,this.mask[i.x+1][i.y+r-2]=!1)}else{for(var a=i.x-1;a<i.x+r+1;a++)if(!this.isValid(a,i.y)||!this.isValid(a,i.y-1)||!this.isValid(a,i.y+1))return!1;for(a=i.x+1;a<i.x+r-1;a++)if(this.mask[a][i.y]||this.mask[a][i.y+1]||this.mask[a][i.y-1])return!1;for(a=i.x;a<i.x+r;a++)this.preLevel[a][i.y]=CellType.CORRIDOR,this.mask[a][i.y-1]=!0,this.mask[a][i.y]=!0,this.mask[a][i.y+1]=!0;"RIGHT"==t?(this.mask[i.x-1][i.y-1]=!0,this.mask[i.x-1][i.y]=!0,this.mask[i.x-1][i.y+1]=!0,this.corridorTip={x:i.x+r-1,y:i.y},this.mask[i.x+r-1][i.y-1]=!1,this.mask[i.x+r-1][i.y]=!1,this.mask[i.x+r-1][i.y+1]=!1,this.mask[i.x+r-2][i.y-1]=!1,this.mask[i.x+r-2][i.y+1]=!1):(this.mask[i.x+r][i.y-1]=!0,this.mask[i.x+r][i.y]=!0,this.mask[i.x+r][i.y+1]=!0,this.corridorTip={x:i.x,y:i.y},this.mask[i.x][i.y-1]=!1,this.mask[i.x][i.y]=!1,this.mask[i.x][i.y+1]=!1,this.mask[i.x+1][i.y-1]=!1,this.mask[i.x+1][i.y+1]=!1)}return this.mask[this.corridorTip.x][this.corridorTip.y]=!1,!0},DungeonBuilder.prototype.save=function(){for(var e=0;e<this.mask.length;e++)this.maskB[e]=this.mask[e].slice(),this.preLevelB[e]=this.preLevel[e].slice()},DungeonBuilder.prototype.rollBack=function(){for(var e=0;e<this.mask.length;e++)this.mask[e]=this.maskB[e].slice(),this.preLevel[e]=this.preLevelB[e].slice()},DungeonBuilder.prototype.linkRooms=function(e,t,r,i){e.map[t.x-e.x][t.y-e.y]=CellType.DOOR,e.addPortal(t.x-e.x,t.y-e.y,r,i.x-r.x,i.y-r.y),r.map[i.x-r.x][i.y-r.y]=CellType.DOOR,r.addPortal(i.x-r.x,i.y-r.y,e,t.x-e.x,t.y-e.y)},DungeonBuilder.prototype.test=function(){var e={uniqueRegistry:{},features:{},gameController:{ui:{levelGen:{roomBounds:{height:10,width:12},baseRooms:10}}},hardcoreMode:!0};e.gameController.player=e;for(var t=0,r=!1,i=0,o=0;o<100;o++){var a=Date.now(),s=(this.createLevel(5,e),Date.now()-a);s>t&&(t=s),(0==r||s<r)&&(r=s),i+=s,console.log("Generated "+(1+o)+" took "+s)}console.log("min "+r),console.log("max "+t),console.log("avg "+i/100)},DungeonBuilder.prototype.test2=function(){var e={uniqueRegistry:{},features:{},gameController:{ui:{levelGen:{roomBounds:{height:9,width:9},baseRooms:12}}},hardcoreMode:!0};e.gameController.player=e;for(var t=1;t<30;t++){for(var r=0,i=!1,o=0,a=0;a<10;a++){var s=Date.now(),n=(this.createLevel(t,e),Date.now()-s);n>r&&(r=n),(0==i||n<i)&&(i=n),o+=n}r<500&&o/10<100?console.log(t+": OK"):console.log(t+": max "+r+" avg "+o/10)}},DungeonBuilder.prototype.SPECIAL_TOMBS=["Sir Robeson\n\nHe will never again see the sun.\n\n\n625-687","KASARIS\n\n\nThe real hero is the coward.\n\n720 - 765","The moment had been prepared for.\n\n\nA.G. Palmer.\n680 - 721","This is the resting place of Kramius\n\n\nI told you it was dark.\n\n420-495","Here lies Dave Williams\n\nHe asked for no rewards.\n\n\n695-735","Here lies Queen Stephanie of the Dumeril\nShe fought to bring joy to folk of all kind.\n\n125-654","Armenia\n\nWe shall forever honor Rubyro Mer'ah, lord of the mountains.\n\n520 - 585","Adam Ring\n\n\nKnight of the Order of Ananias.\n\n1542-1698"],DungeonBuilder.prototype.SPECIAL_BOOKS=[{title:"Extending your life",author:"Dave Williams",text:"After years of experimentation, I was finally able to concoct the potion to extend your own life. Unfortunately, the elements required for it are extremely scarse: Antimony is found in very small quantities in the depths of caverns, and the only place where Mercuria has been found is on the icy valley of Garmandar."},{title:"A Bold Collection",author:"G. the Infantryman",text:'I was in the King\'s Army. A lowly member of the infantry. One day I ate mushrooms from a field and had a strange dream. More like a "trip" into the stuff that makes up the world around us. So, I have been exploring (especially mushrooms and their properties) and putting my notes into this book under one of four categories (Atomic, Bacterial, Chemical, Genetic). Everyplace I visit for this work I scribble a little reference to this book, "ABCGi", for posterity (and advertising!).'},{title:"Multimagic Scholarship",author:"Estephan Barish",text:"Limiting wizards to the written book undermines their ability to fully share the knowledge they have gained. Upon completing my book, after 10 years of research, I realized that while I may be able to describe the practical effects of each known spell of the Mind magic school, I could never actually demonstrate what was going on in the subject mind."},{title:"Musings of Tripaseca",author:"King Ohitom",text:'"Tis a deceptive thing\nto wander the halls of Ananias.\nMany warriors lost their lives,\nbut scant is the talk...\nof those who lost their minds.\nThy soul, tested.\nThy heart, pressed.\nNone shall remain unaffected,\nby the deeds of the evil Snake."\n\nThese words were spoken by the fallen hero Tripaseca, during his last adventure in the tomb of the fallen king.'}],DungeonBuilder.prototype.getSpecialTombDescription=function(){var e=this.gameController.player,t=rand(0,this.SPECIAL_TOMBS.length-1);return!e.uniqueRegistry["TOMB_"+t]&&(e.uniqueRegistry["TOMB_"+t]=!0,this.SPECIAL_TOMBS[t])},DungeonBuilder.prototype.getSpecialBookDescription=function(){var e=this.gameController.player,t=rand(0,this.SPECIAL_BOOKS.length-1);return!e.uniqueRegistry["BOOK_"+t]&&(e.uniqueRegistry["BOOK_"+t]=!0,this.SPECIAL_BOOKS[t].type="book",this.SPECIAL_BOOKS[t])};

},{"./CellType.enum":7,"./Level.class.js":17,"./NPCBuilder.class.js":22,"./Room.class.js":28,"./Util.js":36,"circular-functions":43}],10:[function(require,module,exports){
var droll=require("droll"),Util=require("./Util"),Effects={attackSelf:function(e,r,n,o,t){r.attackTarget?r.attackTarget(r,{type:"BASH"},!0,function(){t(!0)},1):e.gameController.showMessageInPanel("Nothing happens.")},morph:function(e,r,n,o){var t=e.pet==r||chance(n.features.successRate)?n.features.successRace:n.features.failRace;e.morphMonster(r,t)},curse:function(e,r,n,o){r.addCounter?(e.gameController.showTextBy(r,"DOOMED!"),r.addCounter(5,"die")):e.gameController.showMessageInPanel("Nothing happens.")},die:function(e){e.die(!0)},recoverFromCharm:function(e){e.isFriendly=!1,e.isSummon=!1},createItem:function(e,r,n,o){var t,a=n.features.itemCode;if(e.currentRoom.getItem(e.x,e.y)?(t=e.currentRoom.getFreePlaceAround(e))||(t=e.currentRoom.getFreePlace()):t=e,t){var s=e.gameController.itemFactory.getItemByCode(a);if(s.features&&s.features.reloadWeaponType){var l=s.features.maxPackSize,i=2*o;i<1&&(i=1),i>l&&(i=l),s.quantity=i}e.currentRoom.addItem(s,t,!0),e.gameController.addItemToRoom(s)}},magicMapping:function(e,r,n,o){var t=n.features.mappingType;if(o){for(var a=6*(o+1),s="",l=0,i=0;i<e.dungeonLevel.rooms.length;i++){var g=e.dungeonLevel.rooms[i];switch(t){case"all":if(e.dungeonLevel.exploreRoom(g,!0,a),!a&&0!=a)for(var m=0;m<g.portals.length;m++){var c=g.portals[m];e.dungeonLevel.exploreCorridor(g,c,c.destination,a)}s="You feel the structure of nearby rooms.";break;case"items":l+=e.dungeonLevel.exploreRoomContents(g,!0,!1,a);break;case"monsters":l+=e.dungeonLevel.exploreRoomContents(g,!1,!0,a)}}"items"===t?s="You feel the location of "+l+" nearby items.":"monsters"===t&&(s="You feel the presence of "+l+" nearby monsters."),e.gameController.drawMiniMap(),e.gameController.showMessageInPanel(s)}else e.gameController.showMessageInPanel("Nothing happens.")},enchant:function(e,r,n){e.gameController.showTextBy(r,"Shining!"),r.currentWeapon.remainingUses.replenish(),e.gameController.showMessageInPanel("The "+r.currentWeapon.name+"'s power is replenished.")},charm:function(e,r,n){e.doCharm(r)&&(e.gameController.particleAnimationAt("wizardry",e.pet),e.gameController.communityClient.playerEvent("pet"," charms a "+e.pet.race.name),e.gameController.showMessageInPanel("You charm the "+e.pet.race.name+"."))},inflictStatus:function(e,r,n){var o=n.features.inflictedStatus;r.inflictStatus(o)},inflictStatusOnAll:function(e,r,n){for(var o=n.features.inflictedStatus,t=0;t<e.currentRoom.monsters.length;t++){var a=e.currentRoom.monsters[t];a.isFriendly||("charm"!=o||e.canCharm(a))&&a.inflictStatus(o)}},darkEvolve:function(e,r,n){var o=e.pet==r;e.doEvolve(!0,r),e.gameController.particleAnimationAt("wizardry",r),o&&e.gameController.communityClient.playerEvent("pet","'s pet evolves into "+e.pet.race.name)},lightEvolve:function(e,r,n){var o=e.pet==r;e.doEvolve(!1,r),e.gameController.particleAnimationAt("wizardry",r),o&&e.gameController.communityClient.playerEvent("pet","'s pet evolves into "+e.pet.race.name)},enchantWeapon:function(e,r,n){e.gameController.showTextBy(r,"Glowing!"),r.currentWeapon.damageRoll.increaseModifier(),e.gameController.showMessageInPanel("The "+r.currentWeapon.name+" vibrates with energy!")},enchantArmor:function(e,r,n){e.gameController.showTextBy(r,"Harden!"),r.currentArmor.defenseValue++,e.gameController.showMessageInPanel("The "+r.currentArmor.name+" glows briefly and hardens!")},repairArmor:function(e,r,n,o){e.gameController.showTextBy(r,"Glowing!"),o?(r.currentArmor.integrity.increaseOpenly(30*o),e.boostEnergyMagic()&&r.currentArmor.integrity.increaseOpenly(100),e.gameController.showMessageInPanel("The "+r.currentArmor.name+" will withstand for much longer.")):e.gameController.showMessageInPanel("Nothing happens.")},recoverStrength:function(e,r,n){e.gameController.showTextBy(r,"Recovered!"),r.attack&&r.attack.replenish(),r==e?e.gameController.showMessageInPanel("You recover the power you had lost."):e.gameController.showMessageInPanel("The "+r.race.name+" recovers the power it had lost.")},increaseStrength:function(e,r,n){e.gameController.showTextBy(r,"+Combat!"),r.attack&&r.attack.extend(1),r==e?e.gameController.showMessageInPanel("Your Combat skill increases."):e.gameController.showMessageInPanel("The "+r.race.name+"'s combat skill increases.")},increaseHP:function(e,r,n,o){if(o){var t=2*o;e.boostEnergyMagic()&&(t+=5),r.hitPoints.extend(t),r==e?e.gameController.showMessageInPanel("Your hit points are increased by "+t+"."):e.gameController.showMessageInPanel("The "+r.race.name+"'s hit points increased by "+t+"."),e.gameController.showTextBy(r,"+"+t+"HP!")}else e.gameController.showMessageInPanel("Nothing happens.")},polymorph:function(e,r,n){var o=e.pet==r;e.doPolymorph(r),e.gameController.particleAnimationAt("wizardry",r),o&&e.gameController.communityClient.playerEvent("pet","'s pet transforms into "+e.pet.race.name)},invisibility:function(e,r,n,o){o?(e.setInvisible(o),e.gameController.showMessageInPanel("You become invisible.")):e.gameController.showMessageInPanel("Nothing happens.")},repairWeapon:function(e,r,n,o){if(e.gameController.showTextBy(r,"Shining!"),o){var t=o*n.features.recoveryStrength;e.boostEnergyMagic()&&(t+=25),t>80&&(t=80);var a=Math.round(r.currentWeapon.remainingUses.max*(t/100));r.currentWeapon.remainingUses.increase(a),e.gameController.showMessageInPanel("The "+r.currentWeapon.name+" will withstand for much longer.")}else e.gameController.showMessageInPanel("Nothing happens.")},repairWeaponOfType:function(e,r,n){e.gameController.showTextBy(r,"Shining!"),r.currentWeapon.remainingUses.replenish(),e.gameController.showMessageInPanel("The "+r.currentWeapon.name+" is back to perfect shape!")},stopBleeding:function(e,r,n){r.cutTurns>0&&(e.gameController.showTextBy(r,"Healed"),r.cutTurns=0);var o=droll.roll(n.features.healingRoll).total;r.heal(o),e==r?e.gameController.showMessageInPanel("You recover "+o+" hit points and bandage your wounds."):e.gameController.showMessageInPanel("You bandage the "+r.race.name+"'s wounds, it recovers "+o+" hit points.")},healStatus:function(e,r){var n=!1;r.isConfused()&&(r.confusionTurns=0,r==e&&e.gameController.updatePlayerStats(!0),n=!0),r.isHallucinating()&&(r.hallucinationTurns=0,r==e&&(e.gameController.updatePlayerStats(!0),e.gameController.recoverPerception()),n=!0),r.isParalyzed()&&(r.paralyzeTurns=0,r.stopBlink(65535),r==e&&e.gameController.updatePlayerStats(!0),n=!0),r.isBlind()&&(r.blindTurns=0,r==e&&(e.gameController.updatePlayerStats(!0),e.gameController.turnOnLights()),n=!0),n?e==r?e.gameController.showMessageInPanel("You feel much better."):e.gameController.showMessageInPanel("The "+r.race.name+" recovers."):e.gameController.showMessageInPanel("Nothing happens.")},summon:function(e,r,n,o,t){var a=n.features.monsterRace;if(!o)return e.gameController.showMessageInPanel("Nothing happens."),void t(!0);var s=15+3*o,l=null;n.features.multiple?l=rand(3,2+o):l=1;for(var i=!1,g=0,m=0;m<l;m++){var c=e.currentRoom.getFreePlace();if(c){var u=e.gameController.monsterFactory.createMonster(e,a,1,!0);u.isFriendly=!0,u.isSummon=!0,u.setEphimeral(rand(15,s)),e.currentRoom.addEnemy(u,c),e.gameController.addMonsterToRoom(u,!0),i||(i=u),g++}}i?(1===g?e.gameController.showMessageInPanel("You summon a "+i.race.name+"."):e.gameController.showMessageInPanel("You summon "+g+" "+i.race.name+"s."),e.gameController.phaser.time.events.add(1e3,function(){t(!0)})):(e.gameController.showMessageInPanel("The spell fails."),t(!0))},magicAttack:function(e,r,n,o,t,a){e.magicAttack(n,r,o,a)},recoverHealth:function(e,r,n,o){var t=o;if(n.features.isSpell&&e.boostEnergyMagic()&&(t+=2),0===t)a=0;else var a=droll.roll(t+"d8").total;r.heal(a,500),n.features.isSpell&&e.gameController.particleAnimationAt("wizardry",r),e==r?e.gameController.showMessageInPanel("You recover "+a+" hit points."):e.gameController.showMessageInPanel(r.getUseDescription()+" recovers "+a+" hit points.")},recoverMagic:function(e,r,n){r.magicPoints?(e.gameController.showTextBy(r,"+MP",null,"GREEN"),r.magicPoints.recoverProportion(.5),e.gameController.particleAnimationAt("wizardry",r),e==r?e.gameController.showMessageInPanel("You recover some magic power."):e.gameController.showMessageInPanel(r.getUseDescription()+" recovers some magic power.")):e.gameController.showMessageInPanel("Nothing happens.")},recoverFullMagic:function(e,r,n){r.magicPoints?(e.gameController.showTextBy(r,"Full MP!",null,"GREEN"),r.magicPoints.replenish(),e.gameController.particleAnimationAt("wizardry",r),e==r?e.gameController.showMessageInPanel("You recover all your magic power."):e.gameController.showMessageInPanel(r.getUseDescription()+" recovers all its magic power.")):e.gameController.showMessageInPanel("Nothing happens.")},recoverFullHealth:function(e,r,n){e.gameController.showTextBy(r,"Full HP!",null,"GREEN"),r.hitPoints.replenish(),n.features.isSpell&&e.gameController.particleAnimationAt("wizardry",r),e==r?e.gameController.showMessageInPanel("You recover all of your hit points."):e.gameController.showMessageInPanel(r.getUseDescription()+" recovers all of its hitpoints.")},pushEnemy:function(e,r,n,o){var t={x:sign(r.x-e.x),y:sign(r.y-e.y)},a=e.gameController.getBezierTween(e.sprite,e.sprite.x,e.sprite.y,e.sprite.x+16*t.x,e.sprite.y+16*t.y,!1,!0,function(){},30,!1,function(){Effects._push(r,t,3,o)});e.gameController.startTween(e.sprite,a)},_push:function(e,r,n,o){console.log("_push",r,n);for(var t=Util.line(e,{x:e.x+r.x*n,y:e.y+r.y*n}),a=0,s={x:e.x,y:e.y},l=1;l<t.length-1;l++){var i=t[l];if(!e.currentRoom.canWalkTo(i.x,i.y))break;s=i,a++}var g=0;g=e.isFloating()?e.sprite.baseY:e.sprite.y;var m=e.gameController.getBezierTween(e.sprite,e.sprite.x,g,e.sprite.x+32*a*r.x,g+32*a*r.y,!1,!1,function(){e.placementOffset=!1,e.x=s.x,e.y=s.y,e.currentRoom.sortMonsters(),o(!0)},30,!1,!1,e.isFloating());e.gameController.startTween(e.sprite,m)},teleport:function(e,r,n){var o=e.dungeonLevel.rooms[rand(0,e.dungeonLevel.rooms.length-1)],t=o.getFreePlace();if(!t)return e.gameController.showTextBy(r,"..."),e.gameController.showMessageInPanel("You find no place to teleport to."),void e.gameController.playSFX("beep");o==r.currentRoom?(r.sprite.x=32*t.x+16,r.sprite.y=32*t.y+e.gameController.YOFFSET,r.placementOffset=!1,r.x=t.x,r.y=t.y,e.gameController.particleAnimationAt("wizardry",r)):r==e||e.pet&&r==e.pet?(e.pet&&r.currentRoom.removeEnemy(e.pet),o.locatePlayer(e,t),e.gameController.newRoom=o,e.gameController.loadNewRoom(),e.gameController.particleAnimationAt("wizardry",t)):(e.gameController.particleAnimationAt("wizardry",r),r.currentRoom.removeEnemy(r),e.gameController.killImage(r.sprite),o.addEnemy(r,t)),n.menuSprite&&e.gameController.useInspector(n.menuSprite,"Teleport!","You materialize in a different place!",!0),e.gameController.disablePlayerAction()},getEffectDescription:function(e,r,n,o){o||(o=1);var t=r.gameController.isDesktop?"\n":". ";if("recoverHealth"===e){var a=o;return n.features.isSpell&&r.boostEnergyMagic()&&(a+=2),"Recovers "+a+"D8 health points."}if("increaseHP"===e){var s=2*o;return r.boostEnergyMagic()&&(s+=5),"Extends health points by "+s+"."}if("invisibility"===e){var l=5*o;return r.boostEnergyMagic()&&(l+=5),"Renders you invisible for "+l+" turns."}if("repairArmor"===e){var i=30*o;return r.boostEnergyMagic()&&(i+=100),"Strengthens your armor for "+i+" points."}if("recoverFullHealth"===e)return"Recovers Full HP";if("wield"===e){var g=n.longDescription?n.longDescription+"\n":"";return n.features.twoHandedBonus&&(g+="Two handed bonus"+t),n.features.usesArrows?n.ammo?1==n.remainingUses.max&&1==n.remainingUses.current?g+"Loaded"+t+"Damage: "+n.getDamageDescription():g+"Loaded with "+n.remainingUses.getText()+" "+n.ammo.features.ammoType+t+"Damage: "+n.getDamageDescription():g+"Unloaded"+t+"Damage: "+n.getDamageDescription():"WAND"===n.type?g+"Charges: "+n.remainingUses.getText()+t+"Damage: "+n.getDamageDescription():g+n.getIntegrityDescription()+t+"Damage: "+n.getDamageDescription()}if("wear"===e)return n.getIntegrityDescription()+t+"Defense: "+n.getDefenseValue();if("wearAsHelmet"===e){g=n.longDescription?n.longDescription+"\n":"";return n.defenseValue?g+n.getIntegrityDescription()+t+"Defense: "+n.getDefenseValue():g+n.getIntegrityDescription()}if("wearAsShield"===e){g=n.longDescription?n.longDescription+"\n":"";return n.defenseValue?g+n.getIntegrityDescription()+t+"Defense: "+n.getDefenseValue():g+n.getIntegrityDescription()}if("repairWeapon"===e){var m=o*n.features.recoveryStrength;return r.boostEnergyMagic()&&(m+=25),m>80&&(m=80),"Restores "+(m=Math.round(m))+"% integrity of any weapon."}if("repairWeaponOfType"!==e){if("reloadWeapon"===e){var c=n.features.attackDescription,u=n.features.ammoType;return n.quantity>1||n.features.liquidAmmo?c+" ("+n.quantity+" "+u+")":c}return""}return"BLADE"==n.features.repairWeaponType?"Fully restores integrity of Swords, Spears and Axes.":"BLUNT"==n.features.repairWeaponType?"Fully restores integrity of Maces and Staffs.":void 0},getBasicEffectDescription:function(e,r){return"recoverHealth"===e?"Recovers some health points.":"increaseHP"===e?"Extends health points.":"invisibility"===e?"Renders you invisible for some turns.":"repairArmor"===e?"Strengthens your armor.":"recoverFullHealth"===e?"Recovers Full HP":"repairWeapon"===e?"Restores part of the integrity of any weapon.":"repairWeaponOfType"!==e?"":"BLADE"==r.features.repairWeaponType?"Fully restores integrity of Swords, Spears and Axes.":"BLUNT"==r.features.repairWeaponType?"Fully restores integrity of Maces and Staffs.":void 0}};module.exports=Effects;

},{"./Util":36,"droll":45}],11:[function(require,module,exports){
var circular=require("circular-functions"),Entity=require("./Entity"),Achievements=require("./AchievementsManager"),Effects=require("./Effects");function Enemy(e,t){0!=arguments.length&&(this.gameController=e,this.race=t,this.x=0,this.y=0,this.hitPoints=new Stat(t.hpRoll.roll()),this.damageMalus=0,this.skillPoints=t.baseSkillPoints,this.command="ATK",this._c=circular.register("Enemy"),this.facingLeft=!0,t.features.friendly?this.isFriendly=!0:this.isFriendly=!1,this.counters=[])}module.exports=Enemy;var Stat=require("./Stat.class.js"),AttackType=require("./AttackType.enum"),Material=require("./Material.enum"),Util=require("./Util");circular.registerClass("Enemy",Enemy,{transients:{gameController:!0,sprite:!0},reviver:function(e,t){e.gameController=t.gameController,e.counters||(e.counters=[])}}),Enemy.prototype.addCounter=function(e,t){this.counters.push({_c:circular.setSafe(),turns:e,effect:t})},Enemy.prototype.updateCounters=function(){for(var e=0;e<this.counters.length&&!this.dead;e++){var t=this.counters[e];t.turns--,t.turns<=0&&(Effects[t.effect](this),this.counters.splice(this.counters.indexOf(t),1).length>0&&e--)}},Enemy.prototype.getDescription=function(){return this.race.name},Enemy.prototype.canUseSkills=function(){return(!this.isFriendly||!this.currentRoom.isSafe())&&this.skillPoints>0},Enemy.prototype.moveOffscreenTo=function(e){var t=this.gameController.player;if(!(t.hitPoints.current<=0||this.dead||this.race.features.invisible&&!this.canUseSkills()||this.isParalyzed()||this.isPanicked()||this.x==e.x&&this.y==e.y||this.isNPC))if(this.race.features.walkRandomlyChance&&chance(this.race.features.walkRandomlyChance)||this.isBlind()||this.moveConfused())this.walkOffscreen(randomDirection());else{var r=this.starePoint(e),i={x:r.x+this.x,y:r.y+this.y},s=r;(!this.currentRoom.canWalkTo(i.x,i.y)||this.currentRoom==t.currentRoom&&t.x==i.x&&t.y==i.y)&&((r=this.directionToSpot(e,this.currentRoom==t.currentRoom&&t))||(r=this.getAlternateDirection(s,!0,!1,!1)),r||(r=this.validRandomDirection()),r||(r={x:0,y:0})),this.walkOffscreen(r)}},Enemy.prototype.walkOffscreen=function(e){var t={x:e.x+this.x,y:e.y+this.y};this.currentRoom.getEnemy(t.x,t.y)||this.currentRoom.canWalkTo(t.x,t.y)&&(this.setFacing(e),this.x=t.x,this.y=t.y,this.placementOffset=!1)},Enemy.prototype.setFacing=function(e){this.sprite&&!this.gameController.player.dungeonLevel.isRetro&&(e.x>0?this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1):e.x<0&&(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0)))},Enemy.prototype.act=function(e,t){var r=this.gameController.player;if(r.hitPoints.current<=0)e();else if(this.dead)e();else if(this.tweenBlocked){var i=this;setTimeout(function(){i.act(e,t)},100)}else{if(this.cancelExtraTurns)return this.cancelExtraTurns=!1,void e();if(this.updateStatus(),this.dead)e();else if(!this.race.features.invisible||this.canUseSkills())if(this.isParalyzed())e();else{var s=!1,n=!1,a=this.attackConfused();if(this.intent=this.decideIntent(a),t?(this.actingInExtraTurn=t.isExtraTurn,t.attack&&t.move?(s=!1,n=!1):t.attack?n=!0:t.move&&(s=!0)):this.actingInExtraTurn=!1,this.actingInExtraTurn&&this.currentRoom!=r.currentRoom)e();else{if(this==r.pet&&this.x==r.x&&this.y==r.y&&!this.race.features.canAttackCovered){if("flee"===this.intent||"stand"===this.intent)return void e();s=!0}if(!n&&this.race.features.walkRandomlyChance&&chance(this.race.features.walkRandomlyChance))this.walk(randomDirection(),e);else{if(!this.isFriendly&&!this.calledForReinforcements&&this.race.features.callsForReinforcements&&chance(20))return this.currentRoom.alertNearbyMonsters(30),this.gameController.showTextBy(this,this.getMessage("intruder","!!"),!1,!1,!1,!0),this.calledForReinforcements=!0,void this.gameController.phaser.time.events.add(350,function(){e()});if(this.isBlind()||this.moveConfused())this.walk(randomDirection(),e);else{if(this.canUseSkills()){if(this.race.features.healingPower&&this.hasInjuredAllies()&&chance(this.race.features.healingChance)){this.gameController.playSFX("magic");for(var o=this.race.features.healingPower,h=0;h<this.currentRoom.monsters.length;h++){(d=this.currentRoom.monsters[h]).isFriendly==this.isFriendly&&(d.heal(o,500),this.gameController.particleAnimationAt("healing",d))}return this.isFriendly&&(r.heal(o,500),this.gameController.particleAnimationAt("healing",r)),this.skillPoints--,this.gameController.updatePlayerStats(!0),void e()}if(this.race.features.summonChance&&chance(this.race.features.summonChance)&&(!this.isFriendly||!this.currentRoom.isSafe())){this.gameController.playSFX("spell"),this.gameController.particleAnimationAt("wizardry",this);var l=rand(1,this.race.features.summonMax);this.gameController.showTextBy(this,"Ha Ha Ha...");for(h=0;h<l;h++){var c=this.currentRoom.getFreePlace();if(c){var u=this.gameController.monsterFactory.createMonster(r,this.race.features.summonEnemy,1,this.isFriendly);u.setEphimeral(rand(4,7)),u.isFriendly=this.isFriendly,this.isFriendly&&(u.isSummon=!0),this.currentRoom.addEnemy(u,c),this.gameController.addMonsterToRoom(u,!0)}}return e(),void this.skillPoints--}}var m=null;if(this.isFriendly&&this.currentRoom.isSafe()&&"stand"!==this.intent){if(this.stayInRoom)return void this.walk(randomDirection(),e);m=r,this.intent="follow",s=!0}else{var p=9999;for(h=0;h<this.currentRoom.monsters.length;h++){var y,d=this.currentRoom.monsters[h];if(a){if(this.isFriendly!=d.isFriendly)continue;if(!(this!=d||this.isConfused()&&chance(40)))continue}else if(this.isFriendly==d.isFriendly)continue;if(!d.isInvisible())(y=this.distanceToTarget(d))==p?this.possibleTargets.push(d):y<p&&(p=y,this.possibleTargets=[],this.possibleTargets.push(d))}if(!this.isFriendly&&!a||this.isFriendly&&a)if(!r.isInvisible())(y=this.distanceToTarget(r))==p?this.possibleTargets.push(r):y<p&&(p=y,this.possibleTargets=[],this.possibleTargets.push(r));if(!this.possibleTargets)return this.possibleTargets=!1,void e();m=randomElementOf(this.possibleTargets),this.possibleTargets=!1,"follow"===this.intent&&(this.nextToTarget(r)&&m!=r&&this.nextToTarget(m)?this.intent="attack":(m=r,s=!0))}this.canSeeTarget=null!=m,this.canSeeTarget&&(this.alerted=!0,m.onSeenBy(this));var g=null,f=this.distanceToTarget(m);if("flee"===this.intent){chance(50)&&this.gameController.showTextBy(this,this.getMessage(chance(50)?"dammit":"argh","!"));var C=this.currentRoom.getPortalOn(this);if(C&&this.currentRoom.isPortalUseable(C))return void(this.isFriendly&&this.x==r.x&&this.y==r.y?e():this.currentRoom.warpMonster(this,C,e));var T=this.isFriendly;a&&(T=!T);var x=this.getEscapePortal();if(x&&(g=this.directionToSpot(x),this.currentRoom.monsterCanWalkTo(T,this.x+g.x,this.y+g.y,s,n)))return void this.walk(g,e,s,n,a);(g=this.starePoint(m)).x*=-1,g.y*=-1;var k={x:g.x+this.x,y:g.y+this.y};if(this.currentRoom.monsterCanWalkTo(T,k.x,k.y,s,n)||(g=this.getAlternateDirection(g,s,n,a)),g)return void this.walk(g,e,s,n,a);if(!this.nextToTarget(m))return void e();this.intent="attack"}if("attack"!==this.intent||this.nextToTarget(m)||!this.race.features.warpChance||s||!chance(this.race.features.warpChance)){if(this.canUseSkills()&&!s){if(this.race.features.yankChance&&chance(this.race.features.yankChance)){var v={x:Math.round(this.currentRoom.width/2),y:Math.round(this.currentRoom.height/2)};this.currentRoom.canWalkTo(v.x,v.y)||(v=this.currentRoom.getFreePlaceAround(v)),v&&(m.warpTo(v,!1,!1,!0),this.skillPoints--)}var E=this.race.skills.paralyze;if(!m.isParalyzed()&&E&&f<=E.range&&chance(E.chance)){this.gameController.playSFX("spell"),(d=this).skillPoints--,d.gameController.particleAnimationAt("wizardry",d);var w=E.effectMessage,P=E.message;return void this.gameController.fadeAnimation(this.sprite,16711680,1e3,function(){m.mindMagicEffectPrevented()?d.gameController.showTextBy(m,"No effect"):(m.paralyzeTurns=rand(2,3),w&&d.gameController.showTextBy(m,w+"!"),d.gameController.showEffectOnInspector(m,w,"unable to move.","ARE"),m.blink(65535,!1),m.stopBreathing(),d.gameController.updatePlayerStats(!0)),e()},function(){P&&d.gameController.showTextBy(d,P)})}var A=this.race.skills.fear;if(!m.isPanicked()&&!m.immuneToFear()&&A&&f<=A.range&&chance(A.chance))return(d=this).skillPoints--,this.gameController.playSFX("spell"),d.gameController.particleAnimationAt("wizardry",d),void this.gameController.fadeAnimation(this.sprite,16711680,1e3,function(){m.mindMagicEffectPrevented()||m.immuneToFear()?m.gameController.showTextBy(m,"No effect"):(d.gameController.showTextBy(m,"FEAR"),d.gameController.showEffectOnInspector(m,"Fear","filled with fear!","ARE"),m.inflictPanick(rand(5,10))),e()});if(!m.isBlind()&&!m.inmuneToBlindness()&&this.race.features.blindChance&&f<=this.race.features.blindRange)if(chance(this.race.features.blindChance))return this.gameController.playSFX("spell"),(d=this).skillPoints--,d.gameController.particleAnimationAt("wizardry",d),void this.gameController.fadeAnimation(this.sprite,16711680,1e3,function(){m.mindMagicEffectPrevented()?d.gameController.showTextBy(m,"No effect"):(d.gameController.showTextBy(m,"Blind"),m.goBlind(rand(d.race.features.blindTurns,d.race.features.blindTurns+5))),e()});if((E=this.race.skills.fetidFumes)&&f<=E.range&&chance(E.chance))return this.gameController.playSFX("spell"),this.skillPoints--,void this.gameController.particleAnimationAt("smoke",m,function(){m.mindMagicEffectPrevented()?m.gameController.showTextBy(m,"No effect"):m.startHallucinating(rand(E.minTurns,E.maxTurns)),e()});if(!m.isConfused()&&this.race.features.confuseChance&&f<=this.race.features.confuseChance)if(chance(this.race.features.confuseChance))return this.gameController.playSFX("spell"),(d=this).skillPoints--,d.gameController.particleAnimationAt("wizardry",d),void this.gameController.fadeAnimation(this.sprite,16711680,1e3,function(){m.mindMagicEffectPrevented()?m.gameController.showTextBy(m,"No effect"):(d.gameController.showTextBy(m,"Confused"),m.goConfused(rand(d.race.features.confuseTurns,d.race.features.confuseTurns+5))),e()});if(this.hitPoints.notFull()&&this.race.features.regenChance&&chance(this.race.features.regenChance)&&(this.gameController.playSFX("magic"),this.heal(this.race.features.regenHP),this.skillPoints--),E=this.race.skills.rangedAttack,!s&&E&&f<=E.range&&chance(E.chance)){if(E.requiresDistance&&1===f){(g=this.starePoint(m)).x*=-1,g.y*=-1,this.intent="backoff";k={x:g.x+this.x,y:g.y+this.y},T=this.isFriendly;if(a&&(T=!T),this.currentRoom.monsterCanWalkTo(T,k.x,k.y,s,n))return void this.walk(g,e,s,n,a);if(g=this.getAlternateDirection(g,s,n,a))return void this.walk(g,e,s,n,a)}if(this.canSeeTarget&&this.currentRoom.clearLOS(this,m)&&(!E.requiresDistance||f>1)){if(E.requiresLoading&&!this.loadedForSkill)return this.gameController.showTextBy(this,E.loadingMessage),this.loadedForSkill=!0,void e();this.loadedForSkill=!1;var R=E.animation;if(chance(30)){var S=chance(50)?"die":"takeThis";this.gameController.showTextBy(this,this.getMessage(S,"!"))}var F=chance(E.accuracy);if(F)R.target={x:m.x,y:m.y};else{var b=this.starePoint(m);R.target={x:m.x+b.x,y:m.y+b.y}}return this.skillPoints--,void this.attackTarget(m,R,F,e,f)}}}if(this.canSeeTarget||!this.alerted){var B=!1,I=!1;if(this.race.features.guardItems&&!this.isFriendly&&(I=!(this.nextToTarget(m)||r.hasRangedWeapon()||r.pet&&r.pet.hasRangedWeapon()||this.hitByPlayer)),I){if(this.currentRoom.getItem(this.x,this.y))return void e();if(B=!0,0==(g=this.stareItem()).x&&0==g.y)return void e()}if(!this.isFriendly&&(this.race.features.guardExit&&!this.hitByPlayer&&this.currentRoom.exit&&!this.nextToTarget(m)&&!r.hasRangedWeapon()&&!(r.pet&&r.pet.hasRangedWeapon()))&&(B=!0,0==(g=this.stareExit()).x&&0==g.y))e();else if(this.isFriendly&&this.gameController.player.isLeavingRoom)e();else{if(B||(g=this.starePoint(m)),"stand"===this.intent){if(this.currentRoom.isSafe()||!this.nextToTarget(m))return void e();this.intent="attack"}k={x:g.x+this.x,y:g.y+this.y};if(!this.currentRoom.isSafe()&&this.isFriendly&&this.race.features.teamPlayer&&r.isRangedAttack()){var D=r.getClosestMonster(),M=Util.line(r,D);for(h=1;h<M.length-1;h++)if(M[h].x==k.x&&M[h].y==k.y){if(!(g=this.directionToSpot(m,M[h])))return void this.walk({x:0,y:0},e,s,n,a);k={x:g.x+this.x,y:g.y+this.y}}}var H=g;T=this.isFriendly;a&&(T=!T),this.currentRoom.monsterCanWalkTo(T,k.x,k.y,s,n)||(g=!1,s&&this.nextToTarget(m)||(g=this.directionToSpot(m)),g||(g=this.getAlternateDirection(H,s,n,a)),g||(g=this.validRandomDirection()),g||(g={x:0,y:0})),this.walk(g,e,s,n,a)}}else this.walk(randomDirection(),e)}else this.warpNextToTarget(m,e)}}}}else e()}},Enemy.prototype.getAlternateDirection=function(e,t,r,i){var s=this.isFriendly;i&&(s=!s);var n=getAlternateDirections(e),a={x:n.a1.x+this.x,y:n.a1.y+this.y},o={x:n.a2.x+this.x,y:n.a2.y+this.y},h=null;if(this.currentRoom.monsterCanWalkTo(s,a.x,a.y,t,r))h=n.a1;else{if(!this.currentRoom.monsterCanWalkTo(s,o.x,o.y,t,r))return!1;h=n.a2}return h},Enemy.prototype.directionToSpot=function(e,t){var r=this.currentRoom.grid.clone(),i=new PF.AStarFinder({diagonalMovement:PF.DiagonalMovement.Always});if(this.currentRoom.markEnemiesOnPathfindingGrid(r),r.setWalkableAt(this.x,this.y,!0),r.setWalkableAt(e.x,e.y,!0),t)if(t.length)for(var s=0;s<t.length;s++)r.setWalkableAt(t[s].x,t[s].y,!1);else r.setWalkableAt(t.x,t.y,!1);var n=i.findPath(this.x,this.y,e.x,e.y,r);return!(n.length<2)&&{x:n[1][0]-this.x,y:n[1][1]-this.y}},Enemy.prototype.validRandomDirection=function(){return{x:0,y:0}},Enemy.prototype.walk=function(e,t,r,i,s){var n={x:e.x+this.x,y:e.y+this.y},a=this.currentRoom.getEnemy(n.x,n.y);if(n.x==this.gameController.player.x&&n.y==this.gameController.player.y&&(a=this.gameController.player),a&&(this.isFriendly!=a.isFriendly||s)){if(this.setFacing(e),!this.actingInExtraTurn&&chance(30)){var o=chance(50)?"die":"takeThis";this.gameController.showTextBy(this,this.getMessage(o,"!"))}return this.attackTarget(a,{type:"BASH"},chance(100-a.getEvadeChance()),t,1),this.race.features.doubleAttack||(this.cancelExtraTurns=!0,this.gameController.debug("Canceling Extra Turns")),void(this.actingInExtraTurn&&this.skillPoints>0&&(this.skillPoints--,this.gameController.updatePlayerStats(!0)))}if(this.currentRoom.monsterCanWalkTo(this.isFriendly,n.x,n.y,r,i)){this.currentRoom.isSafe()||this.gameController.playSFX("step"),this.setFacing(e);var h=this.sprite.x+32*e.x,l=0,c=(l=this.isFloating()?this.sprite.baseY:this.sprite.y)+32*e.y;if(this.placementOffset&&(h-=this.placementOffset.x,c-=this.placementOffset.y,this.placementOffset=!1),!this.actingInExtraTurn&&"attack"===this.intent&&a&&(this.isFriendly!=a.isFriendly||s)&&chance(30)){o=chance(50)?"die":"comeHere";this.gameController.showTextBy(this,this.getMessage(o,"!"))}var u=this.gameController.getBezierTween(this.sprite,this.sprite.x,l,h,c,!1,!1,!1,!1,!1,!1,this.isFloating());this.currentRoom.isSafe()&&(u=null),u&&(u.onComplete.add(function(){t()},this),this.gameController.startTween(this.sprite,u)),this.x=n.x,this.y=n.y,this.currentRoom.sortMonsters(),this.actingInExtraTurn&&this.skillPoints>0&&(this.skillPoints--,this.gameController.updatePlayerStats(!0)),this.race.features.doubleAttack&&!this.race.features.doubleSpeed&&(this.cancelExtraTurns=!0),u||(this.sprite.x=h,this.isFloating()?this.sprite.baseY=c:this.sprite.y=c,t())}else t()},Enemy.prototype.warpNextToTarget=function(e,t){for(var r=0;r<20;r++){var i={x:e.x+rand(-1,1),y:e.y+rand(-1,1)};if(i.x!=this.gameController.player.x||i.y!=this.gameController.player.y)if(!this.currentRoom.getEnemy(i.x,i.y)&&this.currentRoom.monsterCanWalkTo(this.isFriendly,i.x,i.y)){var s=this.gameController.translateToViewportCoordinates(i),n={x:s.x};this.isFloating()?n.baseY=s.y:n.y=s.y;var a=this.gameController.tween(this.sprite).to(n,this.gameController.animationLength,Phaser.Easing.Sinusoidal.InOut);return a.onComplete.add(t,this),this.gameController.startTween(this.sprite,a),this.placementOffset=!1,this.x=i.x,this.y=i.y,void this.currentRoom.sortMonsters()}}t()},Enemy.prototype.warpTo=function(e){if(this.currentRoom.isFreeFloor(e.x,e.y)){var t=this.gameController.translateToViewportCoordinates(e),r={x:t.x};this.isFloating()?r.baseY=t.y:r.y=t.y;var i=this.gameController.tween(this.sprite).to(r,this.gameController.animationLength/4),s=this;this.tweenBlocked=!0,i.onComplete.add(function(){s.tweenBlocked=!1},this),this.gameController.startTween(this.sprite,i),this.placementOffset=!1,this.x=e.x,this.y=e.y,this.currentRoom.sortMonsters()}},Enemy.prototype.starePlayer=function(){return this.starePoint(this.gameController.player)},Enemy.prototype.nextToTarget=function(e){var t=Math.abs(e.x-this.x),r=Math.abs(e.y-this.y);return t<=1&&r<=1},Enemy.prototype.distanceToTarget=function(e){var t=Math.abs(e.x-this.x),r=Math.abs(e.y-this.y);return Math.max(t,r)},Enemy.prototype.stareItem=function(){var e=this.currentRoom.items;return 0==e.length?this.starePlayer():this.starePoint(e[0])},Enemy.prototype.stareExit=function(){return this.currentRoom.exit?this.starePoint(this.currentRoom.exit):this.starePlayer()},Enemy.prototype.starePoint=function(e){return{x:sign(e.x-this.x),y:sign(e.y-this.y)}},Enemy.prototype.getTheDescription=function(e){return this.isUnique?this.name:e?"The "+this.getDescription():"the "+this.getDescription()},Enemy.prototype.attackTarget=function(e,t,r,i,s){this.gameController.logEvent(this.race.name+" attacks "+(e.race?e.race.name:"player"));var n=this,a=function(){if(e.shaking)e.onShakeOver=a;else{if("ARROW"===t.type||"FIREBALL"===t.type)if(n.gameController.resetProjectile(),r){if(n.performDamage(e,s))return void Entity.shake(e,i)}else n.gameController.showTextBy(e,"Miss");i()}},o=null,h=t.yOffset||0;if("BASH"===t.type){var l=this.starePoint(e),c=this.sprite.x+16*l.x,u=0;this.isFloating()?u=this.sprite.baseY:u+=this.sprite.y;var m=u+16*l.y;o=this.gameController.getBezierTween(this.sprite,this.sprite.x,u,c,m,!1,!0,a,30,!1,function(){if(n.gameController.playSFX(n.getAttackSFX()),r&&"BASH"===t.type?(n.race.features.invisible||n.gameController.showScratchAt(n.x,n.y,e.x,e.y,n.getScratchType()),n.performDamage(e,s)&&Entity.shake(e)):n.gameController.showTextBy(e,"Miss"),!r){var i=chance(50),a=n.gameController.tween(e.sprite).to({x:e.sprite.x+16*(i?1:-1)},100,Phaser.Easing.Sinusoidal.In,!1,0,0,!0);n.gameController.startTween(e.sprite,a)}},this.isFloating())}else if("ARROW"===t.type){var p=null;(p=t.tileIndexes?this.gameController.animatedProjectile(t.animationId,t.tileIndexes):this.gameController.prepareProjectile(t.tileIndex)).pivot.x=.5*p.width,p.pivot.y=.5*p.height,p.rotation=-Math.getAngle(e,this);var y=this.gameController.mapOffset;p.x=this.sprite.x+y.x,p.y=this.sprite.y+y.y+h;c=32*t.target.x+16+y.x,m=32*t.target.y+this.gameController.YOFFSET+y.y+h;if(0===(f=lineDistance(this.sprite,e.sprite)))return void a();var d=t.speed;d||(d=160);var g=f/d*1e3/3;(o=this.gameController.tween(p).to({x:c,y:m},g,Phaser.Easing.Sinusoidal.In)).onComplete.add(a,this),this.gameController.playSFX(this.getAttackSFX())}else if("FIREBALL"===t.type){(p=this.gameController.animatedProjectile(t.animationId,t.tileIndexes)).pivot.x=.5*p.width,p.pivot.y=.5*p.height,p.rotation=0;y=this.gameController.mapOffset;p.x=this.sprite.x+y.x,p.y=this.sprite.y+y.y+h;var f;c=32*t.target.x+16+y.x,m=32*t.target.y+this.gameController.YOFFSET+y.y+h;if(0===(f=lineDistance(this.sprite,e.sprite)))return void a();g=f/160*1e3;(o=this.gameController.tween(p).to({x:c,y:m},g,Phaser.Easing.Sinusoidal.In)).onComplete.add(a,this),this.gameController.playSFX(this.getAttackSFX())}this.gameController.startTween(this.sprite,o)},Enemy.prototype.stealItem=function(e){if(e.getRandomItem){var t=e.getRandomItem();return!!t&&(t==e.currentArmor&&(e.currentArmor=null),t==e.currentArmwear&&(e.currentArmwear=null),t==e.currentLegwear&&(e.currentLegwear=null),t==e.currentFootwear&&(e.currentFootwear=null),t==e.currentWeapon&&(e.currentWeapon=null),t==e.previousWeapon&&(e.previousWeapon=null,this.gameController.switchButtonGroup.visible=!1),this.gameController.updatePlayerStats(!1),e.removeItem(t),this.stolenItem=t,!0)}},Enemy.prototype.performDamage=function(e,t){var r,i="body",s=null,n=1;if(e.isHumanoid())if(e.tryBlock())this.gameController.showTextBy(e,"BLOCK!"),this.gameController.playSFX("hit"),s=e.currentShield;else{var a=1;this.isWarrior()&&(a=4);for(var o=a;o>0;o--){var h=rand(0,100);if(i=h<1?"neck":h<6?"face":h<15?"head":h<20?"arm":h<25?"leg":h<30?"feet":"body",a>1){switch(i){case"neck":s=e.currentHelmet&&e.currentHelmet.features.protectsNeck?e.currentHelmet:null;break;case"face":s=e.currentHelmet&&e.currentHelmet.features.protectsFace?e.currentHelmet:null;break;case"head":s=e.currentHelmet&&e.currentHelmet.features.protectsHead?e.currentHelmet:null;break;case"arm":s=e.currentArmwear;break;case"leg":s=e.currentLegwear;break;case"feet":s=e.currentFootwear;break;case"body":default:s=e.currentArmor}if(!s)break}}switch(i){case"neck":s=e.currentHelmet&&e.currentHelmet.features.protectsNeck?e.currentHelmet:null,n=2.5;break;case"face":s=e.currentHelmet&&e.currentHelmet.features.protectsFace?e.currentHelmet:null,n=2;break;case"head":s=e.currentHelmet&&e.currentHelmet.features.protectsHead?e.currentHelmet:null,n=1.5;break;case"arm":s=e.currentArmwear;break;case"leg":s=e.currentLegwear;break;case"feet":s=e.currentFootwear;break;case"body":default:s=e.currentArmor}}else s=e.currentArmor;"body"!==i&&(r=500),null!=s&&(n=1,e.stats&&s.defenseValue>0&&(e.stats.conducts.noArmorUsed=!1)),this.race.features.invisible&&this.skillPoints--;var l=this.race.damageRoll.roll();this.race.skills.rangedAttack&&this.race.skills.rangedAttack.requiresDistance&&t<2&&(l=1),this.attack&&(l+=this.attack.current);var c=this.getDamageBonus(e)*n;if(l=Math.floor(l*c),l-=this.damageMalus,e==this&&this.isConfused()&&(l=Math.floor(l/2)),(l=e.affectReceivedDamageByTactic(l))<0&&(l=0),this.race.features.weakenChance&&!e.immuneToDisease()&&chance(this.race.features.weakenChance)){if(this.gameController.playSFX("spell"),this.gameController.particleAnimationAt("wizardry",e),this.gameController.showTextBy(e,"WEAKEN"),this.gameController.showEffectOnInspector(e,"Weaken","power is reduced by 1."),e.attack)return e.attack.reduce(1),this.gameController.updatePlayerStats(!0),!0;e.damageMalus++}if(e.hitPoints&&!e.immuneToDisease()&&this.race.features.reduceMaxHPChance&&chance(this.race.features.reduceMaxHPChance))return this.gameController.playSFX("spell"),this.gameController.particleAnimationAt("wizardry",e),this.gameController.showTextBy(e,"DRAIN"),this.gameController.showEffectOnInspector(e,"Drain","hit points are reduced by 1."),e.hitPoints.contract(1),this.gameController.updatePlayerStats(!0),!0;if(e.currentWeapon&&this.race.features.disarmChance&&chance(this.race.features.disarmChance))return this.gameController.showTextBy(this,"DISARM!"),this.gameController.showEffectOnInspector(e,"Disarm","weapon is taken off your hands."),e.disarm(),this.gameController.updatePlayerStats(!1),!1;if(!this.stolenItem&&this.race.features.stealChance&&chance(this.race.features.stealChance))return this.gameController.playSFX("hit"),this.stealItem(e)?(this.gameController.showTextBy(this,"Fetch!"),this.gameController.showEffectOnInspector(e,"Steal","been stolen an item!","HAVE")):this.gameController.showTextBy(this,"Miss"),this.gameController.updatePlayerStats(!1),!1;if(e.currentArmor&&this.race.features.damageArmorChance)return chance(this.race.features.damageArmorChance)&&(this.gameController.showTextBy(this,"ACID!"),e.currentArmor.damage(this.race.features.damageArmor),this.gameController.showEffectOnInspector(e,"Acid","armor is badly damaged.")),this.gameController.updatePlayerStats(!1),!0;if(e.currentWeapon&&this.race.features.damageWeaponChance){if(chance(this.race.features.damageWeaponChance)){this.gameController.showTextBy(this,"Merton!"),this.gameController.playSFX("spell"),this.gameController.particleAnimationAt("wizardry",e);var u=rand(1,this.race.features.damageWeaponMax);this.gameController.showTextBy(e,"-"+u,null,"RED",!1,!0),this.gameController.showEffectOnInspector(e,"Merton","weapon is badly damaged."),e.currentWeapon.remainingUses.reduce(u)}return this.gameController.updatePlayerStats(!0),!1}if(null!=s&&(s.damage(l),l-=s.getDefenseValue()),l<=3&&(l=rand(1,3)),e.race&&e.race.features.evadeChance&&chance(e.race.features.evadeChance)){var m=this.currentRoom.getFreePlaceAround(e);if(m)return e.warpTo(m,!1,!1,!0),!1}if(e.tryParry())return e.currentWeapon&&e.degradeMeleeWeapons&&e.degradeMeleeWeapons()&&e.currentWeapon.spend(),this.gameController.showTextBy(e,"PARRY!"),this.gameController.playSFX(e.getAttackSFX()),this.gameController.updatePlayerStats(!1),!1;"neck"===i?this.gameController.showTextBy(e,"Neck hit!"):"face"===i?this.gameController.showTextBy(e,"Face hit!"):"head"===i&&this.gameController.showTextBy(e,"Head hit!"),e.takeDamage(l),e.isPanicked()&&e.panickTurns&&chance(60)&&(e.panickTurns=1),this.race.features.cutChance&&chance(this.race.features.cutChance)&&(e.currentArmor&&e.currentArmor.protectFromCuts||(this.gameController.playSFX("slash1"),this.gameController.showTextBy(e,"CUT!"),r=500,this.gameController.showEffectOnInspector(e,"Cut","bleeding","ARE"),e.cutTurns=rand(5,15)));var p=this.gameController.player;e!=p&&e.hitPoints.current<=0&&(e.die(!0),this.isPet()&&Achievements.achievePetKill()),e==p&&(p.lastAttacker=this,p.lastDamagingItem=!1,p.lastDamagingSpell=!1),chance(50)&&this.currentRoom.addBlood(e.x,e.y,rand(0,5));var y="";return c>1?y="!":c<1&&(y="..."),this.gameController.showTextBy(e,"-"+l+y,null,"RED",r,!0),this.gameController.updatePlayerStats(!0),!s||s!=e.currentShield},Enemy.prototype.heal=function(e,t){this.gameController.showTextBy(this,"+"+e,null,"GREEN",t,!0),this.hitPoints.increase(e)},Enemy.prototype.die=function(e){this.dead=!0;var t=this.currentRoom!=this.gameController.player.currentRoom;switch(this.race.material){case Material.BONE:this.currentRoom.addBlood(this.x,this.y,rand(6,11));break;case Material.FLESH:this.currentRoom.addBlood(this.x,this.y,rand(0,5))}if(this.stolenItem){var r={x:this.x,y:this.y};this.currentRoom.getItem(this.x,this.y)&&((r=this.currentRoom.getFreePlaceAround(r))||(r=this.currentRoom.getFreePlace())),r&&(this.currentRoom.addItem(this.stolenItem,r,!0),t||this.gameController.addItemToRoom(this.stolenItem))}if(this.race.features.dropsRing&&(this.dropRingAt(this.x,this.y),this.gameController.showDenziMessage("Great!","Wear the ring to win the game, or continue diving into the depths!")),this.race.features.dropArrows&&chance(50)&&(this.stuckArrows?this.stuckArrows+=rand(1,2):this.stuckArrows=rand(1,2)),this.stuckArrows&&!t&&this.gameController.player._stashAt(this.x,this.y,this.stuckArrows,"arrows"),this.currentRoom.removeEnemy(this),!t){var i=this.gameController.tween(this.sprite).to({alpha:0},500,Phaser.Easing.Linear.None,!1);this.gameController.phaser.time.events.add(100,function(){this.gameController.playSFX("death")},this),i.onComplete.add(function(){this.gameController.killImage(this.sprite)},this),i.start()}e&&this.gameController.player.pet==this&&(this.gameController.petDead(),this.gameController.player.pet=null,this.gameController.updatePetStats()),this.gameController.player.petAway&&this.gameController.player.petAway==this&&(this.gameController.player.petAway=!1,this.awayTurns=0)},Enemy.prototype.dropRingAt=function(e,t){var r=this.currentRoom.getItem(e,t);r&&this.gameController.removeItemFromRoom(r);var i=this.gameController.itemFactory.getRing();this.currentRoom.addItem(i,{x:e,y:t},!0),this.gameController.addItemToRoom(i)},Enemy.prototype.isParalyzed=function(){return this.paralyzeTurns&&this.paralyzeTurns>0},Enemy.prototype.hasRangedWeapon=function(){return this.canUseSkills()&&this.race.features.attackRange},Enemy.prototype.getAttackSFX=function(){if(this.race.attackSFX)return this.race.attackSFX;switch(this.race.attackType){case AttackType.BITE:case AttackType.BLUNT:return"punch";case AttackType.PIERCING:case AttackType.SLASHING:case AttackType.CHOPPING:return"slash"}return"punch"},Enemy.prototype.getScratchType=function(){switch(this.race.attackType){case AttackType.BITE:return"bite";case AttackType.BLUNT:return"blunt";case AttackType.PIERCING:return"thrust";case AttackType.SLASHING:return"slash";case AttackType.CHOPPING:return"hack"}return"blunt"},Enemy.prototype.getDamageBonus=function(e){if(!e.race)return 1;if(!this.race)return 1;switch(e.race.material){case Material.FLESH:return this.race.attackType==AttackType.SLASHING||this.race.attackType==AttackType.PIERCING?1.3:1;case Material.BONE:return this.race.attackType==AttackType.BLUNT?1.3:this.race.attackType==AttackType.PIERCING?.2:1;case Material.WOOD:return this.race.attackType==AttackType.CHOPPING?1.3:this.race.attackType==AttackType.SLASHING||this.race.attackType==AttackType.PIERCING?.2:1}return 1},Enemy.prototype.tryParry=function(){return!!this.race.features.canParry&&chance(10)},Enemy.prototype.tryBlock=function(){return!!this.race.features.canBlock&&chance(10)},Enemy.prototype.redBlink=function(){this.blink(16711680,!0)},Enemy.prototype.blink=function(e,t){if(this.isPet()&&(!this.gameController.petBlinking||t)&&(!t||e!=this.blinkColor)){this.blinkColor&&this.stopBlink(this.blinkColor),this.blinkColor=e,this.gameController.petBlinking=!0;var r={step:0};this.gameController.petColorTween&&this.gameController.petColorTween.stop(),this.gameController.petColorTween=this.gameController.tween(r).to({step:100},1e3,Phaser.Easing.Sinusoidal.Out,!1,0,Number.MAX_VALUE,!0);var i=this,s=this.gameController.petColorTween;s.onUpdateCallback(function(){r.step>99||(r.step>1&&(i.gameController.phaser.renderType===Phaser.CANVAS?i.sprite.tint=Phaser.Color.interpolateColor(16777215,e,100,r.step,1):i.sprite.tint=Phaser.Color.interpolateColor(16777215,e,100,r.step)),r.step<1&&s.pleaseDie&&(s.stop(),i.sprite.tint=16777215,i.gameController.petBlinking=!1,i.blinkColor=!1))}),this.gameController.petColorTween.start()}},Enemy.prototype.stopBlink=function(e){!this.gameController.petBlinking||e&&e!=this.blinkColor||(this.gameController.petColorTween.pleaseDie=!0)},Enemy.prototype.levelUp=function(){if(this.powerLevel++,chance(50)){var e=rand(2,4);this.hitPoints.extend(e),this.gameController.showTextBy(this,"HP+"+e,void 0,void 0,300,!0),this.gameController.appendInspectorMessage("\n"+this.getDescription()+"'s Hit points +"+e)}else this.attack.extend(1),this.gameController.showTextBy(this,"Power+1",void 0,void 0,300),this.gameController.appendInspectorMessage("\n"+this.getDescription()+"'s Power +1");this.skillPoints=this.race.baseSkillPoints+Math.floor(this.powerLevel/2),this.hitPoints.recoverProportionOfTotal(.2),this.gameController.playSFX("magic")},Enemy.prototype.tryLevelUp=function(){chance(80)&&this.levelUp()},Enemy.prototype.hasInjuredAllies=function(){for(var e=0;e<this.currentRoom.monsters.length;e++){var t=this.currentRoom.monsters[e];if(t.isFriendly==this.isFriendly&&t.hitPoints.notFull())return!0}return!(!this.isFriendly||!this.gameController.player.hitPoints.notFull())},Enemy.prototype.canWield=function(){return!1},Enemy.prototype.canWearArmor=function(){return!1},Enemy.prototype.changeRace=function(e,t){var r=this.hitPoints,i=this.attack,s=this.race.damageRoll,n=this.powerLevel,a=this.x,o=this.y,h=this.isFriendly,l=this.isSummon,c=(this.sprite.x,this.sprite.y,this.placementOffset);this.die(!1);var u=this.gameController.player,m=this.gameController.monsterFactory.createMonster(u,e,1,h);if(m.x=a,m.y=o,m.isFriendly=h,m.isSummon=l,this.currentRoom.addEnemy(m,m),this.gameController.addMonsterToRoom(m),c&&(m.placementOffset=c),t){var p=m.hitPoints.current;m.hitPoints=r,m.hitPoints.extend(p);var y=m.race.damageRoll.roll();i&&(m.attack=i,m.attack.extend(y),m.race.damageRoll=s,m.currentPowerLevel=n)}return m},Enemy.prototype.flash=function(e){var t=this.sprite;t.tint=e,this.gameController.phaser.time.events.add(100,function(){t.tint=16777215})},Enemy.prototype.getADescription=function(){var e=this.race.name;return Util.startsWithVowel(e)?"an "+e:"a "+e},Enemy.prototype.getUseDescription=function(){return"The "+this.race.name},Enemy.prototype.inflictPanick=function(e){this.immuneToFear()?this.gameController.showTextBy(this,"Ha!"):(this.panickTurns=e,this.isPet()&&this.gameController.updatePlayerStats(!0))},Enemy.prototype.goBlind=function(e){this.blindTurns=e,this.gameController.updatePlayerStats(!0)},Enemy.prototype.isBlind=function(){return this.blindTurns>0},Enemy.prototype.goConfused=function(e){this.confusionTurns=e,this.gameController.updatePlayerStats(!0)},Enemy.prototype.isConfused=function(){return this.confusionTurns>0},Enemy.prototype.moveConfused=function(){return this.isConfused()&&chance(30)},Enemy.prototype.attackConfused=function(){return this.isConfused()&&chance(50)||this.isHallucinating()&&chance(20)},Enemy.prototype.isInvisible=function(){return this.race.features.invisible},Enemy.prototype.isBleeding=function(){return this.cutTurns>0},Enemy.prototype.isOverburdened=function(){return!1},Enemy.prototype.isTrapped=function(){return!1},Enemy.prototype.startHallucinating=function(e){this.hallucinationTurns=e,this.gameController.updatePlayerStats(!0)},Enemy.prototype.isHallucinating=function(){return this.hallucinationTurns>0},Enemy.prototype.getStatusAilments=function(){if(!(this.isBlind()||this.isConfused()||this.isInvisible()||this.isParalyzed()||this.isOverburdened()||this.isTrapped()||this.isBleeding()||this.isHallucinating()||this.isPanicked()))return!1;var e=[];return this.isBlind()&&e.push("Blind"),this.isConfused()&&e.push("Confused"),this.isInvisible()&&e.push("Invisible"),this.isParalyzed()&&e.push("Paralyzed"),this.isOverburdened()&&e.push("Overburdened"),this.isTrapped()&&e.push("Trapped"),this.isBleeding()&&e.push("Bleeding"),this.isHallucinating()&&e.push("Hallucinating"),this.isPanicked()&&e.push("Panicked"),e},Enemy.prototype.updateStatus=function(){var e=this.currentRoom==this.gameController.player.currentRoom;this.cutTurns>0&&(this.takeDamage(2),e&&this.gameController.showTextBy(this,"-2",null,"RED",!1,!0),this.currentRoom.addBlood(this.x,this.y,rand(0,5)),this.cutTurns--,this.hitPoints.current<=0)?this.die(!0):(this.blindTurns>0&&(this.blindTurns--,e&&this.isPet()&&0==this.blindTurns&&this.gameController.updatePlayerStats(!0)),this.hallucinationTurns>0&&(this.hallucinationTurns--,e&&this.isPet()&&0==this.hallucinationTurns&&this.gameController.updatePlayerStats(!0)),this.confusionTurns>0&&(this.confusionTurns--,e&&this.isPet()&&0==this.confusionTurns&&this.gameController.updatePlayerStats(!0)),this.panickTurns>0&&(this.panickTurns--,e&&this.isPet()&&0==this.panickTurns&&this.gameController.updatePlayerStats(!0)),this.isParalyzed()&&(this.paralyzeTurns--,0==this.paralyzeTurns&&(this.stopBlink(65535),this.resumeBreathing(),e&&this.isPet()&&0==this.paralyzeTurns&&this.gameController.updatePlayerStats(!0))),this.ephimeral&&(this.lifeTurns--,0==this.lifeTurns)?this.die(!0):(this.sprite&&this.race.features.invisible&&(this.nextToTarget(this.gameController.player)?this.sprite.visible=!0:this.sprite.visible=!1),this.updateCounters()))},Enemy.prototype.setEphimeral=function(e){this.ephimeral=!0,this.lifeTurns=e};var words={common:{intruder:"Intruder",die:"Die",takeThis:"Take this",comeHere:"Come here",dammit:"Dammit",argh:"Argh"},draconian:{intruder:"Kayu",die:"Zama",takeThis:"Ogou Waar",comeHere:"Heg Li",dammit:"Zomg",argh:"Agg"},eyal:{intruder:"Roka",die:"Die",takeThis:"Pren Ca",comeHere:"Venes Izi",dammit:"Maudire",argh:"Gah"},orcish:{intruder:"Oe Oe",die:"Tenga",takeThis:"Tropel",comeHere:"Venite",dammit:"Suerte",argh:"Grrr"}},onomato={hiss:"Hisss",horse:"Breeee",howl:"Howwwwl",mee:"Mee",meow:"Meow",roar:"Roar",shreek:"Shreek",squeek:"Squeeek",ugh:"Ugh",wagga:"Wagga",wargh:"Wargh",woof:"Woof"};function lowerDanger(e,t){return t.danger-e.danger}Enemy.prototype.getMessage=function(e,t){return"none"===this.race.language?"":(onomato[this.race.language]||(words[this.race.language]?words[this.race.language][e]:""))+t},Enemy.prototype.isPanicked=function(){return this.panickTurns>0||this.race.features.panickLimit&&100*this.hitPoints.getProportion()<=this.race.features.panickLimit},Enemy.prototype.inflictStatus=function(e){if(this.race.features.boss)this.gameController.showTextBy(this,"...");else{switch(e){case"panick":this.inflictPanick(30);break;case"charm":this.isFriendly||(this.race.features.charmResistant?this.gameController.showTextBy(this,"..."):(this.isFriendly=!0,this.isSummon=!0,this.addCounter(rand(10,15),"recoverFromCharm")));break;case"confusion":this.goConfused(30);break;case"blindness":this.inmuneToBlindness()||this.goBlind(30)}this.gameController.particleAnimationAt("wizardry",this)}},Enemy.prototype.inmuneToBlindness=function(){return this.race.features.eyeless},Enemy.prototype.isPet=function(){return this==this.gameController.player.pet},Enemy.prototype.isFloating=function(){return this.race.features.floating},Enemy.prototype.getBaseSpriteY=function(){return this.isFloating()?this.sprite.baseY:this.sprite.y},Enemy.prototype.getEscapePortal=function(){var e=this.getClosestPortal();if(!e)return!1;if(this.isDangerousPosition(e)){var t=this.getLessDangerousPortal();return!(!t||t==e)&&t}return e},Enemy.prototype.isDangerousPosition=function(e){for(var t=0;t<this.currentRoom.monsters.length;t++){var r=this.currentRoom.monsters[t];if(r!=this&&r.isFriendly!=this.isFriendly){var i=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y);if(i<=1&&s<=1)return!0}}if(!this.isFriendly){i=Math.abs(this.gameController.player.x-e.x),s=Math.abs(this.gameController.player.y-e.y);if(i<=1&&s<=1)return!0}return!1},Enemy.prototype.getClosestPortal=function(){for(var e=9999,t=!1,r=0;r<this.currentRoom.portals.length;r++){var i=this.currentRoom.portals[r],s=flatDistance(i.x,i.y,this.x,this.y);if(!this.isFriendly)if(flatDistance(i.x,i.y,this.gameController.player.x,this.gameController.player.y)<s)continue;s<e&&(e=s,t=i)}return t},Enemy.prototype.getLessDangerousPortal=function(){if(1==this.currentRoom.portals.length)return this.currentRoom.portals[0];for(var e=[],t=0;t<this.currentRoom.portals.length;t++){for(var r=this.currentRoom.portals[t],i=0,s=0;s<this.currentRoom.monsters.length;s++){var n=this.currentRoom.monsters[s];n.isFriendly!=this.isFriendly&&(i+=flatDistance(r.x,r.y,n.x,n.y))}this.isFriendly||(i+=flatDistance(r.x,r.y,this.gameController.player.x,this.gameController.player.y)),e.push({portal:r,danger:i})}return e.sort(lowerDanger),e[0].portal},Enemy.prototype.isHumanoid=function(){return this.race.features.humanoid},Enemy.prototype.immuneToDisease=function(){return this.race.features.immuneToDisease},Enemy.prototype.immuneToFear=function(){return this.race.features.fearless},Enemy.prototype.onSeenBy=function(e){},Enemy.prototype.getEvadeChance=function(){return this.isParalyzed()?0:this.race.evadeChance},Enemy.prototype.getPassiveSkillsDescription=function(){return(this.race.description?this.race.description+"\n":"")+(this.race.skillsDescription?this.race.skillsDescription+"\n":"")+(this.isWarrior()?"Skilled fighter\n":"")},Enemy.prototype.getHealthDescription=function(){switch(Math.floor(100*this.hitPoints.getProportion()/25)){case 0:return"Critically wounded";case 1:return"Severely wounded";case 2:return"Wounded";default:return""}},Enemy.prototype.isDefensiveTactic=function(){return!1},Enemy.prototype.isAggressiveTactic=function(){return!1},Enemy.prototype.affectReceivedDamageByTactic=function(e){return this.isDefensiveTactic()?Math.floor(.8*e):this.isAggressiveTactic()?Math.floor(1.2*e):e},Enemy.prototype.affectRangedAttackHitChanceByTactic=function(e){return this.isDefensiveTactic()?e-20:this.isAggressiveTactic()?e+10:e},Enemy.prototype.affectCausedDamageByTactic=function(e){return this.isDefensiveTactic()?e-.5:this.isAggressiveTactic()?e+.5:e},Enemy.prototype.affectUnarmedCausedDamageByTactic=function(e){return this.isDefensiveTactic()?Math.round(.5*e):this.isAggressiveTactic()?Math.round(1.5*e):e},Enemy.prototype.affectEnemyEvadeChanceByTactic=function(e){return this.isDefensiveTactic()?e+5:this.isAggressiveTactic()?e-5:e},Enemy.prototype.affectEvadeChanceByTactic=function(e){return this.isAggressiveTactic()?e-5:this.isDefensiveTactic()?e+10:e},Enemy.prototype.decideIntent=function(e){return e?"attack":!this.isPanicked()||this.isFriendly&&this.currentRoom==this.gameController.player.currentRoom&&this.currentRoom.isSafe()?this.obeysCommand()?"ATK"===this.command?"attack":"FOL"===this.command?"follow":"STA"===this.command?"stand":"RET"===this.command?"flee":void 0:"attack":"flee"},Enemy.prototype.obeysCommand=function(){this.gameController.player;return!this.gameController.player.petAway||this.gameController.player.petAway!=this||(this.awayTurns||(this.awayTurns=0),this.awayTurns++,!(this.awayTurns>25&&chance(20))||(this.command="ATK",!1))},Enemy.prototype.canWearShield=function(){return!1},Enemy.prototype.buildSprite=function(e,t,r,i){this._buildSprite(e,t,r,i)},Enemy.prototype.resetSprite=function(){var e=this.sprite.y;this.isFloating()&&(e=this.sprite.baseY),this._buildSprite(this.sprite.x,e,this.gameController.mobGroup),this.facingLeft=!0},Enemy.prototype._buildSprite=function(e,t,r,i){this.sprite&&this.sprite.destroy();var s=this.gameController.player;if(s.isBlind()||this.race.features.invisible)this.sprite=this.gameController.phaser.add.image(e,t,"blank",0,r);else if(s.dungeonLevel.isRetro&&this.isFriendly)this.sprite=this.gameController.phaser.add.image(e,t,"tileset32",2,r);else if(s.isHallucinating()&&chance(60)){var n=this.gameController.monsterFactory.getSimilarRace(this.race);n||(n=this.race),this.sprite=this.gameController.phaser.add.image(e,t,"blank",0,r),this.morphSprite(n)}else if(this.race.features.noAnimation)this.sprite=this.gameController.phaser.add.image(e,t,"monsters",this.race.spriteIndex,r);else if(i)this.sprite=this.gameController.getImage(e,t,"animations32",1,r),this.sprite.animations.add("spawn",this.race.features.spawnAnimIndexes),this.sprite.animations.play("spawn",16),this.gameController.phaser.time.events.add(62.5*this.race.features.spawnAnimIndexes.length,function(){this.resetSprite()},this);else{var a=this.race.spriteIndex;a*=3;var o=this.gameController.phaser.add.image(e,t,"monsters",a,r);o.animations.add("breath",[a,a+1,a+2,a+1]);var h=this.race.features.animationSpeed;h||(h=4),this.isParalyzed()||o.animations.play("breath",h,!0),this.customBreathAnimation=!1,o.animations.next(rand(0,3)),this.sprite=o}this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.inputEnabled=!0,this.sprite.events.onInputDown.add(function(e,t){this.gameController.interactBridge(this,t)},this),this.isFloating()&&(this.sprite.baseY=this.sprite.y,this.gameController.floatAnimation(this.sprite))},Enemy.prototype.morphSprite=function(e){if(e.features.invisible)this.sprite.loadTexture("blank");else if(e.features.noAnimation)this.sprite.loadTexture("monsters",e.spriteIndex);else{var t=3*e.spriteIndex;this.sprite.loadTexture("monsters",t),this.sprite.animations.add("breath"+t,[t,t+1,t+2,t+1]);var r=this.race.features.animationSpeed;r||(r=4),this.isParalyzed()||this.sprite.animations.play("breath"+t,r,!0),this.customBreathAnimation="breath"+t,this.sprite.animations.next(rand(0,3))}},Enemy.prototype.stopBreathing=function(){this.sprite.animations.stop()},Enemy.prototype.resumeBreathing=function(){this.customBreathAnimation?this.sprite.animations.play(this.customBreathAnimation,4,!0):this.sprite.animations.play("breath",4,!0)},Enemy.prototype.mindMagicEffectPrevented=function(){return!1},Enemy.prototype.isWarrior=function(){return this.race.features.warrior},Enemy.prototype.takeDamage=function(e){this.hitPoints.reduce(e)},Enemy.prototype.takeDamageAndCheck=function(e){this.hitPoints.reduce(e),this.hitPoints.current<=0&&this.die(!0)};

},{"./AchievementsManager":1,"./AttackType.enum":5,"./Effects":10,"./Entity":12,"./Material.enum":19,"./Stat.class.js":32,"./Util":36,"circular-functions":43}],12:[function(require,module,exports){
module.exports={shake:function(e,a){e.flash(16711680),e.shaking=!0;var t=e.gameController,n=t.phaser.add.tween(e.sprite).to({x:e.sprite.x+5},50,Phaser.Easing.Linear.None,!1),r=t.phaser.add.tween(e.sprite).to({x:e.sprite.x-5},50,Phaser.Easing.Linear.None,!1),s=t.phaser.add.tween(e.sprite).to({x:e.sprite.x+3},50,Phaser.Easing.Linear.None,!1),o=t.phaser.add.tween(e.sprite).to({x:e.sprite.x-3},50,Phaser.Easing.Linear.None,!1),i=t.phaser.add.tween(e.sprite).to({x:e.sprite.x},50,Phaser.Easing.Linear.None,!1);n.onComplete.add(function(){t.playSFX("hit"),r.start()}),r.onComplete.add(function(){s.start()}),s.onComplete.add(function(){o.start()}),o.onComplete.add(function(){i.start()}),i.onComplete.add(function(){e.shaking=!1,a&&a(),e.onShakeOver&&(e.onShakeOver(),e.onShakeOver=!1)}),n.start()},shakeTimeMillis:250};

},{}],13:[function(require,module,exports){
var circular=require("circular-functions"),Effects=require("./Effects"),MapBorders=require("./MapBorders"),Util=require("./Util"),EventLog=require("./debug/EventLog"),Achievements=require("./AchievementsManager");function GameController(t,e){this.version=e.version,this.incrementalVersion=e.incrementalVersion,this.devMode=e.devMode,this.phaser=t,this.player=null,this.level=null,this.font="16px PixelFont",this.ptf=new PhaserTextField(this.phaser),this.fontColor="#dddddd",this.titleColor="#dddd00",this.fontSpec={font:this.font,fill:this.fontColor},this.titleSpec={font:this.font,fill:this.titleColor},this.isDesktop=e.isDesktop,this.soundsDisabled=e.soundsDisabled,this.isCocoon=e.isCocoon,this.isGold=1,this.tamActivated=this.isGold,this.setup=e,this.disablePromo=!1,this.assetLoadingErrors=!1,this.isDesktop?(this.ui=UILayout.DESKTOP,this.upperTapVerb="Click",this.tapVerb="click",this.tappingVerb="clicking",this.displayMode="DESKTOP"):("TABLET"===e.displayMode?(this.ui=UILayout.LANDSCAPE,this.setOrientation("landscape")):"PORTRAIT"===e.displayMode?(this.ui=UILayout.PORTRAIT,this.setOrientation("portrait")):"TRAILER"===e.displayMode?(this.ui=UILayout.TRAILER,this.setOrientation("landscape")):(this.ui=UILayout.CHIBI,this.setOrientation("landscape")),this.displayMode=e.displayMode,this.upperTapVerb="Tap",this.tapVerb="tap",this.tappingVerb="tapping"),this.isCocoon&&this.initBackButton(),this.currentCombatMessage=0,this.animationLength=300,this.attackLength=250,this.warpLength=300,this.ENTER_ROOM_TWEEN_TIME=500,this.storage=new Storage,this.panelStack=new Array,this.textAt={};var i=new Array;this.messagesStack=i,this.storage.getItem("preferences")?(this.preferences=JSON.parse(this.storage.getItem("preferences")),void 0===this.preferences.sfxEnabled&&(this.preferences.sfxEnabled=!0),void 0===this.preferences.fullScreenPreferred&&(this.preferences.fullScreenPreferred=!0)):this.preferences={soundEnabled:!0,musicEnabled:!0,sfxEnabled:!0,fullScreenPreferred:!0},this.musicController=new MusicController(this,this.preferences.musicEnabled),this.sfxController=new SFXController(this,this.preferences.sfxEnabled),this.communityClient=new CommunityClient(this),this.persistanceManager=new GamePersistance,this.storage.getItem("ananias.knows")?this.knows=JSON.parse(this.storage.getItem("ananias.knows")):this.knows={},this.mapMode="hidden",this.ui!=UILayout.CHIBI&&(this.mapMode="opaque"),this.tapActionSprites=[],this.buttonState={},this.track("Init"),this.eventLog=new EventLog(this),this.runningOnNWJS()&&this.preferences.fullScreenPreferred&&(this.fullScreen(),this.fullScreenRequested=!0)}module.exports=GameController;var MonsterFactory=require("./MonsterFactory.class.js"),ItemFactory=require("./ItemFactory.class.js"),Spells=require("./Spells.js"),DungeonBuilder=require("./DungeonBuilder.class.js"),Player=require("./Player.class.js"),MusicController=require("./MusicController.class.js"),SFXController=require("./SFXController.class.js"),CommunityClient=require("./CommunityClient.class.js"),InventoryPanel=require("./panels/InventoryPanel.class.js"),EntityInfoPanel=require("./panels/EntityInfoPanel.class.js"),BookPanel=require("./panels/BookPanel.class.js"),PromoPanel=require("./panels/PromoPanel.class"),HelpPanel=require("./panels/HelpPanel.class"),NewGamePanel=require("./panels/NewGamePanel.class"),CharacterCreationPanel=require("./panels/CharacterCreationPanel.class"),TitlePanel=require("./panels/TitlePanel.class"),SplashPanel=require("./panels/SplashPanel.class"),SelectUpgrade=require("./panels/SelectUpgrade.class"),GamePersistance=require("./GamePersistance.class"),CellType=require("./CellType.enum"),Storage=require("./Storage.class"),PhaserTextField=require("./PhaserTextField.class"),FishAddornment=require("./ui/FishAddornment.class"),LifeBar=require("./ui/LifeBar.class"),Dialog=require("./ui/Dialog.class");GameController.prototype.savePreferences=function(){this.storage.setItem("preferences",JSON.stringify(this.preferences))};var UILayout=require("./ui/Layouts");GameController.prototype.resetUI=function(){this.showingInventory=!1,this.refreshSpellIcons=!0,this.inventoryButtonText.text="Items",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.inventoryButtonText,this.ui.inventoryButton.x,this.ui.buttonSpecs.text.xCenter),this.inventoryButtonIcon.loadTexture("tileset32",113),this.petCommandGroup.visible=!0,this.tacticsGroup.visible=!0,this.ui.helpButton.onlyOnInventory?this.helpButtonGroup.visible=!1:this.helpButtonGroup.visible=!0,this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!0),this.ui.settingsOnlyOnInventory?this.settingsButtonGroup.visible=!1:this.settingsButtonGroup.visible=!0,this.shareCharacterButtonGroup.visible=!1,this.player&&this.player.previousWeapon?(this.switchButtonGroup.visible=!0,this.switchWeaponSprite.loadTexture(this.player.previousWeapon.menuSprite.texture)):this.switchButtonGroup.visible=!1,this.ui.minimap.toogleButton&&(this.toogleMapButtonGroup.visible=!0),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.toogleSpellsRowButtonGroup.visible=!0),this.titlePanel.hide(),this.promoPanel.hide(),this.helpPanel.hide(),this.messageStack=new Array,this.messageRepeatCounter=1,this.lastMessage="",this.MESSAGE_STACK_SIZE=9,this.YOFFSET=8,this.inventoryPanel.reset(),this.guiLayer.visible=!0,this.hudLayer.visible=!0,this.playerBlinking=!1,this.petBlinking=!1,this.knows.survivedFirstLevel?this.showDenziMessage("Denzi says...","Welcome to the Rift of Ananias. You may want to read the tome of Ananias ("+this.ui.helpButton.location+") for guidance."):this.showDenziMessage("Denzi says...","Listen to me carefully if you want to survive. "+this.upperTapVerb+" an arrow icon next to a corridor to move."),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.spellsRowGroup.visible=!1,this.showingSpellsRow=!1)},GameController.prototype.initialize=function(){this.phaser.stage.backgroundColor="#000000",this.bgLayer=this.phaser.add.group(),this.phaser.add.image(0,0,"background",this.bgLayer),this.mapLayer=this.phaser.add.group();var t=this.ui.mapScale||1;this.mapLayer.scale.setTo(t);var e=!1;this.ui.mainPanel.mapOverlay&&(this.mapOverlayer=this.phaser.add.group(),this.phaser.add.image(0,0,this.ui.mainPanel.mapOverlay,this.mapOverlayer),e=this.phaser.add.image(0,0,"background",this.mapOverlayer),this.mapOverlayer.scale.setTo(t)),this.initMapUI(),this.initGUI(),this.titlePanel=new TitlePanel(this),this.titlePanel.init(),this.splashPanel=new SplashPanel(this),this.splashPanel.init(),this.promoPanel=new PromoPanel(this),this.promoPanel.init(),this.helpPanel=new HelpPanel(this),this.helpPanel.init(),this.newGamePanel=new NewGamePanel(this),this.newGamePanel.init(),this.characterCreationPanel=new CharacterCreationPanel(this),this.characterCreationPanel.init(),this.selectUpgradeScreen=new SelectUpgrade(this),this.selectUpgradeScreen.init(),this.entityInfoPanel=new EntityInfoPanel(this),this.entityInfoPanel.init(),this.bookPanel=new BookPanel(this),this.bookPanel.init(),this.dialog=new Dialog(this),this.dialog.init(),(!this.soundsDisabled||this.isCocoon||this.setup.isNode)&&(this.sfxController.init(),this.musicController.init()),this.monsterFactory=new MonsterFactory(this),this.itemFactory=new ItemFactory(this),Achievements.init(this),this.builder=new DungeonBuilder(this.monsterFactory,this.itemFactory);var i=this;setTimeout(function(){e&&(e.visible=!1),i.splashPanel.show()},500),window.onerror=function(t,e,s,o,n){if(!i.devMode){var a="Critical Error: ["+t+"] on "+e+" ("+s+","+o+").\n\n";n&&(a+=n+".\n",n.message&&(a+=n.message+"\n"),n.stack&&(a+="\n\nStack:\n"+n.stack)),a+=i.gatherEnvironmentData(),i.communityClient.mailDevteam("Ananias "+i.version+" Error",a),i.player&&!i.player.dead&&i.player.currentRoom?(window.alert("A critical error just happened. I will now try to recover your game."),i.showingInventory&&i.hideInventory(),i.logEvent("Input enabled, After critical error"),i.enablePlayerAction()):(window.alert("A critical error just happened. Restarting game."),location.reload())}},this.secondTick()},GameController.prototype.gatherEnvironmentData=function(){var t="";return t+="\nVersion: "+this.version,t+="\nLoaded Game Version: "+this.loadedGameVersion,t+="\nContainer: "+this.getContainer(),"undefined"!=typeof device?(t+="\nCordova Version: "+device.cordova,t+="\nModel: "+device.model,t+="\nPlatform: "+device.platform,t+="\nUUID: "+device.uuid,t+="\nDevice Version: "+device.version,t+="\nManufacturer: "+device.manufacturer,t+="\nIs Virtual: "+device.isVirtual,t+="\nSerial: "+device.serial):t+="\nNo Device Info","undefined"!=typeof navigator?(t+="\nBrowser CodeName: "+navigator.appCodeName,t+="\nBrowser Name: "+navigator.appName,t+="\nBrowser Version: "+navigator.appVersion,t+="\nCookies Enabled: "+navigator.cookieEnabled,t+="\nBrowser Language: "+navigator.language,t+="\nBrowser Online: "+navigator.onLine,t+="\nPlatform: "+navigator.platform,t+="\nUser-agent header: "+navigator.userAgent):t+="\nNo Navigator Info",t+="\nAsset loading errors: "+this.assetLoadingErrors,t+="\n\nActivity Log:\n",t+=this.eventLog.getEventStack().join("\n")},GameController.prototype.sendTipToDevteam=function(t){this.communityClient.mailDevteam("Ananias "+this.version+" debug tip",t)},GameController.prototype.popMessage=function(){var t=this;if(this.gameOn){var e=t.messagesStack.shift();e?(t.showSocialMessage(e.messageText,e.highlight),setTimeout(function(){t.popMessage()},3500)):setTimeout(function(){t.popMessage()},500)}},GameController.prototype.addText=function(t,e,i,s,o){var n;return(n=this.phaser.add.text(t,e,i,s,o)).autoRound=!0,n.lineSpacing=-8,n},GameController.prototype.showSocialMessage=function(t,e){this.showSimpleMessage(t,e)},GameController.prototype.showSimpleMessage=function(t,e){this.simpleMessageLabel.visible=!0,this.simpleMessageLabel.text=t,this.centerText(this.simpleMessageLabel,this.ui.mainPanel.socialMessage.x,this.ui.mainPanel.socialMessage.width),this.popupCloseTime=Util.getCurrentTimeMillis()+1800;var i=this;this.phaser.time.events.add(2e3,function(){Util.getCurrentTimeMillis()>i.popupCloseTime&&(i.simpleMessageLabel.visible=!1)})},GameController.prototype.restartGame=function(t){this.playSFX("tap"),this.isCocoon||this.setup.isNode||this.devMode||this.fullScreenRequested||this.preferences.fullScreenPreferred&&(this.fullScreen(),this.fullScreenRequested=!0),this.persistanceManager.existsGame()?this.persistanceManager.savedGameOlderVersion(this)?this.dialog.alert("Warning",this.ui.oldVersionMessage,this._doLoadSavedGame.bind(this)):this._doLoadSavedGame():this.newGame(t)},GameController.prototype._doLoadSavedGame=function(){if(this.resetUI(),!this.persistanceManager.restoreGame(this))return this.resetUI(),void this.newGame(hardcoreMode);this.persistanceManager.deleteGame(),this.mapLayer.visible=!0,this.mapUILayer.visible=!0,this.newRoom=this.player.currentRoom,this.resetRoom(this.player.currentRoom),this.newRoom=null,this.showDenziMessage("Welcome back","Remember: Your save game can only be used once, save again if you want to reload!"),this.gameActive=!0,this.playerLifeBar.setStat(this.player.hitPoints),this.playerMagicBar.setStat(this.player.magicPoints),this.player.pet?(this.selectPetCommand(this.player.pet.command,!0),this.petCommandGroup.visible=!0,this.petLifeBar.setStat(this.player.pet.hitPoints)):this.petCommandGroup.visible=!1,this.tacticsGroup.visible=!0,this.selectTactic(this.player.getTactic(),!0),this.player.previousWeapon&&(this.switchButtonGroup.visible=!0,this.switchWeaponSprite.loadTexture(this.player.previousWeapon.menuSprite.texture)),this.setupUseAndThrowButtons(),this.applyButtonGroup.visible=!1,this.shareCharacterButtonGroup.visible=!1,this.confirmApplyButtonGroup.visible=!1,this.cancelApplyButtonGroup.visible=!1,this.selectATargetMessageText&&(this.selectATargetMessageText.visible=!1),this.selectedTargetIcon.visible=!1,this.updatePlayerStats(!1),this.inventoryPanel._relocateItemSprites(),this.musicController.stopMusic(),this.musicController.playDungeonMusic(),this.communityClient.startGame()},GameController.prototype.newGame=function(t){this.track("Start Game"),this.loadedGameVersion=!1,this.resetUI(),this.depth=0,this.player=new Player(this),this.player.hardcoreMode=t,this.player.weaponDegEnabled=!!this.preferences.weaponDegEnabled,this.newGamePanel.show()},GameController.prototype.stopGame=function(){this.musicController.stopMusic(),this.settingsButtonGroup.visible=!1,this.helpButtonGroup.visible=!1,this.applyButtonGroup.visible=!1,this.confirmApplyButtonGroup.visible=!1,this.cancelApplyButtonGroup.visible=!1,this.selectATargetMessageText&&(this.selectATargetMessageText.visible=!1),this.selectedTargetIcon.visible=!1,this.switchButtonGroup.visible=!1,this.useButtonGroup.visible=!1,this.dropButtonGroup.visible=!1,this.petCommandGroup.visible=!1,this.tacticsGroup.visible=!1,this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!1),this.persistanceManager.saveScore(this.player,this.depth)},GameController.prototype.showGameOverScreen=function(){this.stopGame(),this.hideDirectionalPad();var t=this.player;if(this.watchedObjectNameText.text="Game Over","center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),t.lastAttacker){t.lastAttacker.sprite||(t.lastAttacker.buildSprite(0,0,void 0,!1),t.lastAttacker.sprite.visible=!1);var e=t.lastAttacker.race.features.unique?"":"a ";this.watchedObjectSprite.loadTexture(t.lastAttacker.sprite.texture),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),t.deathReason="#You# #are# #kill# by "+e+t.lastAttacker.race.name,this.watchedObjectDescriptionText.text=t.replaceKeys(t.deathReason),this.communityClient.deathEvent(t.className,this.depth,t.lastAttacker.race.name)}else t.lastDamagingItem?(t.lastDamagingItem.menuSprite||t.lastDamagingItem.setMenuSprite(),this.watchedObjectSprite.loadTexture(t.lastDamagingItem.menuSprite.texture),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),t.deathReason="#You# #die# by "+t.lastDamagingDescription,this.watchedObjectDescriptionText.text=t.replaceKeys(t.deathReason),this.communityClient.deathEventAccident(t.className,this.depth,t.lastDamagingDescription)):t.lastDamagingSpell&&(this.watchedObjectSprite.loadTexture(Spells.getIconTexture(this,t.lastDamagingSpell)),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),t.deathReason="#You# #die# by "+t.lastDamagingDescription,this.watchedObjectDescriptionText.text=t.replaceKeys(t.deathReason),this.communityClient.deathEventAccident(t.className,this.depth,t.lastDamagingDescription));if("center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.communityClient.token&&(!this.loadedGameVersion||this.loadedGameVersion===this.version)){var i={className:t.shortClassName,characterSex:t.isMale?"Male":"Female",depth:this.depth,kills:t.kills,hardcoreMode:t.hardcoreMode,won:!1};this.communityClient.saveScore(i)}this.persistanceManager.deleteGame(),t.won=!1,this.showingInventory||(this.disablePlayerAction(),this.killImage(this.player.sprite),this.inventoryButtonText.text="Back",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.inventoryButtonText,this.ui.inventoryButton.x,this.ui.buttonSpecs.text.xCenter),this.inventoryButtonIcon.loadTexture("tileset32",130)),this.entityInfoPanel.show(this.player)},GameController.prototype.shareCharacterStory=function(){var t=this;this.player.deathId?this.openURL(this.communityClient.apiPath+"grave/"+this.player.deathId):this.communityClient.shareCharacter(this.player,{ok:function(e){t.player.deathId=e.id,t.openURL(t.communityClient.apiPath+"grave/"+e.id)},error:function(){window.alert("Error creating character story.")}})},GameController.prototype.showWinGameScreen=function(){this.stopGame();var t=this.player;if(t.won=!0,t.isGod=!0,this.updatePlayerSprite(),this.watchedObjectSprite.loadTexture(t.sprite.texture),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),this.watchedObjectNameText.text="You Win!","center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),t.deathReason="#You# #become# a god by wearing the Ring of Ananias",this.watchedObjectDescriptionText.text=t.replaceKeys(t.deathReason),"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.communityClient.winEvent(t.className),this.inputDisabled=!1,this.logEvent("Input enabled showWinGameScreen"),this.communityClient.token&&(!this.loadedGameVersion||this.loadedGameVersion===this.version)){var e={className:t.shortClassName,characterSex:t.isMale?"Male":"Female",depth:this.depth,kills:t.kills,hardcoreMode:t.hardcoreMode,won:!0};this.communityClient.saveScore(e)}this.persistanceManager.deleteGame(),this.showingInventory||this.disablePlayerAction(),Achievements.achieveWin(this.player),this.entityInfoPanel.show(this.player)},GameController.prototype.createButton=function(t,e,i,s,o,n,a,r){var l=r&&r.buttonSpecs?r.buttonSpecs:this.ui.buttonSpecs,h=l.tileset,p=l.indexes,c=l.icon.x,u=l.icon.y,d=l.text.x,m=l.text.y;r&&r.tooltipXOff&&(d=r.tooltipXOff);var y=t.x,g=t.y,v=r&&r.tileset?r.tileset:"tileset32",b=!1;r&&r.createGroup&&(b=o=this.phaser.add.group(o));var f=this.phaser.add.image(y,g,h,p[e],o),x=this.phaser.add.image(y+c,g+u,v,i,o),w=this.addText(y+d,g+m,s,this.fontSpec,o),I=!1;return n&&l.small&&(I=this.phaser.add.image(y+c,g+u,"tileset32",n,o)),l.text.xCenter&&this.centerText(w,y,l.text.xCenter),f.inputEnabled=!0,l.small&&(w.isAnaniasTooltip=!0,w.visible=!1,a||this.ui.noTooltips||(f.events.onInputOver.add(function(){this.visible=!0},w),f.events.onInputOut.add(function(){this.visible=!1},w))),{button:f,icon:x,label:w,overlay:I,createdGroup:b}},GameController.prototype.centerButtonLabel=function(t,e){var i=this.ui.buttonSpecs.small?192:256;this.centerText(t,e,i)},GameController.prototype.createHButton=function(t,e,i,s){return this._createHButton(t,e,i,this.ui.buttonSpecs.small,s)},GameController.prototype._createHButton=function(t,e,i,s,o){var n=s?"horizontalButton48":"horizontalButton",a=s?192:256,r=s?15:25;o&&o.size&&128===o.size&&(n="horizontalButton48-128",a=128,r=15);var l=t.x,h=t.y,p=e.length%4;o&&o.createGroup&&(i=this.phaser.add.group(i));var c=this.phaser.add.image(l,h,n,p,i),u=this.addText(l,h+r,e,this.fontSpec,i);return this.centerText(u,l,a),c.inputEnabled=!0,{button:c,label:u,createdGroup:i}},GameController.prototype.initMapUI=function(){this.mapUILayer=this.phaser.add.group(),this.mapUILayer.visible=!1;var t=this.ui.mapPanel.x+24;this.ui.mapPanel.statusAilments&&(t=this.ui.mapPanel.statusAilments.baseX.player),this.statusText=this.addText(t,0,"",this.fontSpec,this.mapUILayer),this.petStatusText=this.addText(0,0,"",{font:this.font,fill:this.fontColor,align:"right"},this.mapUILayer)},GameController.prototype.initGUI=function(){this.hudLayer=this.phaser.add.group(),this.hudLayer.visible=!1;var t=this.phaser.add.group();t.visible=!1,this.guiLayer=this.phaser.add.group(),this.guiLayer.visible=!1,this.ui.mainPanel.portrait&&(this.portraitSprite=this.phaser.add.image(this.ui.mainPanel.portrait.x,this.ui.mainPanel.portrait.y,"blank",0,this.hudLayer),this.characterNameLabel=this.addText(this.ui.mainPanel.portrait.x+52,this.ui.mainPanel.portrait.y,"",this.fontSpec,this.hudLayer)),this.hpText=this.addText(this.ui.hpIcon.x+16,this.ui.hpIcon.y+2,"",this.fontSpec,this.hudLayer),this.phaser.add.image(this.ui.hpIcon.x,this.ui.hpIcon.y,"tileset16",32,this.hudLayer),this.mpText=this.addText(this.ui.mpIcon.x+16,this.ui.mpIcon.y+2,"",this.fontSpec,this.hudLayer),this.mpIcon=this.phaser.add.image(this.ui.mpIcon.x,this.ui.mpIcon.y,"tileset16",48,this.hudLayer),this.mpIcon.animations.add("shine",[48,49,50,49]),this.mpIcon.animations.play("shine",4,!0);var e=this.ui.petIcon.x,i=this.ui.petIcon.x+16;this.ui.skillPointsIcon.rightAlign&&(e=this.ui.petIcon.x-16,i=this.ui.petIcon.x-16),this.skillPointsText=this.addText(i,this.ui.skillPointsIcon.y+2,"",this.fontSpec,this.hudLayer),this.skillPointsIcon=this.phaser.add.image(e,this.ui.skillPointsIcon.y,"tileset16",48,this.hudLayer),this.skillPointsIcon.animations.add("shine",[48,49,50,49]),this.skillPointsIcon.animations.play("shine",4,!0),this.petText=this.addText(i,this.ui.petIcon.y+2,"",this.fontSpec,this.hudLayer),this.petHPIcon=this.phaser.add.image(e,this.ui.petIcon.y,"tileset16",34,this.hudLayer),this.ui.skillPointsIcon.rightAlign&&(this.petText._baseX=this.petText.x,this.skillPointsText._baseX=this.skillPointsText.x),this.weaponText=this.addText(this.ui.weaponIcon.x+16,this.ui.weaponIcon.y,"",this.fontSpec,this.hudLayer),this.armorText=this.addText(this.ui.armorIcon.x+16,this.ui.armorIcon.y,"",this.fontSpec,this.hudLayer),this.weaponSprite=this.phaser.add.image(this.ui.weaponIcon.x,this.ui.weaponIcon.y,"",1,this.hudLayer),this.armorSprite=this.phaser.add.image(this.ui.armorIcon.x,this.ui.armorIcon.y,"",1,this.hudLayer),this.projectileSprite=this.phaser.add.image(0,0,"",this.mobGroup),this.projectileSprite.visible=!1;var s=!1,o={x:this.ui.inspector.x,y:this.ui.inspector.y,w:this.ui.inspector.width,titleLines:this.ui.inspector.titleLines,descriptionLines:this.ui.inspector.descriptionLines};(o.titleLines||(o.titleLines=1),this.objectInspectorGroup=this.phaser.add.group(this.guiLayer),this.ui.inspector.toogleButton&&(this.objectInspectorGroup.visible=!1),this.ui.inspector.scrollBackground)&&(this.phaser.add.image(this.ui.inspector.x-36,this.ui.inspector.y-16,"dialog",0,this.objectInspectorGroup).inputEnabled=!0);s=this.ui.inspector.centeredLayout?{sprite:{x:o.x+Math.floor(o.w/2)-16,y:o.y},title:{x:o.x,y:o.y+36,width:o.w,centered:!0},text:{x:o.x,y:o.y+36+20*o.titleLines,width:o.w,centered:!0}}:this.ui.inspector.scrollBackground?{sprite:{x:o.x-16,y:o.y},title:{x:o.x+20,y:o.y+this.ui.inspector.yOffset,width:o.w-20},text:{x:o.x-16,y:o.y+32,width:o.w+16}}:{sprite:{x:o.x,y:o.y},title:{x:o.x+36,y:o.y+this.ui.inspector.yOffset,width:o.w-36},text:{x:o.x,y:o.y+32,width:o.w}},this.watchedObjectSprite=this.phaser.add.image(s.sprite.x,s.sprite.y,"tileset32",1,this.objectInspectorGroup),this.watchedObjectNameText=this.addText(s.title.x,s.title.y,"Denzi says...",{font:this.font,fill:this.titleColor,wordWrap:this.ui.inspector.titleWrap,wordWrapWidth:s.title.width,maxLines:o.titleLines},this.objectInspectorGroup),s.title.centered&&(this.watchedObjectNameText.align="center",this.watchedObjectNameText.ananiasCenterWidth=s.title.width,this.watchedObjectNameText.ananiasBaseX=s.title.x),this.watchedObjectDescriptionText=this.addText(s.text.x,s.text.y,"Listen to me carefully if you want to survive. "+this.upperTapVerb+" an arrow icon next to a corridor to move.",{font:this.font,fill:this.fontColor,wordWrap:!0,wordWrapWidth:s.text.width,maxLines:o.descriptionLines},this.objectInspectorGroup),s.text.centered&&(this.watchedObjectDescriptionText.align="center",this.watchedObjectDescriptionText.ananiasCenterWidth=s.text.width,this.watchedObjectDescriptionText.ananiasBaseX=s.text.x),this.watchedObjectNameText.lineSpacing=-8,this.watchedObjectDescriptionText.lineSpacing=-8,this.miniMapGroup=this.phaser.add.group(this.guiLayer),this.mapScrollImage=this.phaser.add.image(this.ui.minimap.x-16,this.ui.minimap.y-16,"mapScroll",0,this.miniMapGroup),this.minimapBMD=this.phaser.add.bitmapData(96,96),this.minimap=this.phaser.add.image(this.ui.minimap.x,this.ui.minimap.y,this.minimapBMD,null,this.miniMapGroup),this.ui.minimap.toogleButton&&(this.miniMapGroup.visible=!1),this.inventoryButtonGroup=this.phaser.add.group(this.guiLayer),this.petCommandGroup=this.phaser.add.group(this.guiLayer),this.applyButtonGroup=this.phaser.add.group(this.guiLayer),this.shareCharacterButtonGroup=this.phaser.add.group(this.guiLayer),this.useButtonGroup=this.phaser.add.group(this.guiLayer),this.dropButtonGroup=this.phaser.add.group(this.guiLayer),this.switchButtonGroup=this.phaser.add.group(this.guiLayer),this.settingsButtonGroup=this.phaser.add.group(this.guiLayer),this.helpButtonGroup=this.phaser.add.group(this.guiLayer),this.tacticsGroup=this.phaser.add.group(this.guiLayer);var n=this.createButton(this.ui.inventoryButton,0,113,"Items",this.inventoryButtonGroup);this.inventoryButton=n.button,this.inventoryButtonIcon=n.icon,this.inventoryButtonText=n.label,n=this.createButton(this.ui.petCommandButton,1,119,"Cover",this.petCommandGroup),this.petCommandButton=n.button,this.currentPetCommandIcon=n.icon,this.currentPetCommandText=n.label,n=this.createButton(this.ui.tacticsButton,1,108,"Stand",this.tacticsGroup,!1),this.tacticsButton=n.button,this.tacticsIcon=n.icon,this.tacticsText=n.label,n=this.createButton(this.ui.applyButton,2,115,"Use On",this.applyButtonGroup,157),this.applyButton=n.button,this.applyButtonText=n.label,n=this.createButton(this.ui.buttons.shareCharacter,3,116,"Share",this.shareCharacterButtonGroup),this.shareCharacterButton=n.button;var a=(n=this.createButton(this.ui.useButton,4,114,"Use",this.useButtonGroup,158)).button;this.useButtonImage=n.icon,this.useButtonText=n.label,this.ui.buttonSpecs.small&&(this.useButtonOverlay=n.overlay);var r=(n=this.createButton(this.ui.dropButton,5,112,"Drop",this.dropButtonGroup,172)).button,l=(n=this.createButton(this.ui.switchButton,6,114,"Switch",this.switchButtonGroup,159)).button;this.switchWeaponSprite=n.icon;var h=(n=this.createButton(this.ui.settingsButton,7,138,!this.ui.settingsButton.noTooltip&&"Menu",this.settingsButtonGroup,!1,!1,{tooltipXOff:-45})).button;if(this.settingsButtonIcon=n.icon,this.settingsButtonText=n.label,n=this.createButton(this.ui.helpButton,7,127,"Help",this.helpButtonGroup,174,!1,{tooltipXOff:-40}),this.helpButton=n.button,this.showMovementButtons=!1,this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup=this.phaser.add.group(this.guiLayer),n=this.createButton(this.ui.zoomedMovementButton,6,135,this.ui.bigDirectionPad?"Pad":"Zoomed",this.moveButtonGroup),this.moveButtonIcon=n.icon,this.moveButtonText=n.label,n.button.events.onInputDown.add(this.switchMoveButtons,this)),this.inventoryButton.events.onInputDown.add(this.switchInventory,this),this.helpButton.events.onInputDown.add(this.showHelp,this),this.petCommandButton.inputEnabled=!0,this.petCommandButton.events.onInputDown.add(this.switchPetCommand,this),this.tacticsButton.inputEnabled=!0,this.tacticsButton.events.onInputDown.add(this.switchTactics,this),this.applyButton.inputEnabled=!0,this.applyButton.events.onInputDown.add(this.applyItemOrSpell,this),this.applyButtonGroup.visible=!1,this.shareCharacterButton.inputEnabled=!0,this.shareCharacterButton.events.onInputDown.add(this.shareCharacterStory,this),this.shareCharacterButtonGroup.visible=!1,a.inputEnabled=!0,a.events.onInputDown.add(this.useItem,this),this.useButtonGroup.visible=!1,r.inputEnabled=!0,r.events.onInputDown.add(this.dropItem,this),this.dropButtonGroup.visible=!1,l.inputEnabled=!0,l.events.onInputDown.add(this.switchWeapon,this),this.switchButtonGroup.visible=!1,h.inputEnabled=!0,h.events.onInputDown.add(this.showSettingsMenu,this),this.ui.minimap.toogleButton){this.toogleMapButtonGroup=this.phaser.add.group(this.guiLayer),this.tinymapBMD=this.phaser.add.bitmapData(48,48),this.phaser.add.image(this.ui.minimap.micromap.x,this.ui.minimap.micromap.y,this.tinymapBMD,null,this.toogleMapButtonGroup);var p=this.phaser.add.image(this.ui.minimap.toogleButton.x,this.ui.minimap.toogleButton.y,"blank",0,this.toogleMapButtonGroup);p.inputEnabled=!0,p.events.onInputDown.add(this.toogleMapVisible,this)}if(this.ui.lowerBar&&this.phaser.add.image(this.ui.lowerBar.x,this.ui.lowerBar.y,"lowerBar",null,this.hudLayer),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.toogleSpellsRowButtonGroup=this.phaser.add.group(this.guiLayer),(n=this.createButton(this.ui.mainPanel.spellsRow.toogleButton,2,119,"Special",this.toogleSpellsRowButtonGroup,!1,!0)).button.inputEnabled=!0,n.button.events.onInputDown.add(this.toogleSpellsRowVisible,this),this.showingSpellsRow=!1),this.ui.inspector.toogleButton&&(this.toogleInspectorButtonGroup=this.phaser.add.group(this.guiLayer),(n=this.createButton(this.ui.inspector.toogleButton,2,127,"Inspector",this.toogleInspectorButtonGroup,156,!0)).button.inputEnabled=!0,n.button.events.onInputDown.add(this.toogleInspectorVisible,this),this.inspectorButtonIcon=n.icon,this.inspectorButton=n.button,this.ui.buttonSpecs.small&&(this.inspectorButtonOverlay=n.overlay)),this.confirmApplyButtonGroup=this.phaser.add.group(this.guiLayer),n=this.createButton(this.ui.confirmApplyButton,0,129,"Ok",this.confirmApplyButtonGroup,!1,!0),this.confirmApplyButton=n.button,this.confirmApplyButton.inputEnabled=!0,this.confirmApplyButton.events.onInputDown.add(this.confirmApplyBase,this),this.confirmApplyButtonGroup.visible=!1,this.cancelApplyButtonGroup=this.phaser.add.group(this.guiLayer),n=this.createButton(this.ui.cancelApplyButton,1,128,"Cancel",this.cancelApplyButtonGroup,!1,!0),this.cancelApplyButton=n.button,this.cancelApplyButton.inputEnabled=!0,this.cancelApplyButton.events.onInputDown.add(this.cancelApplyItem,this),this.cancelApplyButtonGroup.visible=!1,this.ui.selectATargetMessage&&(this.selectATargetMessageText=this.addText(this.ui.selectATargetMessage.x,this.ui.selectATargetMessage.y,"Select a target",this.fontSpec,this.hudLayer),this.selectATargetMessageText.align="center",this.centerText(this.selectATargetMessageText,this.ui.selectATargetMessage.x,this.ui.selectATargetMessage.width),this.selectATargetMessageText.visible=!1),this.initDirectionalButtonsHiRes(),this.ui.mainPanel.useZoomedMovement&&this.initDirectionalButtons(),this.useKeyboard()&&this.initKeyboard(),this.selectedTargetIcon=this.phaser.add.image(0,0,"tileset32",136,this.guiLayer),this.selectedTargetIcon.visible=!1,this.playerLifeBar=new LifeBar(this.ui.mainPanel.lifeBar.x,this.ui.mainPanel.lifeBar.y,this.hudLayer,this.phaser,{width:this.ui.mainPanel.lifeBar.width,height:3}),this.playerMagicBar=new LifeBar(this.ui.mainPanel.magicBar.x,this.ui.mainPanel.magicBar.y,this.hudLayer,this.phaser,{width:this.ui.mainPanel.magicBar.width,height:3,colour:"0x00FFFF"}),this.petLifeBar=new LifeBar(this.ui.mainPanel.petLifeBar.x,this.ui.mainPanel.petLifeBar.y,this.hudLayer,this.phaser,{width:this.ui.mainPanel.petLifeBar.width,height:3,reverse:this.ui.mainPanel.petLifeBar.reverse}),this.inventoryPanel=new InventoryPanel(this,t),this.depthText=this.addText(this.ui.minimap.x+60,this.ui.minimap.y+76,"",{font:this.font,fill:"#582000"},this.miniMapGroup),this.ui.minimap.hideDepth&&(this.depthText.visible=!1),this.ui.mainPanel.spellsRow){var c=this.ui.mainPanel.spellsRow,u=this.hudLayer;if(c.toogleButton?(this.spellsRowGroup=this.phaser.add.group(u),this.spellsRowGroup.visible=!1,u=this.spellsRowGroup):this.spellsRowGroup=u,!this.ui.lowerBar)for(var d=0;d<8;d++)this.ui.mainPanel.spellsRow.vertical?this.phaser.add.image(c.x,d*c.space+c.y,c.icon.name,c.icon.index,u):this.phaser.add.image(d*c.space+c.x,c.y,c.icon.name,c.icon.index,u);this.selectedSpellBox=this.getImage(0,0,c.selectedIcon.name,c.selectedIcon.index,u),this.selectedSpellBox.visible=!1}this.simpleMessageLabel=this.addText(this.ui.mainPanel.socialMessage.x,this.ui.mainPanel.socialMessage.y,"",{font:this.font,fill:this.fontColor,wordWrap:!0,align:"center",wordWrapWidth:this.ui.mainPanel.socialMessage.width},this.guiLayer),this.simpleMessageLabel.setShadow(-1,1,"rgba(0,0,0,1)",0),this.simpleMessageLabel.visible=!1,this.simpleMessageLabel.lineSpacing=-8,this.locationImageGroup=this.phaser.add.group(this.guiLayer),this.locationImageGroup.visible=!1;var m=this.phaser.add.image(0,0,"background",0,this.locationImageGroup);this.locationImage=this.phaser.add.image(this.ui.locationImage.x,this.ui.locationImage.y,"intros",0,this.locationImageGroup),this.locationText=this.addText(this.ui.locationImage.x-20,this.ui.locationImage.y+72,"",{font:this.font,fill:this.titleColor,wordWrap:!0,align:"center",wordWrapWidth:200},this.locationImageGroup),this.locationText.text="Level Complete\n\n\n\n\n"+this.upperTapVerb+" to continue",this.locationText.x=this.ui.locationImage.x-20+Math.round((200-this.locationText.width)/2),this.locationText.lineSpacing=-8,this.locationDetailText=this.addText(this.ui.locationImage.x-20,this.ui.locationImage.y+90,"",{font:this.font,fill:this.fontColor,wordWrap:!0,align:"center",wordWrapWidth:200},this.locationImageGroup),this.locationDetailText.lineSpacing=-8,m.inputEnabled=!0,m.events.onInputDown.add(function(t){this.tryLevelUp(),this.locationImageGroup.visible=!1,this.hudLayer.visible=!0},this)},GameController.prototype.updateSpellIcons=function(){this.spellsGroup&&this.killAllImagesOnGroup(this.spellsGroup);var t=this.ui.mainPanel.spellsRow;t.toogleButton?this.spellsGroup=this.phaser.add.group(this.spellsRowGroup):this.spellsGroup=this.phaser.add.group(this.hudLayer),this.spellsGroup.visible=!0;for(var e=this.player.spells,i=0;i<e.length;i++){var s=e[i];if(this.ui.mainPanel.spellsRow.vertical)var o=this.getImage(t.x,i*t.space+t.y,"spells",s.icon,this.spellsGroup);else o=this.getImage(i*t.space+t.x,t.y,"spells",s.icon,this.spellsGroup);o.inputEnabled=!0,o.visible=!0;var n=this;o.events.onInputDown.add(function(t,e){n.interactSpellBridge(this,n.isDoubleTap(e))},s)}},GameController.prototype.isDoubleTap=function(t){if(!t.previousTapTime)return!1;var e=!1;return t.previousTapTime&&t.previousX&&t.previousY&&Math.abs(t.previousX-t.x)<8&&Math.abs(t.previousY-t.y)<8&&(e=Date.now()-t.previousTapTime<400),t.previousX=t.x,t.previousY=t.y,e},GameController.prototype.initDirectionalButtons=function(){this.ui.bigDirectionPad?this._initBigMovementButtons():this._initOnMapArrows()},GameController.prototype._initBigMovementButtons=function(){var t=this.ui.bigDirectionPad.x,e=this.ui.bigDirectionPad.y;this.bigDirectionButtons=new Array,this.runningIndicators=new Array;for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++){var o=t+64*(i+1),n=e+64*(s+1),a=0;if(0==i&&0==s)a=1;else switch(a=96,i){case-1:a+=-1==s?3:0==s?5:0;break;case 0:a+=-1==s?6:4;break;case 1:a+=-1==s?2:0==s?7:1}var r=this.createButton({x:o,y:n},rand(0,3),a,1===a?"Self":"",this.guiLayer,!1,!0,{createGroup:!0}),l=this;!function(t){r.button.events.onInputDown.add(function(){l.move(t)},l),r.button.direction=t}({x:i,y:s}),r.createdGroup.visible=!1,this.bigDirectionButtons.push(r.createdGroup);var h=this.phaser.add.image(0,0,"tileset32",a+8-16,this.guiLayer);h.visible=!1,h.direction={x:i,y:s},this.runningIndicators.push(h)}},GameController.prototype._initOnMapArrows=function(){var t=this.ui.mapPanel.x+16,e=this.ui.mapPanel.y+16;this.bigDirectionButtons=new Array,this.runningIndicators=new Array;for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++){var o=t+96*(i+1),n=e+96*(s+1),a=this.phaser.add.image(o,n,"tileset96",0,this.guiLayer);a.inputEnabled=!0;var r=this;!function(t){a.events.onInputDown.add(function(){r.move(t)},r),a.direction=t}({x:i,y:s}),a.visible=!1,this.bigDirectionButtons.push(a);var l=0==i&&0==s?"blank":"tileset32",h=0;if("blank"!==l)switch(h=96,i){case-1:h+=-1==s?3:0==s?5:0;break;case 0:h+=-1==s?6:4;break;case 1:h+=-1==s?2:0==s?7:1}var p=this.phaser.add.bitmapData(96,96),c=this.phaser.add.image(0,0,l,h);p.draw(c,32,32),c.destroy(),a.loadTexture(p),a.baseSpriteIndex=h,this.tween(a).to({x:o+16*i,y:n+16*s},1500,Phaser.Easing.Sinusoidal.Out,!0,0,Number.MAX_VALUE,!0);var u=this.phaser.add.image(0,0,l,h+8-16,this.guiLayer);u.visible=!1,u.direction={x:i,y:s},this.runningIndicators.push(u)}},GameController.prototype.initDirectionalButtonsHiRes=function(){this.directionButtons=new Array;for(var t=-1;t<=1;t++)for(var e=-1;e<=1;e++){var i=0==t&&0==e?"blank":"tileset32",s=0;if("blank"!==i)switch(s=80,t){case-1:s+=-1==e?3:0==e?5:0;break;case 0:s+=-1==e?6:4;break;case 1:s+=-1==e?2:0==e?7:1}var o=s;this.showMovementArrows()||(i="blank",o=0);var n=this.phaser.add.image(32*t,32*e,i,o,this.guiLayer);n.baseSpriteIndex=s,n.inputEnabled=!0;var a=this;!function(t){n.events.onInputDown.add(function(){a.move(t)},a),n.direction=t}({x:t,y:e}),n.visible=!1,this.directionButtons.push(n)}},GameController.prototype.move=function(t,e){if(this.targetSelectionActive&&0==t.x&&0==t.y)this.targetSelf();else if(this.player.currentRoom&&!this.inputDisabled&&this.movementEnabled){var i=t.x,s=t.y,o=!1;if(0==i&&0==s&&!e){var n=this,a=this.player.currentRoom.getItem(this.player.x,this.player.y),r=this.player.currentRoom.isStairs(this.player.x,this.player.y),l=this.player.currentRoom.isPond(this.player.x,this.player.y);if(this.player.currentRoom.isSafe()&&(a?1:0)+(r?1:0)+(l?1:0)==1&&(a=!1,r=!1,l=!1),a||r||l){var h=[];return this.player.currentRoom.isSafe()||h.push({text:"Pass the turn",action:function(){n.dialog.hide(),n.move(t,"SELF")}}),a&&h.push({text:"Pick up the item",action:function(){n.dialog.hide(),n.move(t,"ITEM")}}),r&&h.push({text:"Use the magic gate",action:function(){n.dialog.hide(),n.move(t,"STAIRS")}}),l&&h.push({text:"Drink from pond",action:function(){n.dialog.hide(),n.move(t,"POND")}}),h.length>3&&(h=h.slice(0,3)),void this.dialog.show("Select One","",h,!0)}o=!0}var p=0==i&&0==s;if(this.player.moveConfused())for(i=0,s=0;0==i&&0==s;)i=rand(-1,1),s=rand(-1,1);var c=this.player.x+i,u=this.player.y+s,d=this.player.currentRoom.getPortalOnXY(c-i,u-s);if(d&&d.dx==i&&d.dy==s)return this.disablePlayerAction(),void this.player.interactWithDoor(d);if(this.player.currentRoom.isValidIncludingBorders(c,u)){if(0!=i||0!=s){var m=this.player.currentRoom.getEnemy(c,u);if(m)return void this.interactBridge(m)}!(a=this.player.currentRoom.getItem(c,u))||!o&&p&&"ITEM"!==e?!this.player.currentRoom.isStairs(c,u)||!o&&p&&"STAIRS"!==e?!this.player.currentRoom.isPond(c,u)||!o&&p&&"POND"!==e?(0==i&&0==s||this.player.currentRoom.isFreeFloor(c,u))&&(this.disablePlayerAction(),this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!1),this.player.walkTo({x:this.player.x+i,y:this.player.y+s})):this.interactPondBridge():this.interactStairsBridge():this.interactItemBridge(a,!0)}}},GameController.prototype.targetSelf=function(){this.currentTargetIndex=this.targetsList.indexOf(this.player);var t="Use item on",e=!1;e=this.selectedItemToApply?this.selectedItemToApply:this.inventoryPanel.selectedItem;var i=this.inventoryPanel.selectedSpell;i||(i=this.selectedSpell),e?e.features.isSpell&&(t="Cast spell on"):i&&(t="Cast spell on"),this.watchedObjectDescriptionText.text=this.upperTapVerb+" on the target\n"+t+" yourself?","center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.ui.selectATargetMessage&&(this.selectATargetMessageText.text=this.upperTapVerb+" on the target\n"+t+" yourself?",this.centerText(this.selectATargetMessageText,this.ui.selectATargetMessage.x,this.ui.selectATargetMessage.width)),this.selectedTarget=!1,this.showConfirmTargetButtons(this.player)},GameController.prototype.showConfirmTargetButtons=function(t){this.selectedTargetIcon.x=t.sprite.x+this.mapOffset.x-16,this.selectedTargetIcon.y=t.sprite.y+this.mapOffset.y-24;var e=t.sprite.y+this.mapOffset.y-24;this.selectedTargetIcon.visible=!0,this.selectedTargetIcon.currentTween&&this.selectedTargetIcon.currentTween.stop(),this.selectedTargetIcon.currentTween=this.tween(this.selectedTargetIcon),this.selectedTargetIcon.currentTween.to({y:e-8},700,Phaser.Easing.Linear.None,!0,0,Number.MAX_VALUE,!0),this.confirmApplyButtonGroup.visible=!0},GameController.prototype.updatePetStats=function(){var t=this.ui.mapPanel.width,e=this.ui.mapPanel.height;if(this.player.pet){this.petText.text=""+this.player.pet.hitPoints.getText(),this.petLifeBar.update(),this.skillPointsText.text=""+this.player.pet.skillPoints,this.ui.skillPointsIcon.rightAlign&&(this.petText.x=this.petText._baseX-this.petText.width,this.skillPointsText.x=this.skillPointsText._baseX-this.skillPointsText.width),this.petHPIcon.visible=!0,this.player.pet.skillPoints>0?(this.skillPointsIcon.visible=!0,this.skillPointsText.visible=!0):(this.skillPointsIcon.visible=!1,this.skillPointsText.visible=!1),this.petCommandGroup.visible=!0;var i=this.player.pet.getStatusAilments(),s=this.ui.mapPanel.y+e-30;if(this.ui.mapPanel.statusAilments&&(s=this.ui.mapPanel.statusAilments.baseY),i){var o="";this.petStatusText.y=s-16*i.length;for(var n=0;n<i.length;n++)o+=i[n]+"\n";this.petStatusText.text=o;var a=this.ui.mapPanel.x+t-24;this.ui.mapPanel.statusAilments&&(a=this.ui.mapPanel.statusAilments.baseX.pet),this.petStatusText.x=a-this.petStatusText.width}else this.petStatusText.text=""}else if(this.petText.text="",this.petLifeBar.clear(),this.skillPointsText.text="",this.petHPIcon.visible=!1,this.skillPointsIcon.visible=!1,this.petCommandGroup.visible=!1,this.player.petAway){s=this.ui.mapPanel.y+e-30,a=this.ui.mapPanel.x+t-24;this.ui.mapPanel.statusAilments&&(s=this.ui.mapPanel.statusAilments.baseY,a=this.ui.mapPanel.statusAilments.baseX.pet),this.petStatusText.text="Away",this.petStatusText.y=s-16,this.petStatusText.x=a-this.petStatusText.width}else this.petStatusText.text=""},GameController.prototype.updatePlayerStats=function(t){this.hpText.text=""+this.player.hitPoints.getText(),this.mpText.text=""+this.player.magicPoints.getText(),this.playerLifeBar.update(),this.playerMagicBar.update(),this.updatePetStats(),this.depthText.text="Lv"+this.depth;var e=this.player.currentWeapon,i=this.player.currentArmor;e?(this.weaponSprite.loadTexture("items-icons",e.iconIndex),e.features.usesArrows||"WAND"===e.type?this.weaponText.text=e.remainingUses.getText():this.weaponText.text=e.getIntegrityDescription(),this.weaponSprite.visible=!0):(this.weaponText.text="",this.weaponSprite.visible=!1);var s=this.player.getStatusAilments(),o=this.ui.mapPanel.height,n=this.ui.mapPanel.y+o-30;if(this.ui.mapPanel.statusAilments&&(n=this.ui.mapPanel.statusAilments.baseY),s){var a="";this.statusText.y=n-16*s.length;for(var r=0;r<s.length;r++)a+=s[r]+"\n";this.statusText.text=a}else this.statusText.text="";this.player&&this.player.previousWeapon?(this.switchButtonGroup.visible=!0,this.switchWeaponSprite.loadTexture(this.player.previousWeapon.menuSprite.texture)):this.switchButtonGroup.visible=!1,i?(i.features.isClothing?this.armorSprite.loadTexture("tileset16",36):this.armorSprite.loadTexture("tileset16",35),this.armorText.text=i.getIntegrityDescription(),this.armorSprite.visible=!0):(this.armorText.text="",this.armorSprite.visible=!1),this.player.hitPoints.getProportion()<.3?this.player.redBlink():this.player.stopBlink(16711680),this.player.pet&&(this.player.pet.hitPoints.getProportion()<.3?this.player.pet.redBlink():this.player.pet.stopBlink(16711680)),this.updateRunningIndicatorGeneral(),t||this.updatePlayerSprite(),this.ui.mainPanel.spellsRow&&(this.refreshSpellIcons&&(this.updateSpellIcons(),this.refreshSpellIcons=!1),this.selectedSpell=!1,this.selectedSpellBox.visible=!1)},GameController.prototype.updateRunningIndicatorGeneral=function(){if(this.showMovementButtons)this.player.hasRunningSkills()&&this.setRunningIndicator();else for(var t=0;t<this.directionButtons.length;t++){var e=this.directionButtons[t],i=e.direction;0==i.x&&0==i.y||(this.showMovementArrows()||e.loadTexture("blank"),this.player.isRunning&&this.player.hasRunningSkills()&&i.x==this.player.runningDirection.x&&i.y==this.player.runningDirection.y?e.loadTexture("tileset32",e.baseSpriteIndex+8):this.showMovementArrows()&&e.loadTexture("tileset32",e.baseSpriteIndex))}},GameController.prototype.setRunningIndicator=function(){this.visibleRunningIndicator=!1;for(var t=0;t<this.runningIndicators.length;t++){var e=this.runningIndicators[t],i=e.direction;0==i.x&&0==i.y||(this.player.isRunning&&i.x==this.player.runningDirection.x&&i.y==this.player.runningDirection.y?(e.x=32*(this.player.x+e.direction.x)+this.mapOffset.x,e.y=32*(this.player.y+e.direction.y)+this.mapOffset.y,this.visibleRunningIndicator=e,e.visible=!0):e.visible=!1)}},GameController.prototype.resetRoom=function(t,e){if(this.persistanceManager.saveGame(this),this.mapGroup&&(this.killAllImagesOnGroup(this.mapGroup),this.killAllImagesOnGroup(this.mobGroup),this.phaser.tweens.remove(this.mapGroup,!0)),this.fishAddornments){for(var i=0;i<this.fishAddornments.length;i++)this.fishAddornments[i].kill();this.fishAddornments=!1}this.initRoom(t,e),this.applyButtonGroup.visible=!1,this.confirmApplyButtonGroup.visible=!1,this.cancelApplyButtonGroup.visible=!1,this.selectATargetMessageText&&(this.selectATargetMessageText.visible=!1),this.selectedTargetIcon.visible=!1,this.setupUseAndThrowButtons()},GameController.prototype.addMonsterToRoom=function(t,e,i){if(t.placementOffset=!1,i){var s=this.player.currentRoom.getPortalOn(t);if(s)if(this.player.currentRoom.isSafe())t.buildSprite(32*t.x+16,32*t.y+this.YOFFSET,this.mobGroup),"right"===s.direction?(t.facingLeft=!1,t.sprite.scale.x*=-1):t.facingLeft=!0;else{var o={x:0,y:0};switch(s.direction){case"up":o.y=-1;break;case"down":o.y=1;break;case"left":o.x=-1,t.facingLeft=!1;break;case"right":t.facingLeft=!0,o.x=1}t.buildSprite(32*(t.x+3*o.x)+16,32*(t.y+3*o.y)+this.YOFFSET,this.mobGroup),this.player.dungeonLevel.isRetro||t.facingLeft||(t.sprite.scale.x*=-1);var n={x:32*t.x+16};t.isFloating()?(t.sprite.baseY=t.sprite.y,n.baseY=32*t.y+this.YOFFSET):n.y=32*t.y+this.YOFFSET,this.startTween(t.sprite,this.tween(t.sprite).to(n,this.ENTER_ROOM_TWEEN_TIME,Phaser.Easing.Sinusoidal.Out))}else t.buildSprite(32*t.x+16,32*t.y+this.YOFFSET,this.mobGroup),t.facingLeft=!0}else t.buildSprite(32*t.x+16,32*t.y+this.YOFFSET,this.mobGroup,e),t.facingLeft=!0;this.player.pet||!t.isFriendly||t.isSummon||t.npcInfo||this.player.recoverPetOnRoomEnter(t),(i||e)&&this.player.currentRoom.sortMonsters()},GameController.prototype.addGarbageToRoom=function(t){this.getImage(32*t.x,32*t.y,"terrain32",32+t.type,this.mapGroup)},GameController.prototype.pullObstacleSprites=function(t){if(this.obstacleSprites)for(var e=0;e<this.obstacleSprites.length;e++)this.obstacleSprites[e].bringToTop()},GameController.prototype.addObstacleToRoom=function(t){var e=null,i=null;t.tileIndex.length?(e=this.getImage(32*t.x,32*t.y-this.YOFFSET,"terrain32",t.tileIndex[0],this.mapGroup),i=t.tileIndex[0],e.animations.add("shine",t.tileIndex),e.animations.play("shine",8,!0)):(e=this.getImage(32*t.x,32*t.y-this.YOFFSET,"terrain32",t.tileIndex,this.mapGroup),i=t.tileIndex),this.obstacleSprites.push(e);var s=CellType.getDescription("terrain32",i);s&&(e.inputEnabled=!0,t.specialDescription?e.examineText=t.specialDescription:e.examineText=s,e.events.onInputDown.add(this.examineFeatureBridge,this))},GameController.prototype.addColumnToRoom=function(t){var e=this.getImage(32*t.x,32*(t.y-1),"terrain32",64,this.mapGroup);e.inputEnabled=!0,e.examineText="A huge stone pillar.",e.events.onInputDown.add(this.examineFeatureBridge,this),(e=this.getImage(32*t.x,32*t.y,"terrain32",65,this.mapGroup)).inputEnabled=!0,e.examineText="A huge stone pillar.",e.events.onInputDown.add(this.examineFeatureBridge,this)},GameController.prototype.addBloodToRoom=function(t){this.getImage(32*t.x,32*t.y,"tileset32",144+t.type,this.mapGroup);var e=this.player.currentRoom.getItem(t.x,t.y);e&&e.sprite&&e.sprite.bringToTop()},GameController.prototype.addItemToRoom=function(t){t.setSprite(),t.setMenuSprite(),this.pullObstacleSprites()},GameController.prototype.removeItemFromRoom=function(t){this.killImage(t.sprite)},GameController.prototype.initItemSprite=function(t){t.setSprite()},GameController.prototype.hideDirectionalPad=function(){this.movementEnabled=!1;for(var t=0;t<this.directionButtons.length;t++)this.directionButtons[t].visible=!1;if(this.bigDirectionButtons)for(t=0;t<this.bigDirectionButtons.length;t++)this.bigDirectionButtons[t].visible=!1;this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!1)},GameController.prototype.locateDirectionalPad=function(){if(this.movementEnabled=!0,this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!0),this.showMovementButtons){if(this.bigDirectionButtons)for(var t=0;t<this.bigDirectionButtons.length;t++){(e=this.bigDirectionButtons[t]).visible=!0}for(t=0;t<this.directionButtons.length;t++){(e=this.directionButtons[t]).visible=!1}this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!0),this.ui.bigDirectionPad||this.hideTapActionButtons()}else{if(this.bigDirectionButtons)for(t=0;t<this.bigDirectionButtons.length;t++){(e=this.bigDirectionButtons[t]).visible=!1}for(t=0;t<this.directionButtons.length;t++){var e=this.directionButtons[t],i=this.player.x+e.direction.x,s=this.player.y+e.direction.y;this.player.isBlind()||this.player.currentRoom.isFreeFloor(i,s,!0)?e.visible=!0:e.visible=!1,e.x=this.player.sprite.x+32*e.direction.x+this.mapOffset.x-16,e.y=this.player.sprite.y+32*e.direction.y+this.mapOffset.y-16+this.YOFFSET}this.ui.bigDirectionPad||this.showTapActionButtons(),this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!1),this.visibleRunningIndicator=!1}this.updateRunningIndicatorGeneral()},GameController.prototype.initRoom=function(t,e){var i=t.map,s=t.monsters,o=t.items,n=t.bloods,a=t.garbage;this.tapActionSprites.length=0;var r=this.ui.mapPanel.width,l=this.ui.mapPanel.height;this.mapOffset={x:(r-32*t.width)/2+this.ui.mapPanel.x,y:(l-32*t.height)/2+this.ui.mapPanel.y},t.isDungeonEntrance&&(this.mapOffset.y+=32),this.usePool?(this.mapGroup||(this.mapGroup=this.phaser.add.group(this.mapLayer)),this.mobGroup||(this.mobGroup=this.phaser.add.group(this.mapLayer))):(this.mapGroup=this.phaser.add.group(this.mapLayer),this.mobGroup=this.phaser.add.group(this.mapLayer)),this.player.isBlind()&&(this.mapGroup.visible=!1),this.mapGroup.x=this.mapOffset.x,this.mapGroup.y=this.mapOffset.y,this.mobGroup.x=this.mapOffset.x,this.mobGroup.y=this.mapOffset.y;var h={up:new Array,left:new Array,down:new Array,right:new Array},p="";if("TEMPLE"===t.getEnvironment()?p="temple":"CAVERNS"===t.getEnvironment()?p="caverns":"LAGOON"===t.getEnvironment()?p="lagoon":"CRYSTAL"===t.getEnvironment()?p="crystal":"ABYSS"===t.getEnvironment()?p="abyss":"LAIR"===t.getEnvironment()&&(p="lair"),"LAGOON"===t.getEnvironment()){this.fishAddornments=[];for(var c=rand(2,4),u=0;u<c;u++){var d=new FishAddornment(this);this.fishAddornments.push(d),d.activate()}}for(var m="LAGOON"===t.getEnvironment(),y=0;y<i.length;y++)for(var g=0;g<i[0].length;g++){t.grid.setWalkableAt(y,g,!t.isSolid(y,g));var v=p+"-wall",b=1,f=!1,x=!1;if(i[y][g].isWall)floorTiles=1,"TEMPLE"===t.getEnvironment()?T=91:"CAVERNS"===t.getEnvironment()?T=36:"LAGOON"===t.getEnvironment()?T=6:"CRYSTAL"===t.getEnvironment()?T=48:"ABYSS"===t.getEnvironment()?T=12:"LAIR"===t.getEnvironment()&&(T=7),b=this.floorHash(y,g,T,t),this.player.dungeonLevel.isRetro&&(v="yendor",b=0),f=CellType.getDescription(v,b);else if(i[y][g].equals(CellType.DOOR)){v=(I=this.getCorridorTile(t.getEnvironment(),y,g)).spriteId,b=I.frame,0==y?h.left.push(g):0==g?h.up.push(y):y==i.length-1?h.right.push(g):h.down.push(y),x=!0}else if(i[y][g].isFloor||i[y][g].equals(CellType.HEALING_POND)){v=(I=this.getTerrainTile(t.getEnvironment(),y,g,t.environmentSubset)).spriteId,b=I.frame,x=i[y][g].isFloor}else i[y][g].equals(CellType.TORCH)?(v=p+"-torch",f="This torch lights the dark room."):i[y][g].metaSpriteId&&"stairs"===i[y][g].metaSpriteId?"YENDOR"===t.getEnvironment()?(v="yendor",b=2):(v=(I=this.getTerrainTile(t.getEnvironment(),y,g,t.environmentSubset)).spriteId,b=I.frame):(v=i[y][g].spriteId,b=i[y][g].tileCount?this.floorHash(y,g,i[y][g].tileCount,t):i[y][g].tileIndex?i[y][g].tileIndex:0,f=CellType.getDescription(v,b));var w=!1,I=!1;if("ABYSS"===t.getEnvironment()){var T=12;(g==t.height-1||!i[y][g].equals(CellType.VOID)&&i[y][g+1].equals(CellType.VOID))&&this.getImage(32*y,32*(g+1),p+"-wall",this.floorHash(y,g+1,T,t),this.mapGroup)}else if(!t.level.isRetro&&t.paintTop(y,g))if(m){this.getImage(32*y,32*g,"lagoon-wall",this.floorHash(y,g,18,t),this.mapGroup);var S=MapBorders.selectBorder(y,g,t);for(u=0;u<S.length;u++)I=this.getImage(32*y,32*g,"terrain32",S[u],this.mapGroup);w=!0}else{if(!t.paintTop(y,g+1)&&g<i[y].length-1&&!i[y][g+1].equals(CellType.VOID));else if(t.isBorderless)w=!0;else{i[y][g]=CellType.WALL;for(S=MapBorders.selectFloatingWallTop(y,g,t),u=0;u<S.length;u++)I=this.getImage(32*y,32*g,"terrain32",S[u],this.mapGroup);w=!0}if(0==g||i[y][g-1].equals(CellType.VOID))for(S=MapBorders.selectUpperWallTop(y,g,t),u=0;u<S.length;u++)this.getImage(32*y,32*(g-1),"terrain32",S[u],this.mapGroup)}if(w||(I=this.getImage(32*y,32*g,v,b,this.mapGroup),f&&(I.inputEnabled=!0,I.examineText=f,I.events.onInputDown.add(this.examineFeatureBridge,this)),x&&(I.inputEnabled=!0,I.worldX=y,I.worldY=g,I.player=this.player,I.events.onInputDown.add(this.walkToCell,I))),i[y][g].metaSpriteId&&"stairs"===i[y][g].metaSpriteId&&"YENDOR"!==t.getEnvironment()){var G=this.getImage(32*y,32*g,"terrain32",76,this.mapGroup);this.player.hasRune&&(G.animations.add("shine",[76,77,78,79,79,79,79,79,78,77,76,76,76,76]),G.animations.play("shine",8,!0))}if(i[y][g].isAnimated&&I)I.animations.add("shine"),I.animations.play("shine",8,!0),I.animations.next(rand(1,3));else if(i[y][g].equals(CellType.DOOR)){var B="",C={x:0,y:0},P=0,A=4;0==y?(C.x=-1,B="left",P=3):0==g?(C.y=-1,B="up",P=1,A=0):y==i.length-1?(C.x=1,B="right",P=2):(C.y=1,B="down",P=0);var E=!1,O=!1,M=this.ui.levelGen.roomBounds.margin;M||(M=1),i[0].length>=this.ui.levelGen.roomBounds.height-M&&(0!=g&&g!=i[0].length-1||(C.x=-1,C.y=0,E=!0,O=this.ui.levelGen.roomBounds.useStickyArrows&&i[0].length==this.ui.levelGen.roomBounds.height,A=0)),i.length>=this.ui.levelGen.roomBounds.width-M&&(0!=y&&y!=i.length-1||(C.y=-1,C.x=0,E=!0,O=this.ui.levelGen.roomBounds.useStickyArrows&&i.length==this.ui.levelGen.roomBounds.width,A=0)),t.isDungeonEntrance?(this.wallImage=this.getImage(32*y-192,32*g-32,"dungeonEntrance",0,this.mapGroup),this.superImage=this.getImage(32*y,32*g-96,"dungeonEntrance2",0,this.mobGroup),C.y=0,C.x=-1,E=!0,O=!1):(this.superImage=!1,this.wallImage=!1);var D=null;t.level.isRetro?D=this.getImage(32*(y+C.x),32*(g+C.y)-A,"yendor",4+P,this.mobGroup):(E||this.getImage(32*(y+C.x),32*(g+C.y),"tileset32",123+P+16,this.mobGroup),D=this.getImage(32*(y+C.x),32*(g+C.y)-A,"tileset32",(O?64:123)+P,this.mobGroup)),D.inputEnabled=!0,D.doorInfo={x:y,y:g,direction:B},D.events.onInputDown.add(this.interactDoorBridge,this),this.tapActionSprites.push(D),this.showMovementButtons&&!this.ui.bigDirectionPad&&(D.visible=!1),this.tween(D).to({y:32*(g+C.y)-A-8},1500,Phaser.Easing.Sinusoidal.Out,!0,0,Number.MAX_VALUE,!0)}else if(i[y][g].equals(CellType.STAIRS))I.inputEnabled=!0,I.events.onInputDown.add(this.interactStairsBridge,this);else if(i[y][g].equals(CellType.HEALING_POND))if(t.isPondUsed)this.getImage(32*y,32*g,"terrain32",70,this.mapGroup);else{var k=this.getImage(32*y,32*g,"terrain32",75,this.mapGroup);k.animations.add("shine",[66,67,68,69]),k.inputEnabled=!0,k.events.onInputDown.add(this.interactPondBridge,this),this.pondSprite=k}}this.wallImage&&this.wallImage.bringToTop();for(u=0;u<a.length;u++)this.addGarbageToRoom(a[u]);for(u=0;u<n.length;u++)this.addBloodToRoom(n[u]);for(u=0;u<o.length;u++)this.addItemToRoom(o[u]);this.obstacleSprites=[];for(u=0;u<t.obstacles.length;u++)this.addObstacleToRoom(t.obstacles[u]);for(u=0;u<t.columns.length;u++)this.addColumnToRoom(t.columns[u]);for(u=0;u<s.length;u++)this.addMonsterToRoom(s[u]);this.player.sprite=this.getImage(0,0,"tileset32",0,this.mobGroup),this.player.sprite.anchor.x=.5,this.player.sprite.anchor.y=.5,this.player.sprite.inputEnabled=!0,this.player.sprite.events.onInputDown.add(this.targetSelfBridge,this);var L=t.getPortalOn(this.player),R=!1;if(this.player.sprite.bringToTop(),L){var F={x:0,y:0};switch(L.direction){case"up":F.y=-1;break;case"down":F.y=1;break;case"left":F.x=-1,this.player.facingLeft=!1;break;case"right":this.player.facingLeft=!0,F.x=1}this.player.isRunning=!0,this.player.runningDirection={_c:circular.setSafe(),x:-1*F.x,y:-1*F.y},this.player.sprite.x=32*(this.player.x+3*F.x)+16,this.player.sprite.y=32*(this.player.y+3*F.y)+this.YOFFSET,R=this.tween(this.player.sprite).to({x:32*this.player.x+16,y:32*this.player.y+this.YOFFSET},this.ENTER_ROOM_TWEEN_TIME,Phaser.Easing.Sinusoidal.Out);var N=this;if(this.player.pet&&this.player.pet.x==this.player.x&&this.player.pet.y==this.player.y){this.player.pet.sprite.x=32*(this.player.x+4*F.x)+16,this.player.pet.sprite.y=32*(this.player.y+4*F.y)+this.YOFFSET,this.player.pet.facingLeft=this.player.facingLeft,this.player.dungeonLevel.isRetro||this.player.pet.facingLeft||(this.player.pet.sprite.scale.x*=-1);var j={x:32*this.player.x+16+8*F.x};this.player.pet.isFloating()?j.baseY=32*this.player.y+this.YOFFSET+8*F.y:j.y=32*this.player.y+this.YOFFSET+8*F.y;var W=this.tween(this.player.pet.sprite).to(j,this.ENTER_ROOM_TWEEN_TIME+200,Phaser.Easing.Sinusoidal.Out);this.player.pet.placementOffset={_c:circular.setSafe(),x:8*F.x,y:8*F.y},F.y>=0&&!this.player.dungeonLevel.isRetro&&this.player.pet.sprite.bringToTop(),W.onComplete.add(function(){e||(N.logEvent("Input enabled pet entering tween complete"),N.enablePlayerAction())}),this.startTween(this.player.pet.sprite,W)}else R.onComplete.add(function(){e||(N.logEvent("Input enabled entering tween complete"),N.enablePlayerAction())}),this.player.pet&&(this.player.pet.placementOffset=!1)}else this.player.sprite.x=32*this.player.x+16,this.player.sprite.y=32*this.player.y+this.YOFFSET,e||(this.logEvent("Input enabled entering tween complete 2"),this.enablePlayerAction());if(this.player.dungeonLevel.isRetro||this.player.facingLeft||(this.player.sprite.scale.x*=-1),"ABYSS"===t.getEnvironment())for(y=-3;y<i.length+3;y++)for(g=-3;g<i[0].length+3;g++)if(!(y>=0&&y<i.length&&g>=0&&g<i[0].length)){v="abyss-floating",floorTiles=18;b=this.floorHash(y,g,floorTiles,t);(I=this.getImage(32*y,32*g,v,b,this.mapGroup)).inputEnabled=!0,I.examineText="You see a huge tombstone floating over an infinite dark abyss.",I.events.onInputDown.add(this.examineFeatureBridge,this)}if("LAGOON"===t.getEnvironment())for(y=-3;y<i.length+3;y++)for(g=-3;g<i[0].length+3;g++)y>=0&&y<i.length&&g>=0&&g<i[0].length||this.getImage(32*y,32*g,"lagoon-wall",this.floorHash(y,g,18,t),this.mapGroup);for(u=0;u<h.up.length;u++){y=h.up[u];if("ABYSS"===t.getEnvironment()){var U=this.getImage(32*(y+1),0,"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this);U=this.getImage(32*(y-1),0,"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this)}for(var K=0;K<3;K++){I=this.getCorridorTile(t.getEnvironment(),0,K);this.getImage(32*h.up[u],32*(-K-1),I.spriteId,I.frame,this.mapGroup),"LAGOON"===t.getEnvironment()&&(this.getImage(32*(h.up[u]-1),32*(-K-1),"terrain32",MapBorders.toSpriteIndex("D","LAGOON",y+g-1+t.x+t.y),this.mapGroup),this.getImage(32*(h.up[u]+1),32*(-K-1),"terrain32",MapBorders.toSpriteIndex("E","LAGOON",y+g+1+t.x+t.y),this.mapGroup))}}for(u=0;u<h.down.length;u++){y=h.down[u];if("ABYSS"===t.getEnvironment()){U=this.getImage(32*(y+1),32*(i[0].length-1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this);U=this.getImage(32*(y-1),32*(i[0].length-1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this)}for(K=0;K<3;K++){I=this.getCorridorTile(t.getEnvironment(),0,K);this.getImage(32*h.down[u],32*(i[0].length+K),I.spriteId,I.frame,this.mapGroup),"LAGOON"===t.getEnvironment()&&(this.getImage(32*(h.down[u]-1),32*(i[0].length+K),"terrain32",MapBorders.toSpriteIndex("D","LAGOON",y+g-1+t.x+t.y),this.mapGroup),this.getImage(32*(h.down[u]+1),32*(i[0].length+K),"terrain32",MapBorders.toSpriteIndex("E","LAGOON",y+g+1+t.x+t.y),this.mapGroup))}}for(u=0;u<h.left.length;u++){g=h.left[u];if("ABYSS"===t.getEnvironment()){b=this.floorHash(0,g,12,t),this.getImage(0,32*(g+1),"abyss-wall",b,this.mapGroup);U=this.getImage(0,32*(g+1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this);U=this.getImage(0,32*(g-1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this)}for(K=0;K<3;K++){I=this.getCorridorTile(t.getEnvironment(),0,K);this.getImage(32*(-K-1),32*g,I.spriteId,I.frame,this.mapGroup),"ABYSS"===t.getEnvironment()?(b=this.floorHash(g,K,12,t),this.getImage(32*(-K-1),32*(g+1),"abyss-wall",b,this.mapGroup)):"LAGOON"===t.getEnvironment()&&(this.getImage(32*(-K-1),32*(g-1),"terrain32",MapBorders.toSpriteIndex("B","LAGOON",y+g-1+t.x+t.y),this.mapGroup),this.getImage(32*(-K-1),32*(g+1),"terrain32",MapBorders.toSpriteIndex("G","LAGOON",y+g+1+t.x+t.y),this.mapGroup))}}for(u=0;u<h.right.length;u++){g=h.right[u];if("ABYSS"===t.getEnvironment()){b=this.floorHash(0,g,12,t),this.getImage(32*(i.length-1),32*(g+1),"abyss-wall",b,this.mapGroup);U=this.getImage(32*(i.length-1),32*(g+1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this);U=this.getImage(32*(i.length-1),32*(g-1),"abyss-flame",0,this.mapGroup);CellType.activateFlameSprite(U,this)}for(K=0;K<3;K++){I=this.getCorridorTile(t.getEnvironment(),0,K);this.getImage(32*(i.length+K),32*g,I.spriteId,I.frame,this.mapGroup),"ABYSS"===t.getEnvironment()?(b=this.floorHash(g,K,12,t),this.getImage(32*(i.length+K),32*(g+1),"abyss-wall",b,this.mapGroup)):"LAGOON"===t.getEnvironment()&&(this.getImage(32*(i.length+K),32*(g-1),"terrain32",MapBorders.toSpriteIndex("B","LAGOON",y+g-1+t.x+t.y),this.mapGroup),this.getImage(32*(i.length+K),32*(g+1),"terrain32",MapBorders.toSpriteIndex("G","LAGOON",y+g+1+t.x+t.y),this.mapGroup))}}t.sortMonsters(),this.level.exploreRoom(t),this.player.checkNewRoomExplored(t),this.drawMiniMap(),R&&this.startTween(this.player.sprite,R),this.updatePlayerStats(!1)},GameController.prototype.hideTapActionButtons=function(){for(var t=0;t<this.tapActionSprites.length;t++){this.tapActionSprites[t].visible=!1}},GameController.prototype.showTapActionButtons=function(){for(var t=0;t<this.tapActionSprites.length;t++){this.tapActionSprites[t].visible=!0}},GameController.prototype.getCorridorTile=function(t,e,i){if("ABYSS"===t){spriteId="abyss-corridor",floorTiles=4;var s=this.floorHash(e,i,floorTiles,this.player.currentRoom);return{spriteId:spriteId,frame:s}}return this.getTerrainTile(t,e,i,this.player.currentRoom.environmentSubset)},GameController.prototype.getTerrainTile=function(t,e,i,s){if("YENDOR"===t)return{spriteId:"yendor",frame:1};var o=0;if("TEMPLE"===t)if(5===s)spriteId="caverns-floor",maxIndex=49;else switch(spriteId="temple-floor",s){case 0:maxIndex=23;break;case 1:o=24,maxIndex=31;break;case 2:o=32,maxIndex=39;break;case 3:o=40,maxIndex=47;break;case 4:o=48,maxIndex=55}else"CAVERNS"===t?(spriteId="caverns-floor",maxIndex=49):"LAGOON"===t?(spriteId="lagoon-floor",maxIndex=5):"CRYSTAL"===t?(spriteId="crystal-floor",maxIndex=11):"ABYSS"===t?(spriteId="abyss-floor",maxIndex=7):"LAIR"===t&&(spriteId="lair-floor",maxIndex=15);var n=maxIndex-o+1,a=this.floorHash(e,i,n,this.player.currentRoom);return{spriteId:spriteId,frame:a+=o}},GameController.prototype.floorHash=function(t,e,i,s){return t+=s.x,e+=s.y,Math.abs(t+3*e+5*t-8*t*t+6*e*e)%i},GameController.prototype.SELF_DIRECTION={x:0,y:0},GameController.prototype.interactBridge=function(t,e){if(this.logEvent("Interact with "+t.race.name),!this.inputDisabled&&!t.dead)if(this.targetSelectionActive){if(this.player.pet&&this.player.pet==t&&this.player.pet.x==this.player.x&&this.player.pet.y==this.player.y){if(this.forceTargetPlayer)return this.forceTargetPlayer=!1,void this.targetSelf();this.forceTargetPlayer=!0}this.selectTarget(t)}else if(e&&2===e.button)this.showMonsterInfo(t);else if(t.npcInfo)this.showConversation(t);else{if(t.x==this.player.x&&t.y==this.player.y)return void this.move({x:0,y:0});if(this.player.moveConfused())return void this.move({x:1,y:1});this.disablePlayerAction(),this.player.interactWith(t)}},GameController.prototype.selectTarget=function(t){this.logEvent("selectTarget"),this.selectedTarget=t;var e="Use item on",i=!1;i=this.selectedItemToApply?this.selectedItemToApply:this.inventoryPanel.selectedItem;var s=this.inventoryPanel.selectedSpell;s||(s=this.selectedSpell),"ranged"===this.targetSelectionMode?e="Attack":i?i.features.dontThrow||this.selectedTarget.isFriendly&&i.features.dontThrowToAllies?i.features.isSpell&&(e="Cast spell over"):e="Throw item at":s&&(e=s.features.notMagicSpell?"Use skill on":"Cast spell over"),this.watchedObjectDescriptionText.text=this.upperTapVerb+" on the target\n"+e+" "+t.race.name+"?","center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.ui.selectATargetMessage&&(this.selectATargetMessageText.text=this.upperTapVerb+" on the target\n"+e+" "+t.race.name+"?",this.centerText(this.selectATargetMessageText,this.ui.selectATargetMessage.x,this.ui.selectATargetMessage.width)),this.showConfirmTargetButtons(this.selectedTarget)},GameController.prototype.interactWithNPCBridge=function(t){this.logEvent("Interact with NPC"),this.inputDisabled||this.targetSelectionActive||(this.disablePlayerAction(),this.player.interactWithNPC(t.npc))},GameController.prototype.interactItemBridge=function(t,e){this.logEvent("Interact with item "+t.code),this.inputDisabled||this.targetSelectionActive||(e||t.x!=this.player.x||t.y!=this.player.y?this.player.interactWithItem(t):this.move(this.SELF_DIRECTION))},GameController.prototype.interactItemInventoryBridge=function(t,e){this.logEvent("Interact with item in inventory "+t.code+", doubleTap"+e),this.inputDisabled?this.inventoryPanel.chemistryMode&&"applySpirit"===t.onUse&&this.inventoryPanel.firstReagent!=t&&this.inventoryPanel.selectSecondReagent(t):this.targetSelectionActive||(this.inventoryPanel.showItemInfo(t),!this.player.dead&&e&&this.useItem())},GameController.prototype.interactSpellBridge=function(t,e){if(this.logEvent("Interact with spell "+t.code+", doubleTap"+e),!this.inputDisabled&&!this.targetSelectionActive)if(this.ui.mainPanel.spellsRow){if(this.showingInventory)return;this.selectSpell(t),!this.player.dead&&e&&this.useSpellFromMain(t)}else this.inventoryPanel.selectSpell(t),!this.player.dead&&e&&this.useItem()},GameController.prototype.getSpellEffectDescription=function(t){var e=!this.player.isMagicExpert()&&"magicAttack"===t.effect,i=void 0;i="false"!==t.description?"magicAttack"===t.effect?t.description+" ["+this.player.getSpellDamageRoll(t)+"]"+(e?" (5% backfire chance)":""):t.description+(e?" (5% backfire chance)":""):Effects.getEffectDescription(t.effect,this.player,t,this.player.magicPower.current);var s=this.player.getSpellMPCost(t);return s&&(i+=" ("+s+"MP)"),i},GameController.prototype.selectSpell=function(t){this.logEvent("Select Spell "+t.code);var e=this.getSpellEffectDescription(t);this.showObjectInfo(Spells.getIconTexture(this,t),t.words,e+"\nDouble "+this.tapVerb+" to cast",!1,!0),this.playSFX("tap"),this.selectedSpell=t,this.inventoryPanel.selectedItem=!1,this.inventoryPanel.selectedSpell=!1;var i=this.player.getSpellIndex(t),s=this.ui.mainPanel.spellsRow;s.vertical?(this.selectedSpellBox.x=s.x,this.selectedSpellBox.y=i*s.space+s.y):(this.selectedSpellBox.x=i*s.space+s.x,this.selectedSpellBox.y=s.y),this.selectedSpellBox.visible=!0},GameController.prototype.interactDoorBridge=function(t){this.logEvent("Interact with door"),this.inputDisabled||this.targetSelectionActive||(this.disablePlayerAction(),this.player.interactWithDoor(t.doorInfo))},GameController.prototype.interactPondBridge=function(){this.logEvent("Interact with pond"),this.inputDisabled||this.targetSelectionActive||(this.disablePlayerAction(),this.knows.pond||(this.showDenziMessage("Magic Fountain","This fountain might replenish your health..."),this.setKnows("pond")),this.player.interactWithPond())},GameController.prototype.resetPond=function(){this.pondSprite.inputEnabled=!1,this.pondSprite.loadTexture("terrain32",70)},GameController.prototype.interactDoorBridgeUp=function(t){if(this.logEvent("interactDoorBridgeUp"),this.newRoom){var e={x:0,y:0};switch(t.direction){case"up":e.y=-1;break;case"down":e.y=1;break;case"left":e.x=-1;break;case"right":e.x=1}var i=this.player.sprite.x+32*e.x*3,s=this.player.sprite.y+32*e.y*3,o=this.tween(this.player.sprite).to({x:i,y:s},this.ENTER_ROOM_TWEEN_TIME,Phaser.Easing.Sinusoidal.Out,!0);this.player.pet&&this.player.pet.overPlayer&&(this.player.pet.overPlayer=!1,this.player.pet.setFacing(e),this.tween(this.player.pet.sprite).to({x:i,y:s},this.ENTER_ROOM_TWEEN_TIME,Phaser.Easing.Sinusoidal.Out,!0,100));var n=this;o.onComplete.add(function(){n.loadNewRoom()})}},GameController.prototype.updateMiniMap=function(){this.level.exploreRoom(this.player.currentRoom),this.drawMiniMap()},GameController.prototype.loadNewRoom=function(){if(this.resetRoom(this.newRoom),this.newRoom=null,this.knows.survivedFirstLevel)this.player.showClosestMonsterInfo();else{var t="";switch(this.currentWalkingMessage||(this.currentWalkingMessage=0),this.currentWalkingMessage){case 0:t=this.upperTapVerb+" into the corridor arrows, enemies or items to interact with them.";break;case 1:t="The stats "+this.ui.statsLocation+" show your health, magic power, weapon and armor status.";break;case 2:t="The stats "+this.ui.petStatsLocation+" show your monster's health and skill points.";break;case 3:t="The minimap "+this.ui.minimapLocation+" shows the current level.";break;case 4:t="Your goal is to find the magic portal and the rune of passage to move into the next level.";break;case 5:t="Take care of your pet monster, use bandages and spells on him to recover its health.";break;case 6:t="You might find magical artifacts to make your monster gain special skills."}this.currentWalkingMessage++,this.currentWalkingMessage>6&&(this.currentWalkingMessage=0),this.showDenziMessage("Denzi says...",t)}},GameController.prototype.petDead=function(){this.knows.survivedFirstLevel||this.showDenziMessage("Sorry...","Your pet monster is dead! Take more care of him next time."),this.communityClient.playerEvent("pet","'s "+this.player.pet.race.name+" dies.")},GameController.prototype.interactStairsBridge=function(){this.logEvent("interactStairsBridge"),this.inputDisabled||this.targetSelectionActive||this.player.goDown()},GameController.prototype.interactStairsBridgeUp=function(t){this.logEvent("interactStairsBridgeUp"),this.newRoom&&(2==this.depth&&(this.setKnows("survivedFirstLevel"),this.showDenziMessage(null,"You survived the first level! Now you are on your own.")),this.resetRoom(this.newRoom),2==this.depth||this.depth>1&&(this.depth-1)%4==0||this.tryLevelUp(),this.newRoom=null)},GameController.prototype.setKnows=function(t){this.knows[t]=!0,this.storage.setItem("ananias.knows",JSON.stringify(this.knows))},GameController.prototype.tween=function(t,e){return e&&this.phaser.tweens.removeFrom(t),this.phaser.add.tween(t)},GameController.prototype.startTween=function(t,e){e.start()},GameController.prototype.showMonsterInfo=function(t){this.player.isHallucinating()?this.showObjectInfo(t,"???","You are not sure what this is.",!1):this.showObjectInfo(t,t.race.name,t.getPassiveSkillsDescription()+t.getHealthDescription(),!1)},GameController.prototype.showObjectInfo=function(t,e,i,s,o){var n=null;if(s){if(o)n=t;else{var a=t.menuSprite;this.player.isHallucinating()&&!this.showingInventory&&(a=t.sprite),n=a.texture}if(this.watchedObjectSprite.loadTexture(n),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),this.watchedObjectNameText.text=e,"center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),this.knows.pickUpItems||this.showingInventory)if(this.knows["item+"+t.onUse]){var r=this.watchedObjectNameText.precalculateWordWrap(this.watchedObjectNameText.text).length-this.ui.inspector.titleLines;if(r>0)for(var l=0;l<r;l++)i="\n"+i;this.watchedObjectDescriptionText.text=i}else{switch(t.onUse){case"wield":this.watchedObjectDescriptionText.text="This is a weapon, wear it to attack your enemies.";break;case"wear":this.watchedObjectDescriptionText.text="This is a piece of armor, it protects you from enemies.";break;default:this.watchedObjectDescriptionText.text=t.getDetails(this.player)}this.knows["item+"+t.onUse]=!0}else this.watchedObjectDescriptionText.text=this.upperTapVerb+" yourself to pick up the item.";"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth)}else n=o?t:t.sprite.texture,this.watchedObjectSprite.loadTexture(n),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),this.watchedObjectNameText.text=e,"center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),this.watchedObjectDescriptionText.text=i,"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth)},GameController.prototype.showDenziMessage=function(t,e,i){this.watchedObjectSprite.loadTexture("tileset32",1),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),this.watchedObjectNameText.text=t?t+"\n":"Denzi says...\n","center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),this.watchedObjectDescriptionText.text=e,"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.ui.inspector.toogleButton&&i&&!this.objectInspectorGroup.visible&&this.toogleInspectorVisible()},GameController.prototype.appendInspectorMessage=function(t){this.watchedObjectDescriptionText.text=this.watchedObjectDescriptionText.text+t,"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth)},GameController.prototype.showCombatHelp=function(){if(!this.knows.killMonsters){var t="";switch(this.currentCombatMessage){case 0:t="You can move freely by "+this.tappingVerb+" the circles around you.";break;case 1:t="Command your pet monster using the button "+this.ui.behaviorButtonsLocation;break;case 2:t=this.upperTapVerb+" on yourself to pass a turn.";break;case 3:t="Weapons and Armor are spent in combat, keep looking for new ones."}this.showDenziMessage("Combat",t),this.currentCombatMessage++,this.currentCombatMessage>3&&(this.combatMessagesShown=!0,this.currentCombatMessage=0)}},GameController.prototype.showConversation=function(t){t.currentDialog||(t.currentDialog=0),this.entityInfoPanel.showConversation(t)},GameController.prototype.showTextBy=function(t,e,i,s,o,n){if(!this.player.isBlind()||t.x==this.player.x&&t.y==this.player.y){var a={x:32*t.x+this.mapOffset.x+16,y:32*t.y+this.mapOffset.y};n||(a.x+=8,a.y-=8),s?"RED"===s?s="#F99":"GREEN"===s&&(s="#0F0"):s="#FFF",this.textAt[a.x+"-"+a.y]&&(a.y+=20),this.textAt[a.x+"-"+a.y]=!0;var r=this.addText(a.x,a.y,e,{font:this.font,fill:s},this.guiLayer);if(r.setShadow(-1,1,"rgba(0,0,0,1)",0),n){var l=this.phaser.add.tween(r).to({y:a.y-50,alpha:0},1500,Phaser.Easing.Linear.None,!1);l.onComplete.add(function(){this.textAt[a.x+"-"+a.y]=!1,r.destroy(),i&&i()},this),l.start()}else this.phaser.time.events.add(900,function(){this.textAt[a.x+"-"+a.y]=!1,r.destroy(),i&&i()},this)}},GameController.prototype.showMessage=function(t){var e=this.lastMessage;e===t?(this.messageRepeatCounter++,this.messageStack[this.messageStack.length-1]=e+" (x"+this.messageRepeatCounter+")"):(this.messageRepeatCounter=1,this.lastMessage=t,this.messageStack.push(t)),this.messageStack.length>this.MESSAGE_STACK_SIZE&&(this.messageStack=this.messageStack.slice(this.messageStack.length-this.MESSAGE_STACK_SIZE,this.messageStack.length));for(var i=0;i<this.messageStack.length;i++)this.messageStack[this.messageStack.length-1-i]+"\n"},GameController.prototype.newLevel=function(t){0==this.depth&&this.communityClient.startGame(),this.player.petAway=!1;var e=this.phaser.add.image(0,0,"background");e.inputEnabled=!0;var i=500;this.depth>0?e.alpha=0:(e.alpha=1,i=50);var s=this.tween(e).to({alpha:1},i),o=this;this.disablePlayerAction(),s.onComplete.add(function(){if(o.depth>0&&o.showLevelSummary(),o.level=o.builder.createLevel(++o.depth,o.player),o.level.player=o.player,o.player.dungeonLevel=o.level,o.track("Enter Level",{depth:o.depth}),o.depth<24&&(2==o.depth||o.depth>1&&(o.depth-1)%4==0)){var i="";"TEMPLE"===o.level.environment?i="Tomb of Ananias":"CAVERNS"===o.level.environment?i="Caverns of Chaos":"LAGOON"===o.level.environment?i="Underground Lagoon":"CRYSTAL"===o.level.environment?i="Crystal Caves":"ABYSS"===o.level.environment?i="Darkness Abyss":"LAIR"===o.level.environment&&(i="Lair of the Ancients"),o.communityClient.newLevelEvent(o.player.className,i,100*o.player.hitPoints.getProportion())}o.depth>1&&Achievements.achieveNewLevel(o.level.environment);var s=o.level.getPlayerRoom();s.locatePlayer(o.player),o.newRoom=s;var n=o.tween(e).to({alpha:0},500);n.onComplete.add(function(){e.destroy()}),o.startTween(e,n),t&&t()},this),this.startTween(e,s)},GameController.prototype.showLevelSummary=function(){var t=this.player.stats.perLevel[this.player.stats.perLevel.length-1],e=Math.round(t.exploredRooms/t.totalRooms*100),i=0,s="";"TEMPLE"===this.level.environment?(i=0,s="Tomb of Ananias"):"CAVERNS"===this.level.environment?(i=2,s="Caverns of Chaos"):"LAGOON"===this.level.environment?(i=4,s="Underground Lagoon"):"CRYSTAL"===this.level.environment?(i=1,s="Crystal Caves"):"ABYSS"===this.level.environment?(i=3,s="Darkness Abyss"):"LAIR"===this.level.environment&&(i=5,s="Lair of the Ancients"),this.locationImage.loadTexture("intros",i),this.locationDetailText.text=s+"\nMonsters killed: "+t.killed+"\nExplored: "+e+"%",this.locationDetailText.x=this.ui.locationImage.x-20+Math.round((200-this.locationDetailText.width)/2),this.hudLayer.visible=!1,this.locationImageGroup.visible=!0},GameController.prototype.tryLevelUp=function(){this.depth>24||(this.player.levelUp(),this.updatePlayerStats(!1))},GameController.prototype._drawOpaqueMiniMap=function(){this.mapScrollImage.visible=!0,this.ui.minimap.hideDepth||(this.depthText.visible=!0),this.minimapBMD.clear();for(var t=this.minimapBMD.context,e=this.level.exploredMap,i=(48-this.level.bounds.x.range)/2-this.level.bounds.x.from,s=(48-this.level.bounds.y.range)/2-this.level.bounds.y.from,o=this.player.currentRoom,n=0;n<e.length;n++)if(e[n])for(var a=0;a<e[n].length;a++)e[n]&&e[n][a]&&e[n][a].minimapFill&&(n>=o.x&&n<o.x+o.width&&a>=o.y&&a<o.y+o.height?t.globalAlpha=1:t.globalAlpha=.5,this.level.isWallLess&&e[n][a].contrastMinimapFill?t.fillStyle=e[n][a].contrastMinimapFill:t.fillStyle=e[n][a].minimapFill,t.fillRect(2*(n+i),2*(a+s),2,2));t.globalAlpha=1,t.fillStyle="rgba(0, 255, 0, 1)";var r=this.player.getPositionOnLevel();t.fillRect(2*(r.x+i),2*(r.y+s),2,2),this.minimapBMD.dirty=!0},GameController.prototype._drawTinyMap=function(){this.tinymapBMD.clear();for(var t=this.tinymapBMD.context,e=this.level.exploredMap,i=Math.round((48-this.level.bounds.x.range)/2-this.level.bounds.x.from),s=Math.round((48-this.level.bounds.y.range)/2-this.level.bounds.y.from),o=this.player.currentRoom,n=0;n<e.length;n++)if(e[n])for(var a=0;a<e[n].length;a++)e[n]&&e[n][a]&&e[n][a].minimapFill&&(n>=o.x&&n<o.x+o.width&&a>=o.y&&a<o.y+o.height?t.globalAlpha=1:t.globalAlpha=.5,this.level.isWallLess&&e[n][a].contrastMinimapFill?t.fillStyle=e[n][a].contrastMinimapFill:t.fillStyle=e[n][a].minimapFill,t.fillRect(n+i,a+s,1,1));t.globalAlpha=1,t.fillStyle="rgba(0, 255, 0, 1)";var r=this.player.getPositionOnLevel();t.fillRect(r.x+i,r.y+s,1,1),this.tinymapBMD.dirty=!0},GameController.prototype.drawMiniMap=function(){"opaque"===this.mapMode?this._drawOpaqueMiniMap():this._drawTransparentMiniMap(),this.ui.minimap.toogleButton&&this._drawTinyMap()},GameController.prototype._drawTransparentMiniMap=function(){this.mapScrollImage.visible=!1,this.depthText.visible=!1,this.minimapBMD.clear();for(var t=this.minimapBMD.context,e=this.level.exploredMap,i=(48-this.level.bounds.x.range)/2-this.level.bounds.x.from,s=(48-this.level.bounds.y.range)/2-this.level.bounds.y.from,o=this.player.currentRoom,n=0;n<e.length;n++)if(e[n])for(var a=0;a<e[n].length;a++)e[n]&&e[n][a]&&e[n][a].minimapFill&&(n>=o.x&&n<o.x+o.width&&a>=o.y&&a<o.y+o.height?t.globalAlpha=.7:t.globalAlpha=.6,this.level.isWallLess&&e[n][a].contrastMinimapFill?t.fillStyle=e[n][a].contrastMinimapFill:t.fillStyle=e[n][a].minimapFill,t.fillRect(2*(n+i),2*(a+s),2,2));t.globalAlpha=1,t.fillStyle="rgba(0, 255, 0, 1)";var r=this.player.getPositionOnLevel();t.fillRect(2*(r.x+i),2*(r.y+s),2,2),this.minimapBMD.dirty=!0},GameController.prototype.switchInventory=function(){this.logEvent("switchInventory"),this.showingInventory?this.player.dead?(this.inventoryPanel.hide(),this.playSFX("tap"),this.resetUI(),this.gotoTitleAfterGameEnd()):this.hideInventory():(this.showInventory(this.player.dead),this.player.dead&&(this.inputDisabled=!1,this.logEvent("Input enabled switchInventory"),this.communityClient.token&&(this.shareCharacterButtonGroup.visible=!0)))},GameController.prototype.showInventory=function(t){this.inputDisabled&&!t||this.targetSelectionActive||(this.ui.settingsOnlyOnInventory&&(this.player.dead||(this.settingsButtonGroup.visible=!0)),this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!1),this.ui.helpButton.onlyOnInventory&&!this.player.dead&&(this.helpButtonGroup.visible=!0),this.ui.minimap.toogleButton&&(this.miniMapGroup.visible=!1,this.toogleMapButtonGroup.visible=!1,"opaque"===this.mapMode&&(this.mapMode="hidden")),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.toogleSpellsRowButtonGroup.visible=!1),this.ui.inspector.toogleButton&&(this.objectInspectorGroup.visible=!1),this.showingInventory=!0,this.inventoryButtonText.text="Back",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.inventoryButtonText,this.ui.inventoryButton.x,this.ui.buttonSpecs.text.xCenter),this.inventoryButtonIcon.loadTexture("tileset32",130),this.petCommandGroup.visible=!1,this.tacticsGroup.visible=!1,this.playSFX("tap"),this.player.itemAction="USE",this.setKnows("checkInventory"),this.knows.useItems||this.showDenziMessage("Items","Select an item to check it, then Use or Drop it."),this.switchButtonGroup.visible=!1,this.inventoryPanel.show(),this.hideDirectionalPad(),this.mapLayer.visible=!1,this.mapUILayer.visible=!1)},GameController.prototype.hideInventory=function(t){this.ui.inspector.toogleButton&&(this.objectInspectorGroup.visible=!1),"transparent"===this.mapMode&&(this.miniMapGroup.visible=!0),this.inventoryButtonText.text="Items",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.inventoryButtonText,this.ui.inventoryButton.x,this.ui.buttonSpecs.text.xCenter),this.inventoryButtonIcon.loadTexture("tileset32",113),this.showingInventory=!1,this.player.pet&&(this.petCommandGroup.visible=!0),this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!0),this.tacticsGroup.visible=!0,this.playSFX("tap"),this.player.previousWeapon&&(this.switchButtonGroup.visible=!0,this.switchWeaponSprite.loadTexture(this.player.previousWeapon.menuSprite.texture)),this.ui.minimap.toogleButton&&(this.toogleMapButtonGroup.visible=!0),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.toogleSpellsRowButtonGroup.visible=!0),this.inventoryPanel.hide(t),this.hudLayer.visible=!0,this.locateDirectionalPad(),this.mapLayer.visible=!0,this.mapUILayer.visible=!0,this.ui.settingsOnlyOnInventory&&(this.settingsButtonGroup.visible=!1),this.ui.helpButton.onlyOnInventory&&(this.helpButtonGroup.visible=!1)},GameController.prototype.hideInventoryWithoutReactivatingPlayer=function(){this.inventoryButtonText.text="Items",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.inventoryButtonText,this.ui.inventoryButton.x,this.ui.buttonSpecs.text.xCenter),this.inventoryButtonIcon.loadTexture("tileset32",113),this.showingInventory=!1,this.player.pet&&(this.petCommandGroup.visible=!0),this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!0),this.tacticsGroup.visible=!0,this.playSFX("tap"),this.player.previousWeapon&&(this.switchButtonGroup.visible=!0,this.switchWeaponSprite.loadTexture(this.player.previousWeapon.menuSprite.texture)),"transparent"===this.mapMode&&(this.miniMapGroup.visible=!0),this.ui.minimap.toogleButton&&(this.toogleMapButtonGroup.visible=!0),this.ui.mainPanel.spellsRow&&this.ui.mainPanel.spellsRow.toogleButton&&(this.toogleSpellsRowButtonGroup.visible=!0),this.inventoryPanel.hide(!0),this.hudLayer.visible=!0,this.mapLayer.visible=!0,this.mapUILayer.visible=!0,this.ui.settingsOnlyOnInventory&&(this.settingsButtonGroup.visible=!1),this.ui.helpButton.onlyOnInventory&&(this.helpButtonGroup.visible=!1)},GameController.prototype.addItemToInventory=function(t){this.inventoryPanel.addItem(t)},GameController.prototype.removeItemFromInventory=function(t){this.inventoryPanel.removeItem(t)},GameController.prototype.track=function(t,e){e||(e={}),e.isDesktop=this.isDesktop,e.isCocoon=this.isCocoon,e.isGold=this.isGold},GameController.prototype.prepareProjectile=function(t,e){return e||(e="tileset16"),this.projectileSprite.loadTexture(e,t),this.projectileSprite.visible=!0,this.player.isBlind()&&(this.projectileSprite.visible=!1),this.projectileSprite},GameController.prototype.animatedProjectile=function(t,e){return this.projectileSprite.loadTexture("animations"),this.projectileSprite.animations.getAnimation(t)||this.projectileSprite.animations.add(t,e),this.projectileSprite.animations.play(t,8,!0,!1),this.projectileSprite.visible=!0,this.player.isBlind()&&(this.projectileSprite.visible=!1),this.projectileSprite},GameController.prototype.resetProjectile=function(t){this.projectileSprite.animations.currentAnim&&this.projectileSprite.animations.stop(),this.projectileSprite.visible=!1},GameController.prototype.disablePlayerAction=function(t){this.stampLastAction(),this.inputDisabled=!0,this.showMovementButtons||this.hideDirectionalPad(),this.movementEnabled=!1,this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!1)},GameController.prototype._checkGameHanged=function(){var t=this.inputDisabled&&!this.dialog.dialogLayer.visible&&!this.locationImageGroup.visible&&!this.selectUpgradeScreen.selectUpgradeGroup.visible&&!this.entityInfoPanel.dialogLayer.visible&&!this.bookPanel.dialogLayer.visible&&!this.inventoryPanel.chemistryMode;if(this.ui.inspector.toogleButton&&(t=t&&!this.objectInspectorGroup.visible),this.ui.minimap.toogleButton&&(t=t&&!this.miniMapGroup.visible),t&&this.player.stats.gameplaySeconds-this.lastActionSeconds>15)throw alert("We detected the game has possibly hanged, if this is not the case please forgive the interruption and let us know about it!"),new Error("Game hanged.")},GameController.prototype.stampLastAction=function(){this.lastActionSeconds=this.player.stats.gameplaySeconds},GameController.prototype.enablePlayerAction=function(t){if(!this.holdEnablingPlayerAction&&(this.stampLastAction(),this.inputDisabled=!1,this.logEvent("Input enabled enablePlayerAction"),this.setupUseAndThrowButtons(),this.locateDirectionalPad(),t&&!this.player.isBlind())){var e=this.player.currentRoom.getItem(this.player.x,this.player.y);e?this.player.inspectItem(e):this.player.showClosestMonsterInfo()}},GameController.prototype.updatePlayerSprite=function(){if(this.ui.mainPanel.portrait&&(this.portraitSprite.loadTexture(this.player.portraitSprite.texture),this.characterNameLabel.text=this.player.characterName+"\n"+this.player.shortClassName+"\nLevel "+this.depth),this.player.dungeonLevel.isRetro)this.player.sprite.loadTexture("tileset32",3);else if(this.player.isInvisible())this.player.sprite.loadTexture("tileset32",206);else{var t=this.getImage(0,0,"bodies-base",this.player.baseSpriteIndex,this.mobGroup),e=this.getImage(0,0,"bodies-base",this.player.baseSpriteIndex+10,this.mobGroup),i=this.player.currentWeapon?this.getImage(0,0,"items-worn",this.player.currentWeapon.masterIndex):null,s=this.player.currentArmor?this.getImage(0,0,"wearables-worn",this.player.currentArmor.masterIndex):null,o=this.player.currentArmwear?this.getImage(0,0,"wearables-worn",this.player.currentArmwear.masterIndex):null,n=this.player.currentLegwear?this.getImage(0,0,"wearables-worn",this.player.currentLegwear.masterIndex):null,a=this.player.currentFootwear?this.getImage(0,0,"wearables-worn",this.player.currentFootwear.masterIndex):null,r=this.player.currentHelmet?this.getImage(0,0,"items-worn",this.player.currentHelmet.masterIndex):null,l=this.player.currentShield?this.getImage(0,0,"items-worn",this.player.currentShield.masterIndex):null,h=null;!1===this.player.hairSpriteIndex||this.player.currentHelmet&&this.player.currentHelmet.features.protectsHead||this.player.currentArmor&&this.player.currentArmor.features.coversHair||(h=this.getImage(0,0,"bodies-hair",this.player.hairSpriteIndex,this.mobGroup));var p=null;!(!1!==this.player.beardSpriteIndex&&this.player.selectedBeardType<15)||this.player.currentArmor&&this.player.currentArmor.features.coversBeard||(p=this.getImage(0,0,"bodies-hair",this.player.beardSpriteIndex,this.mobGroup));var c=this.phaser.add.bitmapData(96,32);if(this.player.isGod){var u=this.getImage(0,0,"tileset32",222,this.mobGroup);c.draw(u,0,0),c.draw(u,32,1),c.draw(u,64,2),this.killImage(u)}c.draw(t,0,0),c.draw(t,32,1),c.draw(t,64,2),c.draw(e,0,0),c.draw(e,32,0),c.draw(e,64,0),this.killImage(t),this.killImage(e),n&&(c.draw(n,0,0),c.draw(n,32,0),c.draw(n,64,1),this.killImage(n)),a&&(c.draw(a,0,0),c.draw(a,32,0),c.draw(a,64,0),this.killImage(a)),o&&(c.draw(o,0,0),c.draw(o,32,1),c.draw(o,64,2),this.killImage(o)),s&&(c.draw(s,0,0),c.draw(s,32,1),c.draw(s,64,2),this.killImage(s)),i&&(c.draw(i,0,0),c.draw(i,32,1),c.draw(i,64,2),this.killImage(i)),p&&(c.draw(p,0,0),c.draw(p,32,1),c.draw(p,64,2)),h&&(c.draw(h,0,0),c.draw(h,32,1),c.draw(h,64,2)),r&&(c.draw(r,0,0),c.draw(r,32,1),c.draw(r,64,2)),l&&(c.draw(l,0,0),c.draw(l,32,1),c.draw(l,64,2)),h&&this.killImage(h),p&&this.killImage(p),r&&this.killImage(r),l&&this.killImage(l),this.phaser.cache.addSpriteSheet("dynamic","",c.canvas,32,32,3,0,0),this.player.sprite.loadTexture("dynamic"),this.player.sprite.animations.add("breath",[0,1,2,1]),this.player.isParalyzed()||(this.player.sprite.animations.play("breath",4,!0),this.player.sprite.animations.next(rand(0,3)))}},GameController.prototype.playSFX=function(t){this.soundsDisabled||("slash"===t&&(t+=rand(1,3)),this.sfxController.play(t))},GameController.prototype.switchPetCommand=function(){if((this.logEvent("switchPetCommand"),!this.inputDisabled)&&!this.targetSelectionActive)switch(this.playSFX("tap"),this.player.pet.command){case"FOL":this.selectPetCommand("ATK");break;case"ATK":this.selectPetCommand("STA");break;case"STA":this.selectPetCommand("RET");break;case"RET":this.selectPetCommand("FOL")}},GameController.prototype.switchTactics=function(){if((this.logEvent("switchTactics"),!this.inputDisabled)&&!this.targetSelectionActive)switch(this.playSFX("tap"),this.player.getTactic()){case"AGR":this.selectTactic("BAL");break;case"BAL":this.selectTactic("DEF");break;case"DEF":this.player.wearShieldPenalty()?this.selectTactic("BAL"):this.selectTactic("AGR")}},GameController.prototype.selectTactic=function(t,e){switch(this.player.setTactic(t,e),t){case"AGR":commandName="Charge",commandIcon=109;break;case"BAL":commandName="Stand",commandIcon=108;break;case"DEF":commandName="Defend",commandIcon=107}this.tacticsIcon.loadTexture("tileset32",commandIcon),this.tacticsText.text=commandName,this.ui.buttonSpecs.text.xCenter&&this.centerText(this.tacticsText,this.ui.tacticsButton.x,this.ui.buttonSpecs.text.xCenter)},GameController.prototype.selectPetCommand=function(t,e){switch(this.player.changePetAI(t,e),t){case"ATK":commandName="Charge",commandIcon=117;break;case"RET":commandName="Flee",commandIcon=118;break;case"STA":commandName="Stay",commandIcon=110;break;case"FOL":commandName="Follow",commandIcon=111}this.currentPetCommandIcon.loadTexture("tileset32",commandIcon),this.currentPetCommandText.text=commandName,this.ui.buttonSpecs.text.xCenter&&this.centerText(this.currentPetCommandText,this.ui.petCommandButton.x,this.ui.buttonSpecs.text.xCenter)},GameController.prototype.saveGame=function(){this.logEvent("saveGame"),this.musicController.stopMusic(),this.playSFX("tap"),this.persistanceManager.saveGame(this),this.titlePanel.show()},GameController.prototype.quitGame=function(){this.logEvent("quitGame");var t=this;this.dialog.prompt("Are you sure?","",function(){t.showingInventory&&t.switchInventory(),t.persistanceManager.deleteGame(),t.musicController.stopMusic(),t.playSFX("tap"),t.gotoTitleAfterGameEnd()})},GameController.prototype.exitGame=function(){this.logEvent("exitGame");var t=this;this.dialog.prompt("Are you sure?","",function(){t.showingInventory&&t.switchInventory(),t.persistanceManager.deleteGame(),t.musicController.stopMusic(),t.playSFX("tap"),ngui.App.quit()})},GameController.prototype.exitGameFromTitle=function(){this.logEvent("exitGameFromTitel");var t=this;this.dialog.prompt("Are you sure?","",function(){t.playSFX("tap"),ngui.App.quit()})},GameController.prototype.gotoTitleAfterGameEnd=function(){this.isGold||this.disablePromo?this.titlePanel.show():(this.deaths||(this.deaths=7),this.deaths++,this.deaths>10?(this.deaths=0,this.promoPanel.show()):this.titlePanel.show())},GameController.prototype.isFullScreen=function(){var t;return null!=document.webkitFullScreenElement?t=document.webkitFullScreenElement:null!=document.fullscreenElement?t=document.fullscreenElement:null!=document.msFullscreenElement?t=document.msFullscreenElement:null!=document.mozFullScreenElement?t=document.mozFullScreenElement:null!=document.webkitFullscreenElement&&(t=document.webkitFullscreenElement),!(null==t||null==t)},GameController.prototype.stopFullScreen=function(){var t=document.webkitExitFullScreen||document.exitFullscreen||document.msExitFullscreen||document.mozExitFullScreen||document.webkitExitFullscreen;t&&(t.call(document),this.preferences.fullScreenPreferred=!1,this.savePreferences())},GameController.prototype.fullScreen=function(){this.phaser.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL;var t=document.getElementsByTagName("body")[0],e=t.webkitRequestFullScreen||t.requestFullscreen||t.msRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen;e&&(e.call(t),this.preferences.fullScreenPreferred=!0,this.savePreferences())},GameController.prototype.particleAnimationAt=function(t,e,i){if(!this.player.isBlind()||e.x==this.player.x&&e.y==this.player.y){e=this.translateToViewportCoordinates(e);var s=null;switch(t){case"healing":s=[39,40,41,40];break;case"wizardry":s=[15,16,17,16];break;case"smoke":s=[72,73,74,75,76,77]}var o=1e3;switch(t){case"healing":case"wizardry":var n=rand(2,4);o=1e3;for(var a=0;a<n;a++){var r={x:rand(0,24),y:e.y+16},l=function(t,i){var n=i.getImage(e.x+r.x*t,r.y,"animations",39,i.mobGroup);n.animations.add("sparkle",s),n.animations.play("sparkle",8,!0,!1),n.anchor.setTo(.5,.5);var a,l=i.tween(n).to({y:r.y-64,alpha:0},o,Phaser.Easing.Sinusoidal.Out);a=n,l.onComplete.add(function(){i.killImage(a)}),i.startTween(n,l)};l(1,this),l(-1,this)}break;case"smoke":o=1500;for(a=0;a<20;a++){var h=this.getImage(e.x+rand(-24,24),e.y+16,"animations",randomElementOf(s),this.mobGroup);h.anchor.setTo(.5,.5);var p=this.tween(h).to({y:e.y+16-64,alpha:0},o,Phaser.Easing.Linear.None);!function(t,e,i){p.onComplete.add(function(){i.killImage(t)})}(h,0,this),this.startTween(h,p)}}i&&setTimeout(function(){i()},o)}},GameController.prototype.explosionAt=function(t,e,i){var s="explosion";switch(t){case"acid":s="explosion-acid";break;case"holy":s="explosion-holy";break;case"freezing":s="explosion-ice"}e=this.translateToViewportCoordinates(e),i||(i=16),i<8&&(i=8);for(var o=[],n=0;n<i;n++)o[n]=16-i+n;var a=this.getImage(e.x,e.y,s,0,this.mobGroup);a.animations.add("sparkle",o),a.animations.play("sparkle",16,!1,!0),a.anchor.setTo(.5,.5)},GameController.prototype.translateToViewportCoordinates=function(t){return{x:32*t.x+16,y:32*t.y+this.YOFFSET}},GameController.prototype.debug=function(t){},GameController.prototype.useSpellFromMain=function(t){if(this.logEvent("useSpellFromMain "+t.code),t.targeted||t.autoUseOnEnemy)this.applyItemOrSpell(t);else{this.disablePlayerAction();var e=this;this.player.useSpell(t,function(t){e.player.stopRunning(),e.player.dead||(e.player.gameController.updatePlayerStats(!0),t?e.player.endTurn():(e.logEvent("Input used spell from main"),e.enablePlayerAction()))})}},GameController.prototype.useItem=function(){if(this.logEvent("useItem"),!this.inputDisabled&&!this.targetSelectionActive){var t=this;if(this.showingInventory){if(!this.inventoryPanel.selectedItem&&!this.inventoryPanel.selectedSpell)return t.logEvent("Input enabled, use Item on inventory"),void this.enablePlayerAction();var e=this.inventoryPanel.selectedItem,i=this.inventoryPanel.selectedSpell;if(e){if(e.isTargeted()||e.features.isSpell&&e.autoUseOnEnemy())return void this.applyItemOrSpell(e);this.disablePlayerAction(),this.player.useItem(this.inventoryPanel.selectedItem,function(e){e||t.player.dead||(t.logEvent("Input enabled, used Item"),t.enablePlayerAction())})}else if(i){if(i.targeted||i.autoUseOnEnemy)return void this.applyItemOrSpell(i);this.disablePlayerAction(),this.player.useSpell(i,function(e){t.player.stopRunning(),t.player.dead||(t.player.gameController.updatePlayerStats(!0),e?t.player.endTurn():(t.logEvent("Input enabled, !used spell"),t.enablePlayerAction()))})}this.player.dead||this.inventoryPanel.chemistryMode||(this.hideInventoryWithoutReactivatingPlayer(),this.player.currentRoom.isSafe()&&this.showInventory(!0))}else if("useGround"===this.useButtonMode){if(!(e=this.player.currentRoom.getItem(this.player.x,this.player.y))||!e.canUseInGround())return void(t.player.dead||(t.logEvent("Input enabled, !used Item on ground"),t.enablePlayerAction()));if(e.isTargeted()){var s=this.player.currentRoom.getEnemies();return this.usingItemOnGround=!0,0!=this.player.currentRoom.monsters.length||this.player.pet?1==s.length&&e.autoUseOnEnemy()?(this.selectedTarget=s[0],void this.confirmApplyItem(e)):void this.selectTargetForItem(e):void(e.features.shouldNotUseOnSelf||(this.selectedTarget=!1,this.confirmApplyItem(e)))}this.disablePlayerAction(),this.player.tryUseUnderlyingItem(function(e){e||t.player.dead||(t.enablePlayerAction(),t.logEvent("Input enabled, !used Item on ground"))})}else"throwSecondary"===this.useButtonMode&&(this.disablePlayerAction(),this.throwSecondaryItem()||this.player.dead||(this.logEvent("Input enabled, throw secondary"),this.enablePlayerAction()))}},GameController.prototype.dropItem=function(){if(this.logEvent("dropItem"),!this.inputDisabled&&(this.disablePlayerAction(),this.showingInventory)){if(!this.inventoryPanel.selectedItem)return this.logEvent("Input enabled, drop Item"),void this.enablePlayerAction();this.player.drop(this.inventoryPanel.selectedItem),this.hideInventoryWithoutReactivatingPlayer(),this.player.currentRoom.isSafe()&&this.showInventory(!0)}},GameController.prototype.throwSecondaryItem=function(){this.logEvent("throwSecondaryItem");var t=this.player.currentRoom.getEnemies(),e=this.player.previousWeapon;return!!e&&(0==t.length?(this.showObjectInfo(e,e.name,"There are no targets to use the item on.",!0),!1):1==t.length&&e.autoUseOnEnemy()?(this.selectedTarget=t[0],this.confirmApplyItem(e),!0):(this.selectTargetForItem(e),!0))},GameController.prototype.hideAllLowerButtons=function(){this.petCommandGroup.visible=!1,this.tacticsGroup.visible=!1,this.switchButtonGroup.visible=!1,this.inventoryButtonGroup.visible=!1,this.applyButtonGroup.visible=!1,this.useButtonGroup.visible=!1,this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!1)},GameController.prototype.showAllLowerButtons=function(){this.updatePlayerStats(!0),this.inventoryButtonGroup.visible=!0,this.tacticsGroup.visible=!0,this.ui.mainPanel.useZoomedMovement&&(this.moveButtonGroup.visible=!0)},GameController.prototype.applyItemOrSpell=function(){if(this.logEvent("applyItemOrSpell"),!this.inputDisabled){this.playSFX("tap");var t=this.player.currentRoom.getEnemies(),e=this.inventoryPanel.selectedItem,i=this.inventoryPanel.selectedSpell||this.selectedSpell,s=e||i;if(0!=this.player.currentRoom.monsters.length||this.player.pet){if(1==t.length&&(i&&i.autoUseOnEnemy||e&&e.autoUseOnEnemy()))return this.hideInventory(),this.selectedTarget=t[0],void(e?this.confirmApplyItem(e):i&&this.confirmApplySpell(i));if(this.showingInventory){if(!e&&!i)return;if(this.selectedItemToApply=!1,this.hideInventory(),e){if(this.player.prevalidateUseItem(e)){var o=!(e.features.dontThrow||e.features.dontThrowToAllies||e.features.isSpell);this.activateTargetSelection(e,o)}}else i&&this.player.prevalidateCastSpell(i)&&this.activateTargetSelectionForSpell(i)}else this.selectedSpell&&(i=this.selectedSpell,this.player.prevalidateCastSpell(i)&&this.activateTargetSelectionForSpell(i))}else s.features.shouldNotUseOnSelf?e?this.showObjectInfo(e,e.name,"There are no targets to use the item on.",!0):s.features.notMagicSpell?this.showObjectInfo(Spells.getIconTexture(this,i),i.words,"There are no targets to use the skill on.",!1,!0):this.showObjectInfo(Spells.getIconTexture(this,i),i.words,"There are no targets to use the spell on.",!1,!0):(this.hideInventory(!0),this.showInventory(!0),this.selectedTarget=!1,e?this.confirmApplyItem(e):i&&this.confirmApplySpell(i))}},GameController.prototype.autoRangedAttack=function(){if(this.logEvent("autoRangedAttack"),this.canUseKeyboardCommands()&&!this.showingInventory){var t=this.player.currentRoom.getEnemies(),e=this.player.currentWeapon;this.player.isRangedAttack()?0==t.length?this.showObjectInfo(e,e.name,"There are no targets to attack.",!0):1==t.length?this.interactBridge(t[0]):(this.showObjectInfo(e,e.name,"Select a target to attack.",!0),this._setTargetSelectionActive("ranged",!1,!1)):this.showDenziMessage("No ranged weapon","You need a ranged weapon to target.")}},GameController.prototype.selectTargetForItem=function(t){this.selectedItemToApply=t,this.player.prevalidateUseItem(t)&&(this.activateTargetSelection(t),this.inputDisabled=!1,this.logEvent("Input enabled selectTargetForItem"))},GameController.prototype.activateTargetSelection=function(t,e){this.showObjectInfo(t,t.name,"Select a target to use the item on.",!0),this._setTargetSelectionActive("item",!t.autoUseOnEnemy()&&!e,!0)},GameController.prototype.selectNextTarget=function(){++this.currentTargetIndex==this.targetsList.length&&(this.currentTargetIndex=0);var t=this.targetsList[this.currentTargetIndex];t==this.player?this.targetSelf():this.selectTarget(t)},GameController.prototype.activateTargetSelectionForSpell=function(t){t.features.notMagicSpell?this.showObjectInfo(Spells.getIconTexture(this,t),t.words,"Select a target to use the skill on.",!1,!0):this.showObjectInfo(Spells.getIconTexture(this,t),t.words,"Select a target to use the spell on.",!1,!0),this._setTargetSelectionActive("spell",!t.autoUseOnEnemy,!0)},GameController.prototype.confirmApplyBase=function(){if(this.playSFX("tap"),this.inventoryPanel.chemistryMode)return this.player.performChemistry(this.inventoryPanel.firstReagent,this.inventoryPanel.secondReagent),this.inventoryPanel.endChemistry(),void(this.player.currentRoom.isSafe()?(this.hideInventory(!1),this.showInventory(!0)):(this.hideInventoryWithoutReactivatingPlayer(),this.player.endTurn()));"item"===this.targetSelectionMode?this.confirmApplyItem():"spell"===this.targetSelectionMode?this.confirmApplySpell():"ranged"===this.targetSelectionMode&&this.confirmRangedAttack(),this.targetsList=!1},GameController.prototype.confirmApplyItem=function(t){this.logEvent("confirmApplyItem"),this._setTargetSelectionInactive();var e=this.usingItemOnGround;if(this.usingItemOnGround=!1,t||(t=this.selectedItemToApply?this.selectedItemToApply:this.inventoryPanel.selectedItem),t){var i=this;this.player.useItemOn(t,this.selectedTarget,function(s){s&&e&&(i.player.currentRoom.removeItem(t),i.removeItemFromRoom(t)),i.player.dead||s||(i.logEvent("Input enabled, confirmApplyItem with item"),i.enablePlayerAction())})}else this.logEvent("Input enabled, confirmApplyItem without item"),this.enablePlayerAction()},GameController.prototype.confirmApplySpell=function(t){if(this.logEvent("confirmApplySpell"),t||(t=this.inventoryPanel.selectedSpell),t||(t=this.selectedSpell),this._setTargetSelectionInactive(),t){var e=this;this.player.useSpellOn(t,this.selectedTarget,function(t){e.player.stopRunning(),e.player.dead||(e.player.gameController.updatePlayerStats(!0),t?e.player.endTurn():(e.logEvent("Input enabled, confirmApplySpell with spell"),e.enablePlayerAction()))})}else this.logEvent("Input enabled, confirmApplySpell without spell"),this.enablePlayerAction()},GameController.prototype.confirmRangedAttack=function(){this.logEvent("confirmRangedAttack"),this._setTargetSelectionInactive(!0),this.selectedTarget&&this.selectedTarget!==this.player&&this.interactBridge(this.selectedTarget)},GameController.prototype._setTargetSelectionActive=function(t,e,i){this.targetSelectionActive=!0,this.cancelApplyButtonGroup.visible=!0,this.ui.mainPanel.hideSystemButtonsWhenTargetting&&(this.settingsButtonGroup.visible=!1,this.helpButtonGroup.visible=!1),this.targetSelectionMode=t;var s=this.player.x,o=this.player.y,n=this.player.currentRoom.getEnemies();if(n.sort(function(t,e){return distance(t.x,t.y,s,o)-distance(e.x,e.y,s,o)}),i){var a=this.player.currentRoom.getFriendlies();a.sort(function(t,e){return distance(t.x,t.y,s,o)-distance(e.x,e.y,s,o)}),e?(this.targetsList=a.concat(n),this.targetsList.unshift(this.player)):(this.targetsList=n.concat(a),this.targetsList.push(this.player))}else this.targetsList=n;this.currentTargetIndex=0,this.hideDirectionalPad(),this.ui.selectATargetMessage&&(this.selectATargetMessageText.visible=!0),0!==this.targetsList.length?(this.targetsList[0]==this.player?this.targetSelf():this.selectTarget(this.targetsList[0]),this.ui.buttons.hideBasicButtonsWhenTargetting&&this.hideAllLowerButtons()):this._setTargetSelectionInactive(!0)},GameController.prototype._setTargetSelectionInactive=function(t){this.targetSelectionActive=!1,t||this.disablePlayerAction(),this.confirmApplyButtonGroup.visible=!1,this.cancelApplyButtonGroup.visible=!1,this.ui.mainPanel.hideSystemButtonsWhenTargetting&&(this.settingsButtonGroup.visible=!0,this.helpButtonGroup.visible=!0),this.targetsList=!1,this.selectATargetMessageText&&(this.selectATargetMessageText.visible=!1),this.selectedTargetIcon.visible=!1,this.forceTargetPlayer=!1,this.ui.buttons.hideBasicButtonsWhenTargetting&&this.showAllLowerButtons()},GameController.prototype.cancelApplyItem=function(){if(this.playSFX("tap"),this.logEvent("cancelApplyItem"),this.targetsList=!1,this.inventoryPanel.chemistryMode)return this.inventoryPanel.endChemistry(),this.showMessageInPanel("Mix cancelled"),this.logEvent("Input enabled, cancelApplyItem for chemistryMode"),void(this.inputDisabled=!1);this._setTargetSelectionInactive(!0),this.usingItemOnGround=!1,this.forceTargetPlayer=!1,this.logEvent("Input enabled, cancelApplyItem"),this.enablePlayerAction();var t=!1;t=this.selectedItemToApply?this.selectedItemToApply:this.inventoryPanel.selectedItem;var e=this.inventoryPanel.selectedSpell;e||(e=this.selectedSpell),this.ui.mainPanel.spellsRow&&(this.selectedSpell=!1,this.selectedSpellBox.visible=!1),t?this.showObjectInfo(t,t.name,"Cancelled.",!0):e&&this.showObjectInfo(Spells.getIconTexture(this,e),e.words,"Cancelled.",!1,!0),this.selectedItemToApply=!1,this.setupUseAndThrowButtons()},GameController.prototype.switchWeapon=function(){this.logEvent("switchWeapon"),this.inputDisabled||this.targetSelectionActive||(this.player.switchWeapon(),this.setupUseAndThrowButtons(),this.updatePlayerStats(!1))},GameController.prototype.showSettingsMenu=function(){if(this.logEvent("showSettingsMenu"),!this.inputDisabled&&!this.targetSelectionActive){this.playSFX("tap");var t=this,e=[{text:"Save Game",action:function(){t.playSFX("tap"),t.showingInventory&&t.switchInventory(),t.saveGame(),t.dialog.hide()}},{text:"Kill Character",action:function(){t.playSFX("tap"),t.quitGame()}}];this.preferences.soundEnabled&&e.push({text:this.musicController.musicEnabled?"Turn Sound Off":"Turn Sound On",action:function(){t.playSFX("tap"),t.musicController.switchMusic(),t.sfxController.switchEnabled(),t.dialog.hide()}}),this.runningOnNWJS()&&e.push({text:"Exit",action:function(){t.playSFX("tap"),t.exitGame()}}),this.dialog.show("Main Menu","",e,!0)}},GameController.prototype.setupUseAndThrowButtons=function(){var t=this.player.currentRoom.getItem(this.player.x,this.player.y);t&&t.canUseInGround()?(this.useButtonGroup.visible=!0,this.useButtonMode="useGround",this.useButtonImage.loadTexture(t.menuSprite.texture),this.useButtonText.text="Use",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.useButtonText,this.ui.useButton.x,this.ui.buttonSpecs.text.xCenter),this.ui.buttonSpecs.small&&this.useButtonOverlay.loadTexture("tileset32",158)):!this.player.previousWeapon||this.player.previousWeapon.features.dontThrow||this.showingInventory?this.useButtonGroup.visible=!1:(this.useButtonGroup.visible=!0,this.useButtonMode="throwSecondary",this.useButtonImage.loadTexture(this.player.previousWeapon.menuSprite.texture),this.useButtonText.text="Throw",this.ui.buttonSpecs.text.xCenter&&this.centerText(this.useButtonText,this.ui.useButton.x,this.ui.buttonSpecs.text.xCenter),this.ui.buttonSpecs.small&&this.useButtonOverlay.loadTexture("tileset32",157))},GameController.prototype.tweenOnPath=function(t,e,i,s,o,n,a,r,l){var h=0,p=this.player.currentRoom,c=p.grid.clone(),u=new PF.AStarFinder({heuristic:PF.Heuristic.manhattan,diagonalMovement:PF.DiagonalMovement.Always}).findPath(e,i,s,o,p.grid);u=PF.Util.compressPath(u),p.grid=c;var d=null,m=null;if(u.length<=1){var y={x:32*s+16};l?y.baseY=32*o+this.YOFFSET:y.y=32*o+this.YOFFSET,h+=this.warpLength;var g=this.tween(t).to(y,this.warpLength,Phaser.Easing.Linear.None);if(n)(f=r-h)<0&&(f=0),g.onComplete.add(function(){this.schedule(n,f,a)},this);g.start()}else{for(var v=1;v<u.length;v++){y={x:32*u[v][0]+16};l?y.baseY=32*u[v][1]+this.YOFFSET:y.y=32*u[v][1]+this.YOFFSET;var b=this.getMovementTweenTime(u[v-1][0],u[v-1][1],u[v][0],u[v][1]);h+=b;var f;g=this.tween(t).to(y,b,Phaser.Easing.Linear.None);if(1==v?d=g:m.chain(g),m=g,v==u.length-1&&n)(f=r-h)<0&&(f=0),g.onComplete.add(function(){this.schedule(n,f,a)},this)}d.start()}return h},GameController.prototype.getMovementTweenTime=function(t,e,i,s){return distance(t,e,i,s)*this.animationLength/3},GameController.prototype.centerText=function(t,e,i){t.x=e+Math.round((i-t.width)/2)},GameController.prototype.showMessageInPanel=function(t){this.showSocialMessage(t,!0),this.watchedObjectDescriptionText.text=t,"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth)},GameController.prototype.examineFeatureBridge=function(t){this.logEvent("examineFeatureBridge"),this.inputDisabled||this.targetSelectionActive||("string"==typeof t.examineText?this.useInspector(t,"Examine",t.examineText,!1,!0):this.examineComplexFeature(t,t.examineText))},GameController.prototype.examineComplexFeature=function(t,e){this.logEvent("examineComplexFeature "+e.type),"book"===e.type&&this.player.tryReading("book")&&(this.useInspector(t,"Read","You read the book."),this.bookPanel.showBook(e))},GameController.prototype.useInspector=function(t,e,i,s,o){t.tileset?this.watchedObjectSprite.loadTexture(t.tileset,t.index):this.watchedObjectSprite.loadTexture(t.texture),this.ui.inspector.toogleButton&&this.inspectorButtonIcon.loadTexture(this.watchedObjectSprite.texture),s&&this.showSocialMessage(i,!0),this.watchedObjectNameText.text=e,"center"===this.watchedObjectNameText.align&&this.centerText(this.watchedObjectNameText,this.watchedObjectNameText.ananiasBaseX,this.watchedObjectNameText.ananiasCenterWidth),this.watchedObjectDescriptionText.text=i,"center"===this.watchedObjectDescriptionText.align&&this.centerText(this.watchedObjectDescriptionText,this.watchedObjectDescriptionText.ananiasBaseX,this.watchedObjectDescriptionText.ananiasCenterWidth),this.ui.inspector.toogleButton&&o&&!this.objectInspectorGroup.visible&&this.toogleInspectorVisible()},GameController.prototype.initBackButton=function(){var t=this;if(this.runningOnCordova()){t=this;document.addEventListener("backbutton",function(){t.doBackButton()&&navigator.notification.confirm("Close Ananias?",function(t){"1"==t&&navigator.app.exitApp()},"Confirmation","Yes,No")},!1)}},GameController.prototype.doBackButton=function(){if(this.gameActive&&this.player)return!this.locationImageGroup.visible&&(this.switchInventory(),!1);var t=this.panelStack[this.panelStack.length-1];return!!t&&(!t.backNavigation||t.backNavigation())},GameController.prototype.alert=function(t,e,i){e||(e="Message"),this.dialog.alert(e,t,i)},GameController.prototype.prompt=function(t,e,i,s){prompt?i(prompt(t)):(this.alert("Sorry, your device doesn't support textual input."),i(""))},GameController.prototype.createTextField=function(t,e,i,s,o,n){n?n.cssClass="prettyTextField":n={cssClass:"prettyTextField"},this.ptf.create(t,e,i,s,o,n)},GameController.prototype.removeTextField=function(t){this.ptf.destroy(t)},GameController.prototype.getTextFieldValue=function(t){return this.ptf.getValue(t)},GameController.prototype.fadeAnimation=function(t,e,i,s,o){var n={step:0},a=Math.round(i/10);i=10*a;var r=this.tween(n).to({step:a},i,Phaser.Easing.Sinusoidal.Out,!1,0,Number.MAX_VALUE,!0),l=this;r.onUpdateCallback(function(){l.phaser.renderType===Phaser.CANVAS?t.tint=Phaser.Color.interpolateColor(16777215,e,101,n.step,1):t.tint=Phaser.Color.interpolateColor(16777215,e,101,n.step),100==n.step&&o&&o(),n.step<1&&(r.stop(),s&&s())}),r.start()},GameController.prototype.floatAnimation=function(t){t.floatHeight=0;var e=this.tween(t).to({floatHeight:16},500,Phaser.Easing.Sinusoidal.Out,!1,0,Number.MAX_VALUE,!0);e.onUpdateCallback(function(){this.y=this.baseY-this.floatHeight},t),e.start()};var bezierInterpolation=function(t,e){return Phaser.Math.bezierInterpolation(t,e)};GameController.prototype.getBezierTween=function(t,e,i,s,o,n,a,r,l,h,p,c){n||(n=this.animationLength),l||(l=20),h||(h=!1);var u={x:[e,Math.floor((e+s)/2),s]};c?u.baseY=[i,Math.floor((i+o)/2)-l,o]:u.y=[i,Math.floor((i+o)/2)-l,o];var d=this.tween(t).to(u,n,Phaser.Easing.Quadratic.Out,h).interpolation(bezierInterpolation),m=null;if(a){var y={x:[s,Math.floor((e+s)/2),e]};c?y.baseY=[o,Math.floor((i+o)/2)-l,i]:y.y=[o,Math.floor((i+o)/2)-l,i],m=this.tween(t).to(y,n,Phaser.Easing.Quadratic.Out,h).interpolation(bezierInterpolation);var g=this;d.onComplete.add(function(){g.startTween(t,m)}),p&&d.onComplete.add(p),r&&m.onComplete.add(function(){r()})}else r&&d.onComplete.add(r);return d},GameController.prototype.showEffectOnInspector=function(t,e,i,s){switch(s||(s="YOUR"),s){case"YOUR":t==this.player?this.useInspector(t.sprite,e,"Your "+i,!0):this.useInspector(t.sprite,e,t.getDescription()+"'s "+i,!0);break;case"ARE":t==this.player?this.useInspector(t.sprite,e,"You are "+i,!0):this.useInspector(t.sprite,e,t.getDescription()+" is "+i,!0);break;case"HAVE":t==this.player?this.useInspector(t.sprite,e,"You have "+i,!0):this.useInspector(t.sprite,e,t.getDescription()+" has "+i,!0)}},GameController.prototype.switchMoveButtons=function(){this.player.dead||(this.showMovementButtons=!this.showMovementButtons,this.locateDirectionalPad(),this.showMovementButtons?(this.moveButtonIcon.loadTexture("tileset32",134),this.ui.bigDirectionPad?this.moveButtonText.text="Inspect":(this.moveButtonText.text="Quick",this.showDenziMessage("Quick Mode","Tap on the enemies, items or corridor arrows to move quickly."))):(this.moveButtonIcon.loadTexture("tileset32",135),this.ui.bigDirectionPad?this.moveButtonText.text="Move":(this.moveButtonText.text="Zoomed",this.showDenziMessage("Zoomed Mode","Tap on the arrows to move in a direction. Use this ONLY when you need precise movement in combat."))),this.ui.buttonSpecs.text.xCenter&&this.centerText(this.moveButtonText,this.ui.zoomedMovementButton.x,this.ui.buttonSpecs.text.xCenter),this.visibleRunningIndicator&&(this.visibleRunningIndicator.visible=!0))},GameController.prototype.usePool=!1,GameController.prototype.getImage=function(t,e,i,s,o){if(this.usePool){if(!o)return this.phaser.add.image(t,e,i,s,o);var n=o.getFirstExists(!1);return n?(n.reset(t,e),n.anchor.x=0,n.anchor.y=0,n.loadTexture(i,s)):n=this.phaser.add.image(t,e,i,s,o),n}return this.phaser.add.image(t,e,i,s,o)},GameController.prototype.killImage=function(t){this.usePool?(t.events&&t.events.destroy(),t.anchor.x=0,t.anchor.y=0,t.inputEnabled=!1,t.monster=!1,t.examineText=!1,t.visible=!1,t.kill()):t.destroy()},GameController.prototype.killAllImagesOnGroup=function(t){var e=this;this.usePool?t.forEach(function(t){e.killImage(t)},this):t.destroy(!0)},GameController.prototype.showBlockingObject=function(t){switch(this.playSFX("beep"),t.type){case"monster":this.useInspector(t.monster.sprite,"Blocked","The "+t.monster.race.name+" blocks your attack.",!0);break;case"cell":var e=this.getCellInfo(t.cell,t.x,t.y);this.useInspector(e,"Blocked","The "+e.description+" blocks your attack.",!0);break;case"obstacle":var i,s=t.obstacle;i=s.tileIndex.length?s.tileIndex[0]:s.tileIndex,this.useInspector({tileset:"terrain32",index:i},"Blocked","The "+s.description+" blocks your attack.",!0)}},GameController.prototype.getCellInfo=function(t,e,i){var s,o,n=0,a=this.player.currentRoom,r="";if("TEMPLE"===a.getEnvironment()?r="temple":"CAVERNS"===a.getEnvironment()?r="caverns":"LAGOON"===a.getEnvironment()?r="lagoon":"CRYSTAL"===a.getEnvironment()?r="crystal":"ABYSS"===a.getEnvironment()?r="abyss":"LAIR"===a.getEnvironment()&&(r="lair"),t.isWall){var l=0;s=r+"-wall","TEMPLE"===a.getEnvironment()?l=80:"CAVERNS"===a.getEnvironment()?l=36:"LAGOON"===a.getEnvironment()?l=6:"CRYSTAL"===a.getEnvironment()?l=48:"ABYSS"===a.getEnvironment()?l=12:"LAIR"===a.getEnvironment()&&(l=7),n=this.floorHash(e,i,l,a),this.player.dungeonLevel.isRetro&&(s="yendor",n=0),o="wall"}else if(t.equals(CellType.DOOR)){s=(h=this.getCorridorTile(a.getEnvironment(),e,i)).spriteId,n=h.frame,o="door"}else if(t.isFloor||t.equals(CellType.HEALING_POND)){var h;s=(h=this.getTerrainTile(a.getEnvironment(),e,i,a.environmentSubset)).spriteId,n=h.frame,o="floor"}else t.equals(CellType.TORCH)?(s=r+"-torch",o="wall"):t.metaSpriteId?"stairs"===t.metaSpriteId&&(s="terrain32","TEMPLE"===a.getEnvironment()?n=248:"CAVERNS"===a.getEnvironment()?n=249:"LAGOON"===a.getEnvironment()?n=250:"CRYSTAL"===a.getEnvironment()?n=251:"LAIR"===a.getEnvironment()?n=252:"ABYSS"===a.getEnvironment()?n=253:"YENDOR"===a.getEnvironment()&&(s="yendor",n=2),o="stairway"):(s=t.spriteId,n=t.tileCount?this.floorHash(e,i,t.tileCount,a):t.tileIndex?t.tileIndex:0,o="wall");return{tileset:s,index:n,description:o}},GameController.prototype.openURL=function(t,e){this.runningOnCordova()?e?cordova.InAppBrowser.open(t,"_blank","location=no,zoom=no"):cordova.InAppBrowser.open(t,"_system"):!this.runningOnNWJS()||e?window.open(t,"_system"):ngui.Shell.openExternal(t)},GameController.prototype.runningOnCocoon=function(){return"undefined"!=typeof Cocoon},GameController.prototype.runningOnNWJS=function(){return"undefined"!=typeof ngui},GameController.prototype.runningOnCordova=function(){return"undefined"!=typeof cordova},GameController.prototype.getContainer=function(){return this.runningOnCordova()?"Cordova":this.runningOnCocoon()?"Cocoon":"undefined"!=typeof ngui?"NWJS":"none"},GameController.prototype.useKeyboard=function(){return!0},GameController.prototype.showMovementArrows=function(){return!1},GameController.prototype.secondTick=function(){var t=this;setTimeout(function(){t.secondTick()},1e3),this.phaser.paused||!this.gameActive||this.player.dead||(this.player.stats.gameplaySeconds++,this._checkGameHanged())},GameController.prototype.moveWithKeyboard=function(t,e){this.gameActive&&(this.entityInfoPanel.dialogLayer.visible?"entity"===this.entityInfoPanel.type&&(1===t.y?this.entityInfoPanel.next():-1===t.y&&this.entityInfoPanel.back()):this.bookPanel.dialogLayer.visible?1===t.y?this.bookPanel.next():-1===t.y&&this.bookPanel.back():this.showingInventory?e||this.inventoryPanel.moveSelected(t.x,t.y):this.player&&this.player.dungeonLevel&&this.move(t))},GameController.prototype.checkKeyboardMovement=function(t){var e=!1;if(this.movementKeysMap[t].key.isDown)e=!0,this.moveWithKeyboard(this.movementKeysMap[t].direction,this.movementKeysMap[t].isAlpha);else for(var i=0;i<this.movementKeys.length;i++){var s=this.movementKeys[i];if(s.key.isDown){e=!0,this.moveWithKeyboard(s.direction,s.isAlpha);break}}if(e){var o=this;this.currentKeyboardTimeout=setTimeout(function(){o.checkKeyboardMovement(t)},200)}},GameController.prototype.toogleInventoryWithKeyboard=function(){this.canUseKeyboardCommands()&&this.switchInventory()},GameController.prototype.canUseKeyboardCommands=function(){return this.gameActive&&!this.entityInfoPanel.dialogLayer.visible&&!this.bookPanel.dialogLayer.visible&&!this.inputDisabled},GameController.prototype.useTabKey=function(){this.canUseKeyboardCommands()&&(this.selectedTargetIcon.visible?this.selectNextTarget():this.switchWeaponWithKeyboard())},GameController.prototype.switchWeaponWithKeyboard=function(){this.canUseKeyboardCommands()&&(this.showingInventory||this.switchWeapon())},GameController.prototype.throwItemUsingKeyboard=function(){if(this.canUseKeyboardCommands())if(this.showingInventory){var t=this.inventoryPanel.selectedItem;t.features.dontThrow||t.features.isSpell||this.applyItemOrSpell()}else this.targetsList?this.selectNextTarget():this.player.previousWeapon&&!this.player.previousWeapon.features.dontThrow&&(this.disablePlayerAction(),this.throwSecondaryItem()||(this.targetsList=!1,this.player.dead||(this.logEvent("Input enabled, throw secondary using keyboard"),this.enablePlayerAction())))},GameController.prototype.initKeyboard=function(){var t=this;t.movementKeys=[],t.movementKeysMap={};var e=this.phaser.input.keyboard;function i(i,s,o){var n=e.addKey(i),a={key:n,direction:s,isAlpha:o};t.movementKeys.push(a),t.movementKeysMap[i]=a,n.onDown.add(function(){t.currentKeyboardTimeout&&(clearTimeout(t.currentKeyboardTimeout),t.currentKeyboardTimeout=0),t.checkKeyboardMovement(i)},t)}i(Phaser.Keyboard.NUMPAD_1,{x:-1,y:1},!0),i(Phaser.Keyboard.NUMPAD_2,{x:0,y:1},!0),i(Phaser.Keyboard.NUMPAD_3,{x:1,y:1},!0),i(Phaser.Keyboard.NUMPAD_4,{x:-1,y:0},!0),i(Phaser.Keyboard.NUMPAD_5,{x:0,y:0},!0),i(Phaser.Keyboard.NUMPAD_6,{x:1,y:0},!0),i(Phaser.Keyboard.NUMPAD_7,{x:-1,y:-1},!0),i(Phaser.Keyboard.NUMPAD_8,{x:0,y:-1},!0),i(Phaser.Keyboard.NUMPAD_9,{x:1,y:-1},!0),i(Phaser.Keyboard.DOWN,{x:0,y:1},!1),i(Phaser.Keyboard.LEFT,{x:-1,y:0},!1),i(Phaser.Keyboard.RIGHT,{x:1,y:0},!1),i(Phaser.Keyboard.UP,{x:0,y:-1},!1),i(Phaser.Keyboard.Z,{x:-1,y:1},!0),i(Phaser.Keyboard.X,{x:0,y:1},!0),i(Phaser.Keyboard.C,{x:1,y:1},!0),i(Phaser.Keyboard.A,{x:-1,y:0},!0),i(Phaser.Keyboard.S,{x:0,y:0},!0),i(Phaser.Keyboard.D,{x:1,y:0},!0),i(Phaser.Keyboard.Q,{x:-1,y:-1},!0),i(Phaser.Keyboard.W,{x:0,y:-1},!0),i(Phaser.Keyboard.E,{x:1,y:-1},!0);var s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.I);s.onDown.add(this.toogleInventoryWithKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.ESC)).onDown.add(this.useEscapeKey,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.QUESTION_MARK)).onDown.add(this.showHelpWithKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.TAB)).onDown.add(this.useTabKey,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.T)).onDown.add(this.throwItemUsingKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.O)).onDown.add(this.switchTacticsWithKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.P)).onDown.add(this.switchPetCommandWithKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.D)).onDown.add(this.dropUsingKeyboard,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.ENTER)).onDown.add(this.useEnterKey,this),(s=this.phaser.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)).onDown.add(this.autoRangedAttack,this),this.phaser.input.keyboard.clearCaptures(),this.phaser.input.keyboard.addKeyCapture(Phaser.Keyboard.TAB),this.phaser.input.keyboard.addKeyCapture([Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT])},GameController.prototype.showHelpWithKeyboard=function(){this.canUseKeyboardCommands()&&this.showHelp()},GameController.prototype.dropUsingKeyboard=function(){this.canUseKeyboardCommands()&&this.dropButtonGroup.visible&&this.dropItem()},GameController.prototype.switchPetCommandWithKeyboard=function(){this.canUseKeyboardCommands()&&this.petCommandGroup.visible&&this.switchPetCommand()},GameController.prototype.switchTacticsWithKeyboard=function(){this.canUseKeyboardCommands()&&this.tacticsGroup.visible&&this.switchTactics()},GameController.prototype.useEnterKey=function(){if(this.gameActive)if(this.dialog.dialogLayer.visible)"prompt"===this.dialog.type?this.dialog.doButtonAction(0):"alert"===this.dialog.type&&this.dialog.doButtonAction(0);else if(this.entityInfoPanel.dialogLayer.visible)"entity"===this.entityInfoPanel.type?this.entityInfoPanel.hide():"conversation"===this.entityInfoPanel.type&&this.entityInfoPanel._nextDialog();else if(this.bookPanel.dialogLayer.visible)this.bookPanel.hide();else if(this.showingInventory)if(this.inventoryPanel.chemistryMode){if(!this.confirmApplyButtonGroup.visible)return;this.confirmApplyBase()}else this.interactItemInventoryBridge(this.inventoryPanel.selectedItem,!0);else{if(!this.selectedTargetIcon.visible)return;this.confirmApplyBase()}},GameController.prototype.useEscapeKey=function(){this.dialog.dialogLayer.visible?this.dialog.closeButtonGroup.visible?this.dialog.hide():"prompt"===this.dialog.type?this.dialog.doButtonAction(1):"alert"===this.dialog.type&&this.dialog.doButtonAction(0):this.entityInfoPanel.dialogLayer.visible?"entity"===this.entityInfoPanel.type&&this.entityInfoPanel.hide():this.bookPanel.dialogLayer.visible?this.bookPanel.hide():this.selectedTargetIcon.visible||this.inventoryPanel.chemistryMode?this.cancelApplyItem():this.showingInventory?this.toogleInventoryWithKeyboard():this.gameActive&&this.settingsButtonGroup.visible&&this.showSettingsMenu()},GameController.prototype.turnOffLights=function(){this.player.currentRoom.darkenRoom(),this.mapGroup.visible=!1},GameController.prototype.turnOnLights=function(){this.player.currentRoom.lightenRoom(),this.mapGroup.visible=!0},GameController.prototype.switchPerception=function(){this.player.currentRoom.switchPerception()},GameController.prototype.recoverPerception=function(){this.player.currentRoom.recoverPerception()},GameController.prototype.schedule=function(t,e,i){this.phaser.time.events.add(e,t,i)},GameController.prototype.toogleMapVisible=function(){this.showingInventory||this.targetSelectionActive||this.inputDisabled&&!this.player.dead&&!this.miniMapGroup.visible||("opaque"===this.mapMode?(this.miniMapGroup.visible=!1,this.player.dead||this.enablePlayerAction(),this.mapMode="hidden"):(this.miniMapGroup.visible=!0,this.disablePlayerAction(),this.mapMode="opaque"),this.drawMiniMap(),this.ui.inspector.toogleButton&&(this.objectInspectorGroup.visible=!1))},GameController.prototype.toogleSpellsRowVisible=function(){this.playSFX("tap"),this.showingSpellsRow=!this.showingSpellsRow,this.spellsRowGroup.visible=this.showingSpellsRow},GameController.prototype.toogleInspectorVisible=function(){this.playSFX("tap"),this.targetSelectionActive||this.inputDisabled&&!this.showingInspector&&!this.player.dead||(this.ui.minimap.toogleButton,this.objectInspectorGroup.visible?("transparent"!==this.mapMode||this.showingInventory||(this.miniMapGroup.visible=!0),this.showingInventory||this.player.dead||(this.logEvent("Input enabled, toogleInspectorVisible"),this.enablePlayerAction()),this.showingInspector=!1,this.inspectorButtonIcon.loadTexture(this.inspectorButtonIcon.savedTexture),this.inspectorButtonIcon.savedTexture=!1,this.ui.buttonSpecs.small&&(this.inspectorButtonOverlay.visible=!0),this.inspectorButtonIcon.y=this.ui.inspector.toogleButton.y,this.inspectorButton.y=this.ui.inspector.toogleButton.y,this.resetButtonState()):(this.miniMapGroup.visible=!1,"opaque"===this.mapMode&&(this.mapMode="hidden"),this.showingInventory||this.disablePlayerAction(),this.showingInspector=!0,this.inspectorButtonIcon.savedTexture=this.inspectorButtonIcon.texture,this.inspectorButtonIcon.loadTexture("tileset32",128),this.inspectorButtonIcon.y=0,this.inspectorButton.y=0,this.ui.buttonSpecs.small&&(this.inspectorButtonOverlay.visible=!1),this.saveButtonState(),this.hideAllButtons(),this.toogleInspectorButtonGroup.visible=!0),this.objectInspectorGroup.visible=!this.objectInspectorGroup.visible)},GameController.prototype.saveButtonState=function(){this.buttonState={throwWeaponOrUse:this.useButtonGroup.visible,switchWeapon:this.switchButtonGroup.visible,changePetAI:this.petCommandGroup.visible,tactics:this.tacticsGroup.visible,showInventory:this.inventoryButtonGroup.visible,toogleMap:!!this.toogleMapButtonGroup&&this.toogleMapButtonGroup.visible,toogleSpellsRow:!!this.toogleSpellsRowButtonGroup&&this.toogleSpellsRowButtonGroup.visible,toogleInspector:!!this.toogleInspectorButtonGroup&&this.toogleInspectorButtonGroup.visible,settings:this.settingsButtonGroup.visible,help:this.helpButtonGroup.visible,drop:this.dropButtonGroup.visible,apply:this.applyButtonGroup.visible}},GameController.prototype.hideAllButtons=function(){this.useButtonGroup.visible=!1,this.switchButtonGroup.visible=!1,this.petCommandGroup.visible=!1,this.tacticsGroup.visible=!1,this.inventoryButtonGroup.visible=!1,this.toogleMapButtonGroup&&(this.toogleMapButtonGroup.visible=!1),this.toogleSpellsRowButtonGroup&&(this.toogleSpellsRowButtonGroup.visible=!1),this.toogleInspectorButtonGroup&&(this.toogleInspectorButtonGroup.visible=!1),this.settingsButtonGroup.visible=!1,this.helpButtonGroup.visible=!1,this.dropButtonGroup.visible=!1,this.applyButtonGroup.visible=!1},GameController.prototype.resetButtonState=function(){this.useButtonGroup.visible=this.buttonState.throwWeaponOrUse,this.switchButtonGroup.visible=this.buttonState.switchWeapon,this.petCommandGroup.visible=this.buttonState.changePetAI,this.tacticsGroup.visible=this.buttonState.tactics,this.inventoryButtonGroup.visible=this.buttonState.showInventory,this.toogleMapButtonGroup&&(this.toogleMapButtonGroup.visible=this.buttonState.toogleMap),this.toogleSpellsRowButtonGroup&&(this.toogleSpellsRowButtonGroup.visible=this.buttonState.toogleSpellsRow),this.toogleInspectorButtonGroup&&(this.toogleInspectorButtonGroup.visible=this.buttonState.toogleInspector),this.settingsButtonGroup.visible=this.buttonState.settings,this.helpButtonGroup.visible=this.buttonState.help,this.dropButtonGroup.visible=this.buttonState.drop,this.applyButtonGroup.visible=this.buttonState.apply,this.buttonState={}},GameController.prototype.targetSelfBridge=function(){this.targetSelectionActive?this.targetSelf():this.move(this.SELF_DIRECTION)},GameController.prototype.logEvent=function(t){this.eventLog.logEvent(t)},GameController.prototype.showReloadHelp=function(){this.isDesktop?this.showDenziMessage("Reload!","Click on yourself or press 's' to reload"):this.showSocialMessage("Tap on yourself to reload")},GameController.prototype.showHelp=function(){this.inputDisabled||(this.runningOnCordova()?this.openURL("https://ananiasgame.com/manual/"+this.version+"/index.html",!0):this.openURL("help/index.html",!0))},GameController.prototype.setOrientation=function(t){this.runningOnCordova()&&window.screen.orientation.lock(t)},GameController.prototype.walkToCell=function(){var t=sign(this.worldX-this.player.x),e=sign(this.worldY-this.player.y);this.player.gameController.move({x:t,y:e})};var SCRATCHES={bite:!1,blunt:2,thrust:1,slash:0,hack:3};GameController.prototype.showScratchAt=function(t,e,i,s,o){if(!1!==SCRATCHES[o]&&!this.player.isBlind()){t=32*t+this.mapOffset.x+16,e=32*e+this.mapOffset.y,i=32*i+this.mapOffset.x+16,s=32*s+this.mapOffset.y;var n=5*SCRATCHES[o],a=this.getImage(i,s,"scratches",n,this.mapLayer);a.visible=!0,a.anchor.x=.5,a.anchor.y=.5,a.rotation=-Math.getAngle2(t,e,i,s),a.animations.add("scratch",[n+3,n+2,n+1,n+0,n+1]),a.animations.play("scratch",32),this.phaser.time.events.add(160,function(){a.destroy()},this)}};

},{"./AchievementsManager":1,"./CellType.enum":7,"./CommunityClient.class.js":8,"./DungeonBuilder.class.js":9,"./Effects":10,"./GamePersistance.class":14,"./ItemFactory.class.js":16,"./MapBorders":18,"./MonsterFactory.class.js":20,"./MusicController.class.js":21,"./PhaserTextField.class":23,"./Player.class.js":24,"./SFXController.class.js":29,"./Spells.js":31,"./Storage.class":33,"./Util":36,"./debug/EventLog":37,"./panels/BookPanel.class.js":49,"./panels/CharacterCreationPanel.class":50,"./panels/EntityInfoPanel.class.js":52,"./panels/HelpPanel.class":55,"./panels/InventoryPanel.class.js":56,"./panels/NewGamePanel.class":57,"./panels/PromoPanel.class":59,"./panels/SelectUpgrade.class":60,"./panels/SplashPanel.class":62,"./panels/TitlePanel.class":64,"./ui/Dialog.class":65,"./ui/FishAddornment.class":66,"./ui/Layouts":67,"./ui/LifeBar.class":68,"circular-functions":43}],14:[function(require,module,exports){
var circular=require("circular-functions");function GamePersistance(){this.storage=new Storage}module.exports=GamePersistance;var Storage=require("./Storage.class");GamePersistance.prototype.saveGame=function(e){var t={_c:circular.register("AnaniasGame"),version:e.loadedGameVersion?e.loadedGameVersion:e.version,player:e.player,depth:e.depth},a=circular.serialize(t);this.storage.setItem("ananiasGame",a),this.storage.setItem("selectedLayout",e.displayMode)},GamePersistance.prototype.deleteGame=function(){this.storage.removeItem("ananiasGame")},GamePersistance.prototype.existsGame=function(){return this.storage.getItem("ananiasGame")},GamePersistance.prototype.savedGameOlderVersion=function(e){var t=this.storage.getItem("ananiasGame");if(!t)return!1;var a={gameController:e};return circular.parse(t,a).version!=e.version},GamePersistance.prototype.restoreGame=function(e){var t=this.storage.getItem("ananiasGame");if(!t)return!1;var a={gameController:e},r=circular.parse(t,a);return e.player=r.player,e.level=r.player.dungeonLevel,e.depth=r.depth,e.loadedGameVersion=r.version,!0},GamePersistance.prototype.saveScore=function(e,t){var a=this.storage.getItem("ananiasScores");a=a?JSON.parse(a):[];var r={className:e.className,depth:t,kills:e.kills};(a.length<10||r.depth>a[a.length-1].depth||r.depth==a[a.length-1].depth&&r.kills>a[a.length-1].kills)&&(a.push(r),a.sort(function(e,t){return e.depth<t.depth?1:e.depth>t.depth?-1:e.kills<t.kills?1:e.kills>t.kills?-1:0}),a.length>10&&(a.length=10),this.storage.setItem("ananiasScores",JSON.stringify(a)))},GamePersistance.prototype.saveLoginInfo=function(e,t){this.storage.setItem("ananiasLogin",JSON.stringify({username:e,loginKey:t}))},GamePersistance.prototype.clearLoginInfo=function(e,t){this.storage.removeItem("ananiasLogin")},GamePersistance.prototype.getLoginInfo=function(e,t){return JSON.parse(this.storage.getItem("ananiasLogin"))};

},{"./Storage.class":33,"circular-functions":43}],15:[function(require,module,exports){
var circular=require("circular-functions"),Spells=require("./Spells"),ActionValidator=require("./ActionValidator"),Effects=require("./Effects"),Entity=require("./Entity");function Item(e,t,i,r,s){this.gameController=e,this.code=t,void 0!==(s=s||{}).masterIndex?(this.masterIndex=s.masterIndex,this.groundIndex=this.masterIndex,s.groundTileset?this.groundTileset=s.groundTileset:this.groundTileset="items-ground"):(this.spriteIndex=s.index,this.groundIndex=this.spriteIndex,this.groundTileset="items-misc",this.menuIndex=s.menuIndex),this.name=i,this.description=i,this.onUse=r,this._c=circular.register("Item")}module.exports=Item,circular.registerClass("Item",Item,{transients:{gameController:!0,sprite:!0,menuSprite:!0},reviver:function(e,t){e.gameController=t.gameController}});var Material=require("./Material.enum"),Roll=require("./Roll.class");Item.prototype.playUseSFX=function(e){this.features.useSfx&&this.gameController.playSFX(this.features.useSfx),this.features.useAnimation&&this.gameController.particleAnimationAt(this.features.useAnimation,e)},Item.prototype.use=function(e,t,i){if(t){if(!(this.features.dontThrow||t.isFriendly&&this.features.dontThrowToAllies)){if(!e.canThrow())return this.gameController.showTextBy(e,"How?!"),this.gameController.playSFX("beep"),void(i&&i(!1));var r=e.currentRoom.getObjectBlockingLOS(e,t);if(r)return this.gameController.showTextBy(e,"Blocked..."),this.gameController.showBlockingObject(r),void(i&&i(!1));if(distance(e.x,e.y,t.x,t.y)>e.getMaxThrowDist(this))return this.gameController.showTextBy(e,"Too far..."),this.gameController.playSFX("beep"),void(i&&i(!1));var s=e.getThrowDifficulty(this);return s&&this.gameController.showTextBy(e,s),void this.throwAt(e,t,i)}if(this.features.applyClose&&!e.canUseItemOnTarget(t))return this.gameController.showTextBy(e,"Too far!"),this.gameController.playSFX("beep"),void(i&&i(!1))}else t=e;if(e.prevalidateUseItem(this)){var o=this.onUse,n=this;if("invokeSpell"===this.onUse){var a=Spells.getSpell(this.features.spell);if(!a)return this.gameController.playSFX("beep"),void(i&&i(!1));o=a.effect,n=a}if(ActionValidator[o]&&!ActionValidator[o](e,t,n))return this.gameController.playSFX("beep"),void(i&&i(!1));this.playUseSFX(t),"invokeSpell"===this.onUse&&(e.stats.conducts.noScrollsUsed=!1,e.stats.conducts.noSpellsUsed=!1),this.features.isPotion&&(e.stats.conducts.noPotionsUsed=!1),this.features.isBandage&&(e.stats.conducts.noBandagesUsed=!1);var l=this._doUse(e,t,i);"relayed"!==l&&i&&i(l)}else i&&i(!1)},Item.prototype._doUse=function(e,t,i){if("wield"===this.onUse){if(t.currentWeapon&&t.currentWeapon==this){if(this.ammo&&this.remainingUses.current>0){var r=this;return this.gameController.dialog.show("Select One","",[{text:"Unwield weapon",action:function(){e.removeWeapon(),r.gameController.dialog.hide(),i&&i(!0)}},{text:"Unload ammo",action:function(){e.unloadWeapon(r),r.gameController.showTextBy(e,"Unloaded"),r.gameController.showMessageInPanel("You unload the "+r.name+"."),r.gameController.dialog.hide(),i&&i(!0)}}]),"relayed"}return e.removeWeapon(),!0}return this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Wield"),t.currentWeapon&&t.currentWeapon!=this&&(t.previousWeapon=t.currentWeapon,this.gameController.switchWeaponSprite.loadTexture(t.previousWeapon.menuSprite.texture),this.gameController.switchButtonGroup.visible=!0),t.currentWeapon=this,t.previousWeapon==this&&(t.previousWeapon=null),this.gameController.playSFX(t.currentWeapon.getAttackSFX()),this.gameController.showMessageInPanel("You wield a "+this.name+"."),!0}if("invokeSpell"===this.onUse){var s=Spells.getSpell(this.features.spell);if(!s)return!1;"teleport"==s.effect&&(t.currentRoom.removeItem(this),e.gameController.removeItemFromRoom(this)),Spells.useScroll(e,t,s,i,this);var o=!1;return"magicAttack"===s.effect&&e.features.elementalSpecialist&&!e.absorbElementalMagic()?(this.remainingCasts?this.remainingCasts--:this.remainingCasts=rand(1,3),0==this.remainingCasts&&(o=!0)):o=!0,o&&(e.removeItem(this),e.currentRoom.removeItem(this),e.gameController.removeItemFromRoom(this)),"relayed"}if("wear"===this.onUse){var n;switch(this.features.wearLocation){case"body":n="currentArmor";break;case"arms":n="currentArmwear";break;case"legs":n="currentLegwear";break;case"foot":n="currentFootwear"}var a=t[n];return a&&a==this?(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Remove"),t[n]=null,this.gameController.showMessageInPanel("You remove the "+this.name+"."),!0):(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Wear"),this.gameController.showMessageInPanel("You wear the "+this.name+"."),t[n]=this,!0)}if("wearAsHelmet"===this.onUse)return t.currentHelmet&&t.currentHelmet==this?(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Remove"),t.currentHelmet=null,this.gameController.showMessageInPanel("You remove the "+this.name+"."),!0):(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Wear"),this.gameController.showMessageInPanel("You wear the "+this.name+"."),t.currentHelmet=this,!0);if("wearAsShield"===this.onUse)return t.currentShield&&t.currentShield==this?(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Remove"),t.currentShield=null,this.gameController.showMessageInPanel("You remove the "+this.name+"."),!0):(this.gameController.showingInventory&&e.currentRoom.isSafe()||this.gameController.showTextBy(t,"Wear"),this.gameController.showMessageInPanel("You wear the "+this.name+"."),t.currentShield=this,e.features.passiveSkills.shieldExpert||"AGR"!==e.currentTactic||this.gameController.selectTactic("BAL",!0),!0);if("winGame"===this.onUse)return e.dead=!0,this.gameController.showWinGameScreen(),!1;if("transmute"===this.onUse)return e.doTransmute(),this.playUseSFX(e),!0;if("applySpirit"===this.onUse)return e.doChemistry(this),"relayed";if("reloadWeapon"===this.onUse){var l=t.currentWeapon.ammo;l&&l.features.ammoType!==this.features.ammoType&&e.unloadWeapon(t.currentWeapon),t.currentWeapon.ammo=this;var h=t.currentWeapon.remainingUses.getRemaining(),m=0;return h>=this.quantity?(t.currentWeapon.remainingUses.increase(this.quantity),e.removeItem(this),m=this.quantity):(t.currentWeapon.remainingUses.increase(h),this.quantity-=h,m=h),this.features.ammoLoadSummary?this.gameController.showTextBy(t,this.features.ammoLoadSummary):this.gameController.showTextBy(t,"Ready "+m+" "+this.features.ammoType),this.features.ammoLoadMessage?this.gameController.showMessageInPanel(this.features.ammoLoadMessage):this.gameController.showMessageInPanel("You ready "+m+" "+this.features.ammoType+" into your "+t.currentWeapon.name+"."),!0}var u=Effects[this.onUse];return!!u&&(u(e,t,this,this.features.magicPower),e.removeItem(this),!0)},Item.prototype.getDetails=function(e){if(this.longDescription&&"wield"!==this.onUse&&"wearAsHelmet"!==this.onUse&&"wearAsShield"!==this.onUse)return this.longDescription;if(!this.onUse)return"";var t=this.onUse,i=this;if("invokeSpell"===this.onUse){var r=Spells.getSpell(this.features.spell);if(!r)return"Unuseable.";if("false"!==r.description)return"magicAttack"===r.effect?r.description+" ["+e.getSpellDamageRoll(r,this.features.magicPower)+"]":r.description;t=r.effect,i=r}return Effects.getEffectDescription(t,e,i,this.features.magicPower)},Item.prototype.getDamageDescription=function(){if(this.isRangedWeapon()||"WAND"===this.type)return this.ammo?0==this.ammo.damageRoll.base?this.damageRoll.getDescription():0==this.damageRoll.base?this.ammo.damageRoll.getDescription():this.damageRoll.getDescription()+"+"+this.ammo.damageRoll.getDescription():this.damageRoll.getDescription();var e=this.getIntegrityDamageModifier();return 0===e?this.damageRoll.getDescription():e>0?this.damageRoll.getDescription()+"+"+e:this.damageRoll.getDescription()+"-"+-e},Item.prototype.spend=function(){this.remainingUses.reduce(1)},Item.prototype.damage=function(e){this.integrity.reduce(e)},Item.prototype.isRangedWeapon=function(){return"BOW"===this.type||"GUN"===this.type||"SLING"===this.type||"CROSSBOW"===this.type},Item.prototype.requiresSpaceToFire=function(){return"BOW"===this.type||"SLING"===this.type},Item.prototype.firesPhysicalProjectile=function(){return"BOW"===this.type||"SLING"===this.type||"CROSSBOW"===this.type},Item.prototype.isMechanicalWeapon=function(){return"GUN"===this.type||"CROSSBOW"===this.type},Item.prototype.TYPE_NAMES=function(e){return"SWORD"===e?"sword":"DAGGER"===e?"dagger":"CROSSBOW"===e?"crossbow":"SLING"===e?"sling":"AXE"===e?"axe":"SPEAR"===e?"spear":"BOW"===e?"bow":"MACE"===e?"mace":"STAFF"===e?"staff":"WAND"===e?"wand":"GUN"===e?"gun":"SCYTHE"===e?"scythe":"WHIP"===e?"whip":void 0},Item.prototype.isFreezing=function(){return"freezing"===this.features.damageType},Item.prototype.isBurning=function(){return"burning"===this.features.damageType},Item.prototype.isAcid=function(){return"acid"===this.features.damageType},Item.prototype.isHoly=function(){return"holy"===this.features.damageType},Item.prototype.isSlashing=function(){return"SWORD"===this.type||"SCYTHE"===this.type||"slashing"===this.features.damageType},Item.prototype.isPiercing=function(){return"SPEAR"===this.type||"BOW"===this.type||"CROSSBOW"===this.type||"DAGGER"===this.type||"piercing"===this.features.damageType},Item.prototype.isBlunt=function(){return"STAFF"===this.type||"MACE"===this.type||"SLING"===this.type||"blunt"===this.features.damageType},Item.prototype.isBluntWeapon=function(){return"STAFF"===this.type||"MACE"===this.type},Item.prototype.isChopping=function(){return"AXE"===this.type||"chopping"===this.features.damageType},Item.prototype.isEtherDamage=function(){return"ether"===this.features.damageType},Item.prototype.isBladeWeapon=function(){return"SWORD"===this.type||"SPEAR"===this.type||"AXE"===this.type||"SCYTHE"===this.type||"DAGGER"===this.type},Item.prototype.getSubtype=function(){return this.isBladeWeapon()?"BLADE":this.isBluntWeapon()?"BLUNT":this.type},Item.prototype.damageModifier=function(e){var t=this;switch(this.ammo&&(t=this.ammo),e){case Material.FLESH:return t.isBurning()?1.4:t.isFreezing()?1.2:t.isAcid()?1.2:t.isSlashing()||t.isPiercing()?1.3:1;case Material.ETHER:if(t.isEtherDamage())return 3;case Material.BONE:return t.isBlunt()?1.3:t.isAcid()?1.4:t.isHoly()?3:t.isPiercing()?.2:1;case Material.WOOD:return t.isBurning()?3:t.isChopping()?2:t.isSlashing()||t.isPiercing()?.2:1}return 1},Item.prototype.getAttackSFX=function(){return"SWORD"===this.type?"slash":"DAGGER"===this.type?"slash":"SCYTHE"===this.type?"slash":"AXE"===this.type?"hit":"SPEAR"===this.type?"slash":"BOW"===this.type?"shoot":"CROSSBOW"===this.type?"shoot":"SLING"===this.type?"shoot":"GUN"===this.type?"shoot":"WHIP"===this.type?"hit":"MACE"===this.type?"hit":"STAFF"===this.type?"hit":"WAND"===this.type?"hit":void 0},Item.prototype.getScratchType=function(){return this.isSlashing()?"slash":this.isPiercing()?"thrust":this.isBlunt()?"blunt":this.isChopping()?"hack":"blunt"},Item.prototype.canUseInGround=function(){return!(!this.onUse||"wield"===this.onUse||"wear"===this.onUse||"wearAsHelmet"===this.onUse||"wearAsShield"===this.onUse||"charm"===this.onUse||"transmute"===this.onUse||"applySpirit"===this.onUse||"reloadWeapon"===this.onUse)},Item.prototype.setMenuSprite=function(){this.menuSprite||(void 0!==this.masterIndex?"wearAsHelmet"===this.onUse?this.menuSprite=this.gameController.getImage(0,0,"items-detail",this.masterIndex):"wield"===this.onUse||"wearAsShield"===this.onUse?this.menuSprite=this.gameController.getImage(0,0,"items-ground",this.masterIndex):this.menuSprite=this.gameController.getImage(0,0,"wearables-ground",this.masterIndex):this.menuSprite=this.gameController.getImage(0,0,"items-misc",this.menuIndex),this.menuSprite.visible=!1,this.menuSprite.inputEnabled=!0,this.menuSprite.events.onInputDown.add(function(e,t){this.gameController.interactItemInventoryBridge(this,this.gameController.isDoubleTap(t))},this))},Item.prototype.setSprite=function(){var e=this.groundIndex;if(this.gameController.player.isHallucinating()&&chance(60)){var t=this.gameController.itemFactory.getSimilarItemDefinition(this);t&&(e=t.masterIndex||t.index)}this.sprite=this.gameController.getImage(32*this.x,32*this.y,this.groundTileset,e,this.gameController.mapGroup),this.sprite.inputEnabled=!0;var i=this;this.sprite.events.onInputDown.add(function(){i.gameController.interactItemBridge(i)},this.gameController)},Item.prototype.throwAt=function(e,t,i){var r,s=null,o=null,n=null;e.stopRunning();var a=80;e.features.throwingWeaponsExpert&&(a=90),a-=e.getThrowAccuracyMalus(this),r=chance(a);var l=!0;if("explode"===this.features.onThrow){s=this.features.damageType,o=new Roll(this.damageRoll.multiplier*this.quantity,this.damageRoll.base),n=this.damageModifier(t.race.material),n/=2;var h=Math.floor(o.getAverage()/4);h>16&&(h=16),h<4&&(h=4),l=!1}else"damage"===this.features.onThrow?(s=this.features.damageType,(o=this.damageRoll.clone()).modifier=this.getIntegrityDamageModifier(),n=this.damageModifier(t.race.material),this.features.throwBonus&&(n*=this.features.throwBonus)):"bounce"===this.features.onThrow?(s="blunt",o=new Roll(0,0),n=0):(s="blunt",o=new Roll(1,3),n=this.damageModifier(t.race.material));var m={x:t.x,y:t.y};if(!r){var u=e.starePoint(t);m.x+=u.x,m.y+=u.y}var p=e.attack.current-rand(0,2);p<1&&(p=1),l||(p=0),(p+=o.roll())<1&&(p=1),p*=n,p=Math.round(p);var g=this,c=!1;!this.features.breakOnThrow&&this.quantity&&this.quantity>1?(c=!0,this.quantity--):e.removeItem(this),this.gameController.updatePlayerSprite();var d="noSpin";this.features.throwStyle&&(d=this.features.throwStyle),this._showItemProjectileAnimation(function(){if("explode"===g.features.onThrow&&(g.gameController.explosionAt(s,m,h),g.gameController.playSFX("explosion")),g.features.breakOnThrow)g.gameController.playSFX("breaking");else if((e.currentRoom.getItem(m.x,m.y)||e.currentRoom.isSolid(m.x,m.y))&&((m=e.currentRoom.getFreePlaceAround(m))||(m=e.currentRoom.getFreePlace())),m){var o=!1;c?g.features.breakChance&&chance(g.features.breakChance)?o=!1:(o=g.gameController.itemFactory.getItemByCode(g.code)).quantity=1:o=g,o&&(e.currentRoom.addItem(o,m,!0),e.gameController.addItemToRoom(o))}if(g.gameController.resetProjectile(),r){if(t.flash(16711680),e.latestAttackType="thrownItem",e._reduceMonsterHitPoints(t,p,n,!1),!g.features.breakOnThrow){if(g.remainingUses&&e.degradeThrownWeapons()){var a=new Roll(4,2,0);g.remainingUses.reduce(a.roll())}g.integrity&&(a=new Roll(5,4,0),g.integrity.reduce(a.roll()))}Entity.shake(t,function(){i&&i(!0)})}else i&&i(!0)},e,t,r,d)},Item.prototype._showItemProjectileAnimation=function(e,t,i,r,s){var o=this.gameController.prepareProjectile(this.groundIndex,this.groundTileset);o.pivot.x=.5*o.width,o.pivot.y=.5*o.height;distance(t.x,t.y,i.x,i.y);var n={x:i.x,y:i.y};if(!r){var a=t.starePoint(n);n.x+=a.x,n.y+=a.y}"spin"===s?o.rotation=-.01:"hurl"===s?o.rotation=-Math.getAngle(n,t):"noSpin"===s&&(o.rotation=Math.random()*Math.PI*2);var l=this.gameController.mapOffset;o.x=t.sprite.x+l.x,o.y=t.sprite.y+l.y;var h=32*n.x+16+l.x,m=32*n.y+this.gameController.YOFFSET+l.y,u=lineDistance(t.sprite,i.sprite);if(0===u)e();else{var p=u/160*1e3/3;p*=3;var g=this.gameController.tween(o).to({x:h,y:m},p,Phaser.Easing.Sinusoidal.In);g.onComplete.add(e),"spin"===s&&g.onUpdateCallback(function(){this.rotation+=.1},o),this.gameController.startTween(this.sprite,g)}},Item.prototype.isTargeted=function(){if("invokeSpell"===this.onUse){var e=Spells.getSpell(this.features.spell);return!!e&&e.targeted}return this.features.targetted},Item.prototype.autoUseOnEnemy=function(){if("invokeSpell"===this.onUse){var e=Spells.getSpell(this.features.spell);return!!e&&e.autoUseOnEnemy}return this.features.autoUseOnEnemy},Item.prototype.shouldNotUseOnSelf=function(){if("invokeSpell"===this.onUse){var e=Spells.getSpell(this.features.spell);return!!e&&e.shouldNotUseOnSelf}return item.features.shouldNotUseOnSelf},Item.INTEGRITY_LEVELS=[{name:"Ruined",damageModifier:-4,defenseModifier:-2},{name:"Badly Worn",damageModifier:-3,defenseModifier:-1},{name:"Worn",damageModifier:0,defenseModifier:0},{name:"Good",damageModifier:0,defenseModifier:0},{name:"Excellent",damageModifier:1,defenseModifier:1},{name:"Amazing",damageModifier:2,defenseModifier:2}],Item.prototype.getIntegrityDescription=function(){return Item.INTEGRITY_LEVELS[this.getIntegrityLevel()].name},Item.prototype.getDefenseValue=function(){var e=this.defenseValue+Item.INTEGRITY_LEVELS[this.getIntegrityLevel()].defenseModifier;return e<0&&(e=0),e},Item.prototype.getIntegrityDamageModifier=function(){return this.isRangedWeapon()||"WAND"===this.type?0:Item.INTEGRITY_LEVELS[this.getIntegrityLevel()].damageModifier},Item.prototype.getIntegrityLevel=function(){var e=0;return(e=this.remainingUses?100*this.remainingUses.getProportion():this.integrity?100*this.integrity.getProportion():3)>100?5:e>80?4:e>60?3:e>20?2:e>10?1:0},Item.prototype.getSummaryDescription=function(){var e=this.name;if("wield"===this.onUse)return this.features.usesArrows?this.ammo?e+" ["+this.remainingUses.getText()+"] ("+this.getDamageDescription()+")":e+" [0] ("+this.getDamageDescription()+")":"WAND"===this.type?e+" ["+this.remainingUses.getText()+"] ("+this.getDamageDescription()+")":e+" ["+this.getIntegrityDescription()+"] ("+this.getDamageDescription()+")";if("wear"===this.onUse||"wearAsHelmet"===this.onUse||"wearAsShield"===this.onUse)return this.defenseValue?e+" ["+this.getIntegrityDescription()+"] ("+this.getDefenseValue()+")":e+" ["+this.getIntegrityDescription()+"]";if("invokeSpell"===this.onUse){var t=Spells.getSpell(this.features.spell);return t?"magicAttack"===t.effect?"Scroll of "+t.words+" ["+this.gameController.player.getSpellDamageRoll(t,this.features.magicPower)+"]":"Scroll of "+t.words:"Useless Scroll"}return this.quantity||this.quantity>1?this.name+" ["+this.quantity+"]":this.name},Item.prototype.getName=function(){return this.features&&this.features.isScroll&&!this.gameController.player.features.cantRead?this.getMagicPowerDescription()+" scroll of "+this.name:this.name},Item.prototype.getMagicPowerDescription=function(){switch(this.features.magicPower){case 6:return"Dim";case 8:return"Plain";case 10:return"Blessed";case 12:return"Ancient"}return""},Item.prototype.isWeapon=function(){return null!=this.damageRoll&&!this.features.reloadWeaponType&&"WAND"!==this.type&&"GUN"!==this.type},Item.prototype.allowsModifiers=function(){return this.isWeapon()};

},{"./ActionValidator":2,"./Effects":10,"./Entity":12,"./Material.enum":19,"./Roll.class":27,"./Spells":31,"circular-functions":43}],16:[function(require,module,exports){
var circular=require("circular-functions");function ItemFactory(e){this.gameController=e,this.itemData=new Array,this.appearanceMap={},this.itemsMap={},this.addWeapon("Steel Sword-1","Steel Sword","Standard warfare tool",0,26,2,3,0,60,"SWORD",5.37634408602151,1,!1,0,{weight:15,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"hurl"}),this.addWeapon("Steel Curved Sword-2","Steel Curved Sword","",1,26,3,3,0,60,"SWORD",4.6594982078853,2,!1,0,{weight:15,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Steel Dagger-3","Steel Dagger","A short general purpose blade, can be thrown.",2,4,2,2,0,60,"DAGGER",5.37634408602151,1,!1,0,{weight:5,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Iron Curved Sword-4","Iron Curved Sword","",3,32,3,3,0,60,"SWORD",4.6594982078853,2,!1,0,{weight:30,canParry:!0,slashing:!0}),this.addWeapon("Iron Short Sword-5","Iron Short Sword","",4,33,2,3,0,60,"SWORD",5.37634408602151,1,!1,0,{weight:20,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"hurl"}),this.addWeapon("Steel Rapier-6","Steel Rapier","",5,39,3,3,0,60,"SWORD",4.6594982078853,2,!1,0,{weight:15,canParry:!0,slashing:!0}),this.addWeapon("Steel Long Sword-7","Steel Long Sword","",6,28,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:20,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"hurl"}),this.addWeapon("Steel Short Sword-8","Steel Short Sword","",7,3,2,3,0,60,"SWORD",5.37634408602151,1,!1,0,{weight:12,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"hurl"}),this.addWeapon("Steel Butcher Knife-9","Steel Butcher Knife","",8,2,1,2,0,45,"DAGGER",.3584229390681,4,!1,0,{weight:15,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Steel Long Sword-10","Steel Long Sword","",9,34,3,3,1,60,"SWORD",4.6594982078853,2,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Royal Sword-11","Royal Sword","A gift from the king, smites the undead.",10,41,3,3,0,60,"SWORD",4.6594982078853,2,!0,0,{weight:15,canParry:!0,slashing:!0,undeadBonus:!0}),this.addWeapon("Crystal Sword-12","Crystal Sword","",11,13,7,3,2,60,"SWORD",.3584229390681,4,!1,5,{weight:20,enchantedWeapon:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Knife-13","Steel Knife","",12,0,2,2,0,60,"DAGGER",5.37634408602151,1,!1,0,{weight:5,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Steel Blood-soaked Knife-14","Steel Blood-soaked Knife","",13,0,4,2,2,60,"DAGGER",3.2258064516129,3,!1,0,{weight:5,enchantedWeapon:!0,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Steel Twin Daggers-15","Steel Twin Daggers","",14,7,4,2,2,60,"DAGGER",3.2258064516129,3,!1,0,{weight:10,twoHanded:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Claws-16","Steel Claws","",15,265,5,2,4,60,"DAGGER",.3584229390681,4,!1,0,{weight:10,twoHanded:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Battle Axe-17","Steel Battle Axe","A trusty weapon which can be thrown.",16,80,2,5,0,90,"AXE",4.6594982078853,2,!1,0,{weight:15,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Steel Hatchet-18","Steel Hatchet","",17,74,1,5,0,90,"AXE",5.37634408602151,1,!1,0,{weight:10,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin",throwBonus:1.5}),this.addWeapon("Iron Axe-19","Iron Axe","",18,80,1,5,0,90,"AXE",5.37634408602151,1,!1,0,{weight:20,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Pick-20","Iron Pick","",19,75,2,3,0,45,"SPEAR",5.37634408602151,1,!1,0,{weight:15,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Battle Axe-21","Iron Battle Axe","A big axe, can parry attacks.",20,80,2,5,0,90,"AXE",4.6594982078853,2,!1,0,{weight:30,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Steel Curved Blade-22","Steel Curved Blade","A sword made for slashing through enemies.",21,32,3,3,0,60,"SWORD",4.6594982078853,2,!0,0,{weight:15,canParry:!0,slashing:!0}),this.addWeapon("Magic Sword-23","Magic Sword","",22,48,7,3,2,60,"SWORD",.3584229390681,4,!1,0,{weight:15,enchantedWeapon:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Katana-24","Steel Katana","A long sharp deadly blade.",23,43,5,3,0,60,"SWORD",3.2258064516129,3,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Iron Brute Sword-25","Iron Brute Sword","",24,35,5,3,0,60,"SWORD",3.2258064516129,3,!1,0,{weight:40,canParry:!0,slashing:!0}),this.addWeapon("Steel Triangle Sword-26","Steel Triangle Sword","",25,38,5,3,0,60,"SWORD",3.2258064516129,3,!1,0,{weight:30,canParry:!0,slashing:!0}),this.addWeapon("Steel Epee-27","Steel Epee","",26,45,3,3,0,60,"SWORD",4.6594982078853,2,!1,0,{weight:15,canParry:!0,slashing:!0}),this.addWeapon("Wooden Mace-28","Wooden Mace","",27,112,3,2,0,60,"MACE",5.37634408602151,1,!1,3,{weight:15,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Lighting Wand-29","Lighting Wand","Shoots a shocking bolt",28,220,2,4,0,40,"WAND",.3584229390681,4,!1,10,{weight:2,ranged:!0,projectile:"lightning",damageType:"piercing",magicStun:!0,magicRanged:!0,breakOnThrow:!0,dontThrow:!0,stunMessage:"Shocked"}),this.addWeapon("Vanish Wand-30","Vanish Wand","Strikes enemies with magic, smites the undead",29,216,2,3,0,60,"WAND",.3584229390681,4,!1,0,{weight:2,damageType:"ether",breakOnThrow:!0,dontThrow:!0,undeadBonus:!0}),this.addWeapon("Iron Mace-31","Iron Mace","",30,105,4,2,0,60,"MACE",4.6594982078853,2,!1,5,{weight:30,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Wooden Spiked Mace-32","Wooden Spiked Mace","",31,101,3,2,1,60,"MACE",5.37634408602151,1,!1,3,{weight:20,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Titan Mace-33","Titan Mace","A weapon of the titan army.",32,96,9,2,1,60,"MACE",.3584229390681,4,!1,10,{weight:50,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Morningstar-34","Iron Morningstar","A rod chained with a spiked ball.",33,106,6,2,2,60,"MACE",3.2258064516129,3,!1,5,{weight:40,canParry:!0}),this.addWeapon("Purple Whip-35","Purple Whip","",34,252,4,2,0,90,"WHIP",4.6594982078853,2,!1,0,{weight:5}),this.addWeapon("Iron Hammer-36","Iron Hammer","",35,102,3,2,0,60,"MACE",5.37634408602151,1,!1,3,{weight:5,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Mace-37","Iron Mace","A basic blunt weapon.",36,112,4,2,0,60,"MACE",4.6594982078853,2,!1,5,{weight:15,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Wooden Mallet-38","Wooden Mallet","",37,108,1,2,0,30,"MACE",.3584229390681,4,!1,5,{weight:5,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Mace-39","Iron Mace","",38,105,4,2,0,60,"MACE",4.6594982078853,2,!1,5,{weight:20,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Wooden Hammer-40","Wooden Hammer","",39,108,3,2,0,60,"MACE",5.37634408602151,1,!1,3,{weight:15,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Chains Mace-41","Iron Chains Mace","",40,106,6,2,0,60,"MACE",3.2258064516129,3,!1,5,{weight:20,canParry:!0}),this.addWeapon("Wooden Mace-42","Wooden Mace","",41,99,3,2,0,60,"MACE",5.37634408602151,1,!1,3,{weight:20,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Mace-43","Iron Mace","",42,105,4,2,0,60,"MACE",4.6594982078853,2,!1,5,{weight:30,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Flame Wand-44","Flame Wand","Shoots a flame projectile",43,218,2,4,0,40,"WAND",.3584229390681,4,!1,0,{weight:2,ranged:!0,projectile:"flame",damageType:"burning",magicRanged:!0,breakOnThrow:!0,dontThrow:!0}),this.addWeapon("Lightning Wand-45","Lightning Wand","Shocks enemies",44,218,4,3,0,60,"WAND",.3584229390681,4,!1,30,{weight:2,damageType:"blunt",magicStun:!0,breakOnThrow:!0,dontThrow:!0,stunMessage:"Shocked"}),this.addWeapon("Frost Wand-46","Frost Wand","Freezes enemies on their spot",45,219,3,4,0,60,"WAND",.3584229390681,4,!1,70,{weight:2,damageType:"blunt",magicStun:!0,breakOnThrow:!0,dontThrow:!0,stunMessage:"Frozen"}),this.addWeapon("Iron Spiked Hammer-47","Iron Spiked Hammer","",46,115,4,2,2,60,"MACE",4.6594982078853,2,!1,5,{weight:30,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Iron Mace-48","Iron Mace","",47,105,6,2,0,60,"MACE",3.2258064516129,3,!1,5,{weight:40,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Steel Sword-49","Steel Sword","",48,28,5,3,0,60,"SWORD",3.2258064516129,3,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Steel Battle Axe-50","Steel Battle Axe","",49,77,3,5,0,90,"AXE",3.2258064516129,3,!1,0,{weight:30,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Steel Spear-51","Steel Spear","A long weapon, made for throwing.",50,179,3,3,0,45,"SPEAR",4.6594982078853,2,!1,0,{weight:10,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Steel Halberd-52","Steel Halberd","",51,169,3,5,0,90,"AXE",3.2258064516129,3,!1,5,{weight:30,twoHandedBonus:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Trident-53","Steel Trident","A spear with three attack blocking spikes on its head.",52,171,3,3,0,45,"SPEAR",4.6594982078853,2,!1,0,{weight:15,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Steel Broadsword-54","Steel Broadsword","",53,45,5,3,0,60,"SWORD",3.2258064516129,3,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Black Steel Spear-55","Black Steel Spear","A spear imbued with magic powers",54,183,7,3,4,45,"SPEAR",.3584229390681,4,!1,0,{weight:15,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Steel Tribal Spear-56","Steel Tribal Spear","",55,181,5,3,0,45,"SPEAR",3.2258064516129,3,!1,0,{weight:15,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Steel Bardiche-57","Steel Bardiche","",56,176,3,5,0,90,"AXE",3.2258064516129,3,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Magic Broadsword-58","Magic Broadsword","",57,48,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:20,enchantedWeapon:!0,canParry:!0,slashing:!0}),this.addWeapon("Steel Katana-59","Steel Katana","",58,42,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:20,canParry:!0,slashing:!0}),this.addWeapon("Steel Dual Spear-60","Steel Dual Spear","",59,180,5,3,0,45,"SPEAR",3.2258064516129,3,!1,0,{weight:20,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Gold Battle Axe-61","Gold Battle Axe","",60,77,4,5,0,90,"AXE",.3584229390681,4,!1,0,{weight:30,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Gold Magic Spear-62","Gold Magic Spear","",61,181,7,3,2,45,"SPEAR",.3584229390681,4,!1,0,{weight:20,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:2}),this.addWeapon("Steel Two Handed Sword-63","Steel Two Handed Sword","A massive two handed sword.",62,46,5,3,2,60,"SWORD",3.2258064516129,3,!1,5,{weight:35,twoHandedBonus:!0,canParry:!0,slashing:!0}),this.addWeapon("Giant Scythe-64","Giant Scythe","",63,173,5,5,2,90,"SCYTHE",.3584229390681,4,!1,0,{weight:60,twoHanded:!0,canParry:!0,slashing:!0}),this.addWeapon("Scythe-65","Scythe","",64,173,2,5,0,90,"SCYTHE",4.6594982078853,2,!1,0,{weight:20,twoHandedBonus:!0,canParry:!0,slashing:!0}),this.addWeapon("Giant Battle Axe-66","Giant Battle Axe","A huge two handed axe.",65,85,4,5,2,90,"AXE",.3584229390681,4,!1,10,{weight:80,twoHanded:!0,canParry:!0,slashing:!0}),this.addWeapon("Green Lance-67","Green Lance","",66,182,5,3,0,45,"SPEAR",3.2258064516129,3,!1,0,{weight:40,enchantedWeapon:!0,twoHanded:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:1.5}),this.addWeapon("Iron Triangle Sword-68","Iron Triangle Sword","",67,37,5,3,0,60,"SWORD",3.2258064516129,3,!1,5,{weight:40,canParry:!0,slashing:!0}),this.addWeapon("Grappling Hook-69","Grappling Hook","",68,198,1,3,0,20,"STAFF",.3584229390681,4,!1,0,{weight:10,twoHanded:!0,canParry:!0}),this.addWeapon("Triblade Sword-70","Triblade Sword","",69,40,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:25,canParry:!0,slashing:!0,onThrow:"damage",throwStyle:"hurl"}),this.addWeapon("Gold Giant Halberd-71","Gold Giant Halberd","",70,169,4,5,2,90,"AXE",.3584229390681,4,!1,10,{weight:40,twoHandedBonus:!0,canParry:!0,slashing:!0}),this.addWeapon("Giant Broadsword-72","Giant Broadsword","",71,37,7,3,0,60,"SWORD",.3584229390681,4,!1,5,{weight:40,twoHandedBonus:!0,canParry:!0,slashing:!0}),this.addWeapon("Huge Hammer-73","Huge Hammer","",72,108,6,2,0,60,"MACE",3.2258064516129,3,!1,10,{weight:30,twoHanded:!0,canParry:!0}),this.addWeapon("Wooden Mace-74","Wooden Mace","",73,99,3,2,0,60,"MACE",5.37634408602151,1,!1,3,{weight:15,canParry:!0,onThrow:"damage",throwStyle:"spin"}),this.addWeapon("Purple Magic Sword-75","Purple Magic Sword","",74,57,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:25,enchantedWeapon:!0,canParry:!0,slashing:!0}),this.addWeapon("Gold Hexablade Sword-76","Gold Hexablade Sword","",75,52,7,3,0,60,"SWORD",.3584229390681,4,!1,0,{weight:25,enchantedWeapon:!0,canParry:!0,slashing:!0}),this.addWeapon("Lance-77","Lance","",76,402,5,3,0,45,"SPEAR",3.2258064516129,3,!1,0,{weight:30,twoHanded:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:1.5}),this.addWeapon("Blue Fauchard-78","Blue Fauchard","",77,178,7,3,0,45,"SPEAR",.3584229390681,4,!1,0,{weight:25,twoHandedBonus:!0,canParry:!0,onThrow:"damage",throwStyle:"hurl",throwBonus:1.5}),this.addWeapon("Wooden Quarterstaff-79","Wooden Quarterstaff","A long wooden pole",78,197,2,2,0,90,"STAFF",5.37634408602151,1,!1,5,{weight:10,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Blue Quarterstaff-80","Blue Quarterstaff","",79,194,3,2,0,90,"STAFF",4.6594982078853,2,!1,5,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Slashing Staff-81","Slashing Staff","Cuts through enemies",176,196,3,4,0,60,"WAND",.3584229390681,4,!1,0,{weight:10,twoHandedBonus:!0,slashing:!0,damageType:"slashing",breakOnThrow:!0,dontThrow:!0}),this.addWeapon("Tribal Staff-82","Tribal Staff","",177,202,4,2,0,90,"STAFF",3.2258064516129,3,!1,5,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Purple Energy Staff-83","Purple Energy Staff","",178,203,3,2,0,90,"STAFF",4.6594982078853,2,!1,5,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Iron Staff-84","Iron Staff","",179,204,3,2,0,90,"STAFF",4.6594982078853,2,!1,5,{weight:20,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Gold Red Gem Staff-85","Gold Red Gem Staff","A staff with a shiny ruby gem.",180,205,4,2,2,90,"STAFF",3.2258064516129,3,!1,5,{weight:15,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Black Blue Gem Staff-86","Black Blue Gem Staff","A staff commonly used by wizards.",181,204,3,2,2,90,"STAFF",4.6594982078853,2,!1,5,{weight:15,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Shepherd Staff-87","Shepherd Staff","",182,198,1,5,0,30,"STAFF",.3584229390681,4,!0,0,{weight:10,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Dragon Tipped Staff-88","Dragon Tipped Staff","",183,196,6,2,0,90,"STAFF",.3584229390681,4,!0,0,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Cleric Staff-89","Cleric Staff","",184,196,6,2,0,90,"STAFF",.3584229390681,4,!1,5,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Bolt Staff-90","Bolt Staff","Shoots a bolt of magic power.",185,207,3,2,0,60,"WAND",.3584229390681,4,!1,0,{weight:10,twoHanded:!0,ranged:!0,projectile:"bolt",damageType:"blunt",magicRanged:!0,breakOnThrow:!0,dontThrow:!0}),this.addWeapon("Blue Flame Staff-91","Blue Flame Staff","",186,194,6,2,2,90,"STAFF",.3584229390681,4,!1,5,{weight:15,enchantedWeapon:!0,twoHanded:!0,canParry:!0}),this.addWeapon("Moonstone Staff-92","Moonstone Staff","",187,204,4,2,0,90,"STAFF",3.2258064516129,3,!1,5,{weight:10,enchantedWeapon:!0,twoHandedBonus:!0,canParry:!0}),this.addWeapon("Purple Energy Staff-93","Purple Energy Staff","",188,200,6,2,0,90,"STAFF",.3584229390681,4,!1,5,{weight:15,enchantedWeapon:!0,twoHanded:!0,canParry:!0}),this.addWeapon("Shovel-94","Shovel","",189,197,1,3,0,50,"MACE",.3584229390681,4,!1,0,{weight:10}),this.addWeapon("Broom-95","Broom","",190,197,1,3,0,20,"STAFF",.3584229390681,4,!1,0,{weight:10,twoHanded:!0,canParry:!0}),this.addWeapon("Cursed Broom-95","Cursed Broom","",190,197,4,3,0,90,"STAFF",.3584229390681,4,!0,0,{weight:10,twoHanded:!0,canParry:!0,dontThrow:!0}),this.addWeapon("Wooden Lute-96","Wooden Lute","",191,197,1,1,0,3,"MACE",.3584229390681,4,!1,0,{weight:5}),this.addWeapon("Yellow Lute-97","Yellow Lute","",192,197,1,1,0,3,"MACE",.3584229390681,4,!1,0,{weight:5}),this.addWeapon("Wooden Harp-98","Wooden Harp","",193,197,1,1,0,5,"MACE",.3584229390681,4,!1,0,{weight:5}),this.addWeapon("Crystal Harp-99","Crystal Harp","",194,197,1,1,0,3,"MACE",.3584229390681,4,!1,0,{weight:5}),this.addWeapon("Wooden Longbow-100","Wooden Longbow","",195,121,4,3,0,1,"BOW",3.2258064516129,3,!1,0,{weight:5,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:6,dontThrow:!0,ammoType:"arrows"}),this.addWeapon("Blue Longbow-101","Blue Longbow","",196,123,6,3,0,1,"BOW",.3584229390681,4,!1,0,{weight:5,enchantedWeapon:!0,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:6,dontThrow:!0,ammoType:"arrows"}),this.addWeapon("Green Bow-102","Green Bow","Shoots arrows",197,130,2,3,0,1,"BOW",5.37634408602151,1,!1,0,{weight:5,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:5,dontThrow:!0,ammoType:"arrows"}),this.addWeapon("White Bow-103","White Bow","Shoots magic powered arrows.",198,126,3,3,0,1,"BOW",4.6594982078853,2,!1,0,{weight:5,enchantedWeapon:!0,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:5,dontThrow:!0,ammoType:"arrows"}),this.addWeapon("Black Crossbow-104","Black Crossbow","",199,147,11,2,0,1,"CROSSBOW",.3584229390681,4,!1,0,{weight:10,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:4,dontThrow:!0,ammoType:"bolts"}),this.addWeapon("Wooden Crossbow-105","Wooden Crossbow","",200,145,7,2,0,1,"CROSSBOW",3.2258064516129,3,!1,0,{weight:10,twoHanded:!0,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:4,dontThrow:!0,ammoType:"bolts"}),this.addWeapon("Sling-106","Sling","",201,155,2,2,0,1,"SLING",5.37634408602151,1,!1,0,{weight:5,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:4,dontThrow:!0,ammoType:"pebbles"}),this.addWeapon("Yellow Sling-107","Yellow Sling","",202,155,2,2,0,1,"SLING",5.37634408602151,1,!1,0,{weight:5,ranged:!0,usesArrows:!0,breakOnThrow:!0,rangeLimit:4,dontThrow:!0,ammoType:"pebbles"}),this.addWeapon("Alchemist Carbine-108","Alchemist Carbine","An advanced artifact capable of shooting liquid.",203,149,1,3,0,40,"GUN",.3584229390681,4,!0,0,{weight:15,twoHanded:!0,ranged:!0,usesArrows:!0,doubleShotChance:50,hitsPointBlank:!0,breakOnThrow:!0,rangeLimit:4,dontThrow:!0}),this.addArmor("White Cloth Shirt1","White Cloth Shirt",0,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Green Cloth Shirt2","Green Cloth Shirt",1,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Blue Cloth Shirt3","Blue Cloth Shirt",2,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Gray Cloth Shirt4","Gray Cloth Shirt",3,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Leather Shirt5","Black Leather Shirt",4,0,70,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Yellow Leather Vest6","Yellow Leather Vest",5,1,150,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Chain Women Hauberk7","Chain Women Hauberk",6,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Iron Breastplate8","Iron Breastplate",7,4,450,1.17,3,!1,{wearLocation:"body",weight:35,isMetal:!0}),this.addArmor("Black Chain Hauberk9","Black Chain Hauberk",8,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Chain Hauberk10","Chain Hauberk",9,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Assassin Armor11","Assassin Armor",10,5,500,1.17,3,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Steel Breastplate12","Steel Breastplate",11,4,450,1.17,3,!1,{wearLocation:"body",weight:35,isMetal:!0}),this.addArmor("Leather Tunic13","Leather Tunic",12,1,200,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Rock Armor14","Rock Armor",13,6,800,.37,4,!1,{wearLocation:"body",weight:70}),this.addArmor("Dragon Armor15","Dragon Armor",14,7,600,.37,4,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Warlord Armor16","Warlord Armor",15,7,600,.37,4,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Gold Breastplate17","Gold Breastplate",16,7,600,.37,4,!1,{wearLocation:"body",weight:70,isMetal:!0}),this.addArmor("Black Coat18","Black Coat",17,0,150,.12,0,!1,{wearLocation:"body",weight:15,isClothing:!0}),this.addArmor("White Steel Breastplate19","White Steel Breastplate",18,5,450,1.17,3,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Red Army Hauberk20","Red Army Hauberk",19,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Black Army Hauberk21","Black Army Hauberk",20,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Blue Army Hauberk22","Blue Army Hauberk",21,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Black Apron23","Black Apron",22,0,200,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Red Apron24","Red Apron",23,0,200,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Gray Ragged Dress25","Gray Ragged Dress",24,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Blue Coat26","Blue Coat",25,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Coat27","Black Coat",26,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Coat28","Black Coat",27,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("White Robe29","White Robe",28,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Robe30","Black Robe",29,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("White Hooded Robe31","White Hooded Robe",30,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Black Hooded Robe32","Black Hooded Robe",31,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Green Hooded Robe33","Green Hooded Robe",32,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("White Hooded Robe34","White Hooded Robe",33,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Black Hooded Robe35","Black Hooded Robe",34,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Black Hooded Robe36","Black Hooded Robe",35,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Red Hooded Robe37","Red Hooded Robe",36,0,150,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Crimson Hooded Robe38","Crimson Hooded Robe",37,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0,coversBeard:!0,coversHair:!0}),this.addArmor("Green Women Dress39","Green Women Dress",38,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Red Women Dress40","Red Women Dress",39,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Blue Women Dress41","Blue Women Dress",40,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Gray Women Dress42","Gray Women Dress",41,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Yellow Women Dress43","Yellow Women Dress",42,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Women Dress44","Black Women Dress",43,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Purple Women Dress45","Purple Women Dress",44,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("White Women Dress46","White Women Dress",45,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Green Silk Shirt47","Green Silk Shirt",46,0,20,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Pink Silk Shirt48","Pink Silk Shirt",47,0,20,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Green Leather Tunic49","Green Leather Tunic",48,1,200,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Soldier Shirt50","Soldier Shirt",49,1,150,10.32,1,!1,{wearLocation:"body",weight:5,isClothing:!0}),this.addArmor("Iron Spikes Breastplate51","Iron Spikes Breastplate",50,4,450,1.17,3,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Titan Armor52","Titan Armor",51,7,700,.37,4,!1,{wearLocation:"body",weight:60,isMetal:!0}),this.addArmor("Gold Dress53","Gold Dress",52,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Leather Armor54","Leather Armor",53,1,250,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Blue Elfish Plate55","Blue Elfish Plate",54,5,600,1.17,3,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Gold Hauberk56","Gold Hauberk",55,5,450,1.17,3,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Bone Breastplate57","Bone Breastplate",56,3,200,3.46,2,!1,{wearLocation:"body",weight:40}),this.addArmor("Leather Women Armor58","Leather Women Armor",57,1,250,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Chain Women Hauberk59","Chain Women Hauberk",58,3,300,3.46,2,!1,{wearLocation:"body",weight:20,isMetal:!0}),this.addArmor("Gold Scales Dress60","Gold Scales Dress",59,7,500,.37,4,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Exotic Breastholder61","Exotic Breastholder",60,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Steel Plate62","Steel Plate",61,5,450,1.17,3,!1,{wearLocation:"body",weight:40,isMetal:!0}),this.addArmor("Cyan Silk Dress63","Cyan Silk Dress",62,0,20,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Wizard Robe64","Wizard Robe",63,2,200,.12,3,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Arcane Robe65","Arcane Robe",64,2,200,.12,3,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Iron Breastplate66","Black Iron Breastplate",65,6,600,.37,4,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Red Sorceress Dress67","Red Sorceress Dress",66,2,200,.12,3,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Sorcerer Robe68","Sorcerer Robe",67,2,200,.12,3,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Priestesss Dress69","Priestesss Dress",68,2,200,.12,3,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Knight of Darkness Armor70","Knight of Darkness Armor",69,7,600,.37,4,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Brown Rags71","Brown Rags",70,0,20,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Rags72","Black Rags",71,0,20,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Elf Guard Armor73","Elf Guard Armor",72,5,700,1.17,3,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Elf Lord Armor74","Elf Lord Armor",73,6,600,.37,4,!1,{wearLocation:"body",weight:50,isMetal:!0}),this.addArmor("Wood Breastplate75","Wood Breastplate",74,1,250,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Red Shirt76","Red Shirt",75,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Leather Women Shirt77","Leather Women Shirt",76,0,80,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Leather Breastholder78","Leather Breastholder",77,0,80,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Breastholder79","Black Breastholder",78,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Red Breastholder80","Red Breastholder",79,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Shoulder Pads81","Shoulder Pads",80,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Chain Dress82","Chain Dress",81,3,300,3.46,2,!1,{wearLocation:"body",weight:35,isMetal:!0}),this.addArmor("Red Leather Women Armor83","Red Leather Women Armor",82,1,250,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Metal Apron84","Metal Apron",83,3,200,3.46,2,!1,{wearLocation:"body",weight:35,isMetal:!0}),this.addArmor("Red Leather Armor85","Red Leather Armor",84,1,250,10.32,1,!1,{wearLocation:"body",weight:10}),this.addArmor("White Tunic86","White Tunic",85,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Red Tunic87","Red Tunic",86,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Blue Tunic88","Blue Tunic",87,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Tunic89","Black Tunic",88,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("White Women Dress90","White Women Dress",89,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Black Women Dress91","Black Women Dress",90,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Blue Women Dress92","Blue Women Dress",91,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Green Women Dress93","Green Women Dress",92,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Red Women Dress94","Red Women Dress",93,0,50,.12,0,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Steel Slayer Plate95","Steel Slayer Plate",94,5,450,1.17,3,!1,{wearLocation:"body",weight:35,isMetal:!0}),this.addArmor("Hide Cape96","Hide Cape",95,1,300,.12,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Hide Cape97","Hide Cape",96,1,300,.12,1,!1,{wearLocation:"body",weight:10}),this.addArmor("Moon Tunic97","Moon Tunic",97,3,300,.12,1,!1,{wearLocation:"body",weight:10,isClothing:!0}),this.addArmor("Leather Pants2","Leather Pants",113,2,150,22.27,1,!1,{wearLocation:"legs",weight:10}),this.addArmor("Leather Pants3","Leather Pants",114,2,150,22.27,1,!1,{wearLocation:"legs",weight:10}),this.addArmor("Chain Leggings5","Chain Leggings",116,3,300,7.47,2,!1,{wearLocation:"legs",weight:20,isMetal:!0}),this.addArmor("Plate Leggings6","Plate Leggings",117,4,350,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Black Plate Leggings7","Black Plate Leggings",118,4,350,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Gray Plate Leggings9","Gray Plate Leggings",120,4,350,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Gold Leggings12","Gold Leggings",123,6,600,.8,4,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Gold Chain Leggings13","Gold Chain Leggings",124,5,400,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Bone Leggings21","Bone Leggings",132,4,400,7.47,2,!1,{wearLocation:"legs",weight:40}),this.addArmor("Plate Leggings22","Plate Leggings",133,4,350,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Plate Leggings23","Plate Leggings",134,4,350,2.53,3,!1,{wearLocation:"legs",weight:30,isMetal:!0}),this.addArmor("Green Silk Skirt1","Green Silk Skirt",112,0,25,.27,0,!1,{wearLocation:"legs",weight:3,isClothing:!0}),this.addArmor("Leather Loincloth4","Leather Loincloth",115,0,75,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Blue Pants8","Blue Pants",119,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Green Pants10","Green Pants",121,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Black Pants11","Black Pants",122,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Straw Skirt14","Straw Skirt",125,0,50,.27,0,!1,{wearLocation:"legs",weight:7,isClothing:!0}),this.addArmor("Short Pants15","Short Pants",126,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Black Short Pants16","Black Short Pants",127,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Thong17","Thong",128,0,20,.27,0,!1,{wearLocation:"legs",weight:3,isClothing:!0}),this.addArmor("Black Open Skirt18","Black Open Skirt",129,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Red Open Skirt19","Red Open Skirt",130,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Leather Briefs20","Leather Briefs",131,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Brown Skirt24","Brown Skirt",135,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Blue Skirt25","Blue Skirt",136,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Black Skirt26","Black Skirt",137,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("White Skirt27","White Skirt",138,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Green Skirt28","Green Skirt",139,0,50,.27,0,!1,{wearLocation:"legs",weight:5,isClothing:!0}),this.addArmor("Leather Pants29","Leather Pants",140,2,150,.27,1,!1,{wearLocation:"legs",weight:10}),this.addArmor("Leather Pants30","Leather Pants",141,2,150,.27,1,!1,{wearLocation:"legs",weight:10}),this.addArmor("Red Leather Gloves1","Red Leather Gloves",160,1,100,10.65,1,!1,{wearLocation:"arms",weight:5}),this.addArmor("Plate Gloves2","Plate Gloves",161,4,300,1.21,3,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Brass Bracelets3","Brass Bracelets",162,0,100,.38,0,!1,{wearLocation:"arms",weight:5,isMetal:!0,isClothing:!0}),this.addArmor("Leather Bracelets4","Leather Bracelets",163,0,50,.38,0,!1,{wearLocation:"arms",weight:2,isClothing:!0}),this.addArmor("Black Leather Gloves5","Black Leather Gloves",164,1,100,3.57,2,!1,{wearLocation:"arms",weight:8}),this.addArmor("Combat Gauntlets6","Combat Gauntlets",165,2,200,3.57,2,!1,{wearLocation:"arms",weight:10}),this.addArmor("Leather Gloves7","Leather Gloves",166,1,100,10.65,1,!1,{wearLocation:"arms",weight:5}),this.addArmor("Plate Gauntlets8","Plate Gauntlets",167,4,300,1.21,3,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Gold Bracelets9","Gold Bracelets",168,0,150,.38,0,!1,{wearLocation:"arms",weight:10,isMetal:!0,isClothing:!0}),this.addArmor("Blue Gloves10","Blue Gloves",169,1,100,10.65,1,!1,{wearLocation:"arms",weight:5}),this.addArmor("Combat Gauntlets11","Combat Gauntlets",170,2,200,3.57,2,!1,{wearLocation:"arms",weight:10}),this.addArmor("Iron Bracelets12","Iron Bracelets",171,0,150,.38,0,!1,{wearLocation:"arms",weight:10,isMetal:!0,isClothing:!0}),this.addArmor("Chain Gloves13","Chain Gloves",172,3,250,3.57,2,!1,{wearLocation:"arms",weight:20,isMetal:!0}),this.addArmor("Knight Gloves14","Knight Gloves",173,4,300,1.21,3,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Rock Gauntlets15","Rock Gauntlets",174,4,400,.38,4,!1,{wearLocation:"arms",weight:30}),this.addArmor("Dragon Gauntlets16","Dragon Gauntlets",175,5,400,.38,4,!1,{wearLocation:"arms",weight:30}),this.addArmor("Warlord Gauntlets17","Warlord Gauntlets",176,5,450,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Gold Gauntlets18","Gold Gauntlets",177,5,500,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Holy Gauntlets19","Holy Gauntlets",178,5,450,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Spiky Gauntlets20","Spiky Gauntlets",179,5,400,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Titan Gauntlets21","Titan Gauntlets",180,5,500,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Bone Gauntlets22","Bone Gauntlets",181,4,350,1.21,3,!1,{wearLocation:"arms",weight:30}),this.addArmor("Mail Gauntlets23","Mail Gauntlets",182,3,250,3.57,2,!1,{wearLocation:"arms",weight:20,isMetal:!0}),this.addArmor("Darkness Gauntlets24","Darkness Gauntlets",183,5,500,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Elfish Gauntlets25","Elfish Gauntlets",184,5,550,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Elfish Gauntlets26","Elfish Gauntlets",185,5,550,.38,4,!1,{wearLocation:"arms",weight:30,isMetal:!0}),this.addArmor("Leather Boots1","Leather Boots",192,1,150,16.67,1,!1,{wearLocation:"foot",weight:30}),this.addArmor("Leather Boots2","Leather Boots",193,1,150,16.67,1,!1,{wearLocation:"foot",weight:30}),this.addArmor("Leather Boots3","Leather Boots",194,1,150,16.67,1,!1,{wearLocation:"foot",weight:30}),this.addArmor("Leather Laced Sandals4","Leather Laced Sandals",195,1,150,.6,0,!1,{wearLocation:"foot",weight:30,isClothing:!0}),this.addArmor("Leather Boots5","Leather Boots",196,1,150,16.67,1,!1,{wearLocation:"foot",weight:30}),this.addArmor("Plate Boots6","Plate Boots",197,3,300,1.9,3,!1,{wearLocation:"foot",weight:70,isMetal:!0}),this.addArmor("Plate Boots7","Plate Boots",198,3,300,1.9,3,!1,{wearLocation:"foot",weight:70,isMetal:!0}),this.addArmor("Red Laced Sandals8","Red Laced Sandals",199,0,30,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("Brown Laced Sandals9","Brown Laced Sandals",200,0,30,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("Yellow Laced Sandals10","Yellow Laced Sandals",201,0,30,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("Black Laced Sandals11","Black Laced Sandals",202,0,30,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("White Sandals12","White Sandals",203,0,30,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("Green Leather Boots13","Green Leather Boots",204,1,150,16.67,1,!1,{wearLocation:"foot",weight:30}),this.addArmor("Black Plate Boots14","Black Plate Boots",205,3,300,1.9,3,!1,{wearLocation:"foot",weight:40,isMetal:!0}),this.addArmor("Plate Boots15","Plate Boots",206,3,300,1.9,3,!1,{wearLocation:"foot",weight:40,isMetal:!0}),this.addArmor("Rock Boots16","Rock Boots",207,4,400,.6,4,!1,{wearLocation:"foot",weight:60}),this.addArmor("Dragon Boots17","Dragon Boots",208,5,500,.6,4,!1,{wearLocation:"foot",weight:40}),this.addArmor("Dark Boots18","Dark Boots",209,5,500,.6,4,!1,{wearLocation:"foot",weight:40,isMetal:!0}),this.addArmor("Gold Boots19","Gold Boots",210,5,600,.6,4,!1,{wearLocation:"foot",weight:60,isMetal:!0}),this.addArmor("Black Laced Sandals20","Black Laced Sandals",211,0,50,.6,0,!1,{wearLocation:"foot",weight:10,isClothing:!0}),this.addArmor("Bone Boots21","Bone Boots",212,4,300,1.9,3,!1,{wearLocation:"foot",weight:80}),this.addArmor("Elfish Boots22","Elfish Boots",213,5,600,.6,4,!1,{wearLocation:"foot",weight:60,isMetal:!0}),this.addHelmet("Horned Cap","Horned Cap","Protects head",84,1,150,"HAT",8.31,1,!1,{protectsHead:!0}),this.addHelmet("Leather Cap","Leather Cap","Protects head",109,1,100,"HAT",8.31,1,!1,{protectsHead:!0}),this.addHelmet("Bear Cap","Bear Cap","Keeps your head warm",83,0,50,"HAT",.3,1,!1,{}),this.addHelmet("Blue Cone Hat","Blue Cone Hat","Increases Elemental Power",89,0,50,"HAT",.3,4,!1,{boostElementalMagic:!0}),this.addHelmet("Black Cone Hat","Black Cone Hat","Increases Energy Magic Power",90,0,50,"HAT",.3,4,!1,{boostEnergyMagic:!0}),this.addHelmet("Priest Cap","Priest Cap","Grants protection against status ailments",103,0,50,"HAT",.3,4,!1,{preventStatusAilments:!0}),this.addHelmet("Blue Hat","Blue Hat","",104,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Black Hat","Black Hat","",105,0,50,"HAT",.3,2,!1,{}),this.addHelmet("White Hat","White Hat","",106,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Green Hat","Green Hat","",107,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Red Hat","Red Hat","",108,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Straw Hat","Straw Hat","",111,0,50,"HAT",.3,1,!1,{}),this.addHelmet("Blue Ribboned Hat","Blue Ribboned Hat","",112,0,50,"HAT",.3,3,!1,{}),this.addHelmet("Black Ribboned Hat","Black Ribboned Hat","",113,0,50,"HAT",.3,3,!1,{}),this.addHelmet("White Ribboned Hat","White Ribboned Hat","",114,0,50,"HAT",.3,3,!1,{}),this.addHelmet("Green Ribboned Hat","Green Ribboned Hat","",115,0,50,"HAT",.3,3,!1,{}),this.addHelmet("Red Ribboned Hat","Red Ribboned Hat","",116,0,50,"HAT",.3,3,!1,{}),this.addHelmet("Black Headkerchief","Black Headkerchief","",117,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Flat Cap","Flat Cap","",127,0,50,"HAT",.3,2,!1,{}),this.addHelmet("Skull Helm","Skull Helm","Protects head and face, prevents panic",85,3,300,"HELM",2.79,2,!1,{protectsHead:!0,protectsFace:!0,preventFear:!0}),this.addHelmet("Joust Helm","Joust Helm","Protects head and face",86,3,300,"HELM",2.79,2,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Avenger Helm","Avenger Helm","Protects head and face",118,3,400,"HELM",2.79,2,!0,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Kabuto","Kabuto","Protects head, grants courage",88,4,450,"HELM",.95,3,!1,{protectsHead:!0,preventFear:!0}),this.addHelmet("Black Winged Helm","Black Winged Helm","Protects head, face and neck",101,3,250,"HELM",.95,3,!1,{protectsHead:!0,protectsFace:!0,protectsNeck:!0}),this.addHelmet("Golden Winged Helm","Golden Winged Helm","Protects head and face",102,3,400,"HELM",.95,3,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Blue Helm","Blue Helm","Protects head and face",120,4,300,"HELM",.95,3,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Paladin Helm","Paladin Helm","Protects head and face",122,4,300,"HELM",.95,3,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Demon Helm","Demon Helm","Protects head, face and neck, scares enemies",126,4,400,"HELM",.1,4,!0,{protectsHead:!0,protectsFace:!0,protectsNeck:!0,causesFear:!0}),this.addHelmet("Helm of Darkness","Helm of Darkness","Protects head and face. Imbues attacks with darkness.",128,5,500,"HELM",.1,4,!0,{protectsHead:!0,protectsFace:!0,darknessBonus:!0}),this.addHelmet("Helm of Light","Helm of Light","Protects head and face. Imbues attacks with light.",129,5,500,"HELM",.1,4,!0,{protectsHead:!0,protectsFace:!0,lightBonus:!0}),this.addHelmet("Helm of the Elves","Helm of the Elves","Protects head and face. Grants Extreme Accuracy.",130,5,500,"HELM",.1,4,!0,{protectsHead:!0,protectsFace:!0,sureShot:!0}),this.addHelmet("Helm of the Mermen","Helm of the Mermen","Protects head and face. Prevents Status Ailments.",131,5,500,"HELM",.1,4,!0,{protectsHead:!0,protectsFace:!0,preventStatusAilments:!0}),this.addHelmet("Iron Helmet","Iron Helmet","Protects head and face",80,2,300,"HELMET",8.31,1,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Metal Cap","Metal Cap","Protects head",91,2,300,"HELMET",8.31,1,!1,{protectsHead:!0}),this.addHelmet("Spiked Helmet","Spiked Helmet","Protects head",121,2,300,"HELMET",8.31,1,!1,{protectsHead:!0}),this.addHelmet("Winged Helmet","Winged Helmet","Protects head and face",81,3,300,"HELMET",2.79,2,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Closed Helmet","Closed Helmet","Protects head and face",82,3,350,"HELMET",2.79,2,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Knight Helmet","Knight Helmet","Protects head and face",87,4,300,"HELMET",.95,3,!1,{protectsHead:!0,protectsFace:!0}),this.addHelmet("Horned Helmet","Horned Helmet","Protects head",92,4,350,"HELMET",.95,3,!1,{protectsHead:!0}),this.addHelmet("Golden Guard Helmet","Golden Guard Helmet","Protects head",93,5,500,"HELMET",.1,4,!1,{protectsHead:!0}),this.addHelmet("Mime Mask","Mime Mask","Confuses Enemies",124,1,50,"MASK",8.31,1,!1,{causesConfusion:!0}),this.addHelmet("Skull Mask","Skull Mask","Scares Enemies",123,2,100,"MASK",.95,3,!1,{causesFear:!0}),this.addHelmet("Totem Mask","Totem Mask","Scares enemies",110,1,100,"MASK",.95,4,!1,{causesFear:!0}),this.addHelmet("Golden Tiara","Golden Tiara","Absorbs mana from enemies",94,0,1e3,"TIARA",.3,4,!1,{regenMana:!0}),this.addHelmet("Blue Circlet","Blue Circlet","Increases Magic Power",96,0,500,"TIARA",.3,4,!1,{boostAllMagic:!0}),this.addHelmet("Black Circlet","Black Circlet","Increases Magic Power",97,0,500,"TIARA",.3,4,!1,{boostAllMagic:!0}),this.addHelmet("Gold Circlet","Gold Circlet","Increases Magic Power",98,0,500,"TIARA",.3,4,!1,{boostAllMagic:!0}),this.addHelmet("Green Circlet","Green Circlet","Increases Magic Power",99,0,500,"TIARA",.3,4,!1,{boostAllMagic:!0}),this.addHelmet("Red Circlet","Red Circlet","Increases Magic Power",100,0,500,"TIARA",.3,4,!1,{boostAllMagic:!0}),this.addHelmet("Topaz Tiara","Topaz Tiara","Increases magic power and mana consumption.",119,0,1e3,"TIARA",.1,4,!1,{pumpMagic:!0}),this.addHelmet("Coral Tiara","Coral Tiara","Reduces mana consumption",125,0,1e3,"TIARA",.1,4,!1,{saveMana:!0}),this.addShield("Red Kite Shield","Red Kite Shield","",144,10,300,"SHIELD",6.5,2,!1,{blockChance:20}),this.addShield("Black Kite Shield","Black Kite Shield","",145,10,300,"SHIELD",6.5,2,!1,{blockChance:20}),this.addShield("Wooden Buckler","Wooden Buckler","",146,5,180,"BUCKLER",13,1,!1,{blockChance:10}),this.addShield("Wooden Planks","Wooden Planks","",147,3,120,"PLANK",13,1,!1,{blockChance:15}),this.addShield("Iron Buckler","Iron Buckler","",148,10,240,"BUCKLER",6.5,2,!1,{blockChance:10}),this.addShield("Army Buckler","Army Buckler","",149,10,240,"BUCKLER",3.25,3,!1,{blockChance:10}),this.addShield("Spiky Buckler","Spiky Buckler","",150,10,240,"BUCKLER",3.25,3,!1,{blockChance:10}),this.addShield("Royal Shield","Royal Shield","",151,15,300,"SHIELD",3.25,3,!1,{blockChance:20}),this.addShield("Wooden Elfish Shield","Wooden Elfish Shield","",152,10,240,"SHIELD",13,1,!1,{blockChance:20}),this.addShield("Red Shield","Red Shield","",153,10,300,"SHIELD",6.5,2,!1,{blockChance:20}),this.addShield("Yellow Shield","Yellow Shield","",154,10,300,"SHIELD",6.5,2,!1,{blockChance:20}),this.addShield("Paladin Shield","Paladin Shield","",155,15,300,"SHIELD",1.69,4,!1,{blockChance:20}),this.addShield("Magic Shield","Magic Shield","Prevents Status ailments",156,15,240,"SHIELD",1.69,4,!1,{blockChance:20,preventStatusAilments:!0}),this.addShield("Squared Buckler","Squared Buckler","",157,10,210,"BUCKLER",3.25,3,!1,{blockChance:10}),this.addShield("Red Squared Buckler","Red Squared Buckler","",158,10,210,"BUCKLER",3.25,3,!1,{blockChance:10}),this.addShield("Elfish Shield","Elfish Shield","",159,15,240,"SHIELD",1.69,4,!1,{blockChance:20}),this.addShield("Iron Shield","Iron Shield","",160,15,360,"SHIELD",1.69,4,!1,{blockChance:20}),this.addShield("Battle Shield","Battle Shield","",161,15,360,"SHIELD",1.69,4,!1,{blockChance:20}),this.addShield("Round Shield","Round Shield","",162,10,360,"SHIELD",.78,5,!1,{blockChance:20}),this.addShield("Round Skull Shield","Round Skull Shield","Causes Fear on enemies",163,10,360,"SHIELD",.78,5,!1,{blockChance:20,causesFear:!0}),this.addShield("Golden Shield","Golden Shield","",164,15,480,"SHIELD",.39,6,!1,{blockChance:20}),this.addShield("Giant Shield","Giant Shield","",165,15,420,"SHIELD",.39,6,!1,{blockChance:20}),this.addShield("Wooden Tower Shield","Wooden Tower Shield","",166,10,480,"TOWER",.26,7,!1,{blockChance:30,heavy:!0}),this.addShield("Reinforced Tower Shield","Reinforced Tower Shield","",167,15,540,"TOWER",.26,7,!1,{blockChance:30,heavy:!0}),this.addShield("Iron Tower Shield","Iron Tower Shield","",168,20,720,"TOWER",.26,7,!1,{blockChance:30,heavy:!0}),this.addShield("Elfish Tower Shield","Elfish Tower Shield","",169,25,420,"TOWER",.13,8,!1,{blockChance:30,heavy:!0}),this.addShield("Demon Shield","Demon Shield","Imbues attacks with darkness",170,20,360,"SHIELD",.13,8,!1,{blockChance:20,darknessBonus:!0}),this.addShield("Paladin Tower Shield","Paladin Tower Shield","Imbues attacks with light",171,20,480,"TOWER",.13,8,!1,{blockChance:30,lightBonus:!0,heavy:!0}),this.addShield("Elfish Magic Shield","Elfish Magic Shield","",172,20,360,"TOWER",.26,7,!1,{blockChance:30,heavy:!0}),this.addScroll("recoverFullHealthSpell","Ram Mox Mani",121,128,14.07,1),this.addScroll("recoverHealthSpell","Mox Mani",122,129,45.03,2),this.addScroll("recoverStrengthSpell","Mox Hul",123,130,8.44,2),this.addScroll("increaseStrengthSpell","Kam Hul",121,131,5.63,3),this.addScroll("increaseHpSpell","Kam Mani",122,132,8.44,3),this.addScroll("invisibilitySpell","Momi Hel",123,133,2.81,2),this.addScroll("befriendMonsterSpell","Kam Melon",121,136,1.69,3),this.addScroll("polymorphSpell","Rando Melon",122,137,8.44,3),this.addScroll("enchantWeaponScroll","Kam Fyr",123,138,5.63,2),this.addScroll("enchantArmorScroll","Kam Gor",121,139,3.38,2),this.addScroll("repairWeaponScroll","Mox Fyr",122,140,11.26,2),this.addScroll("repairArmorScroll","Mox Gor",123,141,11.26,2),this.addScroll("repairWeapon1Scroll","Ram Mox",121,142,16.89,1),this.addScroll("darkPowerScroll","Hel Ram",123,171,.56,2),this.addScroll("holyPowerScroll","Lor Ram",121,172,.56,2),this.addScroll("rechargeWandScroll","Kam Va",122,147,11.26,2),this.addScroll("summonLichScroll","Ram Hum Melon",123,148,5.63,2),this.addScroll("summonSkeletonScroll","Hum Melon",121,149,11.26,2),this.addScroll("teleportScroll","Rando Lom",122,160,8.44,2),this.addScroll("revealMapScroll","Lor Koro",123,161,8.44,2),this.addScroll("inflictPanicScroll","Crip",121,162,1.69,2),this.addScroll("charmScroll","Melon",123,163,1.69,2),this.addScroll("attackSelfScroll","Rew Ram",122,174,11.26,2),this.addScroll("confuseScroll","Rew",122,164,1.69,2),this.addScroll("createArrowsScroll","Momi Gyr",121,173,5.63,2),this.addScroll("detectItemsScroll","Lor Obbo",123,165,8.44,2),this.addScroll("detectMonstersScroll","Lor Ben",121,144,8.44,2),this.addScroll("blindScroll","An Lor",121,166,1.69,2),this.addScroll("inflictMassPanicScroll","Vas Crip",122,167,1.69,2),this.addScroll("massCharmScroll","Vas Melon",121,168,1.69,2),this.addScroll("massConfuseScroll","Vas Rew",123,169,1.69,2),this.addScroll("massBlindScroll","Vas An Lor",122,170,1.69,2),this.addScroll("firePillarScroll","Pyr Ran",122,150,5.63,2),this.addScroll("fireTornadoScroll","Pyr Wos",123,151,3.94,2),this.addScroll("fireBallScroll","Pyr Won",121,152,8.44,2),this.addScroll("fireBoltScroll","Pyr Spak",122,153,11.26,2),this.addScroll("iceBoltScroll","Jan Spak",123,154,11.26,2),this.addScroll("freezeBoltScroll","Ram Jan Spak",121,155,5.63,2),this.addScroll("iceTornadoScroll","Jan Wos",122,156,3.94,2),this.addScroll("lightningBallScroll","Krak Won",123,157,5.63,2),this.addScroll("lightningExplosionScroll","Krak Bom",121,158,3.94,2),this.addScroll("gravityExplosionScroll","Grav Bom",122,159,3.94,2),this.addItem({appearance:"HERB",code:"healEssence",description:"Herbolaria",longDescription:"This herb contains the essence of healing, can be mixed into a potion.",index:3,menuIndex:51,rarity:40,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,isEssence:!0,onThrow:"bounce",onWhiteSpirit:"healingPotion",onBlackSpirit:"holyShot",explodeChance:5}}),this.addItem({appearance:"HERB",code:"acidEssence",description:"Malaria",longDescription:"A deadly plant containing the phosphorum essence, can be mixed into a potion.",index:4,menuIndex:52,rarity:40,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,isEssence:!0,onThrow:"bounce",onWhiteSpirit:"gelShot",onBlackSpirit:"acidShot",explodeChance:50}}),this.addItem({appearance:"HERB",code:"fireEssence",description:"Sulphur",longDescription:"Sulphur essence can be extracted from this mushroom to mix it into a potion.",index:5,menuIndex:53,rarity:35,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,isEssence:!0,onThrow:"bounce",onWhiteSpirit:"powerPotion",onBlackSpirit:"flamingShot",explodeChance:50}}),this.addItem({appearance:"STONE",code:"iceEssence",description:"Mercuria",longDescription:"This stone is cold to the touch. It can be ground and mixed into a potion.",index:6,menuIndex:54,rarity:35,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,isEssence:!0,onWhiteSpirit:"increaseHPPotion",onBlackSpirit:"iceShot",explodeChance:10}}),this.addItem({appearance:"STONE",code:"divineEssence",description:"Borax",longDescription:"The essence of Borax, said to be the gift of gods. It can be ground and mixed into a potion.",index:9,menuIndex:57,rarity:30,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,isEssence:!0,onWhiteSpirit:"invisibilityPotion",onBlackSpirit:"methylPotion",explodeChance:30}}),this.addItem({appearance:"STONE",code:"whiteSpirit",description:"Antimony",longDescription:"This base element of light can be mixed with an essence to create a potion.",index:7,menuIndex:55,rarity:40,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,spiritType:"white"}}),this.addItem({appearance:"STONE",code:"blackSpirit",description:"Arsenic",longDescription:"This base element of darkness can be mixed with an essence to create a potion.",index:8,menuIndex:56,rarity:40,tier:3,inventorySort:9,onUse:"applySpirit",features:{organicItem:!0,spiritType:"black"}}),this.addItem({appearance:"STONE",code:"pebbles",description:"Pebble",damageRoll:{base:1,multiplier:0,modifier:0},index:10,menuIndex:58,onUse:"reloadWeapon",rarity:80,tier:2,inventorySort:11,features:{organicItem:!0,onThrow:"damage",reloadWeaponType:"SLING",ammoType:"pebbles",attackDescription:"Can be thrown or shot using a sling.",damageType:"blunt",projectile:"rock",maxPackSize:5,ammoLoadSummary:"Ready Rock",ammoLoadMessage:"You put a rock into the sling.",reuseableAmmo:!0,breakChance:10}}),this.addItem({appearance:"ARROW",code:"arrows",description:"Arrow",damageRoll:{base:1,multiplier:0,modifier:0},index:1,menuIndex:49,onUse:"reloadWeapon",rarity:50,tier:2,inventorySort:11,features:{spawnedAmmo:!0,onThrow:"bounce",reloadWeaponType:"BOW",ammoType:"arrows",attackDescription:"Can be shot using a bow.",damageType:"piercing",projectile:"arrow",maxPackSize:10,ammoLoadSummary:"Nock Arrow",ammoLoadMessage:"You nock an arrow into your bowstring.",breakChance:40}}),this.addItem({appearance:"ARROW",code:"bolts",description:"Bolt",damageRoll:{base:1,multiplier:0,modifier:0},index:11,menuIndex:59,onUse:"reloadWeapon",rarity:20,tier:2,inventorySort:11,features:{spawnedAmmo:!0,onThrow:"bounce",reloadWeaponType:"CROSSBOW",ammoType:"bolts",attackDescription:"Can be shot using a crossbow.",damageType:"piercing",projectile:"xbolt",maxPackSize:20,ammoLoadSummary:"Load Bolt",ammoLoadMessage:"You load a bolt into the groove.",breakChance:40}}),this.addItem({appearance:"SPELL",code:"bandage",description:"Bandage",longDescription:"Recovers 10D3 hitpoints, stops bleeding",index:2,menuIndex:50,onUse:"stopBleeding",rarity:250,tier:2,inventorySort:11,features:{onThrow:"bounce",applyClose:!0,targetted:!0,dontThrowToAllies:!0,healingRoll:"10D3",isBandage:!0}}),this.addItem({appearance:"POTION",code:"flamingShot",description:"Liquid Fire",damageRoll:{base:2,multiplier:3,modifier:0},index:16,menuIndex:64,onUse:"reloadWeapon",rarity:30,tier:3,inventorySort:10,features:{onThrow:"explode",throwStyle:"spin",breakOnThrow:!0,reloadWeaponType:"GUN",ammoType:"flame shots",attackDescription:"Ignites in contact with air. Explodes when thrown causing massive damage.",damageType:"burning",projectile:"flame",maxPackSize:40,liquidAmmo:!0},unique:!0}),this.addItem({appearance:"POTION",code:"acidShot",description:"Acid",damageRoll:{base:2,multiplier:4,modifier:0},index:17,menuIndex:65,onUse:"reloadWeapon",rarity:30,tier:3,inventorySort:10,features:{onThrow:"explode",throwStyle:"spin",breakOnThrow:!0,reloadWeaponType:"GUN",ammoType:"acid shots",attackDescription:"Burns the skins of enemies. Explodes when thrown causing massive damage.",damageType:"acid",projectile:"acidShot",maxPackSize:40,liquidAmmo:!0},unique:!0}),this.addItem({appearance:"POTION",code:"gelShot",description:"Acid Gel",stunChance:50,stunMessage:"Stuck",damageRoll:{base:2,multiplier:2,modifier:0},index:18,menuIndex:66,onUse:"reloadWeapon",rarity:30,tier:3,inventorySort:10,features:{onThrow:"explode",throwStyle:"spin",breakOnThrow:!0,reloadWeaponType:"GUN",ammoType:"gel shots",attackDescription:"Sticks to the enemies, preventing them from moving. Explodes when thrown causing massive damage.",damageType:"acid",projectile:"gelShot",maxPackSize:40,liquidAmmo:!0},unique:!0}),this.addItem({appearance:"POTION",code:"holyShot",description:"Holy Water",damageRoll:{base:1,multiplier:2,modifier:0},index:19,menuIndex:67,onUse:"reloadWeapon",rarity:30,tier:3,inventorySort:10,features:{onThrow:"explode",breakOnThrow:!0,throwStyle:"spin",reloadWeaponType:"GUN",ammoType:"holy shots",attackDescription:"Cleanses the souls of undead and evil. Explodes when thrown causing massive damage.",damageType:"holy",projectile:"holyShot",maxPackSize:40,liquidAmmo:!0},unique:!0}),this.addItem({appearance:"POTION",code:"iceShot",description:"Liquid Ice",stunChance:80,stunMessage:"Frozen",damageRoll:{base:2,multiplier:2,modifier:0},index:20,menuIndex:68,onUse:"reloadWeapon",rarity:30,tier:3,inventorySort:10,features:{onThrow:"explode",breakOnThrow:!0,throwStyle:"spin",reloadWeaponType:"GUN",ammoType:"ice shots",attackDescription:"Freezes in contact with the air into a deadly icicle spikes. Explodes when thrown causing massive damage.",damageType:"piercing",projectile:"iceSpike",maxPackSize:40,liquidAmmo:!0},unique:!0}),this.addPotion("relaxingPotion","Zinc Potion","Cures from confusion, hallucination and temporal paralysis or blindness.",25,73,"healStatus",10,1,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,magicPower:5}),this.addPotion("healingPotion","Herbolaria Potion","Recovers all hitpoints.",21,69,"recoverFullHealth",10,1,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,magicPower:5}),this.addPotion("powerPotion","Sulphur Potion","Increases Combat Skill.",22,70,"increaseStrength",5,3,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,magicPower:5}),this.addPotion("increaseHPPotion","Mercuria Potion",!1,23,71,"increaseHP",5,3,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,magicPower:5}),this.addPotion("invisibilityPotion","Borax Potion",!1,24,72,"invisibility",5,2,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,magicPower:5}),this.addPotion("darkPowerPotion","Mandragora Potion","Makes a monster evolve using dark power.",25,73,"darkEvolve",1,2,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,shouldNotUseOnSelf:!0}),this.addPotion("holyPowerPotion","Angelus Potion","Makes a monster evolve using holy power.",26,74,"lightEvolve",1,2,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0,shouldNotUseOnSelf:!0}),this.addPotion("ethylPotion","Ethyl Potion","Recovers Magic Power.",27,75,"recoverMagic",20,2,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0}),this.addPotion("methylPotion","Methyl Potion","Recovers all Magic Power.",28,76,"recoverFullMagic",5,4,{breakOnThrow:!0,targetted:!0,throwStyle:"spin",applyClose:!0,dontThrowToAllies:!0,dontThrow:!0}),this.addStatue(1,96,2,"Monk","",1),this.addStatue(2,97,3,"Warlock","",1),this.addStatue(3,98,4,"Sage","",1),this.addStatue(4,99,5,"Hermit","",1),this.addStatue(5,100,6,"Emperor","",1),this.addStatue(6,101,8,"Servant","",1),this.addStatue(7,102,9,"Ninja","",2),this.addStatue(8,103,11,"Dancer","",2),this.addStatue(9,104,33,"Green Slime","",2),this.addStatue(10,105,34,"Blue Slime","",2),this.addStatue(11,106,25,"Kobold","",2),this.addStatue(12,107,26,"Orc","",2),this.addStatue(13,108,27,"Troll","",3),this.addStatue(14,109,28,"Goblin","",3),this.addStatue(15,110,29,"Lizardman","",3),this.addStatue(16,111,0,"Ghost Knight","",3),this.addStatue(17,112,15,"Ghost","",3),this.addStatue(18,113,17,"Flaming Knight","",3),this.addStatue(19,114,20,"Borgo","",3),this.addStatue(20,115,40,"Woods Fairy","",4),this.addStatue(21,116,21,"Succubus","",4),this.addStatue(22,117,22,"Pumpkin","",4),this.addStatue(23,118,23,"Vampiress","",4),this.addStatue(24,119,24,"Starman","",4),this.addStatue(25,96,30,"Hellbull","",4),this.addStatue(26,97,31,"Yabros","",4),this.addStatue(27,98,32,"Okuro","",5),this.addStatue(28,99,36,"Kraken","",5),this.addStatue(29,100,45,"Yomo","",5),this.addStatue(30,101,18,"Fire Demon","",5),this.addStatue(31,102,19,"Ice Demon","",5),this.addStatue(32,103,37,"Water Demon","",5),this.addStatue(33,104,38,"Air Demon","",5),this.addStatue(34,105,35,"Bacteria Demon","",6),this.addStatue(35,106,39,"Sky Fairy","",6),this.addStatue(36,107,41,"Keeper","",6),this.addStatue(37,108,42,"Gold Golem","",6),this.addStatue(38,109,43,"Ice elemental","",6),this.addStatue(39,110,44,"Fire elemental","",6)}module.exports=ItemFactory;var Item=require("./Item.class.js"),Stat=require("./Stat.class.js"),Roll=require("./Roll.class.js");ItemFactory.prototype.addItem=function(e){this.itemsMap[e.code]=e;var a=this.appearanceMap[e.appearance];a||(a=[],this.appearanceMap[e.appearance]=a),a.push(e),this.itemData.push(e)},ItemFactory.prototype.addStatue=function(e,a,t,o,r,i){var n={code:"STATUE_"+e,description:"Statue of "+o,longDescription:"Saved in your statue collection",index:a,menuIndex:124,onPickup:"getStatue",statueIndex:e,rarity:5,tier:1,minLevel:4*(i-1),unique:!1,inventorySort:12,features:{noWeight:!0},appearance:"STATUE"};this.addItem(n)},ItemFactory.prototype.addArmor=function(e,a,t,o,r,i,n,d,s){var h={code:e,description:a,masterIndex:t,onUse:"wear",defenseValue:o,resilience:r,rarity:i,tier:n,unique:d,inventorySort:2,features:s};switch(h.features.weight>=45&&(h.features.heavyArmor=!0),h.features.wearLocation){case"body":h.inventorySort=3;break;case"arms":h.inventorySort=5;break;case"legs":h.inventorySort=6;break;case"foot":h.inventorySort=7}h.features.isClothing?(h.features.onThrow="bounce",h.appearance="CLOTHING"):h.appearance="ARMOR",h.groundTileset="wearables-ground",this.addItem(h)},ItemFactory.prototype.addHelmet=function(e,a,t,o,r,i,n,d,s,h,l){var c={code:e,description:a,longDescription:t,masterIndex:o,defenseValue:r,resilience:i,onUse:"wearAsHelmet",rarity:d,tier:s,unique:h,inventorySort:4,features:l};c.appearance=n,this.addItem(c)},ItemFactory.prototype.addShield=function(e,a,t,o,r,i,n,d,s,h,l){var c={code:e,description:a,longDescription:t,masterIndex:o,defenseValue:r,resilience:i,onUse:"wearAsShield",rarity:d,tier:s,unique:h,inventorySort:2,features:l};c.appearance=n,this.addItem(c)},ItemFactory.prototype.addWeapon=function(e,a,t,o,r,i,n,d,s,h,l,c,g,m,w){var p={code:e,description:a,longDescription:t,masterIndex:o,iconIndex:r,onUse:"wield",damageRoll:{base:i,multiplier:n,modifier:d},maxUses:s,type:h,rarity:l,tier:c,unique:g,inventorySort:1,stunChance:m,features:w};w?w.autoUseOnEnemy=!0:w={autoUseOnEnemy:!0},p.appearance="WP_"+p.type,this.addItem(p)},ItemFactory.prototype.addScroll=function(e,a,t,o,r,i){var n={code:e,description:a,index:t,menuIndex:o,onUse:"invokeSpell",rarity:r,tier:i,inventorySort:8,features:{spell:a}};n.features.dontThrow=!0,n.features.magicSpell=!0,n.features.isScroll=!0,n.appearance="SPELL",this.addItem(n)},ItemFactory.prototype.addPotion=function(e,a,t,o,r,i,n,d,s){var h={code:e,description:a,index:o,longDescription:t,menuIndex:r,onUse:i,rarity:n,tier:d,inventorySort:10};h.features=s||{},h.features.useSfx||(h.features.useSfx="potion"),h.features.isPotion=!0,h.appearance="POTION",this.addItem(h)},ItemFactory.prototype.getAnItem=function(e){e||(e="main");for(var a=this.itemGroups[e],t=rand(0,100*a.generationChanceTotal)/100,o=0;o<a.thresholds.length;o++)if(t<=a.thresholds[o].threshold)return this.getItem(a.thresholds[o].item);return this.getItem(a.thresholds[0].item)},ItemFactory.prototype.calculateRarityOffsets=function(e){this.itemGroups={};for(var a=0;a<this.itemData.length;a++){var t=this.itemData[a];if(!(t.minLevel&&t.minLevel>e)&&!t.unique){var o="main";t.features&&(t.features.organicItem?o="organicItem":t.features.spawnedAmmo&&(o="spawnedAmmo")),this.pushThreshold(t,t.rarity,o)}}},ItemFactory.prototype.pushThreshold=function(e,a,t){if(!(a<=0)){var o=this.itemGroups[t];o||(o={generationChanceTotal:0,thresholds:[]},this.itemGroups[t]=o),o.generationChanceTotal+=a,o.thresholds.push({threshold:o.generationChanceTotal,item:e})}},ItemFactory.prototype.getItemByCode=function(e,a){return this.getItem(this.itemsMap[e],a)},ItemFactory.prototype.getItemNameByCode=function(e){return this.itemsMap[e].description},ItemFactory.prototype.getItem=function(e,a){var t=this.gameController.player,o=new Item(this.gameController,e.code,e.description,e.onUse,e);if(void 0!==e.defenseValue&&e.resilience&&(o.defenseValue=e.defenseValue,o.integrity=new Stat(e.resilience),o.integrity.current=a?Math.floor(.5*e.resilience):Math.floor(e.resilience*(rand(60,100)/100))),e.damageRoll&&e.maxUses)if(o.remainingUses=new Stat(e.maxUses),a?"WAND"===e.type?o.remainingUses.current=o.remainingUses.max:o.remainingUses.current=Math.floor(.5*o.remainingUses.max):o.remainingUses.current=Math.floor(o.remainingUses.max*(rand(50,100)/100)),"WAND"!==e.type||t.features.wandExpert)o.damageRoll=new Roll(e.damageRoll.base,e.damageRoll.multiplier,e.damageRoll.modifier);else{var r=Math.ceil(e.damageRoll.base/2);o.damageRoll=new Roll(r,e.damageRoll.multiplier,e.damageRoll.modifier),o.remainingUses.max=Math.floor(o.remainingUses.max/4),o.remainingUses.current=Math.floor(o.remainingUses.max*(rand(50,100)/100))}if(e.features&&e.features.reloadWeaponType&&(a||e.features.liquidAmmo?o.quantity=e.features.maxPackSize:o.quantity=1,o.damageRoll=new Roll(e.damageRoll.base,e.damageRoll.multiplier,e.damageRoll.modifier)),e.statueIndex&&(o.statueIndex=e.statueIndex),e.onPickup&&(o.onPickup=e.onPickup),o.stunChance=e.stunChance,o.features=e.features,e.features||(o.features={}),o.features._c=circular.setSafe(),o.type=e.type,o.transmutation=e.transmutation,o.longDescription=e.longDescription,o.inventorySort=e.inventorySort,e.features&&e.features.magicSpell&&t.features.cantRead?(o.name="Scroll",o.description="Scroll",o.longDescription="You can't read what is written in the scroll."):e.features&&e.features.advancedMagic&&!t.isMagicExpert()&&(o.longDescription="You don't understand the runes on this spell."),e.features&&e.features.isScroll)if(a)o.features.magicPower=6;else{var i=rand(1,100);i=i>90?12:i>70?10:i>40?8:6,o.features.magicPower=i}if(o.allowsModifiers()&&(chance(3)||o.features.enchantedWeapon&&chance(70)))switch(rand(0,1)){case 0:o.name="Fire "+o.name,o.features.damageType="burning";break;case 1:o.name+=" of Smite Undead",o.features.undeadBonus=!0}return o.appearance=e.appearance,o.iconIndex=e.iconIndex,o},ItemFactory.prototype.getRing=function(){return this.getItem({appearance:"RING",code:"ananias",description:"Ring of Ananias",longDescription:"An Amran Abaret Wom'a Sebaret",index:0,menuIndex:48,onUse:"winGame",inventorySort:12})},ItemFactory.prototype.getRune=function(){return this.getItem({appearance:"STONE",code:"rune",description:"Rune of Passage",longDescription:"Activates Magic Gates",index:12,menuIndex:60,onPickup:"setRune",inventorySort:12,features:{noWeight:!0}})},ItemFactory.prototype.test=function(){for(var e=1;e<25;e++){this.calculateRarityOffsets(e);for(var a=rand(3,5),t="",o=0;o<a;o++)t+=this.getAnItem().code+", ";console.log("Depth "+e+" "+t)}},ItemFactory.prototype.getStartingWeapon=function(){var e=randomElementOf(["Quarter Staff","Dagger","Mace","Spear","Battle Axe","Bow"]);return this.getItem(this.itemsMap[e],!0)},ItemFactory.prototype.getStartingArmor=function(){return this.getItem(this.itemsMap.Leather,!0)},ItemFactory.prototype.getSimilarItemDefinition=function(e){return randomElementOf(this.appearanceMap[e.appearance])};

},{"./Item.class.js":15,"./Roll.class.js":27,"./Stat.class.js":32,"circular-functions":43}],17:[function(require,module,exports){
var circular=require("circular-functions");function Level(){this.rooms=new Array,this.exploredMap=new Array,this._c=circular.register("Level")}module.exports=Level,circular.registerClass("Level",Level);var CellType=require("./CellType.enum");Level.prototype.addRoom=function(e){this.rooms.push(e),e.level=this},Level.prototype.getPlayerRoom=function(){for(var e=0;e<this.rooms.length;e++)if(this.rooms[e].isStart)return this.rooms[e];return this.rooms[0]},Level.prototype.exploreRoom=function(e,r,t){for(var o=e.x;o<e.x+e.width;o++)for(var i=e.y;i<e.y+e.height;i++)if(!t&&0!=t||!(distance(o,i,this.player.currentRoom.x+this.player.x,this.player.currentRoom.y+this.player.y)>=t)){this.exploredMap[o]||(this.exploredMap[o]=new Array);var s=o-e.x,n=i-e.y;e.getItem(s,n)&&!r?this.exploredMap[o][i]=CellType.ITEM:e.hasObstacles(s,n)?this.exploredMap[o][i]=CellType.WALL:this.exploredMap[o][i]=e.map[s][n]}},Level.prototype.exploreRoomContents=function(e,r,t,o){for(var i=0,s=e.x;s<e.x+e.width;s++)for(var n=e.y;n<e.y+e.height;n++)if(!o&&0!=o||!(distance(s,n,this.player.currentRoom.x+this.player.x,this.player.currentRoom.y+this.player.y)>=o)){this.exploredMap[s]||(this.exploredMap[s]=new Array);var a=s-e.x,l=n-e.y;r&&e.getItem(a,l)&&(this.exploredMap[s][n]=CellType.ITEM,i++),t&&e.getEnemy(a,l)&&(this.exploredMap[s][n]=CellType.WALL,i++)}return i},Level.prototype.exploreAll=function(){for(var e=0;e<this.map.length;e++)for(var r=0;r<this.map[0].length;r++)this.exploredMap[e]||(this.exploredMap[e]=new Array),this.exploredMap[e][r]=this.map[e][r]},Level.prototype.exploreCorridor=function(e,r,t){var o={};o.x=r.x+e.x,o.y=r.y+e.y;for(var i=new Array;(o.x!==t.x||o.y!==t.y)&&null!=(o=this.closeUnexploredCorridor(o));)i.push(o),this.exploredMap[o.x][o.y]=this.map[o.x][o.y];for(var s=0;s<i.length;s++)this.markSurroundingsExplored(i[s])},Level.prototype.markSurroundingsExplored=function(e){if("ABYSS"==this.environment||"LAGOON"==this.environment)this.exploredMap[e.x]||(this.exploredMap[e.x]=new Array),this.exploredMap[e.x][e.y]=this.map[e.x][e.y];else for(var r=e.x-1;r<=e.x+1;r++)for(var t=e.y-1;t<=e.y+1;t++)r<0||r>this.width-1||t<0||t>this.height-1||(this.exploredMap[r]||(this.exploredMap[r]=new Array),this.exploredMap[r][t]=this.map[r][t])},Level.prototype.closeUnexploredCorridor=function(e){for(var r=e.x-1;r<=e.x+1;r++)for(var t=e.y-1;t<=e.y+1;t++)if(!(r<0||r>this.width-1||t<0||t>this.height-1)&&(r!=e.x||t!=e.y)&&(r==e.x||t==e.y)&&(this.exploredMap[r]||(this.exploredMap[r]=new Array),this.map[r][t].equals(CellType.CORRIDOR)&&!this.exploredMap[r][t]))return{x:r,y:t};return null},Level.prototype.getADescription=function(){var e=null;return"TEMPLE"===this.environment?e=["It gets darker as you descend into the depths.","There's a foul odor of decay here.","What evil creatures await in this level?","You wonder if it was a good idea to venture here.","There's no way back now...","You hear a horrible shriek!","It smells of herbs and antiseptics.","This dungeon is very dusty..."]:"CAVERNS"===this.environment?e=["These twisty caves seem to be alive","You wonder if there's something beyond these caves","You can feel the spirits of the dead roaming","You feel trapped.","It's pitch black here"]:"LAGOON"===this.environment?e=["The atmosphere here is really damp.","You see a system of connected islands.","It's too humid here!","This lagoon streches far beyond your sight.","You fear you could fall into the water."]:"CRYSTAL"===this.environment?e=["Bright crystals addorn this cave.","You feel these could be your last minutes.","You yearn for the air of the wilderness","You almost can't breath.","The air feels pretty thin here."]:"ABYSS"===this.environment?e=["This place gives you the creeps.","You are surrounded in unending darkness.","You can feel the presence of the ring.","You have ventured far enough.","You feel your end closing by."]:"LAIR"===this.environment?e=["This is definitively not a cavern!","You feel like you are inside someone.","You are almost there, you should push forward.","This place seems to vibrate with life."]:"YENDOR"===this.environment&&(e=["This place looks like a classic roguelike."]),e[rand(0,e.length-1)]},Level.prototype.getMusicKey=function(){return!this.silent&&("TEMPLE"===this.environment?"temple":"CAVERNS"===this.environment?"caves":"LAGOON"===this.environment?"lagoon":"CRYSTAL"===this.environment?"lagoon":"ABYSS"===this.environment?"lair":"LAIR"===this.environment&&"lair")};

},{"./CellType.enum":7,"circular-functions":43}],18:[function(require,module,exports){
var MapBorders={selectBorder:function(i,e,o){var l="",r=!o.isSolid(i,e-1),n=!o.isSolid(i+1,e),t=!o.isSolid(i-1,e),a=!o.isSolid(i,e+1),S=!1,s=!1,d=!1;if(r&&(n&&(l+="K",S=!0,s=!0),t&&(l+="L",S=!0,d=!0),n||t||(l="G")),n||a||o.isSolid(i+1,e+1)||(l+="A"),t||a||o.isSolid(i-1,e+1)||(l+="C"),a){n&&(l+="I"),t&&(l+="J"),n||t||S||(l+="B")}else!s&&n&&(l+="D"),!d&&t&&(l+="E");return n||r||o.isSolid(i+1,e-1)||(l+="F"),t||r||o.isSolid(i-1,e-1)||(l+="H"),""===l&&(l="X"),parseWallCode(l,o,i,e)},selectFloatingWallTop:function(i,e,o){var l="",r=!o.isSolid(i,e-1),n=!o.isSolid(i+1,e),t=!o.isSolid(i-1,e),a=!o.isSolid(i,e+1),S=!1,s=!1,d=!1,M={};if(r){var A=!1;(n||!a&&!o.isSolid(i+1,e+1))&&(l+="K",S=!0,s=!0,A=!0,M.K=!0),(t||!a&&!o.isSolid(i-1,e+1))&&(l+="L",S=!0,d=!0,A=!0,M.L=!0),A||(l="G")}if(M.K||n||a||o.isSolid(i+1,e+1)&&o.isSolid(i+1,e+2)||(l+="A"),M.L||t||a||o.isSolid(i-1,e+1)&&o.isSolid(i-1,e+2)||(l+="C"),a||!a&&!o.isSolid(i,e+2)){var E=n||!n&&!o.isSolid(i+1,e+1),C=t||!t&&!o.isSolid(i-1,e+1);E&&(l+="I"),C&&(l+="J"),E||C||S||(l+="B")}else s||!n&&(n||o.isSolid(i+1,e+1))||(l+="D"),d||!t&&(t||o.isSolid(i-1,e+1))||(l+="E");return n||r||o.isSolid(i+1,e-1)||(l+="F"),t||r||o.isSolid(i-1,e-1)||(l+="H"),""===l&&(l="X"),parseWallCode(l,o,i,e)},selectUpperWallTop:function(i,e,o){o.isSolid(i,e-1);var l=!o.isSolid(i+1,e),r=!o.isSolid(i-1,e),n=!o.isSolid(i,e+1),t="";return l||n||o.isSolid(i+1,e+1)||(t+="A"),r||n||o.isSolid(i-1,e+1)||(t+="C"),n&&l?t+="I":n&&r?t+="J":(l&&(t+="D"),r&&(t+="E")),""==t&&(t="B"),parseWallCode(t,o,i,e)},toSpriteIndex:function(i,e,o){var l=REVERSE_WALLTOP_MAP[e][i].length;return l?REVERSE_WALLTOP_MAP[e][i][o%l]:REVERSE_WALLTOP_MAP[e][i]}},REVERSE_WALLTOP_MAP={TEMPLE:{A:112,B:[116,117,118,119],C:113,D:[144,145,146,147],E:[148,149,150,151],F:128,G:[132,133,134,135],H:129,I:114,J:115,K:130,L:131,M:256,N:257,O:258,P:259,Q:260,R:261,S:262,X:15},CAVERNS:{A:160,B:[164,165,166,167],C:161,D:[192,193,194,195],E:[196,197,198,199],F:176,G:[180,181,182,183],H:177,I:162,J:163,K:178,L:179,M:264,N:265,O:266,P:267,Q:268,R:269,S:270,X:15},CRYSTAL:{A:208,B:[212,213,214,215],C:209,D:[240,241,242,243],E:[244,245,246,247],F:224,G:[228,229,230,231],H:225,I:210,J:211,K:226,L:227,M:280,N:281,O:282,P:283,Q:284,R:285,S:286,X:117},LAIR:{A:120,B:124,C:121,D:152,E:156,F:136,G:140,H:137,I:122,J:123,K:138,L:139,M:288,N:289,O:290,P:291,Q:292,R:293,S:294,X:117},LAGOON:{A:168,B:[172,173,174,175],C:169,D:[200,201,202,203],E:[204,205,206,207],F:184,G:[188,189,190,191],H:185,I:170,J:171,K:186,L:187,M:272,N:273,O:274,P:275,Q:276,R:277,S:278,X:15}},METACOMBINATIONS={S:["I","J","K","L"],M:["J","L"],N:["B","G"],O:["I","K"],P:["K","L"],Q:["D","E"],R:["I","J"]};function parseWallCode(i,e,o,l){if(1==i.length)return[MapBorders.toSpriteIndex(i,e.getEnvironment(),o+l+e.x+e.y)];i=replaceMetaCombinations(i);for(var r=[],n=0;n<i.length;n++){var t=i.substr(n,1);r[n]=MapBorders.toSpriteIndex(t,e.getEnvironment(),o+l+e.x+e.y)}return r}function replaceMetaCombinations(i){return i.length>=4&&(i=replaceMetaCombination(i,"S",METACOMBINATIONS.S)),i=replaceMetaCombination(i,"M",METACOMBINATIONS.M),i=replaceMetaCombination(i,"N",METACOMBINATIONS.N),i=replaceMetaCombination(i,"O",METACOMBINATIONS.O),i=replaceMetaCombination(i,"P",METACOMBINATIONS.P),i=replaceMetaCombination(i,"Q",METACOMBINATIONS.Q),i=replaceMetaCombination(i,"R",METACOMBINATIONS.R)}function replaceMetaCombination(i,e,o){for(var l=0;l<o.length;l++)if(-1==i.indexOf(o[l]))return i;for(l=0;l<o.length;l++){var r=i.indexOf(o[l]);i=i.slice(0,r)+i.slice(r+1)}return i+e}module.exports=MapBorders;

},{}],19:[function(require,module,exports){
module.exports=Material={FLESH:0,BONE:1,WOOD:2,ETHER:3};

},{}],20:[function(require,module,exports){
function MonsterFactory(e){this.gameController=e,this.ecosystem=new Array,this.openEcosystem=new Array,this.races=new Array,this.racesByAnatomy=[],this.addRace(new Race("MOUTH","Mouth","A crawling monstrosity.","",47,new Roll(4,4,0),new Roll(2,3,0),{walkRandomlyChance:10,panickLimit:20,eyeless:!0,bestiary:!0},{},Material.FLESH,5,0,AttackType.BITE,!1,"BUG","hiss",3),1,4),this.addRace(new Race("ORC","Orc","A strong monster that protects the treasures of the dungeon.","",16,new Roll(5,4,0),new Roll(3,3,0),{guardItems:!0,teamPlayer:!0,callsForReinforcements:!0,panickLimit:10,humanoid:!0,bestiary:!0},{},Material.FLESH,15,0,AttackType.BLUNT,!1,"HUMANOID","orcish",7),1,4),this.addRace(new Race("SATYR","Satyr","","Dash: Double movement speed.",17,new Roll(5,4,0),new Roll(2,3,0),{doubleSpeed:!0,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:30,humanoid:!0,bestiary:!0,warrior:!0},{},Material.FLESH,20,20,AttackType.BLUNT,!1,"HUMANOID","common",7),1,4),this.addRace(new Race("PHANTOM","Phantom","A guardian spirit of the tombs.","Heal: Recovers health to all allies.",19,new Roll(4,4,0),new Roll(1,3,0),{walkRandomlyChance:20,healingPower:2,healingChance:60,lightEvolution:"SPIRIT",darkEvolution:"SPIRIT",panickLimit:20,eyeless:!0,floating:!0,bestiary:!0},{},Material.ETHER,5,5,AttackType.BLUNT,!1,"PHANTOM","none",4),1,4),this.addRace(new Race("SPIRIT","Spirit","An ancient spirit of the tombs.","Fear: Inflicts terror on enemies.",53,new Roll(4,4,0),new Roll(1,3,0),{panickLimit:20,eyeless:!0,floating:!0},{fear:{chance:80,range:2}},Material.ETHER,5,5,AttackType.BLUNT,!1,"PHANTOM","none",3),!1,!1),this.addRace(new Race("OPHIDIAN","Ophidian","","Rustic Bow: Ranged attack",22,new Roll(5,4,0),new Roll(2,3,0),{dropArrows:!0,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,humanoid:!0,bestiary:!0},{rangedAttack:{chance:100,range:6,accuracy:80,requiresLoading:!0,loadingMessage:"Nock Arrow",animation:{type:"ARROW",tileIndex:0},requiresDistance:!0}},Material.FLESH,15,20,AttackType.PIERCING,"shoot","TAILOID","hiss",8),1,4),this.addRace(new Race("KOBOLD","Kobold","","Disarm enemy",26,new Roll(6,4,0),new Roll(2,3,0),{disarmChance:30,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:20,humanoid:!0,bestiary:!0,warrior:!0},{},Material.FLESH,20,0,AttackType.SLASHING,!1,"HUMANOID","woof",9),2,4),this.addRace(new Race("EYE","Eyeball","","Gaze: Paralyzes enemy",20,new Roll(4,4,0),new Roll(1,3,0),{darkEvolution:"BLOOD_EYE",lightEvolution:"GLOW_EYE",chasePlayer:!0,floating:!0,bestiary:!0},{paralyze:{chance:20,range:2,effectMessage:"Paralyzed"}},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),1,4),this.addRace(new Race("GLOW_EYE","Glowing Eyeball","","Flash: Blinds enemy",48,new Roll(4,4,0),new Roll(1,3,0),{blindChance:50,blindRange:3,blindTurns:5,lightEvolution:"ICE_EYE",darkEvolution:"FIRE_EYE",chasePlayer:!0,eyeless:!0,floating:!0},{},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),!1,!1),this.addRace(new Race("BLOOD_EYE","Bloody Eyeball","","Gaze: Paralyzes enemy",49,new Roll(4,4,0),new Roll(1,3,0),{darkEvolution:"BOLT_EYE",lightEvolution:"FIRE_EYE",chasePlayer:!0,floating:!0},{paralyze:{chance:20,range:2,effectMessage:"Paralyzed"}},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),!1,!1),this.addRace(new Race("ICE_EYE","Ice Sphere","A sphere of freezing ice","Freeze: Paralyzes enemy",50,new Roll(4,4,0),new Roll(1,3,0),{chasePlayer:!0,eyeless:!0,floating:!0},{paralyze:{chance:60,range:1,effectMessage:"Frozen"}},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),!1,!1),this.addRace(new Race("FIRE_EYE","Fire Sphere","A sphere of blazing fire.","Fireball: Ranged Attack",51,new Roll(4,4,0),new Roll(1,3,0),{chasePlayer:!0,eyeless:!0,floating:!0},{rangedAttack:{chance:80,range:3,accuracy:70,animation:{type:"ARROW",tileIndexes:[42,43,44]}}},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),!1,!1),this.addRace(new Race("BOLT_EYE","Bolt Sphere","A sphere of shocking lightning","Shock: Paralyzes enemy",52,new Roll(4,4,0),new Roll(1,3,0),{chasePlayer:!0,eyeless:!0,floating:!0},{paralyze:{chance:40,range:1,effectMessage:"Shocked"}},Material.FLESH,15,10,AttackType.BLUNT,!1,"EYE","none",4),!1,!1),this.addRace(new Race("INVOKER","Invoker","This mage is a master of the undead.","Summon Skeletons",25,new Roll(5,4,0),new Roll(2,3,0),{summonChance:50,summonEnemy:"SKELETON",summonMax:3,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:40,humanoid:!0,bestiary:!0},{},Material.FLESH,5,2,AttackType.BLUNT,!1,"MAGE","common",9),5,9),this.addRace(new Race("SKELETON","Skeleton","An undead warrior brought back to life.","",42,new Roll(5,4,0),new Roll(2,3,0),{walkRandomlyChance:20,spawnAnimIndexes:[8,9,10,11,12,13,14,15],isUndead:!0,eyeless:!0,bestiary:!0,warrior:!0},{},Material.BONE,5,0,AttackType.BLUNT,!1,"HUMANOID","none",4),5,9),this.addRace(new Race("SGHOST","Ghost","An invisible entity.","",1,new Roll(5,4,0),new Roll(2,3,0),{invisible:!0,eyeless:!0,bestiary:!0},{},Material.ETHER,5,20,AttackType.BLUNT,!1,"INVISIBLE","none",1),5,9),this.addRace(new Race("WARG","Warg","A rabid wolfine lurking in the depths.","Attacks in packs",18,new Roll(7,4,0),new Roll(2,3,0),{packGenerated:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:20,bestiary:!0},{},Material.FLESH,15,0,AttackType.BITE,!1,"BEAST","howl",4),5,9),this.addRace(new Race("WOGORAT","Wogorat","A massive resilient monster.","",15,new Roll(8,4,0),new Roll(2,3,0),{panickLimit:30,eyeless:!0,bestiary:!0},{},Material.FLESH,5,0,AttackType.BITE,!1,"BUG","none",2),5,9),this.addRace(new Race("DEATH_WORM","Death Worm","","Poison bite: Reduces power",24,new Roll(5,4,0),new Roll(2,3,0),{weakenChance:20,lightEvolution:"EARTH_WORM",darkEvolution:"CHAOS_WORM",panickLimit:20,bestiary:!0},{},Material.BONE,5,5,AttackType.BITE,!1,"BUG","none",2),5,9),this.addRace(new Race("EARTH_WORM","Earth Worm","","Poison bite: Reduces power",54,new Roll(5,4,0),new Roll(2,3,0),{weakenChance:20,panickLimit:20,eyeless:!0},{},Material.FLESH,5,5,AttackType.BITE,!1,"TAILOID","none",2),!1,!1),this.addRace(new Race("CHAOS_WORM","Chaos Worm","","Poison bite: Reduces power",55,new Roll(5,4,0),new Roll(2,3,0),{weakenChance:20,panickLimit:20,eyeless:!0},{},Material.FLESH,5,5,AttackType.BITE,!1,"TAILOID","none",2),!1,!1),this.addRace(new Race("SARKA","Sarka","","Fear: Inflicts terror on enemies.",21,new Roll(9,4,0),new Roll(4,3,0),{teamPlayer:!0,chasePlayer:!0,humanoid:!0,bestiary:!0,warrior:!0},{fear:{chance:50,range:1}},Material.FLESH,15,2,AttackType.PIERCING,!1,"HUMANOID","hiss",7),9,13),this.addRace(new Race("TRENT","Trent","A bulky wooden creature. Can stand a lot of damage.","",23,new Roll(11,4,0),new Roll(2,3,0),{panickLimit:20,bestiary:!0,animationSpeed:1},{},Material.WOOD,5,0,AttackType.BLUNT,!1,"HUMANOID","none",5),9,13),this.addRace(new Race("MERMAID","Merman","","Charming Song",46,new Roll(7,4,0),new Roll(2,3,0),{confuseChance:20,confuseRange:3,confuseTurns:20,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,humanoid:!0,weakVsDarkness:!0,bestiary:!0,warrior:!0},{},Material.FLESH,15,5,AttackType.BLUNT,!1,"TAILOID","common",9),9,13),this.addRace(new Race("GRIFFIN","Griffin","A winged creature armed with throwing spears.","",31,new Roll(9,4,0),new Roll(3,3,0),{chasePlayer:!0,callsForReinforcements:!0,floating:!0,humanoid:!0,bestiary:!0,warrior:!0},{rangedAttack:{chance:80,range:4,accuracy:60,animation:{type:"ARROW",tileIndex:8},requiresDistance:!0}},Material.FLESH,20,20,AttackType.PIERCING,!1,"WINGED","shreek",8),9,13),this.addRace(new Race("NYMPH","Nymph","","Fetch: Steals an item. Blinding Beauty. ",30,new Roll(9,4,0),new Roll(2,3,0),{doubleSpeed:!0,stealChance:30,blindChance:50,blindRange:1,blindTurns:1,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:20,humanoid:!0,bestiary:!0},{},Material.FLESH,15,2,AttackType.BLUNT,!1,"HUMANOID","common",8),9,13),this.addRace(new Race("SIREEN","Sireen","","Lullaby: Paralyzes enemy",29,new Roll(11,5,0),new Roll(3,3,0),{teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:20,floating:!0,humanoid:!0,bestiary:!0,warrior:!0},{paralyze:{chance:10,range:2,effectMessage:"Sleep"}},Material.FLESH,15,5,AttackType.PIERCING,!1,"WINGED","shreek",9),14,17),this.addRace(new Race("CENTAUR","Centaur","","Regen: Recover health while fighting.",27,new Roll(12,5,0),new Roll(4,3,0),{regenChance:80,regenHP:2,doubleSpeed:!0,canBlock:!0,teamPlayer:!0,chasePlayer:!0,humanoid:!0,bestiary:!0,warrior:!0},{},Material.FLESH,10,20,AttackType.PIERCING,!1,"BEAST","common",7),13,17),this.addRace(new Race("GUALAR","Gualar","A disgusting skeletal monster.","+ Acid Shot + Violet fumes",28,new Roll(10,5,0),new Roll(2,3,0),{damageArmorChance:20,damageArmor:20,isUndead:!0,teamPlayer:!0,panickLimit:20,bestiary:!0},{fetidFumes:{chance:40,range:1,minTurns:20,maxTurns:40}},Material.BONE,5,1,AttackType.BLUNT,!1,"BUG","hiss",4),13,17),this.addRace(new Race("GUARDIAN","Guardian","A strong knight of chaos guarding the dungeon exits.","",32,new Roll(12,5,0),new Roll(5,3,0),{guardExit:!0,teamPlayer:!0,humanoid:!0,bestiary:!0,warrior:!0},{},Material.ETHER,5,0,AttackType.SLASHING,!1,"KNIGHT","common",10),13,17),this.addRace(new Race("SORCEROR","Sorceror","","Merton + Illusion of Death + Telepathy",33,new Roll(10,6,0),new Roll(2,3,0),{damageWeaponChance:40,damageWeaponMax:20,confuseChance:20,confuseRange:3,confuseTurns:10,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,panickLimit:20,humanoid:!0,bestiary:!0},{telepathy:!0},Material.FLESH,5,5,AttackType.BLUNT,!1,"MAGE","common",9),13,17),this.addRace(new Race("TRIDUDE","Tridude","A monster with a rare trilateral symmetry.","Thrice: Attack 3 times",59,new Roll(5,6,0),new Roll(2,3,0),{doubleAttack:!0,tripleAttack:!0,weakVsDarkness:!0,bestiary:!0},{},Material.FLESH,15,20,AttackType.BITE,!1,"BUG","none",3),13,17),this.addRace(new Race("LICH","Lich","An undead entity able to overcome death by replicating.","Clone",34,new Roll(12,6,0),new Roll(3,3,0),{summonChance:5,summonEnemy:"LICH",summonMax:1,spawnAnimIndexes:[0,1,2,3,4,5,6,7],isUndead:!0,teamPlayer:!0,chasePlayer:!0,humanoid:!0,bestiary:!0},{},Material.BONE,5,3,AttackType.BLUNT,!1,"MAGE","common",8),17,21),this.addRace(new Race("UNBORN_ASSASSIN_1","Unborn Assassin","An elusive deadly foe born from sorcery.","Evade + Cutting Edge: Makes enemies bleed.",69,new Roll(10,6,0),new Roll(3,4,0),{cutChance:30,evadeChance:20,isUndead:!0,teamPlayer:!0,chasePlayer:!0,fearless:!0,humanoid:!0,warrior:!0},{},Material.ETHER,0,0,AttackType.SLASHING,!1,"KNIGHT","common",8),17,21),this.addRace(new Race("UNBORN_ASSASSIN_2","Unborn Assassin","An elusive deadly foe born from sorcery.","Evade + Cutting Edge: Makes enemies bleed.",70,new Roll(10,6,0),new Roll(3,4,0),{cutChance:20,evadeChance:40,isUndead:!0,teamPlayer:!0,chasePlayer:!0,fearless:!0,humanoid:!0,warrior:!0},{},Material.ETHER,0,0,AttackType.SLASHING,!1,"KNIGHT","common",8),17,21),this.addRace(new Race("DEMONSPAWN","Demonspawn","","Warp + Entrap + Block",35,new Roll(12,6,0),new Roll(3,3,0),{warpChance:50,entrap:!0,canBlock:!0,teamPlayer:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"HUMANOID","common",5),17,21),this.addRace(new Race("DRACONIAN_WARRIOR","Draconian Warrior","A dweller of the depths, its strength is legendary.","Telepathy",36,new Roll(10,6,0),new Roll(4,4,0),{teamPlayer:!0,chasePlayer:!0,humanoid:!0,warrior:!0},{telepathy:!0},Material.FLESH,15,0,AttackType.BLUNT,!1,"HUMANOID","draconian",5),17,21),this.addRace(new Race("CHAOS_ANGEL","Chaos Angel","","Heal: Recovers health to all allies.",37,new Roll(13,6,0),new Roll(2,3,0),{healingPower:6,healingChance:70,teamPlayer:!0,floating:!0,humanoid:!0,weakVsDarkness:!0},{},Material.ETHER,5,5,AttackType.PIERCING,!1,"WINGED","common",5),21,25),this.addRace(new Race("CHAOS_PRIEST","Chaos Priest","","Weaken: Reduces Health. Blinding Light",38,new Roll(14,6,0),new Roll(3,3,0),{reduceMaxHPChance:20,blindChance:30,blindRange:2,blindTurns:3,teamPlayer:!0,chasePlayer:!0,callsForReinforcements:!0,humanoid:!0,weakVsDarkness:!0},{},Material.FLESH,5,3,AttackType.BLUNT,!1,"MAGE","common",4),21,25),this.addRace(new Race("ARACHNOID","Arachnoid","","Dash + Entrap: Prevents enemies from fleeing.",39,new Roll(13,6,0),new Roll(5,3,0),{doubleSpeed:!0,entrap:!0,teamPlayer:!0,chasePlayer:!0,humanoid:!0,warrior:!0},{},Material.BONE,5,10,AttackType.SLASHING,!1,"BUG","common",5),21,25),this.addRace(new Race("DRACONIAN_WIZARD","Draconian Wizard","","Telepathy + Fire disc: Ranged Attack",40,new Roll(13,6,0),new Roll(4,3,0),{teamPlayer:!0,chasePlayer:!0,humanoid:!0},{rangedAttack:{chance:80,range:2,accuracy:50,animation:{type:"FIREBALL",tileIndexes:[3,4,5]}},telepathy:!0},Material.FLESH,15,10,AttackType.BLUNT,!1,"MAGE","draconian",6),21,25),this.addRace(new Race("SHERTUL_1","Sher'Tul Derk","Ancient dweller of Eyal.","Yank + Fear",60,new Roll(14,6,0),new Roll(5,3,0),{unique:!0,charmResistant:!0,yankChance:80,fearless:!0,eyeless:!0,weakVsDarkness:!0,warrior:!0},{fear:{chance:80,range:3}},Material.ETHER,15,3,AttackType.PIERCING,!1,"BUG","eyal",0),21,25),this.addRace(new Race("SHERTUL_2","Sher'Tul Amak","Ancient dweller of Eyal.","Yank + Fear",61,new Roll(14,6,0),new Roll(5,3,0),{unique:!0,charmResistant:!0,yankChance:80,fearless:!0,eyeless:!0,weakVsDarkness:!0,warrior:!0},{fear:{chance:80,range:3}},Material.ETHER,15,3,AttackType.BLUNT,!1,"BUG","eyal",0),21,25),this.addRace(new Race("SHERTUL_3","Sher'Tul Gorddak","Ancient dweller of Eyal.","Yank + Fear",62,new Roll(14,6,0),new Roll(5,3,0),{unique:!0,charmResistant:!0,yankChance:80,fearless:!0,eyeless:!0,weakVsDarkness:!0,warrior:!0},{fear:{chance:80,range:3}},Material.ETHER,15,3,AttackType.BLUNT,!1,"BUG","eyal",0),21,25),this.addRace(new Race("SHERTUL_4","Sher'Tul Tolvert","Ancient dweller of Eyal.","Yank + Fear",63,new Roll(14,6,0),new Roll(5,3,0),{unique:!0,charmResistant:!0,yankChance:80,fearless:!0,eyeless:!0,weakVsDarkness:!0,warrior:!0},{fear:{chance:80,range:3}},Material.ETHER,15,3,AttackType.SLASHING,!1,"BUG","eyal",0),21,25),this.addRace(new Race("SLASH","Slash","The Guardian of the Ring","Warp + Entrap + Block",41,new Roll(1,1,339),new Roll(5,4,0),{warpChance:50,entrap:!0,canBlock:!0,charmResistant:!0,dropsRing:!0,unique:!0,chasePlayer:!0,humanoid:!0,weakVsDarkness:!0,boss:!0,warrior:!0},{},Material.FLESH,15,0,AttackType.SLASHING,!1,"SLASH","common",0),!1,!1),this.addRace(new Race("TOROLL","Toroll","A massive demonic creature.","",270,new Roll(20,7,0),new Roll(4,4,0),{chasePlayer:!0,noAnimation:!0,warrior:!0},{},Material.FLESH,15,0,AttackType.BLUNT,!1,"DARK","ugh",1),26,!1),this.addRace(new Race("XORNO","Xorno","A elemental of earth able to shift it's shape.","",271,new Roll(15,7,0),new Roll(4,4,0),{chasePlayer:!0,eyeless:!0,noAnimation:!0},{},Material.FLESH,15,0,AttackType.BLUNT,!1,"DARK","none",1),26,!1),this.addRace(new Race("PORPWORM","Porpworm","A gargantuan monster able to swallow whole and digest its victims within only a few minutes","",272,new Roll(20,7,0),new Roll(4,4,0),{chasePlayer:!0,eyeless:!0,noAnimation:!0},{},Material.FLESH,5,0,AttackType.BLUNT,!1,"DARK","none",1),26,!1),this.addRace(new Race("UMBEROLK","Umberolk","A powerful subterranean predator with iron-like claws. Muscles bulge beneath their thick, scaly hides.","",273,new Roll(15,7,0),new Roll(6,4,0),{chasePlayer:!0,noAnimation:!0},{},Material.FLESH,5,0,AttackType.BLUNT,!1,"DARK","wargh",1),26,!1),this.addRace(new Race("VOMPIRE","Vompire","A preternatural being of a malignant nature.","Bite: Reduces Health",274,new Roll(10,7,0),new Roll(4,4,0),{reduceMaxHPChance:40,chasePlayer:!0,humanoid:!0,weakVsLight:!0,noAnimation:!0,warrior:!0},{},Material.FLESH,20,5,AttackType.BLUNT,!1,"DARK","common",5),26,!1),this.addRace(new Race("DROGON","Drogon","A deadly winged demon, old as Earth.","Fireball: Ranged Attack",275,new Roll(20,7,0),new Roll(6,4,0),{fearless:!0,noAnimation:!0},{rangedAttack:{chance:70,range:3,accuracy:70,animation:{type:"ARROW",tileIndexes:[42,43,44]}}},Material.FLESH,5,10,AttackType.BLUNT,!1,"DARK","roar",3),26,!1),this.addRace(new Race("KITTEN","Lynx","Agile and unpredictable, transforms into powerful nimble creatures.","",1,new Roll(18,1,0),new Roll(1,2,0),{startingPet:!0,fingerless:!0,canMeow:!0,darkEvolution:"PANTHER",lightEvolution:"TIGER",teamPlayer:!0,panickLimit:20},{},Material.FLESH,15,0,AttackType.BITE,!1,"BEAST","meow",6),!1,!1),this.addRace(new Race("PANTHER","Panther","","Dash: Double movement speed.",2,new Roll(0,0,10),new Roll(0,0,5),{fingerless:!0,doubleSpeed:!0,darkEvolution:"PANTHER_DEMON",lightEvolution:"SABRETIGER",teamPlayer:!0,panickLimit:10},{},Material.FLESH,25,30,AttackType.BITE,!1,"BEAST","roar",5),!1,!1),this.addRace(new Race("TIGER","Tiger","","Twice: Attack 2 times",3,new Roll(0,0,15),new Roll(0,0,5),{fingerless:!0,doubleAttack:!0,darkEvolution:"SABRETIGER",lightEvolution:"TIGER_DEMON",teamPlayer:!0,panickLimit:10},{},Material.FLESH,10,20,AttackType.BITE,!1,"BEAST","roar",5),!1,!1),this.addRace(new Race("PANTHER_DEMON","Panther Demon","","Dash: Double movement speed.",4,new Roll(0,0,15),new Roll(0,0,5),{doubleSpeed:!0,teamPlayer:!0,humanoid:!0,warrior:!0},{},Material.FLESH,20,30,AttackType.SLASHING,!1,"HUMANOID","roar",7),!1,!1),this.addRace(new Race("SABRETIGER","Sabretooth Tiger","","Dash + Twice",5,new Roll(0,0,0),new Roll(0,0,0),{fingerless:!0,doubleSpeed:!0,doubleAttack:!0,teamPlayer:!0},{},Material.FLESH,10,60,AttackType.BITE,!1,"BEAST","roar",4),!1,!1),this.addRace(new Race("TIGER_DEMON","Tiger Demon","","Twice: Attack 2 times",6,new Roll(0,0,20),new Roll(0,0,5),{doubleAttack:!0,teamPlayer:!0,humanoid:!0,warrior:!0},{},Material.FLESH,15,30,AttackType.BITE,!1,"HUMANOID","roar",7),!1,!1),this.addRace(new Race("PUPPY","Dire Wolf","Resilient and loyal, transforms into nerve breaking creatures with special skills.","",7,new Roll(24,1,0),new Roll(1,2,0),{startingPet:!0,fingerless:!0,darkEvolution:"DARK_WOLF",lightEvolution:"LIGHT_WOLF",teamPlayer:!0,panickLimit:20},{},Material.FLESH,15,0,AttackType.BITE,!1,"BEAST","woof",8),!1,!1),this.addRace(new Race("DARK_WOLF","Dark Wolf","","Howl: Paralyzes Enemy",8,new Roll(0,0,20),new Roll(0,0,5),{fingerless:!0,darkEvolution:"HELL_HOUND",lightEvolution:"WOLF_DEMON",teamPlayer:!0,panickLimit:10},{paralyze:{chance:20,range:2,message:"Howwwwwl!",effectMessage:"Paralyzed"}},Material.FLESH,15,20,AttackType.BITE,!1,"BEAST","howl",8),!1,!1),this.addRace(new Race("LIGHT_WOLF","Light Wolf","","Attacks while covered.",9,new Roll(0,0,20),new Roll(0,0,5),{fingerless:!0,canAttackCovered:!0,darkEvolution:"WOLF_DEMON",lightEvolution:"DIVINE_HOUND",teamPlayer:!0,panickLimit:10},{},Material.FLESH,15,20,AttackType.BITE,!1,"BEAST","howl",8),!1,!1),this.addRace(new Race("HELL_HOUND","Hell Hound","","Howl: Paralyzes Enemy",10,new Roll(0,0,30),new Roll(0,0,5),{fingerless:!0,teamPlayer:!0,weakVsLight:!0},{paralyze:{chance:40,range:3,message:"Howwwwwl!",effectMessage:"Paralyzed"}},Material.FLESH,15,20,AttackType.BITE,!1,"BEAST","howl",8),!1,!1),this.addRace(new Race("WOLF_DEMON","Wolf Demon","A strong wolf-like creature","",11,new Roll(0,0,15),new Roll(0,0,15),{teamPlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.FLESH,15,0,AttackType.SLASHING,!1,"HUMANOID","howl",9),!1,!1),this.addRace(new Race("DIVINE_HOUND","Sky Hound","","Attacks while covered.",12,new Roll(0,0,30),new Roll(0,0,5),{fingerless:!0,canAttackCovered:!0,teamPlayer:!0,weakVsDarkness:!0},{},Material.FLESH,15,20,AttackType.BITE,!1,"BEAST","howl",8),!1,!1),this.addRace(new Race("PONY","Pony","","Allows you to carry 4 more items.",13,new Roll(50,1,0),new Roll(1,2,0),{startingPet:!0,walkRandomlyChance:20,fingerless:!0,carryBonus:4,darkEvolution:"HORSE",lightEvolution:"HORSE",panickLimit:30},{},Material.FLESH,5,5,AttackType.BLUNT,!1,"BEAST","horse",3),!1,!1),this.addRace(new Race("HORSE","Horse","","Allows you to carry 8 more items.",14,new Roll(0,0,20),new Roll(0,0,5),{walkRandomlyChance:20,fingerless:!0,carryBonus:8,darkEvolution:"BLACK_UNICORN",lightEvolution:"WHITE_UNICORN",panickLimit:30},{},Material.FLESH,5,5,AttackType.BLUNT,!1,"BEAST","horse",4),!1,!1),this.addRace(new Race("BLACK_UNICORN","Black Unicorn","The legendary horse of darkness.","Allows you to carry 8 more items.",43,new Roll(0,0,30),new Roll(0,0,5),{walkRandomlyChance:20,fingerless:!0,carryBonus:8,teamPlayer:!0,weakVsLight:!0},{},Material.FLESH,10,5,AttackType.BLUNT,!1,"BEAST","horse",6),!1,!1),this.addRace(new Race("WHITE_UNICORN","White Unicorn","The legendary horse of light.","Allows you to carry 8 more items.",44,new Roll(0,0,30),new Roll(0,0,5),{walkRandomlyChance:20,fingerless:!0,carryBonus:8,teamPlayer:!0,weakVsDarkness:!0},{},Material.FLESH,10,5,AttackType.BLUNT,!1,"BEAST","horse",6),!1,!1),this.addRace(new Race("SHEEP","Sheep","","",45,new Roll(8,1,0),new Roll(1,1,0),{startingPet:!0,fingerless:!0,panickLimit:60},{},Material.FLESH,5,0,AttackType.BITE,!1,"BEAST","mee",3),!1,!1),this.addRace(new Race("FROG","Giant Frog","","Spit Acid: Ranged Attack",56,new Roll(16,1,0),new Roll(1,2,0),{startingPet:!0,fingerless:!0,teamPlayer:!0,panickLimit:30},{rangedAttack:{chance:80,range:3,accuracy:80,animation:{type:"ARROW",animationId:"frogAcid",tileIndexes:[51,52,53],speed:80,yOffset:8}}},Material.FLESH,5,5,AttackType.BITE,!1,"BUG","wagga",5),!1,!1),this.addRace(new Race("KOD_1","The Chad","Evil is all you see on his eyes.","Parry + Block",74,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_2","Felipe","A member of the order of Darkness","Parry + Block",75,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_3","Nikad","A member of the order of Darkness","Parry + Block",76,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_4","Scarvye","A servant of darkness with a battle-scarred visage.","Parry + Block",77,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_5","The Unseen","The intentions of this mysterious agent are unknown.","Parry + Block",78,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_6","Paul","A member of the order of Darkness.","Parry + Block",73,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_7","Hugo Falcandus","Keeps an account of all misdeeds in the world.","Parry + Block",79,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_I","Jack Bonar","A woebegone knight raised in the nefarious barony of Shadyside.","Parry + Block",71,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,canBlock:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_8","Sir Jerpe","Servicer of shadows, portable holes.","Parry",80,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_9","Maxwell Sebastian","A former artist corrupted by Darkness.","Parry",81,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_A","James the Depraved","A member of the order of Darkness.","Parry",82,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_B","Glitched","A Knight corrupted by a powerful glitch in the game.","Parry",83,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_DON","Don Tomas","A middle aged knight with a meticulously groomed moustache and goatee.  Slender and agile for his age.","Parry",72,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_C","Durrok","A member of the order of Darkness.","Parry",84,new Roll(6,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),10,25),this.addRace(new Race("KOD_D","Hadria","A member of the order of Darkness.","Parry",85,new Roll(7,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),13,25),this.addRace(new Race("KOD_E","Tir-Mordreth","A member of the order of Darkness.","Parry",86,new Roll(7,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{},Material.ETHER,15,0,AttackType.SLASHING,!1,"KNIGHT","common",0),13,25),this.addRace(new Race("KOD_F","Brask Mumei","Expelled from the Cult of Darkness for excessive drunkenness.","Parry + Fireball",87,new Roll(8,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{rangedAttack:{chance:50,range:4,accuracy:50,animation:{type:"FIREBALL",tileIndexes:[3,4,5]}}},Material.ETHER,15,10,AttackType.SLASHING,!1,"KNIGHT","common",0),15,25),this.addRace(new Race("KOD_G","Myssil","A member of the order of Darkness.","Parry + Fireball",88,new Roll(8,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{rangedAttack:{chance:50,range:4,accuracy:50,animation:{type:"FIREBALL",tileIndexes:[3,4,5]}}},Material.ETHER,15,10,AttackType.SLASHING,!1,"KNIGHT","common",0),15,25),this.addRace(new Race("KOD_H","Lucifuge","A high ranking officer in service to the Cult of Darkness.","Parry + Fireball",89,new Roll(8,9,0),new Roll(2,8,3),{canParry:!0,unique:!0,charmResistant:!0,chasePlayer:!0,humanoid:!0,weakVsLight:!0,warrior:!0},{rangedAttack:{chance:50,range:4,accuracy:50,animation:{type:"FIREBALL",tileIndexes:[3,4,5]}}},Material.ETHER,15,10,AttackType.SLASHING,!1,"KNIGHT","common",0),15,25),this.addRace(new Race("RAT_DEMON","Rat Guardian","","Dash: Double movement speed.",64,new Roll(32,6,4),new Roll(2,2,1),{doubleSpeed:!0,charmResistant:!0,fearless:!0,humanoid:!0,weakVsLight:!0,boss:!0,warrior:!0},{},Material.FLESH,15,20,AttackType.BITE,!1,"HUMANOID","squeek",0),!1,!1),this.addRace(new Race("LIZARD","Lizard Guardian","","Summon Skeletons, Mirage: Causes Confusion",65,new Roll(32,6,0),new Roll(3,6,1),{charmResistant:!0,summonChance:50,summonEnemy:"SKELETON",summonMax:3,confuseChance:20,confuseRange:3,confuseTurns:20,fearless:!0,humanoid:!0,boss:!0,warrior:!0},{},Material.FLESH,15,3,AttackType.BLUNT,!1,"MAGE","hiss",0),!1,!1),this.addRace(new Race("MERMAID_QUEEN","Mermaid Guardian","The queen of the underground lagoon.","Charming Song",66,new Roll(40,6,0),new Roll(4,4,0),{charmResistant:!0,confuseChance:50,confuseRange:4,confuseTurns:20,fearless:!0,humanoid:!0,weakVsDarkness:!0,boss:!0,warrior:!0},{},Material.FLESH,15,5,AttackType.PIERCING,!1,"TAILOID","common",0),!1,!1),this.addRace(new Race("OPHIDIAN_GUARDIAN","Ophidian Guardian","The strongest warrior of the Ophidian race.","Ancient Bow: Ranged attack",67,new Roll(48,6,0),new Roll(4,6,0),{charmResistant:!0,fearless:!0,humanoid:!0,boss:!0,warrior:!0},{rangedAttack:{chance:80,range:5,accuracy:70,requiresLoading:!0,loadingMessage:"Nock Arrow",animation:{type:"ARROW",tileIndex:69},requiresDistance:!0}},Material.FLESH,5,20,AttackType.PIERCING,!1,"TAILOID","hiss",0),!1,!1),this.addRace(new Race("DEMON_GUARDIAN","Demon Guardian","","Warp + Entrap",68,new Roll(60,6,0),new Roll(5,3,6),{charmResistant:!0,warpChance:50,entrap:!0,fearless:!0,humanoid:!0,weakVsLight:!0,boss:!0,warrior:!0},{},Material.ETHER,5,20,AttackType.SLASHING,!1,"KNIGHT","common",0),!1,!1),this.addRace(new Race("AILORUS_SAGE","Ailorus Sage","A mysterious feline full of knowledge.","",57,new Roll(48,4,0),new Roll(3,6,0),{charmResistant:!0,fearless:!0,humanoid:!0,friendly:!0},{},Material.FLESH,5,20,AttackType.BLUNT,!1,"HUMANOID","common",0),!1,!1),this.addRace(new Race("GLENN","Human Warrior",".","",58,new Roll(48,4,0),new Roll(3,6,0),{charmResistant:!0,fearless:!0,humanoid:!0,friendly:!0},{},Material.FLESH,5,20,AttackType.BLUNT,!1,"HUMANOID","common",0),!1,!1)}module.exports=MonsterFactory;var Race=require("./Race.class.js"),Enemy=require("./Enemy.class.js"),Roll=require("./Roll.class.js"),Stat=require("./Stat.class"),AttackType=require("./AttackType.enum"),Material=require("./Material.enum");MonsterFactory.prototype={createMonster:function(e,a,n,t){var r=this.races[a];r.features.unique&&(e.uniqueRegistry[a]=!0);var l=new Enemy(this.gameController,r);if(n&&n>25){var i=5*(n-25),o=2*(n-25);l.hitPoints.extend(i),l.attack=new Stat(o)}return e.hardcoreMode&&!t&&l.hitPoints.multiply(2),l},getEcosystem:function(e){var a=this.ecosystem[e];return a||[]},getOpenEcosystem:function(){return this.openEcosystem},getRace:function(e){return this.races[e]},addRace:function(e,a,n){if(this.races[e.code]=e,a)if(n)for(var t=a;t<=n;t++)this.ecosystem[t]||(this.ecosystem[t]=new Array),this.ecosystem[t].push(e.code);else this.openEcosystem.push(e.code);var r=this.racesByAnatomy[e.anatomy];r||(r=[],this.racesByAnatomy[e.anatomy]=r),r.push(e)},getSimilarRace:function(e){var a=this.racesByAnatomy[e.anatomy];return!!a&&randomElementOf(a)},canCreate:function(e,a,n){return!this.races[a].features.unique||n&&!e.uniqueRegistry[a]},randomSpecies:function(){var e=null;do{e=randomElementOf(this.getEcosystem(rand(1,25)));var a=this.races[e]}while(a.features.unique);return e}};

},{"./AttackType.enum":5,"./Enemy.class.js":11,"./Material.enum":19,"./Race.class.js":26,"./Roll.class.js":27,"./Stat.class":32}],21:[function(require,module,exports){
function MusicController(e,s){this.gameController=e,this.musicEnabled=s,this.loadingMusic={}}module.exports=MusicController;var DUNGEON_TRACKS=["temple","caves","lagoon","lair"];MusicController.prototype.init=function(){this.gameController.phaser},MusicController.prototype.playDungeonMusic=function(){if(this.gameController.gameActive&&this.gameController.player&&!this.gameController.player.dead&&(!this.currentMusic||!this.currentMusic.isPlaying)){var e=randomElementOf(DUNGEON_TRACKS);this.playMusic(e),this.gameController.phaser.time.events.add(24e4,this.playDungeonMusic,this)}},MusicController.prototype.playMusic=function(e,s){if(this.gameController.preferences.soundEnabled)if(this.musicEnabled){if(this.currentMusicKey!=e||s){this.currentMusic&&this.stopMusic();var i=this.gameController.phaser,t=this;if(this.currentMusicKey=e,!this.loadingMusic[e]){var r="title"===e;this.loadingMusic[e]=!0,i.load.reset(!0,!1),i.load.audio("music-"+e,this.getFiles(e)),i.load.onLoadComplete.add(function(){var s=i.add.audio("music-"+e,.7);t.currentMusic=s,i.sound.setDecodedCallback("music-"+e,function(){this==t.currentMusicKey?t.currentMusic&&t.currentMusic.play("",0,.2,r):(s.destroy(),t.gameController.phaser.cache.checkSoundKey(this)&&t.gameController.phaser.cache.removeSound(this)),t.loadingMusic[e]=!1},e),i.load.onLoadComplete.removeAll()}),i.load.start()}}}else this.wantedToPlay=e},MusicController.prototype.getFiles=function(e){switch(e){case"title":return["music/theLegendOfAnanias.ogg","music/theLegendOfAnanias.mp3"];case"temple":return["music/descendingIntoDarkness.ogg","music/descendingIntoDarkness.mp3"];case"caves":return["music/decayingLife.ogg","music/decayingLife.mp3"];case"lagoon":return["music/dropsOfDoom.ogg","music/dropsOfDoom.mp3"];case"lair":return["music/mastersOfTime.ogg","music/mastersOfTime.mp3"];case"intro":return["music/destructionOfKramora.ogg","music/destructionOfKramora.mp3"]}},MusicController.prototype.stopMusic=function(){this.currentMusic&&(this.currentMusic.stop(),this.currentMusic.destroy(),this.currentMusic.isDecoded&&this.gameController.phaser.cache.removeSound("music-"+this.currentMusicKey),this.currentMusic=null,this.wantedToPlay=this.currentMusicKey,this.currentMusicKey=!1)},MusicController.prototype.switchMusic=function(){this.musicEnabled=!this.musicEnabled,this.musicEnabled?(this.currentMusicKey?this.playMusic(this.currentMusicKey,!0):this.wantedToPlay&&this.playMusic(this.wantedToPlay),this.gameController.preferences.musicEnabled=!0):(this.stopMusic(),this.gameController.preferences.musicEnabled=!1),this.gameController.savePreferences()};

},{}],22:[function(require,module,exports){
function NPCBuilder(){this.generatedByLevel=new Array,this.npcDefinitions=new Array,this.initializeDefinitions()}module.exports=NPCBuilder,NPCBuilder.prototype.getLevelNPCs=function(e){for(var n=new Array,o=0;o<this.npcDefinitions.length;o++)for(var a=this.npcDefinitions[o],t=0;t<a.spawns.length;t++)a.spawns[t].level==e&&n.push(a);return n},NPCBuilder.prototype.initializeDefinitions=function(){this.npcDefinitions.push({code:"ADAM",race:"AILORUS_SAGE",name:"Adam",followPlayer:!1,spawns:[{level:1,dialog:["You see the faint spirit of a feline creature wielding a staff topped by a crescent shapped gem.\n\nIt has been staring at you since the moment you entered the room.","Hail traveler! I am known as Adam.\n\nI am the last Guardian of the Tombs. Since milennia, it has been my ancestor's duty to keep the safety of the ancient relics of Ananias.","The world is in peril now! The destruction of Kramora has been unleashed, and nothing can stand on its path!","Will you be brave and powerful enough to retrieve the ring of Ananias? I will not stand in your way, but I must warn you... You will face perils like nothing you have seen in your life.","I hope we can meet later... if you manage to survive.","Gradually, the spectre disappears until you can not see him anymore."],onDialogEnd:[{key:"LEAVE_ROOM"}]},{level:5,dialog:["You still live, I am surprised.","You must know that the power of Kramora has given life to particularily powerful monsters which are now guarding the way to the Darkness Abyss.","This potion is one of the rarest concoctions of Alchemy, it will transform a monster into a more powerful being through the powers of darkness and light.","Please take it with you, it may be very helpful. We will meet again... if you still live.","Gradually, the spectre disappears until you can not see him anymore."],onDialogEnd:[{key:"GIVE_EVOLVE_POTION"},{key:"LEAVE_ROOM"}]},{level:10,dialog:["Few people have reached this place in hundreds of years.","This is the last known potion of metamorphosis, it can make your monster even stronger.","We will not see each other again... the powers ruling the depths below are too strong for me to manifest physically. I wish you success!","Gradually, the spectre disappears until you can not see him anymore."],onDialogEnd:[{key:"GIVE_EVOLVE_POTION"},{key:"LEAVE_ROOM"}]}]},{code:"GLENN",race:"GLENN",name:"Glenn",followPlayer:!1,spawns:[{level:2,dialog:["You see a warrior in light leather armor wearing a crossbow.","Greetings, I am Glenn Wichman... I came here to find the Ring of Ananias and avenge the destruction of my city.","May your sword be strong and you can stand against the evil creatures that dwell here."],onDialogEnd:[{key:"LEAVE_ROOM"}]},{level:7,dialog:["I am glad to see you still live... here, please take this crossbow, it may be useful in the worlds ahead. There are plenty of bolts around, but they are no good without a proper crossbow!","I'll see you around... don't die!"],onDialogEnd:[{key:"GIVE_CROSSBOW"},{key:"LEAVE_ROOM"}]}]})};

},{}],23:[function(require,module,exports){
function PhaserTextField(t){this.phaser=t;var e=document.createElement("div");e.style.position="absolute",e.style.top=0,e.style.left=0,document.body.appendChild(e),this.container=e,this.components=[];var i=this;window.addEventListener("resize",function(){setTimeout(function(){i._relocateComponents()},100)}),this.defaultDisableVisibilityChange=this.phaser.stage.disableVisibilityChange}module.exports=PhaserTextField,PhaserTextField.prototype={create:function(t,e,i,s,n,o){var h=o.cssClass,l=o.type,a=document.createElement("input");l&&a.setAttribute("type",l),o.onBlur&&a.addEventListener("blur",o.onBlur),a.setAttribute("autocomplete","new-password"),a.style.visibility="hidden",a.style.position="absolute",a.ptf_top=i,a.ptf_left=e,a.ptf_width=s,a.ptf_height=n,a.id=t,h&&(a.className=h),o.maxLength&&(a.maxLength=o.maxLength),this.container.appendChild(a),this.components.push(a),this._relocateComponents(),a.style.visibility="visible",this.phaser.stage.disableVisibilityChange=!0},getValue:function(t){return this._get(t).value},destroy:function(t){for(var e=0;e<this.components.length;e++){if(this.components[e].id==t){this.components.splice(e,1);break}}this.container.removeChild(this._get(t)),0==this.components.length&&(this.phaser.stage.disableVisibilityChange=this.defaultDisableVisibilityChange)},_relocateComponents:function(){for(var t=this.phaser.canvas.offsetTop,e=this.phaser.canvas.offsetLeft,i=this.phaser.scale.scaleFactorInversed.x,s=this.phaser.scale.scaleFactorInversed.y,n=0;n<this.components.length;n++){var o=this.components[n];o.style.top=o.ptf_top*s+t+"px",o.style.left=o.ptf_left*i+e+"px",o.style.width=o.ptf_width*i+"px",o.style.height=o.ptf_height*s+"px",o.style.fontSize=(o.ptf_height-2)*s+"px"}},hideAll:function(){for(var t=0;t<this.components.length;t++)this.components[t].style.visibility="hidden"},showAll:function(){for(var t=0;t<this.components.length;t++)this.components[t].style.visibility="visible"},_get:function(t){return document.getElementById(t)}};

},{}],24:[function(require,module,exports){
var circular=require("circular-functions"),ActionValidator=require("./ActionValidator"),Spells=require("./Spells"),Text=require("./Text"),Skills=require("./Skills"),Entity=require("./Entity"),Achievements=require("./AchievementsManager"),Upgrades=require("./Upgrades");function Player(e){this.gameController=e,this.powerLevel=1,this.items=[],this.uniqueRegistry={_c:circular.setSafe()},this.x=0,this.y=0,this.currentWeapon=null,this.currentArmor=null,this.currentLegwear=null,this.currentArmwear=null,this.currentFootwear=null,this.currentHelmet=null,this.currentShield=null,this.isFriendly=!0,this._c=circular.register("Player"),this.facingLeft=!0,this.kills=0,this.levelKills=0,this.exploredRoomsMap={_c:circular.setSafe()},this.exploredLevelRooms=0,this.MAX_CARRY_CAPACITY=30,this.MAX_SPELLS=8,this.isRunning=!1,this.hasRune=!1,this.magicPoints=void 0,this.spells=[],this.circles={_c:circular.setSafe(),ELEMENTAL:0,LIFE:0,MATTER:0,MIND:0,WITCHCRAFT:0,NONE:0},this.currentTactic="BAL",this.stats={_c:circular.setSafe(),perLevel:[],misses:0,hits:0,killMap:{},conducts:{noScrollsUsed:!0,noSpellsUsed:!0,noPotionsUsed:!0,noBandagesUsed:!0,noWeaponsUsed:!0,noArmorUsed:!0,noKills:!0,noRoomUnexplored:!1},challenges:{achieved:{},failed:{},counters:{}},gameplaySeconds:0},this.usedUpgrades={_c:circular.setSafe(),HP:0,MP:0,COMBAT:0,MAGIC_POWER:0,STRENGTH:0}}module.exports=Player;var Stat=require("./Stat.class"),Roll=require("./Roll.class"),Material=require("./Material.enum"),CellType=require("./CellType.enum"),Util=require("./Util");circular.registerClass("Player",Player,{transients:{gameController:!0,portraitSprite:!0,sprite:!0},reviver:function(e,t){e.gameController=t.gameController;var r=e.gameController;r.player=e;for(var i=0;i<e.items.length;i++){var s=e.items[i];r.addItemToRoom(s),r.addItemToInventory(s)}e.rebuildPortraitSprite(),e.stats&&!e.stats.challenges&&(e.stats.challenges={achieved:{},failed:{},counters:{}}),e.usedUpgrades||(e.usedUpgrades={_c:circular.setSafe(),HP:0,MP:0,COMBAT:0,MAGIC_POWER:0,STRENGTH:0})}}),Player.prototype={setPet:function(e){this.pet=e,this.petAway=!1,e.awayTurns=0,this.pet.isFriendly=!0,e.attack||(this.pet.attack=new Stat(1)),e.magicPower||(this.pet.magicPower=new Stat(1)),e.powerLevel||(this.pet.powerLevel=1),this.gameController.petLifeBar.setStat(e.hitPoints),this.gameController.selectPetCommand("FOL",!0)},isRangedAttack:function(){return this.currentWeapon&&this.currentWeapon.features.ranged},interactWith:function(e){var t=flatDistance(this.x,this.y,e.x,e.y),r=this.isRangedAttack();1===t||r?e.isFriendly&&!this.isConfused()?1===t?this.attackConfused()?this.doAttack(e):e==this.pet||e.isSummon?this.switchPlaces(e):this.recoverPet(e):this.walkTo(e):this.doAttack(e):this.walkTo(e)},recoverPet:function(e){this.pet&&(this.gameController.showTextBy(this.pet,"Left"),this.pet.command="ATK"),this.setPet(e),this.gameController.showTextBy(e,"Join"),this.stopRunning(),this.gameController.updatePetStats(),this.gameController.logEvent("Input enabled, recoverPet"),this.gameController.enablePlayerAction()},recoverPetOnRoomEnter:function(e){this.pet&&(this.gameController.showTextBy(this.pet,"Left"),this.pet.command="ATK"),this.setPet(e),this.gameController.updatePetStats()},switchPlaces:function(e){this.dungeonLevel.isRetro||(e.x<this.x?(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0),e.facingLeft&&(e.sprite.scale.x*=-1,e.facingLeft=!1)):e.x>this.x&&(this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1),e.facingLeft||(e.sprite.scale.x*=-1,e.facingLeft=!0))),this.stopRunning();var t={x:e.x,y:e.y};e.x=this.x,e.y=this.y,this.x=t.x,this.y=t.y,this.currentRoom.sortMonsters(),this.checkItemBelow();var r=32*e.x+16,i=32*e.y+this.gameController.YOFFSET;e.placementOffset&&(e.placementOffset=!1);var s=32*this.x+16,n=32*this.y+this.gameController.YOFFSET;if(this.currentRoom.isSafe())e.sprite.x=r,e.isFloating()?e.sprite.baseY=i:e.sprite.y=i,this.sprite.x=s,this.isFloating()?this.sprite.baseY=n:this.sprite.y=n,this.endTurn();else{this.gameController.getBezierTween(e.sprite,e.sprite.x,e.getBaseSpriteY(),r,i,!1,!1,!1,!1,!0,!1,e.isFloating());var o=this.gameController.getBezierTween(this.sprite,this.sprite.x,this.sprite.y,s,n);o.onComplete.add(this.endTurn,this),this.gameController.startTween(this.sprite,o)}},interactWithNPC:function(e){this.gameController.showConversation(e),this.gameController.logEvent("Input enabled, interactWithNPC"),this.gameController.enablePlayerAction()},interactWithPond:function(){if(this.gameController.disablePlayerAction(),this.currentRoom.getCell(this.x,this.y).equals(CellType.HEALING_POND))if(this.currentRoom.hasPond&&!this.currentRoom.isPondUsed){this.gameController.playSFX("potion"),this.gameController.pondSprite.animations.play("shine",8,!0);var e=this;this.gameController.phaser.time.events.add(1e3,function(){e.currentRoom.isPondUsed=!0,e.gameController.resetPond();var t=rand(0,9);if(9==t)e.immuneToDisease()?(e.gameController.showTextBy(e,"Ugh...",null,"GREEN"),e.gameController.useInspector(e.sprite,"Fountain","The water is tainted, but you are unharmed.",!0)):(e.gameController.showTextBy(e,"Sick...",null,"GREEN"),e.gameController.useInspector(e.sprite,"Fountain","The water is tainted, you feel weaker.",!0),e.attack.reduce(1));else if(8==t){var r=rand(5,15);e.gameController.showTextBy(e,"+"+r,null,"RED",!1,!0),e.hitPoints.extend(r),e.gameController.useInspector(e.sprite,"Fountain","The water makes you feel more alive!",!0)}else 7==t?(e.gameController.showTextBy(e,"Stronger!"),e.gameController.useInspector(e.sprite,"Fountain","The water makes you feel stronger!",!0),e.attack.extend(1)):t>=5?(e.hitPoints.replenish(),e.gameController.showTextBy(e,"Refreshing!"),e.gameController.useInspector(e.sprite,"Fountain","The water recovers all of your health!",!0)):(e.heal(rand(20,40)),e.gameController.useInspector(e.sprite,"Fountain","The water recovers some of your health!",!0));e.endTurn()})}else this.endTurn();else{this.gameController.knows.pond||(this.gameController.showDenziMessage("Healing Ponds","These ponds replenish your health."),this.gameController.setKnows("pond"));var t=this.currentRoom.pondPosition;if(this.currentRoom.isSafe())flatDistance(this.x,this.y,t.x,t.y)>1&&this.canWarp()?this.warpTo(t,function(){this.gameController.logEvent("Input enabled, warpTo Pond"),this.gameController.enablePlayerAction(!0)},this):this.walkTo(t);else this.walkTo(t)}},hasRangedWeapon:function(){return this.currentWeapon&&this.currentWeapon.isRangedWeapon()&&!this.currentWeapon.remainingUses.empty()},useItem:function(e,t,r){this.useItemOn(e,!1,t,r)},useItemOn:function(e,t,r,i){var s=this;e.use(this,t,function(e){r&&r(e),s.stopRunning(),s.dead||(s.gameController.updatePlayerStats(!1),(e||i)&&s.endTurn()),s.gameController.setKnows("useItems")})},useSpell:function(e,t){this.useSpellOn(e,!1,t)},prevalidateUseItem:function(e){if(e.onUse)if(e.features.magicSpell&&!this.tryReading("scroll"));else{if(!e.features.advancedMagic||this.isMagicExpert())return!0;this.gameController.showTextBy(this,"How?"),this.gameController.showMessageInPanel("You don't understand this spell.")}else this.gameController.showTextBy(this,"Useless"),this.gameController.showMessageInPanel("This item is useless.");return this.gameController.playSFX("beep"),!1},prevalidateCastSpell:function(e){if(e.features.advancedMagic&&!this.isMagicExpert())return this.gameController.showTextBy(this,"How?"),this.gameController.showMessageInPanel("You don't understand this spell."),this.gameController.playSFX("beep"),!1;if(0===this.magicPower.current)return this.gameController.showTextBy(this,"No Magic"),this.gameController.showMessageInPanel("You don't have any magic power."),this.gameController.playSFX("beep"),!1;if(this.features.hexSpells){var t=this.getMPCost(e);if(this.pet&&(t=Math.ceil(t/2)),this.hitPoints.current<=t)return this.gameController.showTextBy(this,"Life Low"),this.gameController.showMessageInPanel("Casting that spell would cost your life."),this.gameController.playSFX("beep"),!1}else if(this.magicPoints.current<this.getMPCost(e))return this.gameController.showTextBy(this,"MP Low"),this.gameController.showMessageInPanel("You don't have enough magic points."),this.gameController.playSFX("beep"),!1;return!0},getMPCost:function(e){var t=e.mpCost;return this.pumpMagic()?t*=2:this.saveMana()&&(t=Math.round(t/2)),t},useSpellOn:function(e,t,r){if(this.prevalidateCastSpell(e)){if(t){if(e.features.applyClose&&!this.canUseItemOnTarget(t))return this.gameController.showTextBy(this,"Too far!"),this.gameController.playSFX("beep"),void(r&&r(!1))}else t=this;if(e.features.advancedMagic&&!this.isMagicExpert())return this.gameController.showTextBy(this,"How?"),this.gameController.showMessageInPanel("You don't understand this spell."),this.gameController.playSFX("beep"),void(r&&r(!1));var i=this.getMPCost(e);if(this.features.hexSpells&&this.pet&&(i=Math.ceil(i/2)),this.features.hexSpells){if(this.hitPoints.current<i)return this.gameController.showTextBy(this,"Life Low"),this.gameController.showMessageInPanel("Casting this spell would kill you."),this.gameController.playSFX("beep"),void(r&&r(!1))}else if(this.magicPoints.current<i)return this.gameController.showTextBy(this,"MP Low"),this.gameController.showMessageInPanel("You don't have enough magic points."),this.gameController.playSFX("beep"),void(r&&r(!1));var s=e.effect;if(ActionValidator[s]&&!ActionValidator[s](this,t,e))return this.gameController.playSFX("beep"),void(r&&r(!1));this.features.hexSpells?(this.pet&&this.pet.takeDamageAndCheck(3),this.selfDamage(i)):this.magicPoints.reduce(i),this.stats.conducts.noSpellsUsed=!1,Spells.castSpell(this,t,e,r)}else r&&r(!1)},tryUseUnderlyingItem:function(e){var t=this.currentRoom.getItem(this.x,this.y);if(t)if(t.canUseInGround()){var r=this;this.useItem(t,function(i){i?(r.currentRoom.removeItem(t),r.gameController.removeItemFromRoom(t),e&&e(!0)):e&&e(!1)})}else e&&e(!1);else e&&e(!1)},interactWithItem:function(e){if(this.gameController.disablePlayerAction(),e.x===this.x&&e.y===this.y)this.canPickUp(e)||e.features.noWeight||"wield"===e.onUse&&this.canWield(e)&&!this.currentWeapon?this.pickup(e):(this.gameController.showTextBy(this,"Inventory Full."),this.gameController.showMessageInPanel("You can't carry more items."),this.gameController.logEvent("Input enabled, interactWithItem cannot pickup"),this.gameController.enablePlayerAction(),this.gameController.playSFX("beep"));else if(this.currentRoom.isSafe()){flatDistance(this.x,this.y,e.x,e.y)>1&&this.canWarp()?this.warpTo(e,function(){this.gameController.logEvent("Input enabled, warp to item"),this.gameController.enablePlayerAction(!0)},this):this.walkTo(e)}else this.walkTo(e)},pickup:function(e){if(this.stopRunning(),e.onPickup)"getStatue"===e.onPickup?this.gameController.communityClient.isEnabled()?(this.gameController.showTextBy(this,"Got Statue"),this.gameController.playSFX("magic"),this.gameController.particleAnimationAt("wizardry",this),this.currentRoom.removeItem(e),this.gameController.removeItemFromRoom(e),this.gameController.showDenziMessage(e.description,"You can check your statue collection on the main menu."),this.gameController.communityClient.addStatueToPlayer(e.statueIndex),this.endTurn()):(this.gameController.showTextBy(this,"..."),this.gameController.showDenziMessage(e.description,"You must connect to Ananias Server to save it in your collection."),this.endTurn(!0)):"setRune"===e.onPickup&&(this.hasRune=!0,this.gameController.showTextBy(this,"Got Rune"),this.gameController.playSFX("magic"),this.currentRoom.removeItem(e),this.gameController.removeItemFromRoom(e),this.endTurn(!0));else{if(this.gameController.playSFX("tap"),this.currentRoom.removeItem(e),this.gameController.removeItemFromRoom(e),e.alreadyPickedUp||this.gameController.communityClient.itemEvent(this.className,e.description),"arrows"===e.code||"bolts"===e.code||"pebbles"===e.code){var t=e.quantity,r=!1;if(this.currentWeapon&&this.currentWeapon.type===e.features.reloadWeaponType?r=this.currentWeapon:this.previousWeapon&&this.previousWeapon.type===e.features.reloadWeaponType&&(r=this.previousWeapon),r&&(r.ammo=e,t>r.remainingUses.getRemaining()?(t-=r.remainingUses.getRemaining(),r.remainingUses.replenish()):(r.remainingUses.increase(t),t=0)),t>0){var i=this._getAvailableStackCapacity(e.code);t>i?(this._stashAmmo(i,e.code),t-=i,e.quantity=t):(this._stashAmmo(t,e.code),t=0)}if(t<=0)return this.gameController.showTextBy(this,"Pick up"),Achievements.achievePickup(e,this),e.alreadyPickedUp||(e.alreadyPickedUp=!0),void this.endTurn()}this.items.push(e),this.items.sort(function(e,t){return e.inventorySort==t.inventorySort?e.code==t.code?0:e.code>t.code?1:-1:e.inventorySort-t.inventorySort}),this.gameController.addItemToInventory(e),this.gameController.setKnows("pickUpItems"),this.gameController.knows.checkInventory||this.gameController.showDenziMessage("Inventory",this.gameController.upperTapVerb+" the Items button to check your items."),"wield"===e.onUse&&this.canWield(e)&&(this.currentWeapon||e.features.twoHanded&&!this.canWieldTwoHanded()?this.previousWeapon||(this.previousWeapon=e):(this.currentWeapon=e,this.gameController.updatePlayerStats(!1))),this.gameController.showTextBy(this,"Pick up"),Achievements.achievePickup(e,this),e.alreadyPickedUp||(e.alreadyPickedUp=!0),this.endTurn()}},canWield:function(e){switch(e.type){case"BOW":return this.features.canUseBows;default:return!0}},addToInventory:function(e){this.items.push(e),this.items.sort(function(e,t){return e.inventorySort==t.inventorySort?e.code==t.code?0:e.code>t.code?1:-1:e.inventorySort-t.inventorySort}),this.gameController.addItemToInventory(e)},getRandomItem:function(){return 0!=this.items.length&&this.items[rand(0,this.items.length-1)]},getItemByCode:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].code===e)return this.items[t];return!1},countItemsByCode:function(e){for(var t=0,r=0;r<this.items.length;r++){var i=this.items[r];i.code===e&&(i.quantity?t+=i.quantity:t++)}return t},countItemsByType:function(e){for(var t=0,r=0;r<this.items.length;r++){var i=this.items[r];i.type===e&&(i.quantity?t+=i.quantity:t++)}return t},hasItem:function(e){for(var t=this.gameController.player.items,r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},removeItem:function(e){e==this.currentArmor&&(this.currentArmor=null),e==this.currentArmwear&&(this.currentArmwear=null),e==this.currentLegwear&&(this.currentLegwear=null),e==this.currentFootwear&&(this.currentFootwear=null),e==this.currentHelmet&&(this.currentHelmet=null),e==this.currentShield&&(this.currentShield=null),e==this.currentWeapon&&(this.currentWeapon=null),e==this.previousWeapon&&(this.previousWeapon=null,this.gameController.switchButtonGroup.visible=!1),this.items.removeObject(e),this.gameController.removeItemFromInventory(e)},isTrapped:function(){for(var e=-1;e<=1;e++)for(var t=-1;t<=1;t++){var r=this.currentRoom.getEnemy(this.x+e,this.y+t);if(r&&!r.isFriendly&&r.race.features.entrap)return!0}return!1},interactWithSelf:function(){this.reloadWeapon()||this.endTurn()},reloadWeapon:function(){if(this.currentWeapon&&this.currentWeapon.features.ammoType&&this.currentWeapon.remainingUses.notFull()){var e=this.getItemByCode(this.currentWeapon.features.ammoType);if(e)return this.useItem(e),!0;this.gameController.showTextBy(this,"No ammo left.")}return!1},stopRunning:function(){this.runningDirection=!1,this.isRunning=!1},compatibleRunningDirection:function(e){if(e.x==this.runningDirection.x&&e.y==this.runningDirection.y)return!0;var t=getAlternateDirections(this.runningDirection);return e.x==t.a1.x&&e.y==t.a1.y||e.x==t.a2.x&&e.y==t.a2.y},walkTo:function(e,t){if(e.x==this.x&&e.y==this.y)return this.interactWithSelf(),void this.stopRunning();if(this.isTrapped()||this.isOverburdened()){var r=this.isTrapped()?"TRAPPED!":"OVERBURDENED.";return this.gameController.showTextBy(this,r),t?t():(this.gameController.logEvent("Input enabled, walkTo cannot walk"),this.gameController.enablePlayerAction()),void this.stopRunning()}this.gameController.playSFX("step"),this.dungeonLevel.isRetro||(e.x>this.x?this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1):e.x<this.x&&(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0)));var i=direction(this,e);if(!this.currentRoom.canWalkTo(this.x+i.x,this.y+i.y)){var s=getAlternateDirections(i);if(this.currentRoom.canWalkTo(this.x+s.a1.x,this.y+s.a1.y))i=s.a1;else{if(!this.currentRoom.canWalkTo(this.x+s.a2.x,this.y+s.a2.y))return t?t():(this.gameController.logEvent("Input enabled, bump!!"),this.gameController.enablePlayerAction()),void this.stopRunning();i=s.a2}}this.x+=i.x,this.y+=i.y,this.currentRoom.sortMonsters(),this.checkItemBelow(),this.isRunning?this.compatibleRunningDirection(i)||this.stopRunning():this.runningDirection&&this.compatibleRunningDirection(i)&&(this.isRunning=!0),this.runningDirection=i,this.runningDirection._c=circular.setSafe();var n=!1;(this.features.assaultSkill&&this.isRunning||this.features.flyingKickSkill)&&(n=this.currentRoom.getEnemy(this.x+i.x,this.y+i.y)).isFriendly&&(n=!1);var o=this.sprite.x+32*i.x,a=this.sprite.y+32*i.y,h=null,l=!1,u=this;n?(l=this.gameController.getBezierTween(this.sprite,this.sprite.x,this.sprite.y,o+32*i.x,a+32*i.y),h=this.gameController.getBezierTween(this.sprite,o+32*i.x,a+32*i.y,o,a),l.onComplete.add(function(){u.gameController.startTween(u.sprite,h),u.performDamage(n,1,!1,u.features.flyingKickSkill)&&Entity.shake(n)}),this.stopRunning()):h=this.gameController.getBezierTween(this.sprite,this.sprite.x,this.sprite.y,o,a),this.currentRoom.isSafe()&&(h=null);var c=function(){if(n&&n.shaking)n.onShakeOver=c;else{var e=!1;if(u.features.slashSkill){if(u.currentWeapon&&u.currentWeapon.features.slashing){var r=getSideDirections(i),s={x:u.x-i.x+r.a1.x,y:u.y-i.y+r.a1.y},o={x:u.x-i.x+r.a2.x,y:u.y-i.y+r.a2.y},a=u.currentRoom.getEnemy(s.x,s.y),h=u.currentRoom.getEnemy(o.x,o.y);if(a&&!a.isFriendly&&(e=u.performDamage(a,1))&&Entity.shake(a),h&&!h.isFriendly){var l=u.performDamage(h,1);e=e||l,l&&Entity.shake(h)}}if(e)return void u.gameController.phaser.time.events.add(Entity.shakeTimeMillis,function(){u.gameController.updateMiniMap(),t?t():u.endTurn()})}u.gameController.updateMiniMap(),t?t():u.endTurn()}};h||l?(h.onComplete.add(c),n?this.gameController.startTween(this.sprite,l):this.gameController.startTween(this.sprite,h)):(this.sprite.x=o,this.sprite.y=a,c())},canWalkTo:function(e){if(e.x==this.x&&e.y==this.y)return!1;if(this.isTrapped()||this.isOverburdened())return!1;var t=direction(this,e);if(!this.currentRoom.canWalkTo(this.x+t.x,this.y+t.y)){var r=getAlternateDirections(t);if(this.currentRoom.canWalkTo(this.x+r.a1.x,this.y+r.a1.y))t=r.a1;else{if(!this.currentRoom.canWalkTo(this.x+r.a2.x,this.y+r.a2.y))return!1;t=r.a2}}return!0},doAttack:function(e,t){var r=distance(this.x,this.y,e.x,e.y),i=!1;if(this.currentWeapon&&this.currentWeapon.requiresSpaceToFire()&&r<2&&(this.gameController.showTextBy(this,"Too close!",null,null,500),this.previousWeapon&&!this.previousWeapon.isRangedWeapon()?(this.switchWeapon(),this.gameController.updatePlayerStats(!1)):i=!0),this.currentWeapon&&(this.currentWeapon.isRangedWeapon()||"WAND"===this.currentWeapon.type)&&this.currentWeapon.remainingUses.current<=0){if(this.currentWeapon.features.ammoType&&1===this.currentWeapon.remainingUses.max){var s=this.getItemByCode(this.currentWeapon.features.ammoType);if(s)return this.gameController.logEvent("Autoreload on attack"),void this.useItem(s,t,!0)}return"BOW"===this.currentWeapon.type?this.gameController.showTextBy(this,"Nock an arrow!"):"CROSSBOW"===this.currentWeapon.type?this.gameController.showTextBy(this,"Load a bolt!"):"SLING"===this.currentWeapon.type?this.gameController.showTextBy(this,"Ready a rock!"):"GUN"===this.currentWeapon.type?(this.gameController.showTextBy(this,"Refill the canister!"),this.gameController.showDenziMessage("Depleted","Mix a potion and load it into the carbine.")):"WAND"===this.currentWeapon.type?(this.gameController.showTextBy(this,"Depleted..."),this.gameController.showDenziMessage("Depleted","The magic power of this wand is gone.")):this.gameController.showTextBy(this,"Broken..."),this.currentWeapon.firesPhysicalProjectile()&&this.gameController.showReloadHelp(),void(t?t():(this.gameController.logEvent("Input enabled, doAttack"),this.gameController.enablePlayerAction()))}var n=this.currentRoom.getObjectBlockingLOS(this,e);if(n)return this.gameController.showTextBy(this,"Blocked..."),t?t():(this.gameController.logEvent("Input enabled, blockedAttack"),this.gameController.enablePlayerAction()),void this.gameController.showBlockingObject(n);if(this.currentWeapon&&this.currentWeapon.features.rangeLimit&&r>this.getRangedWeaponRange())return this.gameController.showTextBy(this,"Too far..."),void(t?t():(this.gameController.logEvent("Input enabled, attack too far"),this.gameController.enablePlayerAction()));if(this.currentWeapon&&this.currentWeapon.ammo&&this.currentWeapon.spend(),this.currentWeapon&&"WAND"===this.currentWeapon.type){var o=100;this.features.wandExpert&&(o=66),chance(o)&&this.currentWeapon.spend()}if(this.currentWeapon&&(this.stats.conducts.noWeaponsUsed=!1),this.gameController.knows.killMonsters?this.isBlind()?this.gameController.useInspector(this.sprite,"You are blind!","You hit something!",!0):this.gameController.showMonsterInfo(e):this.gameController.showCombatHelp(),this.dungeonLevel.isRetro||(e.x>this.x?this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1):e.x<this.x&&(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0))),this.isRangedAttack()&&!i){var a=!1,h=null;h=this.currentWeapon.ammo?this.currentWeapon.ammo.features.projectile:this.currentWeapon.features.projectile;var l=0;this.currentWeapon.features.usesArrows&&this.hasExtremeAccuracy()?l=95:this.currentWeapon.features.magicRanged&&this.features.wandExpert?(l=100,a=!0):l=r<2&&this.currentWeapon.features.hitsPointBlank?100:70,this.isConfused()&&(l-=40),l=this.affectRangedAttackHitChanceByTactic(l),a&&(l=100);var u=chance(l);(d=this).gameController.playSFX(d.getAttackSFX()),this._showProjectileAnimation(h,function(){if(d.currentWeapon&&d.currentWeapon.ammo&&!d.currentWeapon.ammo.features.liquidAmmo){var i=!1;u?d.currentWeapon.ammo.features.reuseableAmmo&&chance(90)&&(i=!0):chance(80)&&(i=!0),i&&d._stashAt(e.x,e.y,1,d.currentWeapon.ammo.code)}d.gameController.resetProjectile(),u&&d.performDamage(e,r,!1,!1,a)?Entity.shake(e,function(){t?t():d.endTurn()}):t?t():d.endTurn()},this,e,u)}else{var c=this.features.chargeSkill&&this.isRunning,m=direction(this.sprite,e.sprite),g=this.sprite.x+16*m.x,p=this.sprite.y+16*m.y;this.gameController.attackLength;c&&2;var d=this,f=function(){e.shaking?e.onShakeOver=f:t?t():d.endTurn()};a=!1;this.currentWeapon&&"WAND"===this.currentWeapon.type&&this.features.wandExpert&&(a=!0);var y=this.gameController.getBezierTween(this.sprite,this.sprite.x,this.sprite.y,g,p,!1,!0,f,30,!1,function(){d.gameController.playSFX(d.getAttackSFX()),d.gameController.showScratchAt(d.x,d.y,e.x,e.y,d.getScratchType()),d.performDamage(e,r,c,!1,a)&&Entity.shake(e)});this.gameController.startTween(this.sprite,y)}this.stopRunning()},_showProjectileAnimation:function(e,t,r,i,s){var n=0,o=!1,a=1;switch(e){case"arrow":n=0,o=!1;break;case"xbolt":n=1,o=!1;break;case"rock":n=4,o=!1,a=3;break;case"flame":n=[42,43,44],o=!0,a=3;break;case"flameBall":n=[3,4,5],o=!0,a=10;break;case"flameBolt":n=[69,70,71],o=!0,a=5;break;case"iceBolt":n=[57,58,59],o=!0,a=5;break;case"lightningBall":n=[0,1,2],o=!0,a=5;break;case"acidShot":n=[48,49,50],o=!0,a=3;break;case"gelShot":n=[60,61,62],o=!0,a=3;break;case"iceSpike":n=[66,67,68],o=!0,a=1;break;case"holyShot":n=[51,52,53],o=!0,a=3;break;case"lightning":n=[45,46,47],o=!0,a=2;break;case"bolt":n=[54,55,56],o=!0,a=2}var h=null;(h=o?this.gameController.animatedProjectile(e,n):this.gameController.prepareProjectile(n)).pivot.x=.5*h.width,h.pivot.y=.5*h.height;var l={x:i.x,y:i.y};if(!s){var u=r.starePoint(l);l.x+=u.x,l.y+=u.y}h.rotation=-Math.getAngle(l,r);var c=this.gameController.mapOffset;h.x=this.sprite.x+c.x,h.y=this.sprite.y+c.y;var m=32*l.x+16+c.x,g=32*l.y+this.gameController.YOFFSET+c.y,p=lineDistance(r.sprite,i.sprite);if(0===p)t();else{var d=p/160*1e3/5;d*=a;var f=this.gameController.tween(h).to({x:m,y:g},d,Phaser.Easing.Sinusoidal.In);f.onComplete.add(t),this.gameController.startTween(this.sprite,f)}},takeDamage:function(e){this.hitPoints.reduce(e),Achievements.doTakeDamage()},selfDamage:function(e){this.hitPoints.reduce(e)},performDamage:function(e,t,r,i,s){if(e.alerted=!0,e.hitByPlayer=!0,!s&&e.race.features.evadeChance&&chance(e.race.features.evadeChance)){var n=this.currentRoom.getFreePlaceAround(e);if(n)return e.warpTo(n),!1}var o=this.attack.current-rand(0,2);o<1&&(o=1);var a=1,h=1,l=!0;if(!i&&this.currentWeapon){if(h=a=this.currentWeapon.damageModifier(e.race.material),r&&a++,this.features.rageSkill&&(a+=1-this.hitPoints.getProportion()),this.currentWeapon.isMechanicalWeapon()||"WAND"===this.currentWeapon.type||(a=this.affectCausedDamageByTactic(a)),this.currentWeapon.features.twoHandedBonus&&!this.currentShield&&(a+=.3),a<=.1&&(a=.1),this.currentWeapon.requiresSpaceToFire()&&t<2)o+=rand(0,2);else{var u=this.currentWeapon.damageRoll.roll()+this.currentWeapon.getIntegrityDamageModifier();u<1&&(u=1),o+=Math.floor(u*a)}if(this.currentWeapon.ammo&&(o+=Math.floor(this.currentWeapon.ammo.damageRoll.roll()*a)),"WAND"===this.currentWeapon.type||this.currentWeapon.ammo);else if(this.degradeMeleeWeapons()){var c=50;this.features.weaponExpert&&(c=33),chance(c)&&this.currentWeapon.spend()}("WAND"===this.currentWeapon.type||this.currentWeapon.ammo&&this.currentWeapon.ammo.features.liquidAmmo)&&(l=!1)}if(!i&&this.currentWeapon||(this.features.unarmedBonus&&(o=3+rand(0,2*this.attack.current)),o=this.affectUnarmedCausedDamageByTactic(o)),i?this.latestAttackType="kick":this.currentWeapon?"WAND"===this.currentWeapon.type?this.latestAttackType="wand":this.currentWeapon.isRangedWeapon()?this.latestAttackType="rangedWeapon":this.latestAttackType="melee":this.latestAttackType="punch",e.race.features.isUndead&&this.undeadAttackBonus()&&(o*=++a),e.race.features.weakVsLight&&this.lightAttackBonus()&&(o*=++a),e.race.features.weakVsDarkness&&this.darknessAttackBonus()&&(o*=++a),!i&&this.currentWeapon&&this.currentWeapon.ammo&&0==this.currentWeapon.remainingUses.current&&(this.currentWeapon.ammo=null),l&&!r&&e.tryParry())return this.gameController.showTextBy(e,"PARRY!"),this.gameController.playSFX("slash"),this.currentRoom.alertNearbyMonsters(20),!1;if(l&&e.tryBlock())return this.gameController.showTextBy(e,"BLOCK!"),this.gameController.playSFX("hit"),this.currentRoom.alertNearbyMonsters(20),!1;var m,g=e.getEvadeChance()-this.attack.current+1;if((g=this.affectEnemyEvadeChanceByTactic(g))<0&&(g=0),chance(g)&&!s)return this.gameController.showTextBy(e,"Miss"),this.stats.misses++,!1;if(this.stats.hits++,this.bowBonus&&e.race.material===Material.FLESH&&this.currentWeapon&&"BOW"===this.currentWeapon.type&&t>=2&&(a++,o=Math.round(2*o)),this.currentWeapon&&this.currentWeapon.features.doubleShotChance&&chance(this.currentWeapon.features.doubleShotChance)&&(this.currentWeapon.spend(),a++,o=Math.round(2*o)),e.isHumanoid()){var p=rand(0,100);m=500,p<2?(this.gameController.showTextBy(e,"Neck hit!"),a+=2,o=Math.round(3*o)):p<6?(this.gameController.showTextBy(e,"Face hit!"),a++,o=Math.round(2*o)):p<15?(this.gameController.showTextBy(e,"Head hit!"),a+=.5,o=Math.round(1.5*o)):m=void 0}return r&&this.gameController.showTextBy(this,"Waaah!"),1!=h&&(m||(m=0),m+=500,h<1?this.gameController.showTextBy(e,"Ineffective..."):h>2?this.gameController.showTextBy(e,"Super effective!"):this.gameController.showTextBy(e,"Effective!")),this._reduceMonsterHitPoints(e,o,a,!0,m),!0},_reduceMonsterHitPoints:function(e,t,r,i,s){if(e.alerted=!0,e.hitByPlayer=!0,e.takeDamage(t),chance(50)&&e.race.material===Material.FLESH&&this.currentRoom.addBlood(e.x,e.y,rand(0,5)),i&&this.currentWeapon&&"BOW"===this.currentWeapon.type){var n=30;this.bowBonus&&(n=60),chance(n)&&(e.race.features.invisible&&e.sprite.loadTexture("tileset16",0),e.stuckArrows?e.stuckArrows++:e.stuckArrows=1)}var o="";if(1!=r&&(o=r<1?"...":r>3?"!!!":r>2?"!!":"!"),this.gameController.showTextBy(e,"-"+t+o,null,"RED",s,!0),e.wasHit=!0,e.hitPoints.current<=0)this.addKill(e),e.die(!0),this.gameController.combatMessagesShown&&this.gameController.setKnows("killMonsters"),this.features.courageSkill&&this.heal(1),this.regenMana()&&this.magicPoints.increase(3),this.gameController.communityClient.killEvent(this.className,e.race.name);else if(i){var a=this.currentWeapon;if(this.currentWeapon&&this.currentWeapon.ammo&&(a=this.currentWeapon.ammo),a&&a.stunChance){var h=a.stunChance;if(a.features.magicStun&&this.features.wandExpert&&(h*=2),chance(h)&&a&&a.stunChance&&chance(h)){var l=a.features.stunMessage;l||(l="Stun"),this.gameController.showTextBy(e,l,null,null,200),e.paralyzeTurns=rand(3,5),e.stopBreathing()}}}if(i&&this.currentWeapon&&this.currentWeapon.remainingUses.current<=0)switch(this.currentWeapon.type){case"BOW":case"CROSSBOW":case"SLING":break;case"GUN":this.gameController.showTextBy(this,"NO AMMO",null,null,500);break;case"WAND":this.gameController.showTextBy(this,"DEPLETED",null,null,500)}},_stashAt:function(e,t,r,i){if(!this.currentRoom.isSolid(e,t)){var s=this.currentRoom.getItem(e,t);if(s)s.code===i&&(s.quantity+=r,s.quantity>s.features.maxPackSize&&(s.quantity=s.features.maxPackSize));else{var n=this.gameController.itemFactory.getItemByCode(i);n.quantity=r,this.currentRoom.addItem(n,{x:e,y:t},!0),this.gameController.addItemToRoom(n)}}},interactWithDoor:function(e){if(this.isTrapped()||this.isOverburdened()){var t=this.isTrapped()?"TRAPPED!":"OVERBURDENED.";return this.gameController.showTextBy(this,t),this.gameController.logEvent("Input enabled, interactWithDoor cannot move"),void this.gameController.enablePlayerAction()}var r=this.currentRoom.getPortalOn(e);if(!r)return this.gameController.logEvent("Input enabled, interactWithDoor no portal"),void this.gameController.enablePlayerAction();var i=flatDistance(this.x,this.y,e.x,e.y);if(this.currentRoom.isSafe())i<1?this.useDoor(e):this.canWarp()?this.warpTo(e,function(){this.currentRoom.isSafe()&&this.x==r.x&&this.y==r.y?this.useDoor(e):(this.gameController.logEvent("Input enabled, interactWithDoor warp"),this.gameController.enablePlayerAction(!0))},this):this.walkTo(e);else if(i<1){var s=this;this.isLeavingRoom=!0,this.afterMonsterTurn=function(){s.isLeavingRoom=!1,s.isParalyzed()||s.losesTurnsForEncumberment()?s.endTurn():(s.gameController.visibleRunningIndicator&&(s.gameController.visibleRunningIndicator.visible=!1),s.useDoor(e))},this.endTurn()}else{var n=this.currentRoom.getEnemy(e.x,e.y);n?(this.gameController.disablePlayerAction(),this.interactWith(n)):this.walkTo(e)}},useDoor:function(e){this.dungeonLevel.isRetro||(e.x==this.currentRoom.width-1?this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1):0==e.x&&(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0))),!this.pet||this.pet.nextToTarget(this)||this.currentRoom.isSafe()&&"STA"!==this.pet.command||(this.petAway=this.pet,this.pet=!1),this.pet&&this.pet.x==this.x&&this.pet.y==this.y&&(this.pet.overPlayer=!0);var t=this.currentRoom.getPortalOn(e);this.x=t.destination.x,this.y=t.destination.y,this.pet&&(this.pet.x=this.x,this.pet.y=this.y,this.currentRoom.removeEnemy(this.pet)),this.currentRoom.sortMonsters(),this.dungeonLevel.exploreCorridor(this.currentRoom,e,t.destination),this.dungeonLevel.exploreRoom(this.currentRoom),this.currentRoom=t.destinationRoom,this.checkItemBelow(),this.pet&&this.currentRoom.addEnemy(this.pet,{x:this.pet.x,y:this.pet.y}),this.gameController.newRoom=this.currentRoom,this.gameController.interactDoorBridgeUp(e)},endTurn:function(e){if(this.updateStatus(),this.isHallucinating()&&!this.isBlind()&&this.gameController.switchPerception(),!this.isBlind()&&!e){var t=this.currentRoom.getItem(this.x,this.y);t?this.inspectItem(t):this.showClosestMonsterInfo()}this.gameController.setupUseAndThrowButtons(),this.gameController.updatePlayerStats(!0),this.gameController.updateMiniMap(),this.currentRoom.monsterTurn()},goDown:function(){if(this.gameController.disablePlayerAction(),this.currentRoom.exit.x===this.x&&this.currentRoom.exit.y===this.y&&this.petAway){var e=this;e.gameController.dialog.prompt("Warning","Leave your pet behind?",function(){e._doGoDown()},function(){e.gameController.logEvent("Input enabled, player go down"),e.gameController.enablePlayerAction()})}else this._doGoDown()},_doGoDown:function(){if(this.isTrapped()||this.isOverburdened()){var e=this.isTrapped()?"TRAPPED!":"OVERBURDENED.";return this.gameController.showTextBy(this,e),this.gameController.logEvent("Input enabled, cannot go down, burdened"),void this.gameController.enablePlayerAction()}if(this.currentRoom.isExit)if(this.currentRoom.exit.x===this.x&&this.currentRoom.exit.y===this.y){if(!this.hasRune)return this.gameController.useInspector(this.sprite,"Magic Gate","Find the rune of passage to activate the gate.",!0),this.gameController.showTextBy(this,"Inactive"),this.gameController.logEvent("Input enabled, cannot go down, no rune"),void this.gameController.enablePlayerAction();if(this.currentRoom.boss&&!this.currentRoom.boss.dead)return this.gameController.showTextBy(this,"COWARD!"),this.gameController.logEvent("Input enabled, cannot go down, coward"),void this.gameController.enablePlayerAction();var t=this.gameController;this.hasRune=!1,this.saveLevelStats();var r=this.gameController.tween(this.sprite).to({alpha:0},1e3);this.gameController.playSFX("magic"),this.gameController.particleAnimationAt("wizardry",this),this.pet&&(this.gameController.particleAnimationAt("wizardry",this.pet),this.gameController.tween(this.pet.sprite).to({alpha:0},1e3).start()),r.onComplete.add(function(){this.gameController.newLevel(function(){var e=t.player;e.sprite.alpha=1,e.pet&&(e.pet.sprite.alpha=1),2==t.depth&&(t.setKnows("survivedFirstLevel"),t.showDenziMessage(null,"You survived the first dungeon level! Now you are on your own.")),t.resetRoom(t.newRoom,!0),t.depth>24&&(t.logEvent("Input enabled, going down to level 24+"),t.enablePlayerAction()),t.newRoom=null})},this),r.start()}else if(this.currentRoom.isSafe()){flatDistance(this.x,this.y,this.currentRoom.exit.x,this.currentRoom.exit.y)>1&&this.canWarp()?this.warpTo(this.currentRoom.exit,function(){this.gameController.logEvent("Input enabled, _doGoDown warp"),this.gameController.enablePlayerAction(!0)},this):this.walkTo(this.currentRoom.exit)}else this.walkTo(this.currentRoom.exit);else this.gameController.enablePlayerAction()},getWeaponDescription:function(){return this.currentWeapon?this.currentWeapon.description+" ("+this.currentWeapon.getIntegrityDescription()+") ["+this.currentWeapon.getDamageDescription()+"]":"No weapon"},getArmorDescription:function(){return this.currentArmor?this.currentArmor.description+" ("+this.currentArmor.getIntegrityDescription()+") ["+this.currentArmor.getDefenseValue()+"]":"No armor"},canWarp:function(){return!(this.isBlind()||this.isConfused()||this.isParalyzed()||this.isOverburdened()||this.isTrapped()||this.isBleeding()||this.isPanicked())},warpTo:function(e,t,r,i){var s=e.x,n=e.y;if(this.isTrapped()||this.isOverburdened()){var o=this.isTrapped()?"TRAPPED!":"OVERBURDENED.";return this.gameController.showTextBy(this,o),void(t&&(r||(r=this),t.call(r)))}if(this.dungeonLevel.isRetro||(s>this.x?this.facingLeft&&(this.sprite.scale.x*=-1,this.facingLeft=!1):s<this.x&&(this.facingLeft||(this.sprite.scale.x*=-1,this.facingLeft=!0))),i)this.gameController.tweenOnPath(this.sprite,this.x,this.y,s,n,t,r,!1,this.isFloating()),this.x=s,this.y=n,this.checkItemBelow(),this.currentRoom.sortMonsters();else{for(var a=this.pathToSpot(e),h=this.x,l=this.y,u=this.currentRoom.getFriendlies(),c=0;c<u.length;c++)u[c].oldx=u[c].x,u[c].oldy=u[c].y;var m=0;for(c=1;c<a.length;c++){if(this.x=a[c][0],this.y=a[c][1],this.currentRoom.sortMonsters(),this.updateStatus(),this.currentRoom.safeQuietMonsterTurn(e),this.currentRoom._monsterFlood(!1,!0)){s=a[c][0],n=a[c][1],m=this.gameController.ENTER_ROOM_TWEEN_TIME;break}}this.checkItemBelow();for(m=this.gameController.getMovementTweenTime(h,l,this.x,this.y),u=this.currentRoom.getFriendlies(),c=0;c<u.length;c++){this.dungeonLevel.isRetro||(u[c].x>u[c].oldx?u[c].facingLeft&&(u[c].sprite.scale.x*=-1,u[c].facingLeft=!1):u[c].y>u[c].oldy&&(u[c].facingLeft||(u[c].sprite.scale.x*=-1,u[c].facingLeft=!0)));var g=this.gameController.tweenOnPath(u[c].sprite,u[c].oldx,u[c].oldy,u[c].x,u[c].y,!1,!1,!1,u[c].isFloating());g>m&&(m=g)}this.gameController.tweenOnPath(this.sprite,h,l,s,n,t,r,m,this.isFloating())}},pathToSpot:function(e){var t=this.currentRoom.grid.clone(),r=new PF.AStarFinder({diagonalMovement:PF.DiagonalMovement.Always});return this.currentRoom.markEnemiesOnPathfindingGrid(t,!0),t.setWalkableAt(this.x,this.y,!0),t.setWalkableAt(e.x,e.y,!0),r.findPath(this.x,this.y,e.x,e.y,t)},canPickUp:function(e){if(e.features.maxPackSize&&!e.features.liquidAmmo){var t=this._getAvailableStackCapacity(e.code);if(this.currentWeapon&&this.currentWeapon.type===e.features.reloadWeaponType&&(t+=this.currentWeapon.remainingUses.getRemaining()),t>0)return!0}return this.items.length-this.getEquippedItemsCount()<this.getTotalCarryCapacity()},_getAvailableStackCapacity:function(e){for(var t=0,r=0;r<this.items.length;r++){var i=this.items[r];i.code===e&&(t+=i.features.maxPackSize-i.quantity)}return t},_stashAmmo:function(e,t){for(var r=e,i=0;i<this.items.length&&0!=r;i++){var s=this.items[i];if(s.code===t){var n=s.features.maxPackSize-s.quantity;n>0&&(n>=r?(s.quantity+=r,r=0):(r-=n,s.quantity+=n))}}},getTotalCarryCapacity:function(){var e=this.carryCapacity;return this.pet&&this.pet.race.features.carryBonus&&(e+=this.pet.race.features.carryBonus),e>this.MAX_CARRY_CAPACITY?this.MAX_CARRY_CAPACITY:e},isOverburdened:function(){return this.items.length-this.getEquippedItemsCount()>this.getTotalCarryCapacity()},getEquippedItemsCount:function(){return(this.currentWeapon?1:0)+(this.currentArmor?1:0)+(this.currentArmwear?1:0)+(this.currentLegwear?1:0)+(this.currentFootwear?1:0)+(this.currentHelmet?1:0)+(this.currentShield?1:0)},levelUp:function(){this.powerLevel++,this.magicPoints.recoverProportion(.5),this.hitPoints.recoverProportionOfTotal(.2);var e=Upgrades.getUpgradesForPlayer(this);e.length>0&&this.gameController.selectUpgradeScreen.show(e)},upgradeHP:function(){var e=1;this.boostUpgrade()&&(e=1.5);var t=rand(3,6);t*=e,t=Math.round(t),this.hitPoints.extend(t),this.gameController.showTextBy(this,"HP+"+t,void 0,"GREEN"),this._showLevelUpMessage("Your hit points have been extended by "+t),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0)},upgradeMP:function(){var e=1;this.boostUpgrade()&&(e=1.5);var t=rand(8,12);t*=e,t=Math.round(t),this.magicPoints.extend(t),this.gameController.showTextBy(this,"MP+"+t,void 0,"GREEN"),this._showLevelUpMessage("Your magic points have been extended by "+t),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0)},upgradeAttack:function(){var e=1;this.boostUpgrade()&&chance(10)&&(e=2);var t=1;t*=e,this.attack.extend(t),this.gameController.showTextBy(this,"Combat+"+t,void 0,"GREEN"),this._showLevelUpMessage("Your combat power has been increased by "+t),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0)},upgradeMagicPower:function(){this.magicPower.extend(1),this.gameController.showTextBy(this,"Magic++",void 0,"GREEN"),this._showLevelUpMessage("Your magic power increases."),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0)},canLearnSpells:function(){return!(this.spells.length>=this.MAX_SPELLS)},learnSpell:function(e){this.canLearnSpells()?(this.addSpell(e),this.gameController.showTextBy(this,e.words),this._showLevelUpMessage("You learn the "+e.words+" spell."),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0)):this._showLevelUpMessage("You cannot learn any more spells.")},upgradeStrength:function(){var e=1;this.boostUpgrade()&&chance(10)&&(e=2);var t=2;t*=e,this.carryCapacity!=this.MAX_CARRY_CAPACITY&&(this.carryCapacity+=t,this.carryCapacity>this.MAX_CARRY_CAPACITY&&(this.carryCapacity=this.MAX_CARRY_CAPACITY),this.gameController.showTextBy(this,"Carry+"+t,void 0,"GREEN"),this._showLevelUpMessage("You can now carry "+t+" more items"),this.gameController.playSFX("magic"),this.gameController.updatePlayerStats(!0))},_showLevelUpMessage:function(e){this.gameController.isDesktop?this.gameController.showDenziMessage("Level "+this.gameController.depth,this.dungeonLevel.getADescription()+"\n\n"+e,!1):this.gameController.showDenziMessage("Level "+this.gameController.depth,e,!1)},drop:function(e){var t={x:this.x,y:this.y};if(this.currentRoom.getItem(this.x,this.y)&&((t=this.currentRoom.getFreePlaceAround(t))||(t=this.currentRoom.getFreePlace()),!t))return this.gameController.showTextBy(this,"No room"),void this.endTurn();e==this.currentArmor&&(this.currentArmor=null),e==this.currentArmwear&&(this.currentArmwear=null),e==this.currentLegwear&&(this.currentLegwear=null),e==this.currentFootwear&&(this.currentFootwear=null),e==this.currentHelmet&&(this.currentHelmet=null),e==this.currentShield&&(this.currentShield=null),e==this.currentWeapon&&(this.currentWeapon=null),e==this.previousWeapon&&(this.previousWeapon=null),this.gameController.updatePlayerStats(!1),this.gameController.showingInventory&&this.currentRoom.isSafe()||this.gameController.showTextBy(this,"Dropped"),this.currentRoom.addItem(e,t,!0),this.removeItem(e),this.gameController.addItemToRoom(e),this.gameController.setKnows("useItems"),this.endTurn()},isParalyzed:function(){return this.paralyzeTurns&&this.paralyzeTurns>0},disarm:function(){var e=this.currentRoom.getFreePlaceAround({x:this.x,y:this.y});e||(e=this.currentRoom.getFreePlace()),e&&(this.currentRoom.addItem(this.currentWeapon,e,!0),this.gameController.addItemToRoom(this.currentWeapon),this.removeItem(this.currentWeapon),this.gameController.updatePlayerStats(!1),this.currentWeapon=null)},getPositionOnLevel:function(){return{x:this.currentRoom.x+this.x,y:this.currentRoom.y+this.y}},changePetAI:function(e,t){if(this.pet){if(!t){var r="";switch(e){case"ATK":r="Charge!";break;case"STA":r="Stay there!";break;case"RET":r="Pull back!";break;case"FOL":r="Follow me!"}this.gameController.showTextBy(this,r)}this.pet.command=e}},canCharm:function(e){return e?e==this?(this.gameController.showMessageInPanel("You can't cast this spell on yourself, select another target."),!1):e!=this.pet||(this.gameController.showMessageInPanel("The "+e.race.name+" is already tame, select another target."),!1):(this.gameController.showTextBy(this,"On who?"),!1)},doCharm:function(e){return e.race.features.charmResistant?(this.gameController.showTextBy(e,"..."),this.gameController.showMessageInPanel("The monster resists!"),!1):(this.pet&&(this.gameController.showTextBy(this.pet,"Left"),this.pet.command="ATK"),e.isFriendly=!0,e.isSummon=!1,this.setPet(e),this.gameController.showTextBy(e,"Join"),!0)},failSpell:function(){this.gameController.showTextBy(this,"Failed"),this.gameController.showMessageInPanel("Your spell fails!")},heal:function(e,t){this.gameController.showTextBy(this,"+"+e,null,"GREEN",t,!0),this.hitPoints.increase(e),Achievements.doHealing()},getAttackSFX:function(){return this.currentWeapon?this.currentWeapon.getAttackSFX():"punch"},getScratchType:function(){return this.currentWeapon?this.currentWeapon.getScratchType():"blunt"},canPolymorph:function(e){return e?e!=this||(this.gameController.showTextBy(this,"Too dangerous"),this.gameController.showMessageInPanel("You can't use this spell on yourself, select another target."),!1):(this.gameController.showTextBy(this,"On who?"),!1)},doPolymorph:function(e){var t=this.morphMonster(e,this.gameController.monsterFactory.randomSpecies());t&&this.gameController.showMonsterInfo(t)},morphMonster:function(e,t){if(e.race.features.boss)return this.gameController.showTextBy(e,"..."),!1;var r=e==this.pet,i=e.changeRace(t,!1);return r&&this.setPet(i),i},canEvolve:function(e,t){if(!t)return this.gameController.showTextBy(this,"On who?"),!1;if(t==this)return this.gameController.showTextBy(this,"Too dangerous"),this.gameController.showMessageInPanel("You can't use this spell on yourself, select another target."),!1;return!!(e?t.race.features.darkEvolution:t.race.features.lightEvolution)||(this.gameController.showTextBy(this,"Nothing happens."),!1)},doEvolve:function(e,t){var r=null;r=e?t.race.features.darkEvolution:t.race.features.lightEvolution;var i=t==this.pet,s=t.changeRace(r,!0);i&&this.setPet(s),this.gameController.showMonsterInfo(s)},switchWeapon:function(){if(this.previousWeapon){if(this.previousWeapon.features.twoHanded&&!this.canWieldTwoHanded())return this.gameController.showTextBy(this,"Two handed"),void this.gameController.showMessageInPanel("You need two free hands to wield the "+this.previousWeapon.name+".");var e=this.previousWeapon;this.currentWeapon?(this.previousWeapon=this.currentWeapon,this.gameController.switchWeaponSprite.loadTexture(this.previousWeapon.menuSprite.texture)):(this.previousWeapon=!1,this.gameController.switchButtonGroup.visible=!1),this.currentWeapon=e,this.gameController.showObjectInfo(e,e.name,e.getDetails(this),!0),this.gameController.playSFX(this.currentWeapon.getAttackSFX())}},tryBlock:function(){return!(this.isParalyzed()||!this.currentShield)&&chance(this.currentShield.features.blockChance)},tryParry:function(){return!(this.isParalyzed()||!this.canParry||!this.currentWeapon||!this.currentWeapon.features.canParry)&&chance(20)},starePoint:function(e){return{x:sign(e.x-this.x),y:sign(e.y-this.y)}},canTransmute:function(){if(!this.canTransmute)return this.gameController.showTextBy(this,"How?"),this.gameController.showMessageInPanel("You don't know how to do that."),!1;var e=this.currentRoom.getItem(this.x,this.y);return e?!!e.transmutation||(this.gameController.showTextBy(this,"How?"),this.gameController.showMessageInPanel("This item doesn't seem to have a transmutation."),!1):(this.gameController.showTextBy(this,"No item."),this.gameController.showMessageInPanel("You should stand on the item you want to transmute.."),!1)},doTransmute:function(){var e=this.currentRoom.getItem(this.x,this.y),t=this.gameController.itemFactory.getItemByCode(e.transmutation);this.currentRoom.addItem(t,{x:this.x,y:this.y},!0),this.gameController.removeItemFromRoom(e),this.gameController.addItemToRoom(t),this.currentRoom.removeItem(e),this.endTurn()},canDoChemistry:function(e){return"applySpirit"===e.onUse},doChemistry:function(e){this.gameController.inventoryPanel.selectReagent(e)},performChemistry:function(e,t){var r=!1;if("white"===e.features.spiritType?r=t.features.onWhiteSpirit:"black"===e.features.spiritType&&(r=t.features.onBlackSpirit),r||("white"===t.features.spiritType?r=e.features.onWhiteSpirit:"black"===t.features.spiritType&&(r=e.features.onBlackSpirit)),!r)return this.gameController.showTextBy(this,"Failed."),void this.gameController.showMessageInPanel("These reagents won't mix.");var i=this.gameController.itemFactory.getItemByCode(r);this.gameController.initItemSprite(i),this.addToInventory(i),this.gameController.playSFX("potion"),this.gameController.communityClient.playerEvent("alchemy","'s concots "+i.description),this.gameController.showMessageInPanel("You brew the elements into "+i.description),this.features.alchemyExpert&&(void 0===t.remainingAlchemyUses?t.remainingAlchemyUses=rand(1,2):t.remainingAlchemyUses--,void 0===e.remainingAlchemyUses?e.remainingAlchemyUses=rand(1,2):e.remainingAlchemyUses--),void 0!==t.remainingAlchemyUses&&0!==t.remainingAlchemyUses||this.removeItem(t),void 0!==e.remainingAlchemyUses&&0!==e.remainingAlchemyUses||this.removeItem(e)},flash:function(e){var t=this.sprite;t.tint=e,this.gameController.phaser.time.events.add(100,function(){t.tint=16777215})},blink:function(e,t){if((!this.gameController.playerBlinking||t)&&(!t||e!==this.blinkColor)){this.blinkColor&&this.stopBlink(this.blinkColor),this.blinkColor=e,this.gameController.playerBlinking=!0;var r={step:0};this.gameController.playerColorTween&&this.gameController.playerColorTween.stop(),this.gameController.playerColorTween=this.gameController.tween(r).to({step:100},1e3,Phaser.Easing.Sinusoidal.Out,!1,0,Number.MAX_VALUE,!0);var i=this,s=this.gameController.playerColorTween;s.onUpdateCallback(function(){r.step>99||(r.step>1&&(i.gameController.phaser.renderType===Phaser.CANVAS?i.sprite.tint=Phaser.Color.interpolateColor(16777215,e,100,r.step,1):i.sprite.tint=Phaser.Color.interpolateColor(16777215,e,100,r.step)),r.step<1&&s.pleaseDie&&(s.stop(),i.sprite.tint=16777215,i.gameController.playerBlinking=!1,i.blinkColor=!1))}),this.gameController.playerColorTween.start()}},redBlink:function(){this.blink(16711680,!0)},stopBlink:function(e){!this.gameController.playerBlinking||e&&e!==this.blinkColor||(this.gameController.playerColorTween.pleaseDie=!0)},canUseItemOnTarget:function(e){return this.pet&&this.pet==e?this.currentRoom.isSafe()||this.pet.nextToTarget(this):e.nextToTarget(this)},getClosestMonster:function(){for(var e=999,t=null,r=0;r<this.currentRoom.monsters.length;r++){var i=this.currentRoom.monsters[r];if(!i.isFriendly){var s=lineDistance(this,i);s<e&&(e=s,t=i)}}return t},showClosestMonsterInfo:function(){var e=this.getClosestMonster();e&&this.gameController.showMonsterInfo(e)},boostEnergyMagic:function(){return(this.features.energyMagicExpert||this.currentHelmet&&this.currentHelmet.features.boostEnergyMagic||this.currentShield&&this.currentShield.features.boostEnergyMagic||this.boostAllMagic())&&!this.hasMetalArmor()},boostElementalMagic:function(){return this.features.elementalSpecialist||this.currentHelmet&&this.currentHelmet.features.boostElementalMagic||this.currentShield&&this.currentShield.features.boostElementalMagic||this.boostAllMagic()},boostAllMagic:function(){return this.currentHelmet&&this.currentHelmet.features.boostAllMagic||this.currentShield&&this.currentShield.features.boostAllMagic},absorbElementalMagic:function(){return this.hasMetalArmor()},hasMetalArmor:function(){return this.currentArmor&&this.currentArmor.features&&this.currentArmor.features.metalArmor||this.currentHelmet&&this.currentHelmet.features.metal||this.currentShield&&this.currentShield.features.metal},setInvisible:function(e){var t=5*e;this.boostEnergyMagic()&&(t+=10),this.invisibilityTurns=t},canWearArmor:function(e){return!0},canWearHelmet:function(e){return!0},getMaxThrowDist:function(e){var t=e.features.weight;return t||(t=1),this.features.throwStrength>=t?4:2*this.features.throwStrength>=t?3:2},getThrowAccuracyMalus:function(e){var t=e.features.weight;t||(t=1);var r=0;return this.isConfused()&&(r=40),this.features.throwStrength>=t?0+r:2*this.features.throwStrength>=t?20+r:40+r},getThrowDifficulty:function(e){var t=e.features.weight;return t||(t=1),!(this.features.throwStrength>=t)&&(2*this.features.throwStrength>=t?"Heavy!":"Too Heavy!")},getADescription:function(){return Util.startsWithVowel(this.className)?"an "+this.className:"a "+this.className},getSpellDamageRoll:function(e,t){t||(t=this.magicPower.current);var r=e.features.magicShape,i=e.features.magicPower;i||(i=1);var s=1;switch(r){case"BALL":s=2;break;case"BOLT":s=1;break;case"PILLAR":s=3;break;case"TORNADO":s=4;break;case"EXPLOSION":s=5}var n=1;return this.pumpMagic()&&(n*=2),this.boostElementalMagic()&&s++,this.absorbElementalMagic()&&(n/=2),n*=i,(1==(n=Math.round(n))?"":n+"x")+(2*s+Math.floor(t/3))+"D2"},magicAttack:function(e,t,r,i){r||(r=this.magicPower.current);var s=e.features.magicShape,n=e.features.magicPower;n||(n=1);var o=1,a=0,h=4;switch(s){case"BALL":o=2,a=20,h=12;break;case"BOLT":o=1,a=5,h=10;break;case"PILLAR":o=3,a=20,h=14;break;case"TORNADO":o=4,a=40,h=16;break;case"EXPLOSION":o=5,a=40,h=16}var l=e.damageModifier(t.race.material);if(this.pumpMagic()&&(l*=2),this.boostElementalMagic()&&o++,this.absorbElementalMagic()&&(l/=2),l*=n,l=Math.round(l),o=(o=new Roll(2*o+Math.floor(r/3),2)).roll(),o*=l,o=Math.round(o),this.currentRoom.alertNearbyMonsters(a),!this.isMagicExpert()&&i&&chance(5))return this.gameController.showMessageInPanel("The spell backfires!"),this.gameController.explosionAt(e.features.damageType,this,h),this.gameController.playSFX("explosion"),this.gameController.showTextBy(this,"-"+o,null,"RED",!1,!0),this.selfDamage(o),this.lastDamagingSpell=e,this.lastAttacker=!1,this.lastDamagingItem=!1,this.lastDamagingDescription="a spell gone awry",this.gameController.communityClient.playerEvent("spell","'s "+e.words+" spell goes awry!"),void this.endTurn();if(this.gameController.communityClient.playerEvent("spell"," casts "+e.words),e.features.projectile){var u=this;this._showProjectileAnimation(e.features.projectile,function(){u.gameController.explosionAt(e.features.damageType,t,h),u.gameController.playSFX("explosion"),u.latestAttackType="magicSpell",u._reduceMonsterHitPoints(t,o,l,!1),u.gameController.resetProjectile(),u.endTurn()},this,t,!0)}else this.gameController.explosionAt(e.features.damageType,t,h),this.gameController.playSFX("explosion"),this.latestAttackType="magicSpell",this._reduceMonsterHitPoints(t,o,l,!1),this.endTurn()},getUseDescription:function(){return"You "},goBlind:function(e){this.gameController.useInspector(this.sprite,"You are blind!","You can only see darkness all around you."),this.blindTurns=e,this.gameController.updatePlayerStats(!0),this.gameController.turnOffLights()},goConfused:function(e){this.gameController.useInspector(this.sprite,"You are confused!","Why did you come here?",!0),this.confusionTurns=e,this.gameController.updatePlayerStats(!0)},isBlind:function(){return this.blindTurns>0},isConfused:function(){return this.confusionTurns>0},moveConfused:function(){return this.isConfused()&&chance(30)},attackConfused:function(){return this.isConfused()&&chance(30)||this.isHallucinating()&&chance(60)},canThrow:function(){return!this.isBlind()},canRead:function(){return!this.isBlind()&&!this.isConfused()&&!this.isHallucinating()},isInvisible:function(){return this.invisibilityTurns>0},isBleeding:function(){return this.cutTurns>0},startHallucinating:function(e){this.gameController.useInspector(this.sprite,"Hallucination","You inhale the fetid vapour emanating from the monster"),this.hallucinationTurns=e,this.gameController.updatePlayerStats(!0)},isHallucinating:function(){return this.hallucinationTurns>0},getStatusAilments:function(){var e=this.getNoiseLevel();if(!(this.isBlind()||this.isConfused()||this.isInvisible()||this.isParalyzed()||this.isOverburdened()||this.isTrapped()||this.isBleeding()||this.isHallucinating()||0!=e||this.isPanicked()||this.isEncumbered()))return!1;var t=[];return this.isBlind()&&t.push("Blind"),this.isConfused()&&t.push("Confused"),this.isInvisible()&&t.push("Invisible"),this.isParalyzed()&&t.push("Paralyzed"),this.isOverburdened()&&t.push("Overburdened"),this.isTrapped()&&t.push("Trapped"),this.isBleeding()&&t.push("Bleeding"),this.isHallucinating()&&t.push("Hallucinating"),this.isPanicked()&&t.push("Panicked"),this.isEncumbered()&&t.push("Encumbered"),e>0?t.push("Noisy"):e<0&&t.push("Stealthy"),t},updateStatus:function(){1==this.invisibilityTurns?(this.invisibilityTurns=0,this.gameController.updatePlayerSprite()):this.invisibilityTurns>0&&this.invisibilityTurns--,1==this.blindTurns?(this.blindTurns=0,this.gameController.useInspector(this.sprite,"Recovered","You can see again",!0),this.gameController.updatePlayerStats(!0),this.gameController.turnOnLights()):this.isBlind()&&this.blindTurns--,1==this.confusionTurns?(this.confusionTurns=0,this.gameController.useInspector(this.sprite,"Recovered","You are no longer confused",!0),this.gameController.updatePlayerStats(!0)):this.isConfused()&&this.confusionTurns--,1==this.panickTurns?(this.panickTurns=0,this.gameController.useInspector(this.sprite,"Recovered","You no longer fear",!0),this.gameController.updatePlayerStats(!0)):this.panickTurns>0&&this.panickTurns--,this.isBleeding()&&(this.takeDamage(2),this.gameController.showTextBy(this,"-2",null,"RED",!1,!0),this.currentRoom.addBlood(this.x,this.y,rand(0,5)),this.cutTurns--),1==this.hallucinationTurns?(this.hallucinationTurns=0,this.gameController.useInspector(this.sprite,"Recovered","You are no longer hallucinating",!0),this.gameController.updatePlayerStats(!0),this.gameController.recoverPerception()):this.isHallucinating()&&this.hallucinationTurns--;var e=this.getNoiseLevel();e>=0&&(e=5*(e+1),this.currentRoom.alertNearbyMonsters(e)),1==this.paralyzeTurns?(this.paralyzeTurns=0,this.stopBlink(65535),this.resumeBreathing(),this.gameController.updatePlayerStats(!0)):this.paralyzeTurns>0&&this.paralyzeTurns--},autoTurn:function(e){if(!this.dead&&this.isPanicked()){var t=this.getClosestMonster();if(t){var r=this.starePoint(t);if(r.x*=-1,r.y*=-1,r.x+=this.x,r.y+=this.y,this.canWalkTo(r))this.walkTo(r,e);else{var i=flatDistance(this.x,this.y,t.x,t.y),s=this.isRangedAttack();1===i||s?this.doAttack(t,e):e()}return}}e()},inspectItem:function(e){this.isHallucinating()?this.gameController.showObjectInfo(e,"???","You are not sure what this is.",!0):this.gameController.showObjectInfo(e,e.getName(),e.getDetails(this),!0)},getNoiseLevel:function(){return-1*(this.features.stealthBonus||0)+(this.hasMetalArmor()?1:0)},inmuneToBlindness:function(){return!1},isPanicked:function(){return this.panickTurns>0},inflictPanick:function(e){this.immuneToFear()||(this.panickTurns=e,this.gameController.updatePlayerStats(!0))},die:function(){this.dead=!0,this.saveLevelStats(),Achievements.doDie()},isFloating:function(){return!1},isHumanoid:function(){return!0},immuneToDisease:function(){return this.features.immuneToDisease||this.currentHelmet&&this.currentHelmet.features.preventStatusAilments||this.currentShield&&this.currentShield.features.preventStatusAilments},immuneToFear:function(){return this.currentHelmet&&this.currentHelmet.features.preventFear||this.currentShield&&this.currentShield.features.preventFear},causesFearWhenSeen:function(){return this.currentHelmet&&this.currentHelmet.features.causesFear||this.currentShield&&this.currentShield.features.causesFear},causesConfusionWhenSeen:function(){return this.currentHelmet&&this.currentHelmet.features.causesConfusion||this.currentShield&&this.currentShield.features.causesConfusion},onSeenBy:function(e){this.causesFearWhenSeen()&&(e.isFriendly||e.seenMask||(e.seenMask=!0,chance(30)&&e.inflictPanick(20))),this.causesConfusionWhenSeen()&&(e.isFriendly||e.seenMask||(e.seenMask=!0,chance(30)&&e.goConfused(20)))},undeadAttackBonus:function(){return this.currentWeapon&&this.currentWeapon.features.undeadBonus||this.currentHelmet&&this.currentHelmet.features.undeadBonus||this.currentShield&&this.currentShield.features.undeadBonus},lightAttackBonus:function(){return this.currentWeapon&&this.currentWeapon.features.lightBonus||this.currentHelmet&&this.currentHelmet.features.lightBonus||this.currentShield&&this.currentShield.features.lightBonus},darknessAttackBonus:function(){return this.currentWeapon&&this.currentWeapon.features.darknessBonus||this.currentHelmet&&this.currentHelmet.features.darknessBonus||this.currentShield&&this.currentShield.features.darknessBonus},hasExtremeAccuracy:function(){return this.sureShot||this.currentHelmet&&this.currentHelmet.features.sureShot},addSpell:function(e){this.spells.push(e),this.circles[e.school]<e.circle&&(this.circles[e.school]=e.circle),this.gameController.refreshSpellIcons=!0},getSpellIndex:function(e){for(var t=0;t<this.spells.length;t++)if(e==this.spells[t])return t;return-1},getCircleForSchool:function(e){return this.circles[e]},canAdvanceOnSchool:function(e){return this.getCircleForSchool(e)<this.maxCircle[e]},hasSpell:function(e){for(var t=0;t<this.spells.length;t++)if(this.spells[t].words===e)return!0;return!1},getEvadeChance:function(){if(this.isParalyzed())return 0;var e=this.evadeChance;return(e=this.affectEvadeChanceByTactic(e))<0&&(e=0),e},regenMana:function(){return this.currentHelmet&&this.currentHelmet.features.regenMana||this.currentShield&&this.currentShield.features.regenMana},pumpMagic:function(){return this.currentHelmet&&this.currentHelmet.features.pumpMagic||this.currentShield&&this.currentShield.features.pumpMagic},saveMana:function(){return this.currentHelmet&&this.currentHelmet.features.saveMana||this.currentShield&&this.currentShield.features.saveMana},getPassiveSkillsDescription:function(e){for(var t=e?"\n":" ",r="",i=this.getPassiveSkillsList(),s=0;s<i.length;s++)r+=this.replaceKeys(i[s])+"."+t;return r},isMagicExpert:function(){return this.magicPower.current>=6},getSpellMPCost:function(e){var t=e.mpCost;return t?(this.pumpMagic()?t*=2:this.saveMana()&&(t=Math.round(t/2)),t):0},checkItemBelow:function(){var e=this.currentRoom.getItem(this.x,this.y);e&&this.gameController.showSimpleMessage(e.getName())},setTactic:function(e,t){if(!t){var r="";switch(e){case"BAL":r="Balanced\t";break;case"DEF":r="Defensive";break;case"AGR":r="Aggresive"}this.gameController.showTextBy(this,r)}this.currentTactic=e},getTactic:function(){return this.currentTactic},isDefensiveTactic:function(){return"DEF"===this.getTactic()},isAggressiveTactic:function(){return"AGR"===this.getTactic()},affectReceivedDamageByTactic:function(e){return this.isDefensiveTactic()?this.features.passiveSkills.superDefenseDefensive?Math.floor(.5*e):Math.floor(.8*e):this.isAggressiveTactic()?Math.floor(1.2*e):e},affectRangedAttackHitChanceByTactic:function(e){return this.isDefensiveTactic()?e-20:this.isAggressiveTactic()?e+10:e},affectCausedDamageByTactic:function(e){return this.isDefensiveTactic()?e-.5:this.isAggressiveTactic()?this.features.passiveSkills.superDamageAggressive?e+.8:e+.5:e},affectUnarmedCausedDamageByTactic:function(e){return this.isDefensiveTactic()?Math.round(.5*e):this.isAggressiveTactic()?Math.round(1.5*e):e},affectEnemyEvadeChanceByTactic:function(e){return this.isDefensiveTactic()?e+5:this.isAggressiveTactic()?this.features.passiveSkills.superHitAggressive?e-10:e-5:e},affectEvadeChanceByTactic:function(e){return this.isAggressiveTactic()?e-5:this.isDefensiveTactic()?this.features.passiveSkills.superEvadeDefensive?e+20:e+10:e},canWearShield:function(){return!0},isEncumbered:function(){return!this.features.canUseHeavyArmor&&(!(!this.currentShield||!this.currentShield.features.heavy)||!(!this.currentArmor||!this.currentArmor.features.heavyArmor))},losesTurnsForEncumberment:function(){if(!this.isEncumbered())return!1;if(this.currentRoom.isSafe())return!1;var e=chance(15);return e&&this.gameController.showTextBy(this,"Slow..."),e},wearShieldPenalty:function(){return!(!this.currentShield||this.features.passiveSkills.shieldExpert)},hasRunningSkills:function(){return this.features.assaultSkill||this.features.chargeSkill},saveLevelStats:function(){this.stats.perLevel.push({killed:this.levelKills,exploredRooms:this.exploredLevelRooms,totalRooms:this.dungeonLevel.rooms.length}),1==this.stats.perLevel.length?this.exploredLevelRooms==this.dungeonLevel.rooms.length&&(this.stats.conducts.noRoomUnexplored=!0):this.exploredLevelRooms!=this.dungeonLevel.rooms.length&&(this.stats.conducts.noRoomUnexplored=!1),this.levelKills=0,this.exploredLevelRooms=0,this.exploredRoomsMap={_c:circular.setSafe()}},addKill:function(e){this.kills++,Achievements.achieveKill(e),this.stats.conducts.noKills=!1,this.levelKills++,this.stats.killMap[e.race.code]?this.stats.killMap[e.race.code]++:this.stats.killMap[e.race.code]=1},checkNewRoomExplored:function(e){this.exploredRoomsMap[e.x+"-"+e.y]||(this.exploredLevelRooms++,this.exploredRoomsMap[e.x+"-"+e.y]=!0)},boostUpgrade:function(){var e=this.stats.perLevel[this.stats.perLevel.length-1];return e&&e.exploredRooms==e.totalRooms},getPassiveSkillsList:function(){return Skills.buildDescriptionsFrom(this)},replaceKeys:function(e,t){return Text.replaceKeys(e,t,this.isMale,this.dead)},unloadWeapon:function(e){var t=e.ammo;if(t){if(this.hasItem(t))t.quantity+=e.remainingUses.current;else{var r=this.getItemByCode(t.code);r&&r.features.maxPackSize-r.quantity>=e.remainingUses.current?r.quantity+=e.remainingUses.current:((t=this.gameController.itemFactory.getItemByCode(t.code)).quantity=e.remainingUses.current,this.gameController.initItemSprite(t),this.addToInventory(t))}e.remainingUses.current=0,e.ammo=null}},removeWeapon:function(){this.gameController.showingInventory&&this.currentRoom.isSafe()||this.gameController.showTextBy(this,"Remove"),this.previousWeapon=this.currentWeapon,this.gameController.switchWeaponSprite.loadTexture(this.previousWeapon.menuSprite.texture),this.gameController.switchButtonGroup.visible=!0,this.gameController.playSFX(this.currentWeapon.getAttackSFX()),this.gameController.showMessageInPanel("You put back your weapon."),this.currentWeapon=null},canWieldTwoHanded:function(){return!this.currentShield},stopBreathing:function(){this.sprite.animations.stop()},resumeBreathing:function(){this.sprite.animations.play("breath",4,!0)},rebuildPortraitSprite:function(){this.buildPortraitSprite(this.selectedSkinTone,this.selectedHairType,this.selectedHairColor,this.selectedBeardType)},buildPortraitSprite:function(e,t,r,i){var s=this.gameController.getImage(0,0,"portrait-base",e),n=!1,o=!1,a=!1;-1!==t&&(t*=5,t+=r,n=this.gameController.getImage(0,0,"portrait-hair",t)),e<=6&&(o=this.maleSelected?this.gameController.getImage(0,0,"portrait-hair",85+r):this.gameController.getImage(0,0,"portrait-hair",90+r)),-1!==i&&(i*=5,i+=r,a=this.gameController.getImage(0,0,"portrait-hair",i));var h=this.gameController.phaser.add.bitmapData(48,48);h.draw(s,0,0),this.gameController.killImage(s),o&&(h.draw(o,0,0),this.gameController.killImage(o)),n&&(h.draw(n,0,0),this.gameController.killImage(n)),a&&(h.draw(a,0,0),this.gameController.killImage(a)),this.portraitSprite||(this.portraitSprite=this.gameController.getImage(0,0,"tileset32",0),this.portraitSprite.visible=!1),this.portraitSprite.loadTexture(h)},getRangedWeaponRange:function(){if(!this.currentWeapon)return 1;if(!this.currentWeapon.features.rangeLimit)return 90;var e=this.currentWeapon.features.rangeLimit;return this.bowBonus&&"BOW"===this.currentWeapon.type&&(e+=2),e},MIND_MAGIC_SAVING_ROLL:new Roll(6,3),mindMagicEffectPrevented:function(){return!!this.immuneToDisease()||this.MIND_MAGIC_SAVING_ROLL.roll()<=this.magicPower.current},tryReading:function(e){if(this.features.cantRead)this.gameController.useInspector(this.sprite,"Read","You never learned to read.");else if(this.isBlind())this.gameController.useInspector(this.sprite,"Read","You are blind, you can't read.");else if(this.isConfused())this.gameController.useInspector(this.sprite,"Read","Your mind jumps in all directions, you can't focus to read.");else{if(!this.isHallucinating())return!0;this.gameController.useInspector(this.sprite,"Read","The characters in the "+e+" are dancing around!")}return!1},degradeMeleeWeapons:function(){return!!this.weaponDegEnabled},degradeThrownWeapons:function(){return!0}};

},{"./AchievementsManager":1,"./ActionValidator":2,"./CellType.enum":7,"./Entity":12,"./Material.enum":19,"./Roll.class":27,"./Skills":30,"./Spells":31,"./Stat.class":32,"./Text":34,"./Upgrades":35,"./Util":36,"circular-functions":43}],25:[function(require,module,exports){
module.exports={KNIGHT:{code:"KNIGHT",name:"Paladin",shortName:"Paladin",defaultSkinTone:1,defaultHairColor:2,defaultMaleHairType:3,defaultMaleBeardType:0,defaultFemaleHairType:1,startingWeapon:"Royal Sword-11",secondaryWeapon:"Steel Dagger-3",startingArmor:"Chain Hauberk10",startingArmorFemale:"Chain Women Hauberk7",startingLegwear:"Leather Pants2",startingArmwear:"Combat Gauntlets6",startingFootwear:"Plate Boots6",startingHelmet:"Iron Helmet",startingUtility:["bandage","bandage","befriendMonsterSpell"],startingShield:"Royal Shield",startingSpells:["Lor Ben"],attack:2,magic:1,carry:16,hp:40,mp:8,evadeChance:10,features:{canUseBows:!0,weaponExpert:!0,canUseHeavyArmor:!0,throwStrength:30,passiveSkills:{superDefenseDefensive:!0,shieldExpert:!0}},maxCircle:{ELEMENTAL:0,LIFE:4,MIND:0,MATTER:0},longDescription:"> Can use aggresive tactics while wearing a shield.\n> Can wear heavy armor without being encumbered.",shortDescription:"Expert using heavy armor, shields and melee weapons.",drawingIndex:0},ARCHER:{code:"ARCHER",name:"Hunter",shortName:"Hunter",defaultSkinTone:1,defaultHairColor:4,defaultMaleHairType:5,defaultMaleBeardType:0,defaultFemaleHairType:2,startingWeapon:"Green Bow-102",secondaryWeapon:"Steel Short Sword-8",startingAmmo:"arrows",startingUtility:["bandage","bandage","befriendMonsterSpell"],startingSpells:["Momi Gyr"],startingArmor:"Green Leather Tunic49",startingLegwear:"Leather Pants2",startingArmwear:"Leather Gloves7",startingFootwear:"Leather Boots5",attack:2,magic:1,carry:16,hp:40,mp:10,evadeChance:15,sureShot:!0,features:{canUseBows:!0,passiveSkills:{},throwStrength:20},maxCircle:{ELEMENTAL:0,LIFE:2,MIND:0,MATTER:2},bowBonus:!0,longDescription:"> Never misses a shot, has increased range and can do critical damage.\n> Preserves arrows from breaking.",shortDescription:"Expert using bows and preserving arrows.",drawingIndex:1},ALCHEMIST:{code:"ALCHEMIST",name:"Alchemist",shortName:"Alchemist",defaultSkinTone:1,defaultHairColor:0,defaultMaleHairType:6,defaultMaleBeardType:2,defaultFemaleHairType:1,startingArmor:"Black Coat27",startingLegwear:"Black Pants11",startingArmwear:"Black Leather Gloves5",startingFootwear:"Leather Boots2",startingWeapon:"Alchemist Carbine-108",secondaryWeapon:"Steel Dagger-3",startingHelmet:"Black Ribboned Hat",startingAmmo:"acidShot",startingUtility:["bandage","bandage","befriendMonsterSpell"],startingSpells:["Lor Obbo"],attack:2,magic:0,carry:16,hp:40,mp:14,evadeChance:10,canTransmute:!0,features:{canUseBows:!0,alchemyExpert:!0,throwStrength:20,passiveSkills:{}},maxCircle:{ELEMENTAL:0,LIFE:0,MIND:0,MATTER:4},longDescription:"> Can reuse reagents to mix more potions.\n> Wields the deadly alchemist carbine.",shortDescription:"Can reuse reagents for Alchemy. Has the Alchemist Carbine.",drawingIndex:3},ARCANE:{code:"ARCANE",name:"Arcane Master",shortName:"Arcane",defaultSkinTone:0,defaultHairColor:1,defaultMaleHairType:7,defaultMaleBeardType:3,defaultFemaleHairType:1,startingArmor:"Blue Coat26",startingArmorFemale:"Black Coat28",startingFootwear:"Leather Boots2",startingWeapon:"Bolt Staff-90",secondaryWeapon:"Steel Dagger-3",startingUtility:["bandage","bandage","befriendMonsterSpell","Lightning Wand-45"],startingSpells:["Rew Ram","Rew"],features:{canUseBows:!1,cumbersomeWeaponUser:!0,throwStrength:10,energyMagicExpert:!0,wandExpert:!0,passiveSkills:{}},maxCircle:{ELEMENTAL:4,LIFE:8,MIND:8,MATTER:4},attack:1,magic:6,carry:16,hp:40,mp:40,evadeChance:5,longDescription:"> Extends magic wands charges and always hits.\n> Effect bonuses when using life and matter spells.\n> Can cast high level spells safely.",shortDescription:"Increases life and accuracy of wands. Master of life and matter magic.",drawingIndex:2},SLAYER:{code:"SLAYER",name:"Monster Slayer",shortName:"Slayer",defaultSkinTone:0,defaultHairColor:0,defaultMaleHairType:6,defaultMaleBeardType:0,defaultFemaleHairType:2,startingWeapon:"Steel Curved Blade-22",secondaryWeapon:"Steel Dagger-3",startingArmor:"Steel Slayer Plate95",startingLegwear:"Leather Pants3",startingArmwear:"Black Leather Gloves5",startingFootwear:"Leather Boots2",startingUtility:["bandage","bandage","Steel Dagger-3","befriendMonsterSpell"],startingSpells:["Jan Spak"],attack:2,magic:1,carry:16,hp:40,mp:10,evadeChance:15,canParry:!0,features:{canUseBows:!0,throwStrength:30,slashSkill:!0,assaultSkill:!0,throwingWeaponsExpert:!0,stealthBonus:1,passiveSkills:{superHitAggressive:!0}},maxCircle:{ELEMENTAL:4,LIFE:0,MIND:0,MATTER:0},longDescription:"> Parries attacks.\n> Slashes through enemies.\n> Jumps into enemies while running.\n> Extra accurate when throwing items.",shortDescription:"Elite soldier, parries attacks and slashes through enemies.",isFellowship:!0,drawingIndex:4},BARBARIAN:{code:"BARBARIAN",name:"Barbarian",shortName:"Barbarian",defaultSkinTone:2,defaultHairColor:1,defaultMaleHairType:5,defaultMaleBeardType:0,defaultFemaleHairType:2,startingWeapon:"Steel Battle Axe-17",startingArmor:"Hide Cape96",startingArmorFemale:"Hide Cape97",startingLegwear:"Leather Pants29",startingLegwearFemale:"Leather Pants30",startingFootwear:"Leather Boots5",secondaryWeapon:"Steel Knife-13",startingShield:"Iron Buckler",startingUtility:["bandage","bandage","bandage"],startingSpells:[],attack:3,magic:0,carry:18,hp:50,mp:0,evadeChance:15,features:{canUseHeavyArmor:!0,canUseBows:!0,throwStrength:30,cantRead:!0,chargeSkill:!0,courageSkill:!0,rageSkill:!0,passiveSkills:{superDamageAggressive:!0,unlimitedCombatUpgrades:!0}},maxCircle:{ELEMENTAL:0,LIFE:0,MIND:0,MATTER:0},longDescription:"> Charges against enemies while running.\n> Gains strength when low on health.\n> Recovers health by defeating foes.",shortDescription:"Charges against enemies. Gains strength when close to death. Recovers health.",isFellowship:!0,drawingIndex:5},AILORUS:{code:"AILORUS",name:"Ailorus Monk",shortName:"Monk",defaultSkinTone:0,defaultHairColor:0,defaultMaleHairType:0,defaultMaleBeardType:0,defaultFemaleHairType:0,startingWeapon:"Steel Knife-13",secondaryWeapon:"Steel Knife-13",startingLegwear:"Leather Loincloth4",startingUtility:["bandage","bandage","befriendMonsterSpell"],startingSpells:["Rew"],startingArmorFemale:"Leather Women Shirt77",attack:2,magic:1,carry:16,hp:50,mp:20,evadeChance:15,features:{canUseBows:!1,flyingKickSkill:!0,unarmedBonus:!0,immuneToDisease:!0,throwStrength:20,stealthBonus:1,passiveSkills:{superEvadeDefensive:!0}},maxCircle:{ELEMENTAL:0,LIFE:0,MIND:4,MATTER:0},longDescription:"> Flying Kick: Jumps into enemies.\n> Unarmed attacks grow stronger with power.\n> Immune to poison and spell maladies",shortDescription:"Martial master with flying kick and claw attacks. Immune to disease.",isFellowship:!0,drawingIndex:6},DUMERIL:{code:"DUMERIL",name:"Dumeril Sage",shortName:"Sage",defaultSkinTone:0,defaultHairColor:0,defaultMaleHairType:0,defaultMaleBeardType:0,defaultFemaleHairType:0,startingWeapon:"Wooden Quarterstaff-79",secondaryWeapon:"Flame Wand-44",startingArmor:"Black Robe30",startingUtility:["recoverHealthSpell","bandage","befriendMonsterSpell"],startingSpells:["Pyr Spak"],features:{canUseBows:!1,cumbersomeWeaponUser:!0,throwStrength:10,elementalSpecialist:!0,passiveSkills:{}},maxCircle:{ELEMENTAL:8,LIFE:4,MIND:4,MATTER:8},attack:1,magic:6,carry:16,hp:40,mp:50,evadeChance:5,longDescription:"> Can read elemental spell scrolls several times and unleash their full power.\n> Can cast high level spells safely.",shortDescription:"Master of the Elemental magic, can multicast and unleash full power.",isFellowship:!0,drawingIndex:7},WITCH:{code:"WITCH",name:"Lunar Witch",shortName:"Witch",defaultSkinTone:1,defaultHairColor:0,defaultFemaleHairColor:2,defaultMaleHairType:5,defaultMaleBeardType:0,defaultFemaleHairType:4,startingWeapon:"Cursed Broom-95",secondaryWeapon:"Flame Wand-44",startingArmorFemale:"Moon Tunic97",startingLegwear:"Green Pants10",startingLegwearFemale:!1,startingUtility:["bandage","bandage","befriendMonsterSpell"],startingSpells:["Vertigo"],features:{alchemyExpert:!0,throwStrength:10,elementalSpecialist:!1,hexSpells:!0,passiveSkills:{}},maxCircle:{ELEMENTAL:0,LIFE:0,MIND:0,MATTER:0,WITCHCRAFT:8},attack:1,magic:4,carry:16,hp:40,mp:0,evadeChance:5,longDescription:"> Inflicts curses and maladies sacrificing its own blood.\n> Can reuse reagents to brew powerful concoctions",shortDescription:"Inflicts curses and maladies sacrificing its own blood.",isFellowship:!0,drawingIndex:23,drawingIndexFemale:24},SHEPHERD:{code:"SHEPHERD",name:"Shepherd",shortName:"Shepherd",defaultSkinTone:1,defaultHairColor:3,defaultMaleHairType:7,defaultMaleBeardType:3,defaultFemaleHairType:1,startingWeapon:"Shepherd Staff-87",startingArmor:"Black Hooded Robe32",startingUtility:["bandage","bandage"],startingSpells:[],startingPet:"SHEEP",features:{canUseBows:!1,cumbersomeWeaponUser:!0,throwStrength:10,passiveSkills:{}},maxCircle:{ELEMENTAL:0,LIFE:0,MIND:0,MATTER:0},attack:1,magic:0,carry:16,hp:40,mp:0,evadeChance:5,longDescription:"> Tends herds of sheep.\n> Does not stand a chance to survive.",shortDescription:"Lifelong sheep herder. Does not stand a chance to survive.",isFellowship:!1,drawingIndex:8}};

},{}],26:[function(require,module,exports){
var circular=require("circular-functions");function Race(i,s,t,e,a,c,r,h,l,u,n,o,f,R,d,k,m){this.code=i,this.name=s,this.description=t,this.tameFactor=m,this.skillsDescription=e,this.spriteIndex=a,this.material=u,this.hpRoll=c,this.damageRoll=r,this.evadeChance=n,this.features=h,this.language=k,this.skills=l||{},this.skills._c=circular.setSafe(),this.baseSkillPoints=o,this.attackType=f,this.attackSFX=R,this.anatomy=d,h||(this.features={}),this.features._c=circular.setSafe(),this._c=circular.register("Race")}module.exports=Race,circular.registerClass("Race",Race);

},{"circular-functions":43}],27:[function(require,module,exports){
var circular=require("circular-functions");function Roll(i,t,r){this.multiplier=i,this.base=t,this.modifier=r,this.modifier||(this.modifier=0),this._c=circular.register("Roll")}module.exports=Roll,circular.registerClass("Roll",Roll),Roll.prototype.roll=function(){for(var i=0,t=0;t<this.multiplier;t++)i+=rand(1,this.base);return i+this.modifier},Roll.prototype.getDescription=function(){return 0!=this.modifier?this.modifier>0?this.multiplier+"D"+this.base+"+"+this.modifier:this.multiplier+"D"+this.base+this.modifier:1==this.base?this.multiplier+"":this.multiplier+"D"+this.base},Roll.prototype.clone=function(){return new Roll(this.multiplier,this.base,this.modifier)},Roll.prototype.getAverage=function(){var i=this.base+this.modifier,t=this.base*this.multiplier+this.modifier;return Math.ceil((i+t)/2)},Roll.prototype.increaseModifier=function(){this.modifier++};

},{"circular-functions":43}],28:[function(require,module,exports){
var circular=require("circular-functions"),Util=require("./Util");function Room(){this.monsters=new Array,this.items=new Array,this.hotspots=new Array,this.portals=new Array,this.bloods=new Array,this.garbage=new Array,this.columns=new Array,this.obstacles=new Array,this._c=circular.register("Room")}module.exports=Room,circular.registerClass("Room",Room,{transients:{hotspots:!0,grid:!0},reviver:function(e,t){e.grid=new PF.Grid(e.width,e.height)}});var CellType=require("./CellType.enum");Room.prototype.addBlood=function(e,t,r){if("YENDOR"!==this.level.environment&&!this.map[e][t].equals(CellType.STAIRS)&&!this.map[e][t].equals(CellType.HEALING_POND)){var o={x:e,y:t,type:r,_c:circular.setSafe()};this.bloods.push(o),this.level.player&&this.level.player.currentRoom==this&&this.level.player.gameController.addBloodToRoom(o)}},Room.prototype.isStairs=function(e,t){return this.map[e][t].equals(CellType.STAIRS)},Room.prototype.isPond=function(e,t){return this.map[e][t].equals(CellType.HEALING_POND)},Room.prototype.addColumn=function(e,t){this.columns.push({x:e,y:t,description:"Column",tileIndex:65,_c:circular.setSafe()}),this.removeGarbage(e,t),this.removeGarbage(e,t-1)},Room.prototype.removeGarbage=function(e,t){for(var r=0;r<this.garbage.length;r++){var o=this.garbage[r];o.x==e&&o.y==t&&this.garbage.removeObject(o)}},Room.prototype.addObstacle=function(e,t,r,o,i,s){this.obstacles.push({x:e,y:t,description:o,tileIndex:r,_c:circular.setSafe(),blocksRangedAttacks:i,specialDescription:s})},Room.prototype.addGarbage=function(e,t,r){var o={x:e,y:t,type:r,_c:circular.setSafe()};this.garbage.push(o)},Room.prototype.setMap=function(e){this.map=e,this.height=e[0].length,this.width=e.length,this.grid=new PF.Grid(this.width,this.height)},Room.prototype.addEnemy=function(e,t){(t||(t=this.getFreePlace()))&&(this.monsters.push(e),e.x=t.x,e.y=t.y,e.currentRoom=this)},Room.prototype.addItem=function(e,t,r){this.items.push(e),e.x=t.x,e.y=t.y,r||(chance(80)&&this.addBlood(e.x,e.y,rand(6,11)),chance(20)&&this.addBlood(e.x,e.y,rand(0,5)))},Room.prototype.addPortal=function(e,t,r,o,i){var s="",n=0,l=0;0==e?(s="left",n=-1):0==t?(s="up",l=-1):e==this.width-1?(s="right",n=1):(s="down",l=1);var a={x:e,y:t,dx:n,dy:l,destinationRoom:r,destination:{x:o,y:i,_c:circular.setSafe()},direction:s,_c:circular.register("Portal")};this.portals.push(a)},Room.prototype.removeEnemy=function(e){this.monsters.removeObject(e)},Room.prototype.removeItem=function(e){this.items.removeObject(e)},Room.prototype.locatePlayer=function(e,t){if(t||(t=this.startingPosition),e.x=t.x,e.y=t.y,e.pet){var r=this.getFreePlaceAround(e);r||(r=e),e.pet.placementOffset=!1,e.pet.x=r.x,e.pet.y=r.y,this.addEnemy(e.pet,{x:e.pet.x,y:e.pet.y})}e.currentRoom=this},Room.prototype.getFreePlaceAround=function(e){for(var t=5e4;;){if(--t<=0)return!1;var r={x:rand(-1,1),y:rand(-1,1)};if((0!=r.x||0!=r.y)&&(r.x+=e.x,r.y+=e.y,this.isFreeFloor(r.x,r.y)&&(!this.level.player||this.level.player.x!=r.x||this.level.player.y!=r.y)))return r}},Room.prototype.getFreePlace=function(){for(var e=5e4;;){if(--e<=0)return!1;var t={x:0,y:0};if(t.x=rand(1,this.width-2),t.y=rand(1,this.height-2),this.isFreeFloor(t.x,t.y)&&(!this.level||!this.level.player||this.level.player.x!=t.x||this.level.player.y!=t.y))return t}},Room.prototype.getEnemy=function(e,t){for(var r=0;r<this.monsters.length;r++){var o=this.monsters[r];if(o.x===e&&o.y===t)return o}return!1},Room.prototype.getItem=function(e,t){for(var r=0;r<this.items.length;r++){var o=this.items[r];if(o.x===e&&o.y===t)return o}return!1},Room.prototype.getPortalOn=function(e){return this.getPortalOnXY(e.x,e.y)},Room.prototype.getPortalOnXY=function(e,t){for(var r=0;r<this.portals.length;r++){var o=this.portals[r];if(o.x===e&&o.y===t)return o}return!1},Room.prototype.getPortalTo=function(e){for(var t=0;t<this.portals.length;t++){var r=this.portals[t];if(r.destinationRoom==e)return r}return!1},Room.prototype.canWalkTo=function(e,t){return!!this.isValidIncludingBorders(e,t)&&(!this.isSolid(e,t)&&!this.getEnemy(e,t))},Room.prototype.isSolid=function(e,t,r){return e>this.width-1||t>this.height-1||e<0||t<0||(!!this.map[e][t].isSolid||!!this.hasObstacles(e,t,r))},Room.prototype.isSwimmable=function(e,t){return!(e>this.width-1||t>this.height-1||e<0||t<0)&&!!this.map[e][t].isSolid},Room.prototype.getSwimmable=function(){for(var e=100;;){if(--e<=0)return!1;var t=rand(1,this.width-2),r=rand(1,this.height-2);if(this.isSwimmable(t,r))return{x:t,y:r}}},Room.prototype.isDepressed=function(e,t){return!(e>this.width-1||t>this.height-1||e<0||t<0)&&this.map[e][t].isDepressed},Room.prototype.hasObstacles=function(e,t,r){return!(0==this.getObstacle(e,t,r))},Room.prototype.getObstacle=function(e,t,r){if(!r)for(var o=0;o<this.columns.length;o++)if(this.columns[o].x==e&&(this.columns[o].y==t||this.columns[o].y-1==t))return this.columns[o];for(o=0;o<this.obstacles.length;o++)if(this.obstacles[o].x==e&&this.obstacles[o].y==t)return this.obstacles[o];return!1},Room.prototype.paintTop=function(e,t){return!(e>this.width-1||t>this.height-1||e<0||t<0)&&this.map[e][t].paintTop},Room.prototype.monsterCanWalkTo=function(e,t,r,o,i){if(!this.isValidIncludingBorders(t,r))return!1;if(this.isSolid(t,r))return!1;var s=!1;if(this.level.player.x==t&&this.level.player.y==r){if(s=this.level.player,e)return!1;if(o)return!1}return s||(s=this.getEnemy(t,r)),s?!o&&(e?!s.isFriendly:s.isFriendly):!i},Room.prototype.isFreeFloor=function(e,t,r){if(e>this.width-1||t>this.height-1||e<0||t<0)return!1;if(this.isSolid(e,t))return!1;var o=this.getEnemy(e,t);return!!(!o||r&&o.race.features.invisible)&&(!this.getItem(e,t)&&((!this.isExit||this.exit.x!=e||this.exit.y!=t)&&!this.map[e][t].isSolid))},Room.prototype.getCell=function(e,t){return this.map[e][t]},Room.prototype.monsterTurn=function(e){this.monsterStack=new Array;for(var t=0;t<this.monsters.length;t++){var r=this.monsters[t];if(r.cancelExtraTurns=!1,this.monsterStack.push({_c:circular.register("TurnInfo"),enemy:r}),(r.race.features.doubleSpeed||r.race.features.doubleAttack)&&r.canUseSkills()){var o={_c:circular.register("TurnInfo"),isExtraTurn:!0};r.race.features.doubleSpeed&&(o.move=!0,o.attack=!0),r.race.features.doubleAttack&&(o.attack=!0),o.enemy=r,this.monsterStack.push(o)}if(r.race.features.tripleAttack&&r.canUseSkills())(o={_c:circular.register("TurnInfo"),isExtraTurn:!0,attack:!0}).enemy=r,this.monsterStack.push(o)}this.monsterAct(0,e)},Room.prototype.safeQuietMonsterTurn=function(e){for(var t=0;t<this.monsters.length;t++){var r=this.monsters[t];if(r.updateStatus(),!r.dead){var o=r.decideIntent();r.isFriendly&&"stand"!==o&&"flee"!==o&&r.moveOffscreenTo(e)}}},Room.prototype.isPortalUseable=function(e){var t=e.destinationRoom;if(t==this.level.player.currentRoom)return!1;var r=t.getPortalTo(this);return!!t.getPlaceAroundWalkableByMonster(r)},Room.prototype.getPlaceAroundWalkableByMonster=function(e){return this.monsterCanWalkTo(!1,e.x+1,e.y,!0,!1)?{x:e.x+1,y:e.y}:this.monsterCanWalkTo(!1,e.x+1,e.y+1,!0,!1)?{x:e.x+1,y:e.y+1}:this.monsterCanWalkTo(!1,e.x+1,e.y-1,!0,!1)?{x:e.x+1,y:e.y-1}:this.monsterCanWalkTo(!1,e.x,e.y+1,!0,!1)?{x:e.x,y:e.y+1}:this.monsterCanWalkTo(!1,e.x,e.y-1,!0,!1)?{x:e.x,y:e.y-1}:this.monsterCanWalkTo(!1,e.x-1,e.y,!0,!1)?{x:e.x-1,y:e.y}:this.monsterCanWalkTo(!1,e.x-1,e.y+1,!0,!1)?{x:e.x-1,y:e.y+1}:!!this.monsterCanWalkTo(!1,e.x-1,e.y-1,!0,!1)&&{x:e.x-1,y:e.y-1}},Room.prototype.warpMonster=function(e,t,r){var o={x:0,y:0};switch(t.direction){case"up":o.y=-1;break;case"down":o.y=1;break;case"left":this.level.player.dungeonLevel.isRetro||e.facingLeft||(e.facingLeft=!0,e.sprite.scale.x*=-1),o.x=-1;break;case"right":!this.level.player.dungeonLevel.isRetro&&e.facingLeft&&(e.facingLeft=!0,e.sprite.scale.x*=-1),o.x=1}var i={x:32*e.x+16+32*o.x*3};e.isFloating()?i.baseY=32*e.y+this.level.player.gameController.YOFFSET+32*o.y*3:i.y=32*e.y+this.level.player.gameController.YOFFSET+32*o.y*3;var s=this.level.player.gameController.tween(e.sprite).to(i,this.level.player.gameController.ENTER_ROOM_TWEEN_TIME,Phaser.Easing.Sinusoidal.Out),n=t.destinationRoom,l=n.getPortalTo(this),a=n.getPlaceAroundWalkableByMonster(l),h=this.level.player.gameController;s.onComplete.add(function(){e.currentRoom.removeEnemy(e),e.x=a.x,e.y=a.y,n.addEnemy(e,e),n==h.player.currentRoom&&h.addMonsterToRoom(e,!1,!0),h.killImage(e.sprite),e.isPet()&&(h.player.petAway=h.player.pet,h.player.pet=!1,h.updatePetStats()),r()}),h.startTween(e.sprite,s)},Room.prototype._monsterFlood=function(e,t){for(var r=!1,o=0;o<this.portals.length;o++){var i=this.portals[o].destinationRoom;if(!e||i!=e){i._monsterFlood(this);var s=i.leakMonstersTo(this);s&&(i.removeEnemy(s),s.placementOffset=!1,s.x=this.portals[o].x,s.y=this.portals[o].y,this.addEnemy(s,s),this==this.level.player.currentRoom&&(r=!0,s.isFriendly?(this.level.player.gameController.addMonsterToRoom(s,!1,!t),s.oldx=s.x,s.oldy=s.y):this.level.player.gameController.addMonsterToRoom(s,!1,!0)))}}return r},Room.prototype.leakMonstersTo=function(e){var t=e.getPortalTo(this),r=!1,o=!1;e.monsterCanWalkTo(!1,t.x,t.y,!0,!1)&&(e.isFriendlyNextTo(t.x,t.y)||(o=!0),r=!0);for(var i=!1,s=this.getPortalTo(e),n=0;n<this.monsters.length;n++){var l=this.monsters[n];if(l.updateStatus(),!l.dead)if(l.alerted||l.isFriendly)if(!l.race.features.guardItems||l.isFriendly||l.hitByPlayer)if(!l.isNPC)if(l.nextToTarget(s))"attack"===l.decideIntent(l.attackConfused())&&(l.isFriendly&&r||!l.isFriendly&&o)&&(i=l,o=!1,r=!1);else this.isValidIncludingBorders(s.x,s.y)&&(l.stayInRoom||l.moveOffscreenTo(s))}return i},Room.prototype.alertNearbyMonsters=function(e,t){if(!(e<0))for(var r=0;r<this.portals.length;r++){var o=this.portals[r].destinationRoom;t&&o==t||(o.alertMonstersOnRoom(e),o.alertNearbyMonsters(e-10,this))}},Room.prototype.alertMonstersOnRoom=function(e){for(var t=0;t<this.monsters.length;t++){var r=this.monsters[t];!r.alerted&&r.race.features&&r.race.features.chasePlayer&&(r.race.skills.telepathy||chance(e))&&(r.alerted=!0)}},Room.prototype.monsterAct=function(e,t){if(e>=this.monsterStack.length){t&&t();var r=this._monsterFlood()?this.level.player.gameController.ENTER_ROOM_TWEEN_TIME+200:0;this.level.player.gameController.schedule(function(){if(this.level.player&&!this.level.player.dead){if(this.level.player.hitPoints.current<=0)return this.level.player.die(),void this.level.player.gameController.showGameOverScreen();if(this.level.player.isParalyzed()||this.level.player.panickTurns>0||this.level.player.losesTurnsForEncumberment()){var e=this;this.level.player.autoTurn(function(){e.monsterTurn(function(){e.level.player.updateStatus()})})}else this.level.player.afterMonsterTurn?(this.level.player.afterMonsterTurn(),this.level.player.afterMonsterTurn=null):(this.level.player.gameController.logEvent("Input enabled, monsterAct after monster turn"),this.level.player.gameController.enablePlayerAction())}},r,this)}else{var o=this,i=this.monsterStack[e];i.enemy.act(function(){o.level.player.gameController.stampLastAction(),o.monsterAct(e+1,t)},i)}},Room.prototype.isSafe=function(){if(0==this.monsters.length)return!0;for(var e=0;e<this.monsters.length;e++){if(!this.monsters[e].isFriendly)return!1}return!0},Room.prototype.isValidIncludingBorders=function(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height},Room.prototype.clearLOS=function(e,t){for(var r=Util.line(e,t),o=1;o<r.length-1;o++){var i=r[o];if(!this.canWalkTo(i.x,i.y)&&!this.isDepressed(i.x,i.y))return!1;if(this.level.player.x==i.x&&this.level.player.y==i.y)return!1}return!0},Room.prototype.getObjectBlockingLOS=function(e,t){for(var r=Util.line(e,t),o=1;o<r.length-1;o++){var i=r[o];if(!this.canWalkTo(i.x,i.y)&&!this.isDepressed(i.x,i.y)){if(this.map[i.x][i.y].isSolid)return{type:"cell",cell:this.map[i.x][i.y],x:i.x,y:i.y};var s=this.getObstacle(i.x,i.y,!1);if(s)return!!s.blocksRangedAttacks&&{type:"obstacle",obstacle:s};var n=this.getEnemy(i.x,i.y);return n?!n.isFriendly&&{type:"monster",monster:n}:{type:"error"}}if(this.level.player.x==i.x&&this.level.player.y==i.y)return{type:"player",player:this.level.player}}return!1},Room.prototype.getEnemies=function(){for(var e=new Array,t=0;t<this.monsters.length;t++){var r=this.monsters[t];r.isFriendly||e.push(r)}return e},Room.prototype.getFriendlies=function(){for(var e=new Array,t=0;t<this.monsters.length;t++){var r=this.monsters[t];r.isFriendly&&e.push(r)}return e},Room.prototype.markEnemiesOnPathfindingGrid=function(e,t){for(var r=0;r<this.monsters.length;r++){var o=this.monsters[r];t&&o.isFriendly||e.setWalkableAt(o.x,o.y,!1)}this==this.level.player.currentRoom&&e.setWalkableAt(this.level.player.x,this.level.player.y,!1)},Room.prototype.darkenRoom=function(){for(var e=0;e<this.monsters.length;e++){this.monsters[e].sprite.loadTexture("blank")}},Room.prototype.lightenRoom=function(){for(var e=0;e<this.monsters.length;e++)this.monsters[e].resetSprite()},Room.prototype.switchPerception=function(){for(var e=0;e<this.monsters.length;e++)if(!chance(40)){var t=this.monsters[e],r=this.level.player.gameController.monsterFactory.getSimilarRace(t.race);r&&t.morphSprite(r)}for(e=0;e<this.items.length;e++)if(!chance(40)){var o=this.items[e],i=this.level.player.gameController.itemFactory.getSimilarItemDefinition(o);i&&o.sprite.loadTexture(o.groundTileset,i.index)}},Room.prototype.recoverPerception=function(){this.lightenRoom();for(var e=0;e<this.items.length;e++){var t=this.items[e];t.sprite.loadTexture(t.groundTileset,t.groundIndex)}},Room.prototype.sortMonsters=function(){this.monsters.sort(function(e,t){return e.y-t.y});for(var e=0;e<this.monsters.length;e++){var t=this.monsters[e];t.sprite&&(t.sprite.bringToTop(),this.level.player.sprite&&t.y<=this.level.player.y&&this.level.player.sprite.bringToTop())}this.level.player.pet&&this.level.player.x==this.level.player.pet.x&&this.level.player.y==this.level.player.pet.y&&this.level.player.pet.sprite&&this.level.player.pet.placementOffset&&this.level.player.pet.placementOffset.y>=0&&!this.level.player.dungeonLevel.isRetro&&this.level.player.pet.sprite.bringToTop(),this.level.player.gameController.superImage&&this.level.player.gameController.superImage.bringToTop()},Room.prototype.getEnvironment=function(){return this.environment?this.environment:this.level.environment},Room.prototype.isFriendlyNextTo=function(e,t){if(this.level.player&&this.level.player.currentRoom==this){var r=Math.abs(e-this.level.player.x),o=Math.abs(t-this.level.player.y);if(r<=1&&o<=1)return!0}for(var i=this.getFriendlies(),s=0;s<i.length;s++){r=Math.abs(e-i[s].x),o=Math.abs(t-i[s].y);if(r<=1&&o<=1)return!0}return!1};

},{"./CellType.enum":7,"./Util":36,"circular-functions":43}],29:[function(require,module,exports){
function SFXController(e,a){this.gameController=e,this.enabled=a}module.exports=SFXController,SFXController.prototype.init=function(){var e=this.gameController.phaser;this.sfx={slash1:e.add.audio("sfx-slash-1",.5),slash2:e.add.audio("sfx-slash-2",.5),slash3:e.add.audio("sfx-slash-3",.5),hit:e.add.audio("sfx-hit",.5),shoot:e.add.audio("sfx-shoot",.5),punch:e.add.audio("sfx-punch",.5),tap:e.add.audio("sfx-tap",.5),step:e.add.audio("sfx-step",.5),explosion:e.add.audio("sfx-explosion",.5),breaking:e.add.audio("sfx-break",.5),death:e.add.audio("sfx-death",.5),beep:e.add.audio("sfx-beep",.5),potion:e.add.audio("sfx-potion",.5),spell:e.add.audio("sfx-spell",.5),playerMagic:e.add.audio("sfx-magic",.5),magic:e.add.audio("sfx-magic",.5)}},SFXController.prototype.play=function(e){this.gameController.preferences.soundEnabled&&this.enabled&&(this.sfx?this.sfx[e]?this.sfx[e].play("",0,.2):(this.sfx.beep.play("",0,.2),this.gameController.sendTipToDevteam("SFXController Tip 1, tried to play "+e)):this.gameController.sendTipToDevteam("SFXController not initialized, tried to play key "+e))},SFXController.prototype.switchEnabled=function(){this.enabled=!this.enabled,this.enabled?this.gameController.preferences.sfxEnabled=!0:this.gameController.preferences.sfxEnabled=!1,this.gameController.savePreferences()};

},{}],30:[function(require,module,exports){
module.exports={buildDescriptionsFrom:function(e){for(var a=this._getSkillsFrom(e),s=[],i=0;i<a.length;i++)s.push(a[i].name+": "+a[i].description);return s},_getSkillsFrom:function(e){var a=[];return e.features.alchemyExpert&&a.push(this.SKILL_DESCRIPTIONS.ALCHEMY_EXPERT),e.features.weaponExpert&&a.push(this.SKILL_DESCRIPTIONS.WEAPON_EXPERT),e.features.passiveSkills.shieldExpert&&a.push(this.SKILL_DESCRIPTIONS.SHIELD_EXPERT),e.features.canUseHeavyArmor&&a.push(this.SKILL_DESCRIPTIONS.ARMOR_EXPERT),e.hasExtremeAccuracy()&&a.push(this.SKILL_DESCRIPTIONS.EXTREME_ACCURACY),e.bowBonus&&a.push(this.SKILL_DESCRIPTIONS.DEADLY_SHOT),e.bowBonus&&a.push(this.SKILL_DESCRIPTIONS.ARROWS_EXPERT),e.isMagicExpert()&&a.push(this.SKILL_DESCRIPTIONS.MAGIC_EXPERT),e.boostEnergyMagic()&&a.push(this.SKILL_DESCRIPTIONS.ENERGY_MAGIC_EXPERT),e.features.wandExpert&&a.push(this.SKILL_DESCRIPTIONS.WANDS_PRESERVE),e.features.wandExpert&&a.push(this.SKILL_DESCRIPTIONS.WANDS_EXPERT),e.canParry&&a.push(this.SKILL_DESCRIPTIONS.PARRY),e.features.slashSkill&&a.push(this.SKILL_DESCRIPTIONS.SLASH),e.features.assaultSkill&&a.push(this.SKILL_DESCRIPTIONS.ASSAULT),e.features.throwingWeaponsExpert&&a.push(this.SKILL_DESCRIPTIONS.THROWING_EXPERT),e.features.stealthBonus&&e.features.stealthBonus>0&&a.push(this.SKILL_DESCRIPTIONS.STEALTH),e.features.chargeSkill&&a.push(this.SKILL_DESCRIPTIONS.CHARGE),e.features.courageSkill&&a.push(this.SKILL_DESCRIPTIONS.COURAGE),e.features.rageSkill&&a.push(this.SKILL_DESCRIPTIONS.RAGE),e.features.flyingKickSkill&&a.push(this.SKILL_DESCRIPTIONS.FLYING_KICK),e.features.unarmedBonus&&a.push(this.SKILL_DESCRIPTIONS.MASTER_MARTIAL_ARTIST),e.immuneToDisease()&&a.push(this.SKILL_DESCRIPTIONS.IMMUNE),(e.boostElementalMagic()||e.boostAllMagic())&&a.push(this.SKILL_DESCRIPTIONS.ELEMENTAL_MAGIC_EXPERT),"Shepherd"==e.className&&a.push(this.SKILL_DESCRIPTIONS.SHEPHERDING),e.features.passiveSkills.superDefenseDefensive&&a.push(this.SKILL_DESCRIPTIONS.SUPER_DEFENSIVE),e.features.passiveSkills.superEvadeDefensive&&a.push(this.SKILL_DESCRIPTIONS.SUPER_EVADE),e.features.passiveSkills.superDamageAggressive&&a.push(this.SKILL_DESCRIPTIONS.SUPER_DAMAGE),e.features.passiveSkills.unlimitedCombatUpgrades&&a.push(this.SKILL_DESCRIPTIONS.UNLIMITED_COMBAT_UPGRADES),e.features.passiveSkills.superHitAggressive&&a.push(this.SKILL_DESCRIPTIONS.SUPERIOR_HIT),a},SKILL_DESCRIPTIONS:{UNLIMITED_COMBAT_UPGRADES:{name:"War Patronage",description:"#You# #can# upgrade Combat and Hit Points indefinitely",longDescription:"When leveling up, you can select upgrades for combat and hit points improvements without any limit."},ALCHEMY_EXPERT:{name:"Alchemy Expert",description:"#You# #can# use reagents multiple times",longDescription:"You can use reagents multiple times."},WEAPON_EXPERT:{name:"Weapons Expert",description:"#You# #preserve# weapons from damage",longDescription:"When hitting with a weapon in melee combat, you have a lower chance (33% vs 50%) of damaging and spending it"},SHIELD_EXPERT:{name:"Shield Expert",description:"#You# #can# wield shields in combat without any penalty",longDescription:"Can use aggresive tactics while wielding a shield"},ARMOR_EXPERT:{name:"Armor Expert",description:"#You# #can# use heavy armor without becoming encumbered",longDescription:'Allows wearing armor and shields marked as "Heavy" without falling to the "Encumbered" status, which may cause losing turns.'},EXTREME_ACCURACY:{name:"Extreme Accuracy",description:"#You# #are# extremely accurate with bows",longDescription:"Has a 95% chance of hitting with arrows (instead of the normal 70% chance)"},DEADLY_SHOT:{name:"Deadly Shot",description:"#Your# bow shots #are2# deadly",longDescription:"Duplicates damage caused by bows on flesh enemies"},ARROWS_EXPERT:{name:"Arrows Expert",description:"#You# #prevent# arrows from breaking",longDescription:"You have a 60% chance of arrows being reuseable after an attack (instead of the usual 30%)"},MAGIC_EXPERT:{name:"Magic Expert",description:"#You# #can# use all spells safely",longDescription:"Can use advanced magic as well as any sort of magic without backfire risk (5%)"},ENERGY_MAGIC_EXPERT:{name:"Energy Magic Expert",description:"#Your# Life and Matter spells #are2# stronger",longDescription:"Increases the effects of spells from Life and Matter schools."},WANDS_PRESERVE:{name:"Wands Preserver",description:"#You# #preserve# wand charges",longDescription:"Has a 1/3 chance of a wand not being spent after using it"},WANDS_EXPERT:{name:"Wands Expert",description:"#Your# wand attacks always hit",longDescription:"Wand attacks ALWAYS hit (100% chance)"},PARRY:{name:"Parry",description:"#You# #can# parry attacks with #your# weapon",longDescription:"Has a 20% chance of deflecting attacks in melee combat, having the weapon take the damage instead. Requires a weapon that can parry."},SLASH:{name:"Slash",description:"#You# #slash# through enemies",longDescription:"Damages enemies by walking by them. For example if there's an enemy above you and another one to your left, and you move in the up-right direction, you will strike them both. Also works for cardinal movement"},ASSAULT:{name:"Assault",description:"#You# #can# assault enemies",longDescription:'When continuing running on the same general direction (See "Running") and having an enemy in front of you, you will jump over him, performing an anticipated attack'},THROWING_EXPERT:{name:"Throwing Expert",description:"#You# #are# extremely accurate with thrown weapons",longDescription:"Base accuracy when throwing objects is 90% (instead of the usual 80%)"},STEALTH:{name:"Stealth",description:"#You# #are# stealthy",longDescription:"Reduces the noise level caused by movement and combat actions, making it less likely for monsters in other rooms to notice you"},CHARGE:{name:"Charge",description:"#You# #can# charge on enemies",longDescription:'Doubles damage when attacking with a weapon on the same general direction you are running (See "Running"), charges cannot be parried by enemies'},COURAGE:{name:"Courage",description:"#You# #recover# #your# health on battle",longDescription:"Recovers 1 hit point after defeating an enemy"},RAGE:{name:"Rage",description:"#Your# attacks #get# stronger when #you# #are# dying",longDescription:"Increases damage up to 200%, based on the current proportion of HP/HP max."},FLYING_KICK:{name:"Flying Kick",description:"#You# #can# hit #your# enemies with flying kicks",longDescription:"Jumps into enemies that are one tile away with a martial attack (Without using a weapon)."},MASTER_MARTIAL_ARTIST:{name:"Master Martial Artist",description:"#You# #are# a master martial artist",longDescription:"When attacking without using weapons, base damage is 3 plus a bonus topping Combat * 2"},IMMUNE:{name:"Immunity",description:"#Your# body and mind #are2# immune to disease",longDescription:"Cannot be paralyzed nor weakened"},ELEMENTAL_MAGIC_EXPERT:{name:"Elemental Magic Expert",description:"#Your# Elemental spells #are2# stronger",longDescription:"Duplicates damage caused by Elemental Magic spells"},SHEPHERDING:{name:"Shepherding",description:"#You# #can# take care of sheep",longDescription:"Can handle herds of sheep with ease"},SUPER_DEFENSIVE:{name:"Superior Defense",description:"#Your# Defensive tactics #are2# outstanding",longDescription:"Received damaged is halved (instead of being reduced by 20%) when using Defensive tactics"},SUPER_EVADE:{name:"Superior Evade",description:"#Your# Evasion tactics #are2# outstanding",longDescription:"Evasion is increased by 20% (instead of 10%) when using Defensive tactics"},SUPER_DAMAGE:{name:"Superior Damage",description:"#Your# Aggresive tactics #are2# devastating",longDescription:"Damage is increased by 80% (instead of 50%) when using Aggresive tactics"},SUPERIOR_HIT:{name:"Superior Accuracy",description:"#Your# Aggresive tactics #are2# outstanding",longDescription:"Accuracy is increased by 10% (instead of 5%) when using Aggresive tactics"}}};

},{}],31:[function(require,module,exports){
var circular=require("circular-functions"),Effects=require("./Effects"),ActionValidator=require("./ActionValidator"),Spells={spellsByWordsMap:{},spellsBySchool:{ELEMENTAL:[],MATTER:[],LIFE:[],MIND:[],WITCHCRAFT:[],NONE:[]},getSpell:function(e){return this.spellsByWordsMap[e]},castSpell:function(e,l,a,i){this._useSpell(e,l,a,i,e.magicPower.current,!0)},useScroll:function(e,l,a,i,t){this._useSpell(e,l,a,i,t.features.magicPower,!1)},_useSpell:function(e,l,a,i,t,r){!ActionValidator[a.effect]||ActionValidator[a.effect](e,l,a)?(a.animation&&e.gameController.particleAnimationAt(a.animation,e),a.features.notMagicSpell?(Effects[a.effect](e,l,a,0,i),"magicAttack"===a.effect||a.features.controlFlow||i(!0)):(e.gameController.playSFX("spell"),e.gameController.showTextBy(e,a.words+"!"),e.gameController.fadeAnimation(e.sprite,a.color,1e3,function(){var s=10*(a.circle-t);r||(s=0),chance(80-s)?(Effects[a.effect](e,l,a,t,i,r),"magicAttack"===a.effect||a.features.controlFlow||i(!0)):(e.failSpell(),i(!1))}))):i(!1)},addSpell:function(e,l,a,i,t,r,s,o,n,c,p,S,d,m,u,h,g){var f=new Spell(e,l,a,i,t,r,s,o,n,c,p,S,d,m,u,h,g);f.features.isSpell=!0,this.spellsByWordsMap[f.words]=f,this.spellsBySchool[f.school][f.circle]||(this.spellsBySchool[f.school][f.circle]=[]),this.spellsBySchool[f.school][f.circle].push(f)},getSpellsOfSchoolOfCircle:function(e,l){return this.spellsBySchool[e][l]?this.spellsBySchool[e][l]:[]},getIconTexture:function(e,l){var a=e.getImage(0,0,"spells",l.icon),i=a.texture;return e.killImage(a),i},getSprite:function(e,l){return e.getImage(0,0,"spells",l.icon,null)},ELEMENTAL:"ELEMENTAL",MATTER:"MATTER",LIFE:"LIFE",MIND:"MIND",WITCHCRAFT:"WITCHCRAFT",NONE:"NONE"};function Spell(e,l,a,i,t,r,s,o,n,c,p,S,d,m,u,h,g){this.code=e,this.school=l,this.words=a,this.description=i,this.icon=s,this.effect=o,this.animation=c,this.color=p,this.isAdvancedMagic=n,this.targeted=S,this.autoUseOnEnemy=d,this.shouldNotUseOnSelf=m,this.features=g,g&&(this.features._c=circular.setSafe()),this.circle=t,this.mpCost=r,this.patronName=u,this.patronIndex=h,this._c=circular.register("Spell")}circular.registerClass("Spell",Spell),Spell.prototype={isFreezing:function(){return"freezing"===this.features.damageType},isBurning:function(){return"burning"===this.features.damageType},isAcid:function(){return"acid"===this.features.damageType},isHoly:function(){return"holy"===this.features.damageType},isSlashing:function(){return"slashing"===this.features.damageType},isPiercing:function(){return"piercing"===this.features.damageType},isBlunt:function(){return"blunt"===this.features.damageType},isChopping:function(){return"chopping"===this.features.damageType},isEtherDamage:function(){return"ether"===this.features.damageType},damageModifier:function(e){switch(e){case Material.FLESH:return this.isBurning()?1.4:this.isFreezing()?1.2:this.isAcid()?1.2:this.isSlashing()||this.isPiercing()?1.3:1;case Material.ETHER:if(this.isEtherDamage())return 3;case Material.BONE:return this.isBlunt()?1.3:this.isAcid()?1.4:this.isHoly()?3:this.isPiercing()?.2:1;case Material.WOOD:return this.isBurning()?3:this.isChopping()?2:this.isSlashing()||this.isPiercing()?.2:1}return 1}},Spells.addSpell("iceBoltScroll","ELEMENTAL","Jan Spak","Shoots a bolt of ice.",1,4,26,"magicAttack",!1,"wizardry",255,!0,!0,!0,"Aylos",43,{damageType:"freezing",magicShape:"BOLT",projectile:"iceBolt"}),Spells.addSpell("fireBoltScroll","ELEMENTAL","Pyr Spak","Shoots a bolt of fire.",1,4,25,"magicAttack",!1,"wizardry",16711680,!0,!0,!0,"Pyrion",44,{damageType:"burning",magicShape:"BOLT",projectile:"flameBolt"}),Spells.addSpell("freezeBoltScroll","ELEMENTAL","Ram Jan Spak","Shoots a bolt of freezing ice.",2,6,27,"magicAttack",!1,"wizardry",255,!0,!0,!0,"Aylos",43,{damageType:"freezing",magicShape:"BOLT",projectile:"iceBolt",magicPower:2}),Spells.addSpell("fireBallScroll","ELEMENTAL","Pyr Won","Creates a disc of flames.",3,6,24,"magicAttack",!1,"wizardry",16711680,!0,!0,!0,"Pyrion",44,{damageType:"burning",magicShape:"BALL",projectile:"flameBall"}),Spells.addSpell("lightningBallScroll","ELEMENTAL","Krak Won","Creates a disc of lightning.",4,8,29,"magicAttack",!1,"wizardry",65535,!0,!0,!0,"Zephko",42,{magicShape:"BALL",projectile:"lightningBall"}),Spells.addSpell("firePillarScroll","ELEMENTAL","Pyr Ran","Creates a pillar of flames.",5,8,22,"magicAttack",!0,"wizardry",16711680,!0,!0,!0,"Pyrion",44,{damageType:"burning",magicShape:"PILLAR"}),Spells.addSpell("fireTornadoScroll","ELEMENTAL","Pyr Wos","Creates a tornado of blazing flames.",6,10,23,"magicAttack",!0,"wizardry",16711680,!0,!0,!0,"Pyrion",44,{damageType:"burning",magicShape:"TORNADO"}),Spells.addSpell("iceTornadoScroll","ELEMENTAL","Jan Wos","Creates a tornado of freezing wind.",7,10,28,"magicAttack",!0,"wizardry",255,!0,!0,!0,"Aylos",43,{damageType:"freezing",magicShape:"TORNADO"}),Spells.addSpell("lightningExplosionScroll","ELEMENTAL","Krak Bom","Creates an explosion of lightning.",8,12,30,"magicAttack",!0,"wizardry",65535,!0,!0,!0,"Zephko",42,{magicShape:"EXPLOSION"}),Spells.addSpell("detectMonstersScroll","LIFE","Lor Ben","Reveals lifeforms around you.",1,4,16,"magicMapping",!1,"",16711935,!1,!1,!1,"Ruma",5,{mappingType:"monsters"}),Spells.addSpell("summonSkeletonScroll","LIFE","Hum Melon","Summons a Skeleton.",2,16,21,"summon",!1,"",16711935,!1,!1,!1,"Gash",12,{controlFlow:!0,monsterRace:"SKELETON"}),Spells.addSpell("recoverStrengthSpell","LIFE","Mox Hul","Recovers power lost to spells or sickness.",3,24,2,"recoverStrength",!1,"healing",16776960,!0,!1,!1,"Ruma",5,{}),Spells.addSpell("recoverHealthSpell","LIFE","Mox Mani","false",4,24,1,"recoverHealth",!1,"healing",65535,!0,!1,!1,"Ruma",5,{}),Spells.addSpell("summonLichScroll","LIFE","Ram Hum Melon","Summons a Lich.",5,16,20,"summon",!0,"",16711935,!1,!1,!1,"Gash",12,{controlFlow:!0,monsterRace:"LICH"}),Spells.addSpell("recoverFullHealthSpell","LIFE","Ram Mox Mani","Completely recovers health.",6,32,0,"recoverFullHealth",!1,"healing",65535,!0,!1,!1,"Myel",39,{}),Spells.addSpell("polymorphSpell","LIFE","Rando Melon","Changes the body and mind of a monster.",6,24,9,"polymorph",!1,"",16711935,!0,!1,!0,"Myel",39,{}),Spells.addSpell("darkPowerScroll","LIFE","Hel Ram","Makes a monster evolve using dark power.",7,24,43,"darkEvolve",!1,"",16711935,!0,!1,!0,"Gash",12,{}),Spells.addSpell("holyPowerScroll","LIFE","Lor Ram","Makes a monster evolve using holy power.",7,24,44,"lightEvolve",!1,"",16711935,!0,!1,!0,"Myel",39,{}),Spells.addSpell("increaseStrengthSpell","LIFE","Kam Hul","Increases your power.",8,48,3,"increaseStrength",!1,"wizardry",16776960,!0,!1,!1,"Ruma",5,{}),Spells.addSpell("increaseHpSpell","LIFE","Kam Mani","false",8,48,4,"increaseHP",!1,"wizardry",16776960,!0,!1,!1,"Myel",39,{}),Spells.addSpell("createArrows","MATTER","Momi Gyr","Creates a pack of arrows",1,10,51,"createItem",!1,"",16711935,!1,!1,!1,"Stagma",24,{itemCode:"arrows"}),Spells.addSpell("detectItemsScroll","MATTER","Lor Obbo","Reveals the items around you.",1,4,37,"magicMapping",!1,"",16711935,!1,!1,!1,"Stagma",24,{mappingType:"items"}),Spells.addSpell("repairWeapon1","MATTER","Ram Mox","false",2,24,14,"repairWeapon",!1,"wizardry",16776960,!1,!1,!1,"Stagma",24,{recoveryStrength:8}),Spells.addSpell("rechargeWandScroll","MATTER","Kam Va","Recharges the wand you are wielding.",3,12,19,"enchant",!0,"wizardry",16776960,!1,!1,!1,"Stagma",24,{}),Spells.addSpell("repairWeapon2","MATTER","Mox Fyr","false",4,24,12,"repairWeapon",!1,"wizardry",16776960,!1,!1,!1,"Stagma",24,{recoveryStrength:12}),Spells.addSpell("revealMapScroll","MATTER","Lor Koro","Reveals the area around you.",5,8,33,"magicMapping",!1,"",16711935,!1,!1,!1,"Stagma",24,{mappingType:"all"}),Spells.addSpell("repairArmorScroll","MATTER","Mox Gor","false",6,24,13,"repairArmor",!1,"wizardry",16776960,!1,!1,!1,"Stagma",24,{}),Spells.addSpell("teleportScroll","MATTER","Rando Lom","Teleports you to another place in the level.",6,8,32,"teleport",!1,"",16711935,!1,!1,!1,"Fels",27,{}),Spells.addSpell("gravityExplosionScroll","MATTER","Grav Bom","Creates an explosion of gravity.",6,8,31,"magicAttack",!0,"wizardry",65280,!0,!0,!0,"Fels",27,{magicShape:"EXPLOSION",magicPower:2}),Spells.addSpell("enchantArmorScroll","MATTER","Kam Gor","Blesses the armor you are wearing.",7,48,11,"enchantArmor",!1,"wizardry",16776960,!1,!1,!1,"Fels",27,{}),Spells.addSpell("enchantWeaponScroll","MATTER","Kam Fyr","Blesses the weapon you are wielding.",8,48,10,"enchantWeapon",!1,"wizardry",16776960,!1,!1,!1,"Fels",27,{}),Spells.addSpell("invisibilitySpell","MATTER","Momi Hel","false",8,16,5,"invisibility",!1,"wizardry",16711935,!1,!1,!1,"Fels",27,{}),Spells.addSpell("attackSelf","MIND","Rew Ram","Commands a being to attack itself.",1,4,52,"attackSelf",!1,"",16711935,!0,!0,!0,"Toki",14,{controlFlow:!0}),Spells.addSpell("confuseScroll","MIND","Rew","Confuses an enemy.",1,8,36,"inflictStatus",!1,"",16711935,!0,!0,!0,"Toki",14,{inflictedStatus:"confusion"}),Spells.addSpell("blindScroll","MIND","An Lor","Blinds an enemy.",2,8,38,"inflictStatus",!1,"",16711935,!0,!0,!0,"Koki",14,{inflictedStatus:"blindness"}),Spells.addSpell("massConfuseScroll","MIND","Vas Rew","Confuses all enemies.",3,12,41,"inflictStatusOnAll",!1,"",16711935,!1,!1,!1,"Poki",14,{inflictedStatus:"confusion"}),Spells.addSpell("massBlindScroll","MIND","Vas An Lor","Blinds all enemies.",4,12,42,"inflictStatusOnAll",!1,"",16711935,!1,!1,!1,"Poki",14,{inflictedStatus:"blindness"}),Spells.addSpell("charmScroll","MIND","Melon","Turns an enemy into a friend.",6,24,35,"inflictStatus",!1,"",16711935,!0,!0,!0,"Koki",14,{inflictedStatus:"charm"}),Spells.addSpell("inflictPanicScroll","MIND","Crip","Makes an enemy retreat in panic.",5,12,34,"inflictStatus",!1,"",16711935,!0,!0,!0,"Toki",14,{inflictedStatus:"panick"}),Spells.addSpell("inflictMassPanicScroll","MIND","Vas Crip","Makes all enemies retreat in panic.",7,24,39,"inflictStatusOnAll",!1,"",16711935,!1,!1,!1,"Koki",14,{inflictedStatus:"panick"}),Spells.addSpell("massCharmScroll","MIND","Vas Melon","Turns all enemies into friends.",8,32,40,"inflictStatusOnAll",!1,"",16711935,!1,!1,!1,"Toki",14,{inflictedStatus:"charm"}),Spells.addSpell("befriendMonsterSpell","MIND","Kam Melon","Makes a monster follow your commands.",8,96,8,"charm",!1,"",16711935,!0,!0,!0,"Poki",14,{}),Spells.addSpell("pushEnemy","NONE","Push Enemy","Push an enemy back using your shield.",-1,0,49,"pushEnemy",!1,"false",!1,!0,!0,!0,"false",-1,{applyClose:!0,notMagicSpell:!0,controlFlow:!0}),Spells.addSpell("vertigo","WITCHCRAFT","Vertigo","Numbs the mind of a sentient being",1,3,36,"inflictStatus",!1,"",9699539,!0,!0,!0,"Gash",12,{inflictedStatus:"confusion"}),Spells.addSpell("libitina","WITCHCRAFT","Libitina","Brings a fallen warrior to life",1,5,21,"summon",!1,"",9699539,!1,!1,!1,"Gash",12,{controlFlow:!0,monsterRace:"SKELETON"}),Spells.addSpell("augurium","WITCHCRAFT","Augurium","The power of divination reveals the area around the witch",2,5,33,"magicMapping",!1,"",9699539,!1,!1,!1,"Gash",12,{mappingType:"all"}),Spells.addSpell("trepidatio","WITCHCRAFT","Trepidatio","Creates a horrendous illusion inside a being's mind",3,10,34,"inflictStatus",!1,"",9699539,!0,!0,!0,"Gash",12,{inflictedStatus:"panick"}),Spells.addSpell("cantata","WITCHCRAFT","Cantata","Enchants a piece of clothing making it hard as steel",4,30,13,"repairArmor",!1,"wizardry",9699539,!1,!1,!1,"Gash",12,{}),Spells.addSpell("confibula","WITCHCRAFT","Confibula","Transforms a being into a frog creature",5,10,53,"morph",!1,"",9699539,!0,!0,!0,"Gash",12,{successRate:80,successRace:"FROG",failRace:"DEMONSPAWN"}),Spells.addSpell("amicitia","WITCHCRAFT","Amicitia","Conquers the mind of an enemy to fight at your side",6,20,35,"inflictStatus",!1,"",9699539,!0,!0,!0,"Gash",12,{inflictedStatus:"charm"}),Spells.addSpell("imprecatio","WITCHCRAFT","Imprecatio","Places a curse into the soul of an enemy, dooming it to die.",7,10,54,"curse",!1,"",9699539,!0,!0,!0,"Gash",12,{}),Spells.addSpell("animulus","WITCHCRAFT","Animulus","Turns any living being into a familiar",8,60,8,"charm",!1,"",9699539,!0,!0,!0,"Gash",12,{}),module.exports=Spells;

},{"./ActionValidator":2,"./Effects":10,"circular-functions":43}],32:[function(require,module,exports){
var circular=require("circular-functions");function Stat(t){this.max=t,this.current=t,this._c=circular.register("Stat")}module.exports=Stat,circular.registerClass("Stat",Stat),Stat.prototype.replenish=function(){this.current=this.max},Stat.prototype.regenerate=function(){this.current<this.max&&this.current++},Stat.prototype.increase=function(t){this.current<this.max&&(this.current+=t),this.current>this.max&&(this.current=this.max)},Stat.prototype.increaseOpenly=function(t){this.current+=t},Stat.prototype.recoverProportion=function(t){var r=this.max-this.current;this.increase(Math.round(r*t))},Stat.prototype.recoverProportionOfTotal=function(t){this.increase(Math.round(this.max*t))},Stat.prototype.reduce=function(t){this.current>0&&(this.current-=t),this.current<0&&(this.current=0)},Stat.prototype.extend=function(t){this.max+=t,this.current+=t},Stat.prototype.multiply=function(t){this.max*=t,this.current*=t},Stat.prototype.contract=function(t){this.max-=t,this.max<0&&(this.max=0),this.current>this.max&&(this.current=this.max)},Stat.prototype.getText=function(){return this.current+"/"+this.max},Stat.prototype.getProportion=function(){return 0===this.max?0:this.current/this.max},Stat.prototype.notFull=function(t){return this.current!==this.max},Stat.prototype.empty=function(){return this.current<=0},Stat.prototype.getRemaining=function(){return this.max-this.current};

},{"circular-functions":43}],33:[function(require,module,exports){
function Storage(){try{localStorage.setItem("__test","test"),localStorage.removeItem("__test"),this.enabled=!0}catch(e){this.enabled=!1}}module.exports=Storage,Storage.prototype={setItem:function(e,t){this.enabled&&localStorage.setItem(e,t)},removeItem:function(e){this.enabled&&localStorage.removeItem(e)},getItem:function(e){return this.enabled?localStorage.getItem(e):null}};

},{}],34:[function(require,module,exports){
module.exports={replaceKeys:function(e,r,o,s,E){var a=null;for(var t in a=s?r?E?PAST_REPLACEMENTS_THEY:PAST_REPLACEMENTS_THIRD_PERSON:PAST_REPLACEMENTS:r?E?PRESENT_REPLACEMENTS_THEY:PRESENT_REPLACEMENTS_THIRD_PERSON:PRESENT_REPLACEMENTS,E||(r?(a.You=o?"He":"She",a.you=o?"he":"she",a.Your=o?"His":"Her",a.your=o?"his":"her"):(a.You="You",a.you="you",a.Your="Your",a.your="your")),a)e=e.replace("#"+t+"#",a[t]);return e},replaceKeysNeutral:function(e){var r=NEUTRAL_REPLACEMENTS;for(var o in r)e=e.replace("#"+o+"#",r[o]);return e},ordinal:function(e){return ORDINALS[e]},capitalizeFirstLetter:function(e){return(e=e.trim()).charAt(0).toUpperCase()+e.slice(1)}};var ORDINALS=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth"],PAST_REPLACEMENTS={You:"You",you:"you",Your:"Your",your:"your",can:"could",preserve:"preserved",prevent:"prevented",are:"were",are2:"were",slash:"slashed",recover:"recovered",get:"got",obey:"obeyed",kill:"killed",die:"died",become:"became"},PAST_REPLACEMENTS_THIRD_PERSON={can:"could",preserve:"preserved",prevent:"prevented",are:"was",are2:"were",slash:"slashed",recover:"recovered",get:"got",obey:"obeyed",kill:"killed",die:"died",become:"became"},PRESENT_REPLACEMENTS={You:"You",you:"you",can:"can",preserve:"preserve",prevent:"prevent",are:"are",are2:"are",Your:"Your",your:"your",slash:"slash",recover:"recover",get:"get",obey:"obey",kill:"kill",die:"die",become:"become"},NEUTRAL_REPLACEMENTS={You:"",you:"",Your:"",your:"",can:"can",preserve:"preserves",prevent:"prevents",are:"",are2:"are",slash:"slashes",recover:"recovers",get:"gets",obey:"obey",kill:"kills",die:"dies",become:"becomes"},PRESENT_REPLACEMENTS_THIRD_PERSON={can:"can",preserve:"preserves",prevent:"prevents",are:"is",are2:"are",slash:"slashes",recover:"recovers",get:"gets",obey:"obey",kill:"kills",die:"dies",become:"becomes"},PRESENT_REPLACEMENTS_THEY={You:"They",you:"they",can:"can",preserve:"preserve",prevent:"prevent",are:"are",are2:"are",Your:"Their",your:"their",slash:"slash",recover:"recover",get:"get",obey:"obey",kill:"kill",die:"die",become:"become"};

},{}],35:[function(require,module,exports){
var Spells=require("./Spells"),Effects=require("./Effects"),ArrayUtils=require("./ArrayUtils");function Upgrade(e){e.spell?this.spell=e.spell:(this.tileset=e.tileset,this.index=e.index,this.description=e.description,this.trigger=e.trigger,this.shortName=e.shortName,this.idolIndex=e.idolIndex,this.name=e.name)}Upgrade.prototype={getTileset:function(){return this.spell?"spells":this.tileset},getIndex:function(){return this.spell?this.spell.icon:this.index},getDescription:function(e){if(this.spell){var l="false"===this.spell.description?Effects.getEffectDescription(this.spell.effect,e,this.spell,e.magicPower.current):this.spell.description;return this.spell.words+" spell: "+l}return this.description},getShortName:function(){return this.spell?this.spell.patronName:this.shortName},getName:function(){return this.spell?this.spell.patronName:this.name},getIdolIndex:function(){return this.spell?this.spell.patronIndex:this.idolIndex},applyUpgrade:function(e){if(!this.spell)return this.trigger(e);e.learnSpell(this.spell)}};var Upgrades={getUpgradesForPlayer:function(e){var l=[],s=[];if((e.usedUpgrades.HP<7||e.features.passiveSkills.unlimitedCombatUpgrades)&&s.push(Upgrades.HP),e.usedUpgrades.MP<7&&s.push(Upgrades.MP),e.usedUpgrades.MAGIC_POWER<7&&e.magicPower.current<10&&s.push(Upgrades.MAGIC_POWER),(e.usedUpgrades.COMBAT<7&&e.attack.current<13||e.features.passiveSkills.unlimitedCombatUpgrades)&&s.push(Upgrades.COMBAT),e.usedUpgrades.STRENGTH<7&&e.carryCapacity<e.MAX_CARRY_CAPACITY&&s.push(Upgrades.STRENGTH),l=ArrayUtils.pickRandomElementsFrom(s,3),e.canLearnSpells()){var r=Spells.getSpellsOfSchoolOfCircle(Spells.ELEMENTAL,e.getCircleForSchool(Spells.ELEMENTAL));r=(r=(r=(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.LIFE,e.getCircleForSchool(Spells.LIFE)))).concat(Spells.getSpellsOfSchoolOfCircle(Spells.MATTER,e.getCircleForSchool(Spells.MATTER)))).concat(Spells.getSpellsOfSchoolOfCircle(Spells.MIND,e.getCircleForSchool(Spells.MIND)))).concat(Spells.getSpellsOfSchoolOfCircle(Spells.WITCHCRAFT,e.getCircleForSchool(Spells.WITCHCRAFT))),e.canAdvanceOnSchool(Spells.ELEMENTAL)&&(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.ELEMENTAL,e.getCircleForSchool(Spells.ELEMENTAL)+1))),e.canAdvanceOnSchool(Spells.LIFE)&&(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.LIFE,e.getCircleForSchool(Spells.LIFE)+1))),e.canAdvanceOnSchool(Spells.MATTER)&&(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.MATTER,e.getCircleForSchool(Spells.MATTER)+1))),e.canAdvanceOnSchool(Spells.MIND)&&(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.MIND,e.getCircleForSchool(Spells.MIND)+1))),e.canAdvanceOnSchool(Spells.WITCHCRAFT)&&(r=r.concat(Spells.getSpellsOfSchoolOfCircle(Spells.WITCHCRAFT,e.getCircleForSchool(Spells.WITCHCRAFT)+1)));for(var t=0;t<r.length;t++){var i=r[t];e.hasSpell(i.words)||l.push(new Upgrade({spell:i}))}}return l.length>9&&(l=ArrayUtils.trim(l,9)),l},increaseHitPoints:function(e){e.usedUpgrades.HP++,e.upgradeHP()},increasePower:function(e){e.usedUpgrades.COMBAT++,e.upgradeAttack()},increaseMagicPoints:function(e){e.usedUpgrades.MP++,e.upgradeMP()},increaseCarry:function(e){e.usedUpgrades.STRENGTH++,e.upgradeStrength()},increaseMagicPower:function(e){e.usedUpgrades.MAGIC_POWER++,e.upgradeMagicPower()},learnSpell:function(e,l){}};Upgrades.HP=new Upgrade({name:"Hadria",idolIndex:7,description:"Allows you to withstand more damage",tileset:"spells",index:48,trigger:Upgrades.increaseHitPoints,shortName:"Hadria"}),Upgrades.MP=new Upgrade({name:"Straus",idolIndex:4,description:"Extends your Magic Points allowing you to cast more spells.",tileset:"spells",index:47,trigger:Upgrades.increaseMagicPoints,shortName:"Straus"}),Upgrades.COMBAT=new Upgrade({name:"Valnyr",idolIndex:1,description:"Makes you more proficient in battle.",tileset:"spells",index:45,trigger:Upgrades.increasePower,shortName:"Valnyr"}),Upgrades.MAGIC_POWER=new Upgrade({name:"Tymall",idolIndex:3,description:"Increases your Magic Power.",tileset:"spells",index:50,trigger:Upgrades.increaseMagicPower,shortName:"Tymall"}),Upgrades.STRENGTH=new Upgrade({name:"Colbi",idolIndex:2,description:"Increases your Strength allowing you to carry more items",tileset:"spells",index:46,trigger:Upgrades.increaseCarry,shortName:"Colbi"}),module.exports=Upgrades;

},{"./ArrayUtils":4,"./Effects":10,"./Spells":31}],36:[function(require,module,exports){
module.exports={line:function(r,e){var t=new Array,n=r.x,u=r.y,i=e.x,o=e.y,a=Math.abs(i-n),s=Math.abs(o-u),f=n<i?1:-1,c=u<o?1:-1,h=a-s;for(t.push({x:n,y:u});n!=i||u!=o;){var l=h<<1;l>-s&&(h-=s,n+=f),l<a&&(h+=a,u+=c),t.push({x:n,y:u})}return t},lesser:function(r,e){return r>e?e:r},VOWELS:["a","e","i","o","u"],startsWithVowel:function(r){return-1!==this.VOWELS.indexOf(r.charAt(0).toLowerCase())},rgbToHex:function(r,e,t){return"0x"+((1<<24)+(r<<16)+(e<<8)+t).toString(16).slice(1)},getCurrentTimeMillis:function(){return(new Date).getTime()},toArray:function(r){var e=[];for(var t in r)e.push({key:t,value:r[t]});return e}};

},{}],37:[function(require,module,exports){
function EventLog(t){this.gameController=t,this.eventStack=[],this.MAX_STACK_SIZE=20}EventLog.prototype={logEvent:function(t){this.eventStack.push(t),this.eventStack.length>this.MAX_STACK_SIZE&&this.eventStack.shift()},getEventStack:function(){return this.eventStack}},module.exports=EventLog;

},{}],38:[function(require,module,exports){
const en=require("./strings_en"),jp=require("./strings_jp"),ru=require("./strings_ru"),Loc={strings:{},setStrings:function(s,t){this.strings[s]=t},setLocale:function(s){this.locale=s},loc:function(s,t){const e=this.strings[this.locale].find(t=>t.key==s);return e?e.value:"{"+s+"}"}};Loc.setStrings("en",en),Loc.setStrings("jp",jp),Loc.setStrings("ru",ru),Loc.setLocale("en"),module.exports=Loc;

},{"./strings_en":39,"./strings_jp":40,"./strings_ru":41}],39:[function(require,module,exports){
const strings=[{group:"ui",key:"startNewGame",value:"Start a New Game"}];module.exports=strings;

},{}],40:[function(require,module,exports){
const strings=[{group:"ui",key:"startNewGame",value:"新しいゲームを始める"}];module.exports=strings;

},{}],41:[function(require,module,exports){
const strings=[{group:"ui",key:"startNewGame",value:"Начать новую игру"}];module.exports=strings;

},{}],42:[function(require,module,exports){
var charenc = {
  // UTF-8 encoding
  utf8: {
    // Convert a string to a byte array
    stringToBytes: function(str) {
      return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)));
    },

    // Convert a byte array to a string
    bytesToString: function(bytes) {
      return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)));
    }
  },

  // Binary encoding
  bin: {
    // Convert a string to a byte array
    stringToBytes: function(str) {
      for (var bytes = [], i = 0; i < str.length; i++)
        bytes.push(str.charCodeAt(i) & 0xFF);
      return bytes;
    },

    // Convert a byte array to a string
    bytesToString: function(bytes) {
      for (var str = [], i = 0; i < bytes.length; i++)
        str.push(String.fromCharCode(bytes[i]));
      return str.join('');
    }
  }
};

module.exports = charenc;

},{}],43:[function(require,module,exports){
var circular = {
	version: "0.0.2",
	currentId: 1,
	showWarnings: false,
	classes: {}
};

module.exports = circular;

/**
 * All classes for Circular objects should be registered
 */
circular.registerClass = function(typeId, class_, metadata){
	if (!metadata)
		metadata = {};
	metadata.prototype = class_
	circular.classes[typeId] = metadata;
};

/**
 * Used to create an object's _c attribute for
 * an object that requires circular serialization.
 */
circular.register = function(type){
	return {
		type: type,
		uid: circular.currentId++
	};
};

/**
 * Used to create an object's _c attribute for
 * an object that doesn't require circular 
 * serialization.
 */
circular.setSafe = function(){
	return {
		isCircularSafe: true
	};
};

/**
 * Returns a serialized version of the object, replacing all
 * object fields to pointers to a master table.
 */
circular.serialize = function (object){
	var objectMap = {};
	var serializableObject = circular._serializeObject(object, objectMap);
	var returnData = {
		object: serializableObject,
		references: objectMap
	};
	return JSON.stringify(returnData);
};

/**
 * Rebuilds the original object using the classes metadata and
 * the references table.
 */
circular.parse = function(json, reviverData){
	var serializedObject = JSON.parse(json);
	var objectMap = [];
	return circular._deserializeObject(serializedObject.object, serializedObject.references, objectMap, reviverData);
};


circular._serializeObject = function (object, objectMap){
	var serializableObject = null;
	if (circular.isArray(object)){
		serializableObject = new Array();
	} else {
		serializableObject = {};
	}
	if (!object._c && !circular.isArray(object)){
		console.log(object);
		throw "ERROR: "+(typeof object)+" without Circular metadata...";
	} else if (!circular.isArray(object)){
		// Reference the serialized object in the object map
		objectMap["x"+object._c.uid] = serializableObject;
	}
	for (var component in object){
		var componentName = component;
		var attribute = object[componentName];
		if (!circular.isArray(object) && circular._isTransient(object._c.type, componentName)){
			// Skip transient attributes
			continue;
		} else if (typeof attribute == 'function'){
			// Functions are not saved
			continue;
		} else if (componentName === '_c'){
			// Circular metadata is saved verbatim
			serializableObject[componentName] = attribute;
		} else if (circular.isArray(attribute)){
			// Arrays are always serialized, no need to check for metadata
			serializableObject[componentName] = circular._serializeObject(attribute, objectMap);
		} else if (attribute == null || typeof attribute !== "object"){
			// Native values are saved verbatim
			serializableObject[componentName] = attribute;
		} else {
			// An Object that might be serialized
			if (attribute._c){
				if (attribute._c.isCircularSafe){
					serializableObject[componentName] = object[componentName];
				} else {
					if (!objectMap["x"+attribute._c.uid]){
						objectMap["x"+attribute._c.uid] = circular._serializeObject(attribute, objectMap);
					}
					serializableObject[componentName] = attribute._c;
				}
			} else {
				if (object._c){
					throw "ERROR: "+componentName+" attribute from circular type "+object._c.type+" has no Circular metadata";
				} else {
					throw "ERROR: ["+componentName+"] attribute from non circular object has no Circular metadata";
				}
			}
		}
	}
	return serializableObject;
};

circular._isTransient = function(type, attributeName) {
	return circular.classes[type] && circular.classes[type].transients && circular.classes[type].transients[attributeName];
};

circular._deserializeObject = function (object, references, objectMap, reviverData){
	var deserializedObject = null;
	if (circular.isArray(object)){
		deserializedObject = [];
	} else if (object._c){
		if (circular.classes[object._c.type] && circular.classes[object._c.type].prototype){
			deserializedObject = new circular.classes[object._c.type].prototype();
		} else {
			if (circular.showWarnings)
				console.log("Warning: prototype for "+object._c.type+" was not found, using {}");
			deserializedObject = {};
		}
		objectMap["x"+object._c.uid] = deserializedObject;
		if (object._c.uid > circular.currentId){
			// Update the circular currentId index, to avoid new objects to overlap with existing for future cerealizations
			circular.currentId = object._c.uid;
		}
	}
	for (var component in object){
		var componentName = component;
		var attribute = object[componentName]; 
		if (componentName === '_c'){
			deserializedObject[componentName] = object[componentName];
			// Circular metadata is restored verbatim
		} else if (circular.isArray(attribute)){
			deserializedObject[componentName] = circular._deserializeObject(attribute, references, objectMap, reviverData);
		} else if (
			attribute &&
			typeof attribute == "object" &&
			attribute.type && 
			attribute.uid){
			if (!objectMap["x"+attribute.uid]){
				circular._deserializeObject(references["x"+attribute.uid], references, objectMap, reviverData);
				if (circular.classes[attribute.type] && circular.classes[attribute.type].reviver){
					circular.classes[attribute.type].reviver(objectMap["x"+attribute.uid], reviverData);
				}
			}
			deserializedObject[componentName] = objectMap["x"+attribute.uid];
		} else {
			deserializedObject[componentName] = attribute;
		}
	}
	return deserializedObject;
};

circular.isArray = function (object){
	return Object.prototype.toString.call( object ) === '[object Array]';
}

},{}],44:[function(require,module,exports){
(function() {
  var base64map
      = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',

  crypt = {
    // Bit-wise rotation left
    rotl: function(n, b) {
      return (n << b) | (n >>> (32 - b));
    },

    // Bit-wise rotation right
    rotr: function(n, b) {
      return (n << (32 - b)) | (n >>> b);
    },

    // Swap big-endian to little-endian and vice versa
    endian: function(n) {
      // If number given, swap endian
      if (n.constructor == Number) {
        return crypt.rotl(n, 8) & 0x00FF00FF | crypt.rotl(n, 24) & 0xFF00FF00;
      }

      // Else, assume array and swap all items
      for (var i = 0; i < n.length; i++)
        n[i] = crypt.endian(n[i]);
      return n;
    },

    // Generate an array of any length of random bytes
    randomBytes: function(n) {
      for (var bytes = []; n > 0; n--)
        bytes.push(Math.floor(Math.random() * 256));
      return bytes;
    },

    // Convert a byte array to big-endian 32-bit words
    bytesToWords: function(bytes) {
      for (var words = [], i = 0, b = 0; i < bytes.length; i++, b += 8)
        words[b >>> 5] |= bytes[i] << (24 - b % 32);
      return words;
    },

    // Convert big-endian 32-bit words to a byte array
    wordsToBytes: function(words) {
      for (var bytes = [], b = 0; b < words.length * 32; b += 8)
        bytes.push((words[b >>> 5] >>> (24 - b % 32)) & 0xFF);
      return bytes;
    },

    // Convert a byte array to a hex string
    bytesToHex: function(bytes) {
      for (var hex = [], i = 0; i < bytes.length; i++) {
        hex.push((bytes[i] >>> 4).toString(16));
        hex.push((bytes[i] & 0xF).toString(16));
      }
      return hex.join('');
    },

    // Convert a hex string to a byte array
    hexToBytes: function(hex) {
      for (var bytes = [], c = 0; c < hex.length; c += 2)
        bytes.push(parseInt(hex.substr(c, 2), 16));
      return bytes;
    },

    // Convert a byte array to a base-64 string
    bytesToBase64: function(bytes) {
      for (var base64 = [], i = 0; i < bytes.length; i += 3) {
        var triplet = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2];
        for (var j = 0; j < 4; j++)
          if (i * 8 + j * 6 <= bytes.length * 8)
            base64.push(base64map.charAt((triplet >>> 6 * (3 - j)) & 0x3F));
          else
            base64.push('=');
      }
      return base64.join('');
    },

    // Convert a base-64 string to a byte array
    base64ToBytes: function(base64) {
      // Remove non-base-64 characters
      base64 = base64.replace(/[^A-Z0-9+\/]/ig, '');

      for (var bytes = [], i = 0, imod4 = 0; i < base64.length;
          imod4 = ++i % 4) {
        if (imod4 == 0) continue;
        bytes.push(((base64map.indexOf(base64.charAt(i - 1))
            & (Math.pow(2, -2 * imod4 + 8) - 1)) << (imod4 * 2))
            | (base64map.indexOf(base64.charAt(i)) >>> (6 - imod4 * 2)));
      }
      return bytes;
    }
  };

  module.exports = crypt;
})();

},{}],45:[function(require,module,exports){
(function() {

   "use strict";

  var root  = this;
  var droll = {};

  // Define a "class" to represent a formula
  function DrollFormula() {
    this.numDice  = 0;
    this.numSides = 0;
    this.modifier = 0;
  }

  // Define a "class" to represent the results of the roll
  function DrollResult() {
    this.rolls    = [];
    this.modifier = 0;
    this.total    = 0;
  }

  /**
   * Returns a string representation of the roll result
   */
  DrollResult.prototype.toString = function() {
    if (this.rolls.length === 1 && this.modifier === 0) {
      return this.rolls[0] + '';
    }

    if (this.rolls.length > 1 && this.modifier === 0) {
      return this.rolls.join(' + ') + ' = ' + this.total;
    }

    if (this.rolls.length === 1 && this.modifier > 0) {
      return this.rolls[0] + ' + ' + this.modifier + ' = ' + this.total;
    }

    if (this.rolls.length > 1 && this.modifier > 0) {
      return this.rolls.join(' + ') + ' + ' + this.modifier + ' = ' + this.total;
    }

    if (this.rolls.length === 1 && this.modifier < 0) {
      return this.rolls[0] + ' - ' + Math.abs(this.modifier) + ' = ' + this.total;
    }

    if (this.rolls.length > 1 && this.modifier < 0) {
      return this.rolls.join(' + ') + ' - ' + Math.abs(this.modifier) + ' = ' + this.total;
    }
  };

  /**
   * Parse the formula into its component pieces.
   * Returns a DrollFormula object on success or false on failure.
   */
  droll.parse = function(formula) {
    var pieces = null;
    var result = new DrollFormula();

    pieces = formula.match(/^([1-9]\d*)?d([1-9]\d*)([+-]\d+)?$/i);
    if (!pieces) { return false; }

    result.numDice  = (pieces[1] - 0) || 1;
    result.numSides = (pieces[2] - 0);
    result.modifier = (pieces[3] - 0) || 0;

    return result;
  };

  /**
   * Test the validity of the formula.
   * Returns true on success or false on failure.
   */
  droll.validate = function(formula) {
    return (droll.parse(formula)) ? true : false ;
  };

  /**
   * Roll the dice defined by the formula.
   * Returns a DrollResult object on success or false on failure.
   */
  droll.roll = function(formula) {
    var pieces = null;
    var result = new DrollResult();

    pieces = droll.parse(formula);
    if (!pieces) { return false; }

    for (var a=0; a<pieces.numDice; a++) {
      result.rolls[a] = (1 + Math.floor(Math.random() * pieces.numSides));
    }

    result.modifier = pieces.modifier;

    for (var b=0; b<result.rolls.length; b++) {
      result.total += result.rolls[b];
    }
    result.total += result.modifier;

    return result;
  };

  // Export library for use in node.js or browser
  if (typeof module !== 'undefined' && module.exports) {
    module.exports = droll;
  } else {
    root.droll = droll;
  }

}());
},{}],46:[function(require,module,exports){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */

// The _isBuffer check is for Safari 5-7 support, because it's missing
// Object.prototype.constructor. Remove this eventually
module.exports = function (obj) {
  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)
}

function isBuffer (obj) {
  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)
}

// For Node v0.10 support. Remove this eventually.
function isSlowBuffer (obj) {
  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))
}

},{}],47:[function(require,module,exports){
(function(){
  var crypt = require('crypt'),
      utf8 = require('charenc').utf8,
      isBuffer = require('is-buffer'),
      bin = require('charenc').bin,

  // The core
  md5 = function (message, options) {
    // Convert to byte array
    if (message.constructor == String)
      if (options && options.encoding === 'binary')
        message = bin.stringToBytes(message);
      else
        message = utf8.stringToBytes(message);
    else if (isBuffer(message))
      message = Array.prototype.slice.call(message, 0);
    else if (!Array.isArray(message))
      message = message.toString();
    // else, assume byte array already

    var m = crypt.bytesToWords(message),
        l = message.length * 8,
        a =  1732584193,
        b = -271733879,
        c = -1732584194,
        d =  271733878;

    // Swap endian
    for (var i = 0; i < m.length; i++) {
      m[i] = ((m[i] <<  8) | (m[i] >>> 24)) & 0x00FF00FF |
             ((m[i] << 24) | (m[i] >>>  8)) & 0xFF00FF00;
    }

    // Padding
    m[l >>> 5] |= 0x80 << (l % 32);
    m[(((l + 64) >>> 9) << 4) + 14] = l;

    // Method shortcuts
    var FF = md5._ff,
        GG = md5._gg,
        HH = md5._hh,
        II = md5._ii;

    for (var i = 0; i < m.length; i += 16) {

      var aa = a,
          bb = b,
          cc = c,
          dd = d;

      a = FF(a, b, c, d, m[i+ 0],  7, -680876936);
      d = FF(d, a, b, c, m[i+ 1], 12, -389564586);
      c = FF(c, d, a, b, m[i+ 2], 17,  606105819);
      b = FF(b, c, d, a, m[i+ 3], 22, -1044525330);
      a = FF(a, b, c, d, m[i+ 4],  7, -176418897);
      d = FF(d, a, b, c, m[i+ 5], 12,  1200080426);
      c = FF(c, d, a, b, m[i+ 6], 17, -1473231341);
      b = FF(b, c, d, a, m[i+ 7], 22, -45705983);
      a = FF(a, b, c, d, m[i+ 8],  7,  1770035416);
      d = FF(d, a, b, c, m[i+ 9], 12, -1958414417);
      c = FF(c, d, a, b, m[i+10], 17, -42063);
      b = FF(b, c, d, a, m[i+11], 22, -1990404162);
      a = FF(a, b, c, d, m[i+12],  7,  1804603682);
      d = FF(d, a, b, c, m[i+13], 12, -40341101);
      c = FF(c, d, a, b, m[i+14], 17, -1502002290);
      b = FF(b, c, d, a, m[i+15], 22,  1236535329);

      a = GG(a, b, c, d, m[i+ 1],  5, -165796510);
      d = GG(d, a, b, c, m[i+ 6],  9, -1069501632);
      c = GG(c, d, a, b, m[i+11], 14,  643717713);
      b = GG(b, c, d, a, m[i+ 0], 20, -373897302);
      a = GG(a, b, c, d, m[i+ 5],  5, -701558691);
      d = GG(d, a, b, c, m[i+10],  9,  38016083);
      c = GG(c, d, a, b, m[i+15], 14, -660478335);
      b = GG(b, c, d, a, m[i+ 4], 20, -405537848);
      a = GG(a, b, c, d, m[i+ 9],  5,  568446438);
      d = GG(d, a, b, c, m[i+14],  9, -1019803690);
      c = GG(c, d, a, b, m[i+ 3], 14, -187363961);
      b = GG(b, c, d, a, m[i+ 8], 20,  1163531501);
      a = GG(a, b, c, d, m[i+13],  5, -1444681467);
      d = GG(d, a, b, c, m[i+ 2],  9, -51403784);
      c = GG(c, d, a, b, m[i+ 7], 14,  1735328473);
      b = GG(b, c, d, a, m[i+12], 20, -1926607734);

      a = HH(a, b, c, d, m[i+ 5],  4, -378558);
      d = HH(d, a, b, c, m[i+ 8], 11, -2022574463);
      c = HH(c, d, a, b, m[i+11], 16,  1839030562);
      b = HH(b, c, d, a, m[i+14], 23, -35309556);
      a = HH(a, b, c, d, m[i+ 1],  4, -1530992060);
      d = HH(d, a, b, c, m[i+ 4], 11,  1272893353);
      c = HH(c, d, a, b, m[i+ 7], 16, -155497632);
      b = HH(b, c, d, a, m[i+10], 23, -1094730640);
      a = HH(a, b, c, d, m[i+13],  4,  681279174);
      d = HH(d, a, b, c, m[i+ 0], 11, -358537222);
      c = HH(c, d, a, b, m[i+ 3], 16, -722521979);
      b = HH(b, c, d, a, m[i+ 6], 23,  76029189);
      a = HH(a, b, c, d, m[i+ 9],  4, -640364487);
      d = HH(d, a, b, c, m[i+12], 11, -421815835);
      c = HH(c, d, a, b, m[i+15], 16,  530742520);
      b = HH(b, c, d, a, m[i+ 2], 23, -995338651);

      a = II(a, b, c, d, m[i+ 0],  6, -198630844);
      d = II(d, a, b, c, m[i+ 7], 10,  1126891415);
      c = II(c, d, a, b, m[i+14], 15, -1416354905);
      b = II(b, c, d, a, m[i+ 5], 21, -57434055);
      a = II(a, b, c, d, m[i+12],  6,  1700485571);
      d = II(d, a, b, c, m[i+ 3], 10, -1894986606);
      c = II(c, d, a, b, m[i+10], 15, -1051523);
      b = II(b, c, d, a, m[i+ 1], 21, -2054922799);
      a = II(a, b, c, d, m[i+ 8],  6,  1873313359);
      d = II(d, a, b, c, m[i+15], 10, -30611744);
      c = II(c, d, a, b, m[i+ 6], 15, -1560198380);
      b = II(b, c, d, a, m[i+13], 21,  1309151649);
      a = II(a, b, c, d, m[i+ 4],  6, -145523070);
      d = II(d, a, b, c, m[i+11], 10, -1120210379);
      c = II(c, d, a, b, m[i+ 2], 15,  718787259);
      b = II(b, c, d, a, m[i+ 9], 21, -343485551);

      a = (a + aa) >>> 0;
      b = (b + bb) >>> 0;
      c = (c + cc) >>> 0;
      d = (d + dd) >>> 0;
    }

    return crypt.endian([a, b, c, d]);
  };

  // Auxiliary functions
  md5._ff  = function (a, b, c, d, x, s, t) {
    var n = a + (b & c | ~b & d) + (x >>> 0) + t;
    return ((n << s) | (n >>> (32 - s))) + b;
  };
  md5._gg  = function (a, b, c, d, x, s, t) {
    var n = a + (b & d | c & ~d) + (x >>> 0) + t;
    return ((n << s) | (n >>> (32 - s))) + b;
  };
  md5._hh  = function (a, b, c, d, x, s, t) {
    var n = a + (b ^ c ^ d) + (x >>> 0) + t;
    return ((n << s) | (n >>> (32 - s))) + b;
  };
  md5._ii  = function (a, b, c, d, x, s, t) {
    var n = a + (c ^ (b | ~d)) + (x >>> 0) + t;
    return ((n << s) | (n >>> (32 - s))) + b;
  };

  // Package private blocksize
  md5._blocksize = 16;
  md5._digestsize = 16;

  module.exports = function (message, options) {
    if (message === undefined || message === null)
      throw new Error('Illegal argument ' + message);

    var digestbytes = crypt.wordsToBytes(md5(message, options));
    return options && options.asBytes ? digestbytes :
        options && options.asString ? bin.bytesToString(digestbytes) :
        crypt.bytesToHex(digestbytes);
  };

})();

},{"charenc":42,"crypt":44,"is-buffer":46}],48:[function(require,module,exports){
function AddFriendPanel(e){this.gameController=e}module.exports=AddFriendPanel,AddFriendPanel.prototype={init:function(e){var t=this.gameController;this.titlePanel=e;var n=t.ui.addFriend;if(this.connectLayer=t.phaser.add.group(),this.connectLayer.visible=!1,this.gameController.isDesktop)var a=t.phaser.add.image(this.gameController.ui.title.backgroundDialog.x,this.gameController.ui.title.backgroundDialog.y,"dialog-v",null,this.connectLayer);else a=t.phaser.add.image(0,0,"background",null,this.connectLayer);a.inputEnabled=!0;var i=!1;i=n.back.small?this.gameController.createHButton(n.back,"< Back",this.connectLayer,{size:128}):this.gameController.createHButton(n.back,"< Back",this.connectLayer),this.backButton=i.button,this.backButton.events.onInputDown.add(this.hide,this),i=this.gameController.createHButton(n.connect,"Connect",this.connectLayer),this.connectButton=i.button,this.gameController.ui.useTextfields?(this.connectButton.events.onInputDown.add(this.connectWithTextfield,this),this.nameText=t.addText(n.nameLabel.x,n.nameLabel.y,"Name/PIN:",this.gameController.fontSpec,this.connectLayer),(i=this.gameController.createHButton(n.search,"Search",this.connectLayer)).button.events.onInputDown.add(function(){this.search()},this)):(this.connectButton.events.onInputDown.add(this.connect,this),i=this.gameController.createButton(n.nameButton,0,137,"Name",this.connectLayer,!1,!0),this.nameButton=i.button,this.nameButton.events.onInputDown.add(this.promptName,this),this.nameText=t.addText(n.popupNameLabel.x,n.popupNameLabel.y,"Name/PIN: Not Set",this.gameController.fontSpec,this.connectLayer)),this.selectedPlayerName=t.addText(n.selectedPlayer.name.x,n.selectedPlayer.name.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerPIN=t.addText(n.selectedPlayer.pin.x,n.selectedPlayer.pin.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerGames=t.addText(n.selectedPlayer.games.x,n.selectedPlayer.games.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerVictories=t.addText(n.selectedPlayer.victories.x,n.selectedPlayer.victories.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerFriends=t.addText(n.selectedPlayer.friends.x,n.selectedPlayer.friends.y,"",this.gameController.fontSpec,this.connectLayer)},promptName:function(){var e=this;this.gameController.prompt("Enter your friend's name or PIN","Add friend",function(t){if(t){e.selectedUsername=t.trim();var n=e.selectedUsername.length>10?e.selectedUsername.substring(0,9)+"...":e.selectedUsername;e.nameText.text="Name/PIN: "+n,e.gameController.communityClient.getPlayerInfo(e.selectedUsername,{ok:function(t){e.setPlayerInfo(t),e.enableInput()},error:function(){e.cleanPlayerInfo(),e.enableInput()}})}else e.selectedUsername=!1,e.nameText.text="Name/PIN: Not Set",e.cleanPlayerInfo()})},connect:function(){this.gameController.playSFX("tap");var e=this.gameController,t=this;this.selectedPIN?(this.disableInput(),e.communityClient.addFriend(this.selectedPIN,{ok:function(n){e.alert("You are now connected with "+t.selectedPlayerName.text,"Success!"),t.enableInput(),t.selectedUsername=!1,t.gameController.ui.useTextfields?t.nameText.text="Name/PIN:":t.nameText.text="Name/PIN: Not Set",t.cleanPlayerInfo(),t.titlePanel.increaseFriendsCount(),t.hide()},error:function(){t.enableInput()}})):this.gameController.alert("Please enter a valid username or PIN","Error")},connectWithTextfield:function(){this.gameController.playSFX("tap");var e=this.gameController,t=this,n=this.gameController.getTextFieldValue("txtUserName_addFriendPanel").trim();this.selectedPIN&&this.selectedUsername==n?(this.disableInput(),e.communityClient.addFriend(this.selectedPIN,{ok:function(n){e.alert("You are now connected with "+t.selectedPlayerName.text,"Success!"),t.enableInput(),t.selectedUsername=!1,t.gameController.ui.useTextfields?t.nameText.text="Name/PIN:":t.nameText.text="Name/PIN: Not Set",t.cleanPlayerInfo(),t.titlePanel.increaseFriendsCount(),t.hide()},error:function(){t.enableInput()}})):this.search(!0)},setPlayerInfo:function(e){this.selectedPlayerName.text=e.name,this.selectedPlayerPIN.text="PIN: "+e.pin,this.selectedPlayerGames.text="Games: "+e.games,this.selectedPlayerVictories.text="Victories: "+e.victories,this.selectedPlayerFriends.text="Friends: "+e.friends,this.selectedPIN=e.pin},cleanPlayerInfo:function(){this.selectedPlayerName.text="",this.selectedPlayerPIN.text="",this.selectedPlayerGames.text="",this.selectedPlayerVictories.text="",this.selectedPlayerFriends.text="",this.selectedPIN=!1},search:function(e){this.gameController.playSFX("tap"),this.enableInput();var t=this.gameController.getTextFieldValue("txtUserName_addFriendPanel").trim();if(""!==t){this.selectedUsername=t;var n=this;this.gameController.communityClient.getPlayerInfo(this.selectedUsername,{ok:function(t){n.setPlayerInfo(t),e&&n.connectWithTextfield()},error:function(){n.cleanPlayerInfo()}})}},show:function(){if(this.gameController.panelStack.push(this),this.cleanPlayerInfo(),this.gameController.ui.useTextfields){var e=this.gameController.ui.addFriend;this.gameController.createTextField("txtUserName_addFriendPanel",e.nameField.x,e.nameField.y,e.nameField.width,e.nameField.height)}this.connectLayer.visible=!0},hide:function(){this.gameController.playSFX("tap"),this.gameController.panelStack.pop(),this.gameController.ui.useTextfields&&this.gameController.removeTextField("txtUserName_addFriendPanel"),this.connectLayer.visible=!1},enableInput:function(){this.backButton.inputEnabled=!0,this.connectButton.inputEnabled=!0,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!0)},disableInput:function(){this.backButton.inputEnabled=!1,this.connectButton.inputEnabled=!1,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!1)},backNavigation:function(){return this.hide(),!1}};

},{}],49:[function(require,module,exports){
var Layouts=require("../ui/Layouts");function BookPanel(t){this.gameController=t}BookPanel.prototype={PAGE_SIZE:8,init:function(){var t=this.gameController,e=t.ui.playerInfo;e.titleText={x:e.x+32,y:e.y+16,width:e.width-64},e.detailText={x:e.x+40,y:e.y+40+8,width:e.width-64-16},e.closeButton={x:e.x+e.width-32,y:e.y},e.nextButton={x:e.x+e.width-32,y:e.y+e.height-32},e.backButton={x:e.x+e.width-32,y:e.y+e.height-64},this.PAGE_SIZE=e.pageSize,this.dialogLayer=t.phaser.add.group(),this.dialogLayer.visible=!1,t.phaser.add.image(0,0,"dialogMask",0,this.dialogLayer).inputEnabled=!0,t.phaser.add.image(e.x,e.y,"inspectorScroll",0,this.dialogLayer);var i=t.createButton(e.closeButton,2,128,"Close",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0});i.button.events.onInputDown.add(this.hide,this),this.closeButtonGroup=i.createdGroup,(i=t.createButton(e.nextButton,2,123,"Next",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0})).button.events.onInputDown.add(this.next,this),this.nextButtonGroup=i.createdGroup,(i=t.createButton(e.backButton,2,124,"Back",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0})).button.events.onInputDown.add(this.back,this),this.backButtonGroup=i.createdGroup,this.titleText=t.addText(e.titleText.x,e.titleText.y,"",{font:t.font,fill:"#880000",align:"center"},this.dialogLayer),this.detailText=t.addText(e.detailText.x,e.detailText.y,"",{font:t.font,fill:"#000000",wordWrap:!0,wordWrapWidth:e.detailText.width},this.dialogLayer)},showBook:function(t){var e=this.gameController,i=e.ui.playerInfo;this.gameController.inputDisabled=!0,this.backButtonGroup.visible=!1,this.nextButtonGroup.visible=!1,this.closeButtonGroup.visible=!0;var o=t.text,a=t.title+"\nBy "+t.author;if(this.titleText.text=a,e.centerText(this.titleText,i.titleText.x,i.titleText.width),this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth-5,this.allLines=this.detailText.precalculateWordWrap(o),this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth+5,this.allLines.length<this.PAGE_SIZE)this.detailText.text=o;else{for(var s=0;s<this.allLines.length;s++)this.allLines[s]=this.allLines[s].trim();this.currentLine=0,this._updateStatus()}this.dialogLayer.visible=!0},back:function(){this.backButtonGroup.visible&&(this.currentLine>0&&this.currentLine--,this._updateStatus())},next:function(){this.nextButtonGroup.visible&&(this.currentLine<this.allLines.length-1&&this.currentLine++,this._updateStatus())},_updateStatus:function(){this.detailText.text=this.allLines.slice(this.currentLine,this.currentLine+this.PAGE_SIZE).join("\n"),0===this.currentLine?this.backButtonGroup.visible=!1:this.backButtonGroup.visible=!0,this.currentLine===this.allLines.length-this.PAGE_SIZE?this.nextButtonGroup.visible=!1:this.nextButtonGroup.visible=!0},hide:function(){this.dialogLayer.visible=!1,this.gameController.player.dead||(this.gameController.inputDisabled=!1,this.gameController.logEvent("Input enabled BookPanel"))}},module.exports=BookPanel;

},{"../ui/Layouts":67}],50:[function(require,module,exports){
"use strict";var circular=require("circular-functions"),PlayerClass=require("../PlayerClass.enum"),Spells=require("../Spells"),Stat=require("../Stat.class");function CharacterCreationPanel(e){this.gameController=e}module.exports=CharacterCreationPanel,CharacterCreationPanel.prototype={init:function(){this._initComponents()},_initComponents:function(){var e=this.gameController,t=this.gameController.phaser,a=this.gameController.ui.characterCreation,i=t.add.group();this.mainLayer=i,i.visible=!1;var n=i;this.portraitLayer=n;var r=i;if(this.bonusPointsLayer=r,e.getImage(0,0,"background",null,i).inputEnabled=!0,a.doubleScreen&&(this.page=0,(r=t.add.group(i)).visible=!1,this.bonusPointsLayer=r,(n=t.add.group(i)).visible=!0,this.portraitLayer=n),this.portraitSprite=e.getImage(a.portrait.x,a.portrait.y,"blank",0,n),this.selectedClassText=e.addText(a.selectedClass.x,a.selectedClass.y,"",e.fontSpec,n),a.nameLabel){var s=e.addText(a.nameLabel.x,a.nameLabel.y,"Name",e.titleSpec,n);a.nameLabel.width&&this.gameController.centerText(s,a.nameLabel.x,a.nameLabel.width)}a.classLabel&&(s=e.addText(a.classLabel.x,a.classLabel.y,"Class",e.titleSpec,n),a.classLabel.width&&this.gameController.centerText(s,a.classLabel.x,a.classLabel.width)),a.skinToneLabel&&(s=e.addText(a.skinToneLabel.x,a.skinToneLabel.y,"Skin",e.titleSpec,n),a.skinToneLabel.width&&this.gameController.centerText(s,a.skinToneLabel.x,a.skinToneLabel.width)),a.hairColorLabel&&(s=e.addText(a.hairColorLabel.x,a.hairColorLabel.y,"Hair Color",e.titleSpec,n),a.hairColorLabel.width&&this.gameController.centerText(s,a.hairColorLabel.x,a.hairColorLabel.width)),a.hairTypeLabel&&(s=e.addText(a.hairTypeLabel.x,a.hairTypeLabel.y,"Hair Style",e.titleSpec,n),a.hairTypeLabel.width&&this.gameController.centerText(s,a.hairTypeLabel.x,a.hairTypeLabel.width)),a.beardTypeLabel&&(s=e.addText(a.beardTypeLabel.x,a.beardTypeLabel.y,"Beard",e.titleSpec,n),a.beardTypeLabel.width&&this.gameController.centerText(s,a.beardTypeLabel.x,a.beardTypeLabel.width)),this.selectedSkinToneText=e.addText(a.selectedSkinTone.x,a.selectedSkinTone.y,"",e.fontSpec,n),this.selectedHairColorText=e.addText(a.selectedHairColor.x,a.selectedHairColor.y,"",e.fontSpec,n),this.selectedHairTypeText=e.addText(a.selectedHairType.x,a.selectedHairType.y,"",e.fontSpec,n),this.selectedBeardTypeText=e.addText(a.selectedBeardType.x,a.selectedBeardType.y,"",e.fontSpec,n),this.bonusPointsText=e.addText(a.bonusPoints.x,a.bonusPoints.y,"",e.titleSpec,r),this.combatText=e.addText(a.combat.x,a.combat.y,"",e.fontSpec,r),this.magicText=e.addText(a.magic.x,a.magic.y,"",e.fontSpec,r),this.carryText=e.addText(a.carry.x,a.carry.y,"",e.fontSpec,r),this.hpText=e.addText(a.hp.x,a.hp.y,"",e.fontSpec,r),this.mpText=e.addText(a.mp.x,a.mp.y,"",e.fontSpec,r),this.evadeText=e.addText(a.evade.x,a.evade.y,"",e.fontSpec,r);var o=this.createButton(a.prevSkinTone,"<",n);o.button.events.onInputDown.add(function(){this.changeSkinTone(-1)},this),(o=this.createButton(a.nextSkinTone,">",n)).button.events.onInputDown.add(function(){this.changeSkinTone(1)},this),(o=this.createButton(a.prevHairColor,"<",n)).button.events.onInputDown.add(function(){this.changeHairColor(-1)},this),(o=this.createButton(a.nextHairColor,">",n)).button.events.onInputDown.add(function(){this.changeHairColor(1)},this),(o=this.createButton(a.prevHairType,"<",n)).button.events.onInputDown.add(function(){this.changeHairType(-1)},this),(o=this.createButton(a.nextHairType,">",n)).button.events.onInputDown.add(function(){this.changeHairType(1)},this),(o=this.createButton(a.prevBeardType,"<",n)).button.events.onInputDown.add(function(){this.changeBeardType(-1)},this),(o=this.createButton(a.nextBeardType,">",n)).button.events.onInputDown.add(function(){this.changeBeardType(1)},this),(o=this.createButton(a.decreaseCombat,"<",r)).button.events.onInputDown.add(function(){this.changeCombat(-1)},this),(o=this.createButton(a.increaseCombat,">",r)).button.events.onInputDown.add(function(){this.changeCombat(1)},this),(o=this.createButton(a.decreaseMagic,"<",r)).button.events.onInputDown.add(function(){this.changeMagic(-1)},this),(o=this.createButton(a.increaseMagic,">",r)).button.events.onInputDown.add(function(){this.changeMagic(1)},this),(o=this.createButton(a.decreaseCarry,"<",r)).button.events.onInputDown.add(function(){this.changeCarry(-1)},this),(o=this.createButton(a.increaseCarry,">",r)).button.events.onInputDown.add(function(){this.changeCarry(1)},this),(o=this.createButton(a.decreaseHP,"<",r)).button.events.onInputDown.add(function(){this.changeHP(-1)},this),(o=this.createButton(a.increaseHP,">",r)).button.events.onInputDown.add(function(){this.changeHP(1)},this),(o=this.createButton(a.decreaseMP,"<",r)).button.events.onInputDown.add(function(){this.changeMP(-1)},this),(o=this.createButton(a.increaseMP,">",r)).button.events.onInputDown.add(function(){this.changeMP(1)},this),(o=this.createButton(a.decreaseEvade,"<",r)).button.events.onInputDown.add(function(){this.changeEvade(-1)},this),(o=this.createButton(a.increaseEvade,">",r)).button.events.onInputDown.add(function(){this.changeEvade(1)},this),(o=this.gameController.createHButton(a.next,"Next >",i)).button.events.onInputDown.add(this.next,this),(o=a.back.small?this.gameController.createHButton(a.back,"< Back",i,{size:128}):this.gameController.createHButton(a.back,"< Back",i)).button.events.onInputDown.add(this.backNavigation,this),a.useTextfields||((o=this.createButton(a.nameButton,"...",n)).button.events.onInputDown.add(this.promptName,this),this.nameText=e.addText(a.popupNameLabel.x,a.popupNameLabel.y,"Rodney",e.fontSpec,n),this.gameController.centerText(this.nameText,a.popupNameLabel.x,a.popupNameLabel.width))},setup:function(e,t,a){this.maleSelected=t,this.selectedClass=e,this.selectedPetId=a,this.statChanges={combat:0,magic:0,carry:0,hp:0,mp:0,evade:0},this.statValues={combat:e.attack,magic:e.magic,carry:e.carry,hp:e.hp,mp:e.mp,evade:e.evadeChance},this.bonusPoints=3,this.options={SkinTone:{currentValue:0},HairColor:{currentValue:0},HairType:{currentValue:0},BeardType:{currentValue:0}},e===PlayerClass.DUMERIL?(this.options.SkinTone.values=[Options.DUMERIL_SKIN],this.options.HairColor.values=[Options.NONE],this.options.HairType.values=[Options.NONE],this.options.BeardType.values=[Options.NONE]):e===PlayerClass.AILORUS?(this.options.SkinTone.values=[Options.AILORUS_DARK],this.options.HairColor.values=[Options.AILORUS_BLACK],this.options.HairType.values=[Options.AILORUS_LONG],this.options.BeardType.values=[Options.WHISKERS]):(this.options.SkinTone.values=[Options.LIGHT_SKIN,Options.MEDIUM_SKIN,Options.DARK_SKIN],this.options.HairColor.values=[Options.BROWN,Options.BLACK,Options.YELLOW,Options.WHITE,Options.RED],this.options.SkinTone.currentValue=e.defaultSkinTone,this.options.HairColor.currentValue=e.defaultHairColor,t?(this.options.BeardType.values=[Options.NONE,Options.BEARD,Options.GOATEE,Options.LONG_BEARD,Options.SMALL_BEARD,Options.MUSTACHE1,Options.MUSTACHE2],this.options.HairType.values=[Options.NONE,Options.SHORT2,Options.SWEEP,Options.SHORT,Options.MOHAWK,Options.LONG2,Options.SHORT3,Options.BALD1,Options.BALD2,Options.BALD3],this.options.HairType.currentValue=e.defaultMaleHairType,this.options.BeardType.currentValue=e.defaultMaleBeardType):(e.defaultFemaleHairColor&&(this.options.HairColor.currentValue=e.defaultFemaleHairColor),this.options.BeardType.values=[Options.NONE],this.options.HairType.values=[Options.NONE,Options.LONG,Options.MID,Options.SHORT2,Options.SWEEP,Options.SHORT,Options.MOHAWK,Options.SHORT3,Options.BALD2,Options.BALD3],this.options.HairType.currentValue=e.defaultFemaleHairType)),this._updateOption("SkinTone"),this._updateOption("HairColor"),this._updateOption("HairType"),this._updateOption("BeardType"),this._refreshPortrait(),this._refreshBonusPanel();var i=this.gameController.ui.characterCreation;this.selectedClassText.text=this.selectedClass.name,this.gameController.centerText(this.selectedClassText,i.selectedClass.x,i.selectedClass.width)},_refreshBonusPanel:function(){this.bonusPointsText.text="Bonus Points: "+this.bonusPoints,this._refreshStat("combat"),this._refreshStat("magic"),this._refreshStat("carry"),this._refreshStat("hp"),this._refreshStat("mp"),this._refreshStat("evade");var e=this.gameController.ui.characterCreation;this.gameController.centerText(this.bonusPointsText,e.bonusPoints.x,e.bonusPoints.width)},_refreshStat:function(e){var t=this.gameController.ui.characterCreation,a=this[e+"Text"];a.text=StatNames[e]+": "+this.statValues[e]+("evade"===e?"%":""),this.gameController.centerText(a,t[e].x,t[e].width),this.statChanges[e]>0?a.addColor("#ff0000",0):a.addColor("#ffffff",0)},changeSkinTone:function(e){this._changeOption("SkinTone",e)},changeHairColor:function(e){this._changeOption("HairColor",e)},changeHairType:function(e){this._changeOption("HairType",e)},changeBeardType:function(e){this._changeOption("BeardType",e)},_changeOption:function(e,t){var a=this.options[e].currentValue;this.gameController.playSFX("tap"),-1===t&&0===a?a=this.options[e].values.length-1:1===t&&a===this.options[e].values.length-1?a=0:a+=t,this.options[e].currentValue=a,this._updateOption(e),this._refreshPortrait()},_updateOption:function(e){var t=this.gameController.ui.characterCreation,a=this.options[e].values[this.options[e].currentValue];this["selected"+e+"Text"].text=a.name,this.gameController.centerText(this["selected"+e+"Text"],t["selected"+e].x,t["selected"+e].width),this._refreshPortrait()},_refreshPortrait:function(){var e=2*this.options.SkinTone.values[this.options.SkinTone.currentValue].index+(this.maleSelected?0:1),t=this.options.HairType.values[this.options.HairType.currentValue].index,a=this.options.HairColor.values[this.options.HairColor.currentValue].index,i=this.options.BeardType.values[this.options.BeardType.currentValue].index;this.gameController.player.buildPortraitSprite(e,t,a,i),this.portraitSprite.loadTexture(this.gameController.player.portraitSprite.texture)},changeCombat:function(e){this._changeStat("combat",e)},_changeStat:function(e,t){this.gameController.playSFX("tap"),t>0?this.bonusPoints>0&&(this.statValues[e]=this.statValues[e]+StatChanges[e],this.bonusPoints--,this.statChanges[e]++):t<0&&this.statChanges[e]>0&&(this.statValues[e]=this.statValues[e]-StatChanges[e],this.bonusPoints++,this.statChanges[e]--),this._refreshBonusPanel()},changeMagic:function(e){this._changeStat("magic",e)},changeCarry:function(e){this._changeStat("carry",e)},changeHP:function(e){this._changeStat("hp",e)},changeMP:function(e){this._changeStat("mp",e)},changeEvade:function(e){this._changeStat("evade",e)},promptName:function(){var e=this,t=this.gameController.ui.characterCreation;this.gameController.prompt("Enter your name","Name",function(a){if(a){e.selectedName=a.trim();var i=e.selectedName.length>15?e.selectedName.substring(0,15)+"...":e.selectedName;e.nameText.text=i}else e.selectedName="Rodney",e.nameText.text="Rodney";e.gameController.centerText(e.nameText,t.popupNameLabel.x,t.popupNameLabel.width)})},next:function(){this.gameController.playSFX("tap");var e=this.gameController.ui.characterCreation;e.useTextfields&&(e.doubleScreen&&0===this.page||!e.doubleScreen)&&(this.selectedName=this.gameController.getTextFieldValue("txtName_characterPanel").trim(),this.gameController.removeTextField("txtName_characterPanel")),e.doubleScreen&&1!==this.page?(this.page=1,this.portraitLayer.visible=!1,this.bonusPointsLayer.visible=!0):this._createCharacter()},_createCharacter:function(){this.player=this.gameController.player,this.selectedName&&0!==this.selectedName.length||(this.selectedName="Rodney"),this.selectedName.length>15&&(this.selectedName=this.selectedName.substring(0,15)),this.player.characterName=this.selectedName;var e=this.selectedClass;this.player.isMale=this.maleSelected;var t=2*this.options.SkinTone.values[this.options.SkinTone.currentValue].index+(this.maleSelected?0:1),a=this.options.HairType.values[this.options.HairType.currentValue].index,i=this.options.HairColor.values[this.options.HairColor.currentValue].index,n=this.options.BeardType.values[this.options.BeardType.currentValue].index;this.player.selectedSkinTone=t,this.player.selectedHairType=a,this.player.selectedHairColor=i,this.player.selectedBeardType=n,-1!==a?(a*=5,a+=i):a=!1,-1!==n?(n*=5,n+=i):n=!1,this.player.baseSpriteIndex=t,this.player.hairSpriteIndex=a,this.player.beardSpriteIndex=n,this.player.features=e.features,this.player.features._c=circular.setSafe();var r=null;e.secondaryWeapon&&(r=this.gameController.itemFactory.getItemByCode(e.secondaryWeapon,!0));var s=null;if(e.startingWeapon){if(s=this.gameController.itemFactory.getItemByCode(e.startingWeapon,!0),e.startingAmmo){var o=this.gameController.itemFactory.getItemByCode(e.startingAmmo,!0);s.ammo=o,s.remainingUses.increase(o.quantity),o.quantity-s.remainingUses.current>0&&(s.ammo.quantity=s.remainingUses.current,(o=this.gameController.itemFactory.getItemByCode(e.startingAmmo,!0)).quantity-=s.ammo.quantity,this.gameController.initItemSprite(o),this.player.addToInventory(o))}}else s=this.gameController.itemFactory.getStartingWeapon();var l=null;e.startingArmor||e.startingArmorFemale?this.player.isMale?e.startingArmor&&(l=this.gameController.itemFactory.getItemByCode(e.startingArmor,!0)):l=e.startingArmorFemale?this.gameController.itemFactory.getItemByCode(e.startingArmorFemale,!0):this.gameController.itemFactory.getItemByCode(e.startingArmor,!0):!1===e.startingArmor&&(l=this.gameController.itemFactory.getStartingArmor());var h=null;e.startingHelmet&&(h=this.gameController.itemFactory.getItemByCode(e.startingHelmet,!0));var c=null;e.startingArmwear&&(c=this.gameController.itemFactory.getItemByCode(e.startingArmwear,!0));var p=null;this.player.isMale?e.startingLegwear&&(p=this.gameController.itemFactory.getItemByCode(e.startingLegwear,!0)):!1!==e.startingLegwearFemale&&(e.startingLegwearFemale?p=this.gameController.itemFactory.getItemByCode(e.startingLegwearFemale,!0):e.startingLegwear&&(p=this.gameController.itemFactory.getItemByCode(e.startingLegwear,!0)));var d=null;e.startingFootwear&&(d=this.gameController.itemFactory.getItemByCode(e.startingFootwear,!0));var m=null;if(e.startingShield&&(m=this.gameController.itemFactory.getItemByCode(e.startingShield,!0)),null!==s&&(this.gameController.initItemSprite(s),this.player.addToInventory(s)),null!==r&&(this.gameController.initItemSprite(r),this.player.addToInventory(r)),null!==l&&(this.gameController.initItemSprite(l),this.player.addToInventory(l)),null!==c&&(this.gameController.initItemSprite(c),this.player.addToInventory(c)),null!==p&&(this.gameController.initItemSprite(p),this.player.addToInventory(p)),null!==d&&(this.gameController.initItemSprite(d),this.player.addToInventory(d)),null!==h&&(this.gameController.initItemSprite(h),this.player.addToInventory(h)),null!==m&&(this.gameController.initItemSprite(m),this.player.addToInventory(m)),e.startingUtility)for(var u=0;u<e.startingUtility.length;u++){var g=e.startingUtility[u],y=this.gameController.itemFactory.getItemByCode(g,!0);this.gameController.initItemSprite(y),this.player.addToInventory(y)}if(e.startingSpells)for(var C=0;C<e.startingSpells.length;C++)this.player.addSpell(Spells.getSpell(e.startingSpells[C]));this.player.currentWeapon=s,this.player.previousWeapon=r,this.player.currentArmor=l,this.player.currentArmwear=c,this.player.currentLegwear=p,this.player.currentFootwear=d,this.player.currentHelmet=h,this.player.currentShield=m,this.player.attack=new Stat(this.statValues.combat),this.player.magicPower=new Stat(this.statValues.magic),this.player.carryCapacity=this.statValues.carry,this.player.hitPoints=new Stat(this.statValues.hp),this.player.magicPoints=new Stat(this.statValues.mp),this.player.evadeChance=this.statValues.evade,this.gameController.playerLifeBar.setStat(this.player.hitPoints),this.gameController.playerMagicBar.setStat(this.player.magicPoints),this.player.canParry=e.canParry,this.player.sureShot=e.sureShot,this.player.canTransmute=e.canTransmute,this.player.bowBonus=e.bowBonus,this.player.className=e.name,this.player.shortClassName=e.shortName,this.player.classCode=e.code,this.player.maxCircle=e.maxCircle,this.player.maxCircle._c=circular.setSafe(),this.gameController.selectTactic(this.player.getTactic(),!0),this.hide();var T=this.selectedPetId;if(e.startingPet&&(T=e.startingPet),T){this.player=this.gameController.player,this.monsterFactory=this.gameController.monsterFactory;var x=this.monsterFactory.createMonster(this.player,T,1,!0);x.isStarter=!0,this.player.setPet(x),this.player.pet.command="FOL",this.gameController.selectPetCommand("FOL",!0)}this.gameController.helpPanel.show()},show:function(){var e=this.gameController.ui.characterCreation;e.useTextfields&&this.gameController.createTextField("txtName_characterPanel",e.nameField.x,e.nameField.y,e.nameField.width,e.nameField.height,{maxLength:15}),e.doubleScreen&&(this.page=0,this.portraitLayer.visible=!0,this.bonusPointsLayer.visible=!1),this.gameController.newGamePanel.hide(),this.gameController.panelStack.push(this),this.mainLayer.visible=!0},hide:function(){this.gameController.panelStack.pop(),this.mainLayer.visible=!1},backNavigation:function(){this.gameController.playSFX("tap");var e=this.gameController.ui.characterCreation;return e.doubleScreen&&1==this.page?(this.page=0,this.portraitLayer.visible=!0,this.bonusPointsLayer.visible=!1,e.useTextfields&&this.gameController.createTextField("txtName_characterPanel",e.nameField.x,e.nameField.y,e.nameField.width,e.nameField.height,{maxLength:15})):(this.hide(),e.useTextfields&&this.gameController.removeTextField("txtName_characterPanel"),this.gameController.newGamePanel.show()),!1},createButton:function(e,t,a){var i=!0===this.gameController.ui.characterCreation.smallButtons,n=i?"tileset32":"tileset64",r=i?32:64,s=i?7:25,o=e.x,l=e.y,h=i?132:rand(0,3),c=this.gameController.phaser.add.image(o,l,n,h,a),p=this.gameController.addText(o,l+s,t,this.gameController.fontSpec,a);return this.gameController.centerText(p,o,r),c.inputEnabled=!0,{button:c,label:p}}};var Options={LIGHT_SKIN:{name:"Light",index:0},MEDIUM_SKIN:{name:"Medium",index:1},DARK_SKIN:{name:"Dark",index:2},DUMERIL_SKIN:{name:"Green",index:3},AILORUS_DARK:{name:"Dark",index:4},AILORUS_BLACK:{name:"Black",index:-1},AILORUS_LONG:{name:"Long",index:-1},NONE:{name:"None",index:-1},WHISKERS:{name:"Whiskers",index:-1},YELLOW:{name:"Yellow",index:0},BROWN:{name:"Brown",index:1},RED:{name:"Red",index:2},WHITE:{name:"White",index:3},BLACK:{name:"Black",index:4},LONG:{name:"Long",index:0},MID:{name:"Mid",index:1},SHORT:{name:"Short",index:2},MOHAWK:{name:"Mohawk",index:3},SHORT2:{name:"Short 2",index:4},SWEEP:{name:"Sweep",index:5},LONG2:{name:"Long 2",index:6},SHORT3:{name:"Short 3",index:7},BALD1:{name:"Bald 1",index:8},BALD2:{name:"Bald 2",index:9},BALD3:{name:"Bald 3",index:10},BEARD:{name:"Beard",index:11},GOATEE:{name:"Goatee",index:12},LONG_BEARD:{name:"Long",index:13},SMALL_BEARD:{name:"Small",index:14},MUSTACHE1:{name:"Mustache",index:15},MUSTACHE2:{name:"Mustache",index:16}},StatChanges={combat:1,magic:1,hp:8,mp:10,evade:2,carry:2},StatNames={combat:"Combat",magic:"Magic",hp:"HP",mp:"MP",evade:"Evade",carry:"Carry"};

},{"../PlayerClass.enum":25,"../Spells":31,"../Stat.class":32,"circular-functions":43}],51:[function(require,module,exports){
function ConnectPanel(e){this.gameController=e}var ForgotPasswordPanel=require("./ForgotPasswordPanel.class");module.exports=ConnectPanel,ConnectPanel.prototype={init:function(e){var t=this.gameController;this.titlePanel=e,this.recoverPasswordPanel=new ForgotPasswordPanel(t),this.recoverPasswordPanel.init(e);var n=t.ui.connect;if(this.connectLayer=t.phaser.add.group(),this.connectLayer.visible=!1,this.gameController.isDesktop)var o=t.phaser.add.image(this.gameController.ui.title.backgroundDialog.x,this.gameController.ui.title.backgroundDialog.y,"dialog-v",null,this.connectLayer);else o=t.phaser.add.image(0,0,"background",null,this.connectLayer);o.inputEnabled=!0;var s=!1;s=n.back.small?this.gameController.createHButton(n.back,"< Back",this.connectLayer,{size:128}):this.gameController.createHButton(n.back,"< Back",this.connectLayer),this.backButton=s.button,this.backButton.events.onInputDown.add(this.hide,this),s=this.gameController.createHButton(n.forgotPassword,"Forgot Password",this.connectLayer),this.forgotPasswordButton=s.button,this.forgotPasswordButton.events.onInputDown.add(this.forgotPassword,this),s=this.gameController.createHButton(n.connect,"Connect",this.connectLayer),this.connectButton=s.button,this.connectButton.events.onInputDown.add(this.connect,this),this.gameController.ui.useTextfields?(this.nameText=t.addText(n.nameLabel.x,n.nameLabel.y,"Username",this.gameController.fontSpec,this.connectLayer),this.passwordText=t.addText(n.passwordLabel.x,n.passwordLabel.y,"Password",this.gameController.fontSpec,this.connectLayer)):(s=this.gameController.createButton(n.nameButton,0,137,"Name",this.connectLayer,!1,!0),this.nameButton=s.button,this.nameButton.events.onInputDown.add(this.promptName,this),s=this.gameController.createButton(n.passwordButton,1,137,"Password",this.connectLayer,!1,!0),this.passwordButton=s.button,this.passwordButton.events.onInputDown.add(this.promptPassword,this),this.nameText=t.addText(n.popupNameLabel.x,n.popupNameLabel.y,"Username: Not Set",this.gameController.fontSpec,this.connectLayer),this.passwordText=t.addText(n.popupPasswordLabel.x,n.popupPasswordLabel.y,"Password: Not Set",this.gameController.fontSpec,this.connectLayer))},promptName:function(){var e=this;this.gameController.prompt("Enter your user name","User name",function(t){if(t){e.selectedUsername=t.trim();var n=e.selectedUsername.length>10?e.selectedUsername.substring(0,9)+"...":e.selectedUsername;e.nameText.text="Username: "+n}else e.selectedUsername=!1,e.nameText.text="Username: Not Set"})},promptPassword:function(){var e=this;this.gameController.prompt("Enter your password","Password",function(t){t&&t.trim().length>0?(e.selectedPassword=t,e.passwordText.text="Password: <Set>"):(e.selectedPassword=!1,e.passwordText.text="Password: Not Set")},"password")},connect:function(){if(this.gameController.playSFX("tap"),this.gameController.ui.useTextfields&&(this.selectedUsername=this.gameController.getTextFieldValue("txtUserName_connectPanel").trim(),this.selectedPassword=this.gameController.getTextFieldValue("txtPassword_connectPanel").trim()),this.selectedUsername&&0!==this.selectedUsername.length)if(this.selectedPassword&&0!==this.selectedPassword.length){this.disableInput();var e=this.gameController,t=this,n={password:this.selectedPassword};e.communityClient.connect(this.selectedUsername,n,{ok:function(n){t.titlePanel.setPlayerInfo(n),e.persistanceManager.saveLoginInfo(t.selectedUsername,n.loginKey),t.enableInput(),t.hide()},error:function(){t.enableInput()}})}else this.gameController.alert("Please enter your password","Error");else this.gameController.alert("Please enter your user name","Error")},forgotPassword:function(){this.hide(),this.recoverPasswordPanel.show()},show:function(){if(this.gameController.panelStack.push(this),this.gameController.ui.useTextfields){var e=this.gameController.ui.connect;this.gameController.createTextField("txtUserName_connectPanel",e.nameField.x,e.nameField.y,e.nameField.width,e.nameField.height),this.gameController.createTextField("txtPassword_connectPanel",e.passwordField.x,e.passwordField.y,e.passwordField.width,e.passwordField.height,{type:"password"})}this.connectLayer.visible=!0},hide:function(){this.gameController.playSFX("tap"),this.gameController.ui.useTextfields&&(this.gameController.removeTextField("txtUserName_connectPanel"),this.gameController.removeTextField("txtPassword_connectPanel")),this.gameController.panelStack.pop(),this.connectLayer.visible=!1},enableInput:function(){this.backButton.inputEnabled=!0,this.forgotPasswordButton.inputEnabled=!0,this.connectButton.inputEnabled=!0,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!0,this.passwordButton.inputEnabled=!0)},disableInput:function(){this.backButton.inputEnabled=!1,this.forgotPasswordButton.inputEnabled=!1,this.connectButton.inputEnabled=!1,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!1,this.passwordButton.inputEnabled=!1)},backNavigation:function(){return this.hide(),!1}};

},{"./ForgotPasswordPanel.class":53}],52:[function(require,module,exports){
var Layouts=require("../ui/Layouts");function PlayerInfoPanel(t){this.gameController=t}PlayerInfoPanel.prototype={PAGE_SIZE:7,init:function(){var t=this.gameController,e=t.ui.playerInfo;e.titleText={x:e.x+64,y:e.y+16,width:e.width-64},e.sprite={x:e.x+24,y:e.y+20},e.detailText={x:e.x+24,y:e.y+40+8,width:e.width-48},e.closeButton={x:e.x+e.width-32,y:e.y},e.forwardButton={x:e.x+e.width-32,y:e.y+e.height-32},e.nextButton={x:e.x+e.width-32,y:e.y+e.height-32},e.backButton={x:e.x+e.width-32,y:e.y+e.height-64},this.PAGE_SIZE=e.pageSize,this.dialogLayer=t.phaser.add.group(),this.dialogLayer.visible=!1,t.phaser.add.image(0,0,"dialogMask",0,this.dialogLayer).inputEnabled=!0,t.phaser.add.image(e.x,e.y,"dialog",0,this.dialogLayer),this.sprite=t.phaser.add.image(e.sprite.x,e.sprite.y,"tileset32",0,this.dialogLayer);var i=t.createButton(e.closeButton,2,128,"Close",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0});i.button.events.onInputDown.add(this.hide,this),this.closeButtonGroup=i.createdGroup,(i=t.createButton(e.nextButton,2,123,"Next",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0})).button.events.onInputDown.add(this.next,this),this.nextButtonGroup=i.createdGroup,(i=t.createButton(e.backButton,2,124,"Back",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0})).button.events.onInputDown.add(this.back,this),this.backButtonGroup=i.createdGroup,(i=t.createButton(e.forwardButton,2,125,"Forward",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0})).button.events.onInputDown.add(this._nextDialog,this),this.forwardButtonGroup=i.createdGroup,this.titleText=t.addText(e.titleText.x,e.titleText.y,"",{font:t.font,fill:t.titleColor},this.dialogLayer),this.titleText.lineSpacing=-8,this.detailText=t.addText(e.detailText.x,e.detailText.y,"",{font:t.font,fill:t.fontColor,wordWrap:!0,wordWrapWidth:e.detailText.width},this.dialogLayer),this.detailText.lineSpacing=-8},showConversation:function(t){var e=this.gameController;e.ui.playerInfo;e.inputDisabled=!0,this.currentNPC=t,this.backButtonGroup.visible=!1,this.nextButtonGroup.visible=!1,this.forwardButtonGroup.visible=!0,this.closeButtonGroup.visible=!1;var i=t.npcInfo.name+"\n"+t.race.name,o=t.npcInfo.dialog[t.currentDialog];if(this.titleText.text=i,this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth-5,this.allLines=this.detailText.precalculateWordWrap(o),this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth+5,this.allLines.length<=this.PAGE_SIZE)this.detailText.text=o;else{for(var s="",a="",n=0;n<this.allLines.length;n++)n<this.PAGE_SIZE?s+=this.allLines[n].trim()+"\n":a+=this.allLines[n].trim()+"\n";this.detailText.text=s,t.npcInfo.dialog.splice(t.currentDialog+1,0,a)}this.sprite.loadTexture(t.sprite.texture),this.dialogLayer.visible=!0,this.type="conversation"},_nextDialog:function(){var t=this.currentNPC;if(t.currentDialog==t.npcInfo.dialog.length-1){for(var e=0;e<t.npcInfo.onDialogEnd.length;e++){var i=t.npcInfo.onDialogEnd[e];if("LEAVE_ROOM"===i.key)t.currentRoom.removeEnemy(t),this.gameController.killImage(t.sprite);else if("GIVE_EVOLVE_POTION"===i.key){var o=chance(50)?"darkPowerPotion":"holyPowerPotion",s=this.gameController.itemFactory.getItemByCode(o);(a=t.currentRoom.getFreePlace())?(t.currentRoom.addItem(s,a),this.gameController.addItemToRoom(s)):(this.gameController.initItemSprite(s),this.gameController.player.addToInventory(s))}else if("GIVE_CROSSBOW"===i.key){var a;s=this.gameController.itemFactory.getItemByCode("Wooden Crossbow-105");(a=t.currentRoom.getFreePlace())?(t.currentRoom.addItem(s,a),this.gameController.addItemToRoom(s)):(this.gameController.initItemSprite(s),this.gameController.player.addToInventory(s))}}this.hide(),this.gameController.logEvent("Input enabled, last Dialog"),this.gameController.enablePlayerAction()}else t.currentDialog++,this.showConversation(t)},show:function(t){var e=this.gameController,i=e.ui.playerInfo;e.inputDisabled=!0;var o=t;this.backButtonGroup.visible=!1,this.nextButtonGroup.visible=!1,this.forwardButtonGroup.visible=!1,this.closeButtonGroup.visible=!0;var s,a="";if(o.dead&&(a+=o.replaceKeys(o.deathReason)+" on level "+e.depth+" of the rift of Ananias\n\n"),a+=o.getPassiveSkillsDescription(i.big),o.invisibilityTurns>0&&(a+=" Invisible."),o.cutTurns>0&&(a+=" Bleeding."),t==e.player?(a+="\nCombat: "+o.attack.current,a+="\nMagic: "+o.magicPower.current):a+="\nPower: "+o.attack.current,s=o.characterName?o.characterName+", the "+o.className:o.race.name,s+="\nLevel "+o.powerLevel,o.dead){for(var n=0,r=0;r<o.stats.perLevel.length;r++)o.stats.perLevel[r].exploredRooms==o.stats.perLevel[r].totalRooms&&n++;for(var l in n&&(a+="\nYou explored "+n+" levels completely"),a+="\n\nYou killed "+o.kills+" monsters",o.stats.killMap){a+="\n- "+o.stats.killMap[l]+" "+this.gameController.monsterFactory.getRace(l).name+"s"}if(o.stats.hits+o.stats.misses>0){var h=Math.round(o.stats.hits/(o.stats.misses+o.stats.hits)*100);a+="\n\nYou did "+o.stats.hits+" hits and missed "+o.stats.misses+" times, for a "+h+"% battle rate"}}var d="are",u="have read",c="have used",p="have killed",g="have left",y="have played";if(t.dead&&(d="were",u="read",c="used",p="killed",g="left",y="played"),t.hardcoreMode&&(a+="\nYou "+d+" a hardcore adventurer."),t.stats){t.stats.conducts&&(a+="\n",t.stats.conducts.noScrollsUsed&&(a+="\nYou "+u+" no scrolls."),t.stats.conducts.noSpellsUsed&&(a+="\nYou "+c+" no spells."),t.stats.conducts.noPotionsUsed&&(a+="\nYou "+c+" no potions."),t.stats.conducts.noBandagesUsed&&(a+="\nYou "+c+" no bandages."),t.stats.conducts.noWeaponsUsed&&(a+="\nYou "+c+" no weapons."),t.stats.conducts.noArmorUsed&&(a+="\nYou "+c+" no armor."),t.stats.conducts.noKills&&(a+="\nYou "+p+" no monsters."),t.stats.conducts.noRoomUnexplored&&(a+="\nYou "+g+" no room unexplored."));var x=t.stats.gameplaySeconds;a+="\n\nYou "+y+" for "+Math.floor(x/60)+" minutes and "+(x%=60)+" seconds"}if(this.titleText.text=s,this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth-5,this.allLines=this.detailText.precalculateWordWrap(a),this.detailText.style.wordWrapWidth=this.detailText.style.wordWrapWidth+5,this.allLines.length<this.PAGE_SIZE)this.detailText.text=a;else{for(r=0;r<this.allLines.length;r++)this.allLines[r]=this.allLines[r].trim();this.currentLine=0,this._updateStatus()}this.sprite.loadTexture(o.sprite.texture),this.dialogLayer.visible=!0,this.type="entity"},back:function(){this.backButtonGroup.visible&&(this.currentLine>0&&this.currentLine--,this._updateStatus())},next:function(){this.nextButtonGroup.visible&&(this.currentLine<this.allLines.length-this.PAGE_SIZE&&this.currentLine++,this._updateStatus())},_updateStatus:function(){this.detailText.text=this.allLines.slice(this.currentLine,this.currentLine+this.PAGE_SIZE).join("\n"),0===this.currentLine?this.backButtonGroup.visible=!1:this.backButtonGroup.visible=!0,this.currentLine===this.allLines.length-this.PAGE_SIZE?this.nextButtonGroup.visible=!1:this.nextButtonGroup.visible=!0},hide:function(){this.dialogLayer.visible=!1,this.gameController.player.dead&&!this.gameController.showingInventory||(this.gameController.inputDisabled=!1,this.gameController.logEvent("Input enabled EntityInfoPanel.hide"))}},module.exports=PlayerInfoPanel;

},{"../ui/Layouts":67}],53:[function(require,module,exports){
function ForgotPasswordPanel(e){this.gameController=e}module.exports=ForgotPasswordPanel,ForgotPasswordPanel.prototype={init:function(e){var t=this.gameController,i=t.ui.forgotPassword;if(this.connectLayer=t.phaser.add.group(),this.connectLayer.visible=!1,this.gameController.isDesktop)var o=t.phaser.add.image(this.gameController.ui.title.backgroundDialog.x,this.gameController.ui.title.backgroundDialog.y,"dialog-v",null,this.connectLayer);else o=t.phaser.add.image(0,0,"background",null,this.connectLayer);o.inputEnabled=!0;var a=!1;a=i.back.small?this.gameController.createHButton(i.back,"< Back",this.connectLayer,{size:128}):this.gameController.createHButton(i.back,"< Back",this.connectLayer),this.backButton=a.button,this.backButton.events.onInputDown.add(this.hide,this),a=this.gameController.createHButton(i.forgotPassword,"Send Recovery Email",this.connectLayer),this.recoverPasswordButton=a.button,this.recoverPasswordButton.events.onInputDown.add(this.recoverPassword,this),this.gameController.ui.useTextfields?this.emailText=t.addText(i.emailLabel.x,i.emailLabel.y,"Email",this.gameController.fontSpec,this.connectLayer):(a=this.gameController.createButton(i.emailButton,2,137,"Email",this.connectLayer,!1,!0),this.emailButton=a.button,this.emailButton.events.onInputDown.add(this.promptEmail,this),this.emailText=t.addText(i.popupEmailLabel.x,i.popupEmailLabel.y,"Email: Not Set",this.gameController.fontSpec,this.connectLayer))},promptEmail:function(){var e=this;this.gameController.prompt("Enter your e-mail","E-mail",function(t){if(t){e.selectedEmail=t.trim();var i=e.selectedEmail.length>10?e.selectedEmail.substring(0,9)+"...":e.selectedEmail;e.emailText.text="Email: "+i}else e.selectedEmail=!1,e.emailText.text="Email: Not Set"})},recoverPassword:function(){if(this.gameController.ui.useTextfields&&(this.selectedEmail=this.gameController.getTextFieldValue("txtEmail_recoverPasswordPanel").trim()),this.selectedEmail&&0!==this.selectedEmail.length){this.disableInput();var e=this.gameController,t=this;e.communityClient.recoverPassword(this.selectedEmail,{ok:function(i){e.alert("A password recovery email has been sent to your email address.","Welcome!"),t.enableInput(),t.hide()},error:function(){t.enableInput()}})}else this.gameController.alert("Please enter your e-mail","Error")},show:function(){if(this.gameController.ui.useTextfields){var e=this.gameController.ui.forgotPassword;this.gameController.createTextField("txtEmail_recoverPasswordPanel",e.emailField.x,e.emailField.y,e.emailField.width,e.emailField.height)}this.gameController.panelStack.push(this),this.connectLayer.visible=!0},hide:function(){this.gameController.ui.useTextfields&&this.gameController.removeTextField("txtEmail_recoverPasswordPanel"),this.gameController.panelStack.pop(),this.connectLayer.visible=!1},enableInput:function(){this.backButton.inputEnabled=!0,this.recoverPasswordButton.inputEnabled=!0,this.gameController.ui.useTextfields||(this.emailButton.inputEnabled=!0)},disableInput:function(){this.backButton.inputEnabled=!1,this.recoverPasswordButton.inputEnabled=!1,this.gameController.ui.useTextfields||(this.emailButton.inputEnabled=!1)},backNavigation:function(){return this.hide(),!1}};

},{}],54:[function(require,module,exports){
function GraveyardPanel(t){this.gameController=t}module.exports=GraveyardPanel,GraveyardPanel.prototype={init:function(){var t=this.gameController,e=t.ui.graveyard;this.graveyardLayer=t.phaser.add.group(),this.graveyardLayer.visible=!1;var o=20,r=60;e.bgOffsets&&(o=e.bgOffsets.x,r=e.bgOffsets.y);var a=t.phaser.add.image(0,0,"background",null,this.graveyardLayer);t.phaser.add.image(o,r,"graveyard",null,this.graveyardLayer),a.inputEnabled=!0,this.titleLabel=t.addText(e.title.x,e.title.y,"Personal Graveyard  - v"+this.gameController.version,this.gameController.titleSpec,this.graveyardLayer),this.gameController.centerText(this.titleLabel,e.title.x,e.title.width);var l=this.createButton(e.back,1,"< Back");this.backButton=l.button,l=this.createButton(e.personal,0,"Own"),this.personalButton=l.button,l=this.createButton(e.friends,3,"Social"),this.friendsButton=l.button,l=this.createButton(e.global,2,"Global"),this.globalButton=l.button,this.backButton.events.onInputDown.add(this.hide,this),this.personalButton.events.onInputDown.add(function(){this.setScores("PERSONAL")},this),this.friendsButton.events.onInputDown.add(function(){this.setScores("FRIENDS")},this),this.globalButton.events.onInputDown.add(function(){this.setScores("GLOBAL")},this)},BUTTON_TYPES:{bigSquare:{width:64,yOff:25,tileset:"tileset64"},horizontal:{width:192,yOff:15,tileset:"horizontalButton48"},smallHorizontal:{width:96,yOff:15,tileset:"horizontalButton48-96"}},createButton:function(t,e,o){var r=this.BUTTON_TYPES.bigSquare;this.gameController.ui.buttonSpecs.small&&(r=this.gameController.ui.graveyard.smallButtons?this.BUTTON_TYPES.smallHorizontal:this.BUTTON_TYPES.horizontal);var a=r.tileset,l=r.width,i=r.yOff,s=t.x,n=t.y,h=this.gameController.ui.buttonSpecs.small?o.length%4:e,d=this.gameController.phaser.add.image(s,n,a,h,this.graveyardLayer),u=this.gameController.addText(s,n+i,o,this.gameController.fontSpec,this.graveyardLayer);return this.gameController.centerText(u,s,l),d.inputEnabled=!0,{button:d,label:u}},setScores:function(t){this.gameController.playSFX("tap");var e=null;switch(t){case"PERSONAL":e="Personal";break;case"FRIENDS":e="Friends";break;case"GLOBAL":e="Global"}var o=this.gameController.ui.graveyard;this.tableGroup&&this.tableGroup.destroy(!0),this.tableGroup=this.gameController.phaser.add.group(this.graveyardLayer);var r=this.gameController.addText(o.promoText.x,o.promoText.y,"Loading...",this.gameController.fontSpec,this.tableGroup),a=this;this.gameController.communityClient.getScores(t,this.gameController.version,this.hardcoreMode,{ok:function(t){a.showScores(t.scores,e,!0)},error:function(){r.text="Error."}})},show:function(t){this.hardcoreMode=t,this.gameController.panelStack.push(this),this.graveyardLayer.visible=!0,this.setScores("PERSONAL")},showScores:function(t,e,o){this.titleLabel.text=e+(this.hardcoreMode?" Hardcore":"")+" - v"+this.gameController.version;var r=this.gameController.ui.graveyard;this.gameController.centerText(this.titleLabel,r.title.x,r.title.width);var a=r.table.x,l=r.table.y;this.tableGroup&&this.tableGroup.destroy(!0),"Personal"===e&&(o=!1);var i=r.table.columns?r.table.columns[0]:158,s=r.table.columns?r.table.columns[0]+r.table.columns[1]:212;this.tableGroup=this.gameController.phaser.add.group(this.graveyardLayer),this.gameController.addText(a,l,"Class",this.gameController.fontSpec,this.tableGroup),this.gameController.addText(a+i,l,"Depth",this.gameController.fontSpec,this.tableGroup),this.gameController.addText(a+s,l,"Kills",this.gameController.fontSpec,this.tableGroup);for(var n=0;n<t.length;n++){var h=t[n],d=h.className;h.won&&(d+="*"),o&&(d=d+" ("+h.playerName+")"),this.gameController.addText(a,l+16*(n+1),d,this.gameController.fontSpec,this.tableGroup),this.gameController.addText(a+i+28,l+16*(n+1),h.depth,this.gameController.fontSpec,this.tableGroup),this.gameController.addText(a+s+10,l+16*(n+1),h.kills,this.gameController.fontSpec,this.tableGroup)}},showPromo:function(t){this.titleLabel.text=t+" Graveyard - v"+this.gameController.version;var e=this.gameController.ui.graveyard;this.gameController.centerText(this.titleLabel,e.title.x,e.title.width),this.tableGroup&&this.tableGroup.destroy(!0),this.tableGroup=this.gameController.phaser.add.group(this.graveyardLayer),this.gameController.addText(e.promoText.x,e.promoText.y,"This feature is only available in the Fellowship Edition",{font:this.gameController.font,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:e.promoText.width},this.tableGroup).lineSpacing=-8;var o=this.gameController.phaser.add.image(e.promoButton.x,e.promoButton.y,"horizontalButton",null,this.tableGroup);this.gameController.addText(e.promoButton.x+75,e.promoButton.y+25,"More Info...",this.gameController.fontSpec,this.tableGroup),o.inputEnabled=!0,o.events.onInputDown.add(this.get,this)},hide:function(){this.gameController.playSFX("tap"),this.gameController.panelStack.pop(),this.graveyardLayer.visible=!1},get:function(){this.gameController.openURL("http://ananiasgame.com/fellowship.html")},backNavigation:function(){return this.hide(),!1}};

},{}],55:[function(require,module,exports){
function HelpPanel(e){this.gameController=e}module.exports=HelpPanel,HelpPanel.prototype={SCRIPT:[{message:"Save Concordia by finding the Ring of Ananias, rumored to be sealed on his tomb.",character:"mage",image:0},{message:"Explore each level looking for the magic gate to go to the next world.",character:"mage",image:1},{message:"In order to activate the gate, you will need to find the rune of passage.",character:"mage",image:1},{message:"Move quickly between rooms by #TAPPING the arrows at the room exits.",character:"mage",image:3},{message:"Scattered around you'll find weapons, armor and other artifacts you will need to survive.",character:"mage",image:2},{message:"#TAP on items to examine and pick them up.",character:"mage",image:4},{message:"Take your time to think your actions thoroughly, you have all the time to make your best choice.",character:"knight"},{message:'The attack stat for weapons is described as "xDy"; damage is calculated by rolling a "y" sided dice "x" times.',character:"knight",image:5},{message:"For example, a 2D6 weapon can cause a minimum damage of 2 and a max of 12",character:"knight",image:5},{message:"You can equip two weapons at a time and switch quickly between them.",character:"knight"},{message:"You can also throw weapons and other items at your enemies.",character:"knight",image:6},{message:"Your character will level up everytime you get to a new level,",character:"mage",image:7},{message:"You'll be able to pick a Heavenly Patron to improve your stats or learn a new spell.",character:"mage",image:8},{message:"Casting spells spends your Magic Points, you recover half your missing points on level up.",character:"mage",image:9},{message:"For a full description of the magic system, classes and items, check the manual inside the game",character:"mage"},{message:"If you have a pet, you can command it to Attack, Pull back or remain close, try to keep it alive.",character:"knight",image:10},{message:"Every time you play, the dungeon will be completely different.",character:"knight"},{message:"You will die. Death is normal. Keep that in mind, and don't give up.",character:"knight"}],init:function(){var e=this.gameController,a=e.ui.help,t=(this.gameController.fontSpec,{font:this.gameController.font,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:a.dialogText.width});this.helpLayer=e.phaser.add.group(),this.helpLayer.visible=!1,e.phaser.add.image(0,0,"background",null,this.helpLayer).inputEnabled=!0,this.dialogText=e.addText(a.dialogText.x,a.dialogText.y,"",t,this.helpLayer),this.dialogText.lineSpacing=-8,this.characterImage=e.phaser.add.image(a.characterImage.x,a.characterImage.y,"misc64-96",1,this.helpLayer),this.helpImage=e.phaser.add.image(a.helpImage.x,a.helpImage.y,"helpImages",0,this.helpLayer),this.nextButton=this.gameController.createHButton(a.next,"Next >",this.helpLayer).button,this.nextButton.events.onInputDown.add(this.next,this),this.skipButton=this.gameController.createHButton(a.skip,"Skip",this.helpLayer).button,this.skipButton.events.onInputDown.add(this.skip,this)},show:function(){this.currentTip=-1,this.next(),this.gameController.panelStack.push(this),this.helpLayer.visible=!0},next:function(){if(this.gameController.playSFX("tap"),this.currentTip++,this.currentTip!=this.SCRIPT.length){var e=this.SCRIPT[this.currentTip],a="knight"===e.character?0:1;this.characterImage.loadTexture("misc64-96",a),this.dialogText.text=e.message.replace("#TAPPING",this.gameController.tappingVerb).replace("#TAP",this.gameController.upperTapVerb),void 0!==e.image&&this.helpImage.loadTexture("helpImages",e.image)}else this.skip()},hide:function(){this.gameController.panelStack.pop(),this.helpLayer.visible=!1},skip:function(){this.hide(),this.gameController.playSFX("tap"),this.gameController.guiLayer.visible=!0;var e=this.gameController;this.gameController.gameActive=!0,this.gameController.newLevel(function(){e.musicController.stopMusic(),e.musicController.playDungeonMusic(),e.mapLayer.visible=!0,e.mapUILayer.visible=!0,e.resetRoom(e.newRoom,!0),e.newRoom=null,e.updatePlayerStats(!1),e.entityInfoPanel.show(e.player),e.communityClient.token||e.alert("You have not logged into Ananias Server, your game session will not be stored and you won't be able to share your character tombstones.","Warning"),e.locationImageGroup.visible||(e.logEvent("Input enabled, last help"),e.enablePlayerAction())})},backNavigation:function(){return!1}};

},{}],56:[function(require,module,exports){
var Spells=require("../Spells"),Effects=require("../Effects");function InventoryPanel(e,t){this.font=e.font,this.gameController=e,this.reset(),this.inventoryGuiLayer=t,this.inventoryGuiLayer.visible=!1;var i=this.gameController.fontSpec;this.font,this.gameController.fontColor;this.gameController.isDesktop&&this.gameController.phaser.add.image(e.ui.inventoryPanel.pos.x,e.ui.inventoryPanel.pos.y,"angelsFrame",0,this.inventoryGuiLayer);var s=this.gameController.ui.inventoryPanel;s.background&&this.gameController.phaser.add.image(s.background.x,s.background.y,s.background.image,0,this.inventoryGuiLayer);var l=e.ui.inventoryPanel.playerIcon.x,r=e.ui.inventoryPanel.playerIcon.y;this.playerSprite=this.gameController.phaser.add.image(l,r,"tileset32",0,this.inventoryGuiLayer),l=e.ui.inventoryPanel.petIcon.x,r=e.ui.inventoryPanel.petIcon.y,this.petStatsGroup=this.gameController.phaser.add.group(this.inventoryGuiLayer),this.petSprite=this.gameController.phaser.add.image(l,r,"tileset32",0,this.petStatsGroup),this.runeSprite=this.gameController.phaser.add.image(l-32,r,"items-misc",60,this.inventoryGuiLayer),this.runeSprite.visible=!1,this.runeSprite.inputEnabled=!0,this.runeSprite.events.onInputDown.add(function(){n.useInspector(this,"Rune of Passage","Activates Magic Gates")},this.runeSprite),e.ui.inventoryPanel.itemSummaryText&&(this.itemSummaryText=this.gameController.addText(e.ui.inventoryPanel.itemSummaryText.x,e.ui.inventoryPanel.itemSummaryText.y,"",i,this.inventoryGuiLayer));var n=this.gameController;this.playerSprite.inputEnabled=!0,this.playerSprite.events.onInputDown.add(function(){this.chemistryMode||n.entityInfoPanel.show(n.player)},this),this.petSprite.inputEnabled=!0,this.petSprite.events.onInputDown.add(function(){n.player.pet&&(this.chemistryMode||n.entityInfoPanel.show(n.player.pet))},this)}module.exports=InventoryPanel,InventoryPanel.prototype={halfSelectItem:function(e){this.gameController.playSFX("tap"),this.itemWorn(e)?(this.selectedEquipmentBox.x=e.menuSprite.x-this.gameController.ui.inventoryPanel.equipment.padding,this.selectedEquipmentBox.y=e.menuSprite.y-this.gameController.ui.inventoryPanel.equipment.padding,this.selectedEquipmentBox.visible=!0,this.selectedItemBox.visible=!1,this.selectedPanel="equipment",this.selectedItemX=e.menuX,this.selectedItemY=e.menuY):(this.selectedItemBox.x=e.menuSprite.x-this.gameController.ui.inventoryPanel.grid.padding,this.selectedItemBox.y=e.menuSprite.y-this.gameController.ui.inventoryPanel.grid.padding,this.selectedItemBox.visible=!0,this.selectedEquipmentBox.visible=!1,this.selectedPanel="bag",this.selectedItemX=e.menuX,this.selectedItemY=e.menuY)},showItemInfo:function(e){this.gameController.showObjectInfo(e,e.getName(),e.getDetails(this.gameController.player),!0),this.itemSummaryText&&(this.itemSummaryText.text=e.getSummaryDescription(),this.gameController.centerText(this.itemSummaryText,this.gameController.ui.inventoryPanel.itemSummaryText.x,this.gameController.ui.inventoryPanel.itemSummaryText.width)),this.gameController.playSFX("tap"),this.selectedItem=e,this.selectedSpell=!1;var t=this.itemWorn(e);if(t?(this.selectedEquipmentBox.x=e.menuSprite.x-this.gameController.ui.inventoryPanel.equipment.padding,this.selectedEquipmentBox.y=e.menuSprite.y-this.gameController.ui.inventoryPanel.equipment.padding,this.selectedEquipmentBox.visible=!0,this.selectedItemBox.visible=!1,this.selectedPanel="equipment",this.selectedItemX=e.menuX,this.selectedItemY=e.menuY):(this.selectedItemBox.x=e.menuSprite.x-this.gameController.ui.inventoryPanel.grid.padding,this.selectedItemBox.y=e.menuSprite.y-this.gameController.ui.inventoryPanel.grid.padding,this.selectedItemBox.visible=!0,this.selectedEquipmentBox.visible=!1,this.selectedPanel="bag",this.selectedItemX=e.menuX,this.selectedItemY=e.menuY),this.selectedSpellBox&&(this.selectedSpellBox.visible=!1),this.gameController.player.dead||(this.gameController.useButtonGroup.visible=!0,this.gameController.dropButtonGroup.visible=!0,e.features.dontThrow||e.features.isSpell?this.gameController.applyButtonGroup.visible=!1:(this.gameController.applyButtonGroup.visible=!0,this.gameController.applyButtonText.text="Throw")),t)this.gameController.useButtonText.text="Remove",this.gameController.useButtonImage.loadTexture("tileset32",120),this.gameController.ui.buttonSpecs.small&&this.gameController.useButtonOverlay.loadTexture("tileset32",159);else{var i="Use";e.features.isSpell?(i="Cast",this.gameController.useButtonImage.loadTexture("tileset32",119)):this.gameController.useButtonImage.loadTexture("tileset32",114),this.gameController.ui.buttonSpecs.small&&this.gameController.useButtonOverlay.loadTexture("tileset32",158),this.gameController.useButtonText.text=i}this.gameController.ui.buttonSpecs.text.xCenter&&(this.gameController.centerText(this.gameController.useButtonText,this.gameController.ui.useButton.x,this.gameController.ui.buttonSpecs.text.xCenter),this.gameController.centerText(this.gameController.applyButtonText,this.gameController.ui.applyButton.x,this.gameController.ui.buttonSpecs.text.xCenter))},selectSpell:function(e){var t=this.gameController.getSpellEffectDescription(e),i=this.gameController.player.getSpellMPCost(e);if(this.itemSummaryText){var s=e.words;"magicAttack"===e.effect&&(s+=" ["+this.gameController.player.getSpellDamageRoll(e)+"]"),i&&(s+=" ("+i+"MP)"),this.itemSummaryText.text=s,this.gameController.centerText(this.itemSummaryText,this.gameController.ui.inventoryPanel.itemSummaryText.x,this.gameController.ui.inventoryPanel.itemSummaryText.width)}this.gameController.showObjectInfo(Spells.getIconTexture(this.gameController,e),e.words,t,!1,!0),this.gameController.playSFX("tap"),this.selectedItem=!1,this.selectedSpell=e,this.selectedItemBox.visible=!1;var l=this.gameController.player.getSpellIndex(e),r=this.gameController.ui.inventoryPanel.spellsRow;this.selectedSpellBox.x=l*r.space+r.x,this.selectedSpellBox.y=r.y,this.selectedSpellBox.visible=!0,this.gameController.player.dead||(this.gameController.useButtonGroup.visible=!0,this.gameController.dropButtonGroup.visible=!1,this.gameController.applyButtonGroup.visible=!1),this.gameController.useButtonImage.loadTexture("tileset32",119),this.gameController.ui.buttonSpecs.small&&this.gameController.useButtonOverlay.loadTexture("tileset32",158),this.gameController.useButtonText.text="Cast",this.gameController.ui.buttonSpecs.text.xCenter&&this.gameController.centerText(this.gameController.useButtonText,this.gameController.ui.useButton.x,this.gameController.ui.buttonSpecs.text.xCenter)},addItem:function(e){e.setMenuSprite(),this.inventoryGroup.add(e.menuSprite),e.menuSprite.visible=!0,this.gameController.mapGroup?this.gameController.mapGroup.remove(e.sprite):e.sprite&&(e.sprite.visible=!1),this._relocateItemSprites()},_relocateItemSprites:function(){var e=this.gameController.player.items,t=0,i=0,s=this.gameController.ui.inventoryPanel.grid,l=this.gameController.ui.inventoryPanel.equipment;l.x=this.gameController.ui.inventoryPanel.playerIcon.x-32,l.y=this.gameController.ui.inventoryPanel.playerIcon.y-32,this.equipmentItems=[];for(var r=0;r<3;r++)this.equipmentItems[r]=[];this.bagItems=[];for(var n=0;n<e.length;n++){var o=e[n];if(o.menuSprite)if(this.itemWorn(o)){var a=0,m=0;if("wear"===o.onUse)switch(o.features.wearLocation){case"body":a=0,m=0;break;case"arms":a=2,m=0;break;case"legs":a=0,m=2;break;case"foot":a=1,m=2}else"wearAsHelmet"===o.onUse?(a=1,m=0):"wearAsShield"===o.onUse?(a=2,m=1):"wield"===o.onUse&&(a=0,m=1);o.menuSprite.x=a*l.space+l.x,o.menuSprite.y=m*l.space+l.y,this.equipmentItems[a][m]=o,o.menuX=a,o.menuY=m}else o.menuSprite.x=t*s.space+s.x,o.menuSprite.y=i*s.space+s.y,this.bagItems[t]||(this.bagItems[t]=[]),this.bagItems[t][i]=o,o.menuX=t,o.menuY=i,++t>s.width&&(i++,t=0)}},itemWorn:function(e){return this.gameController.player.currentWeapon==e||this.gameController.player.currentArmor==e||this.gameController.player.currentArmwear==e||this.gameController.player.currentLegwear==e||this.gameController.player.currentFootwear==e||this.gameController.player.currentHelmet==e||this.gameController.player.currentShield==e},hide:function(e){this.gameController.panelStack.pop(),this.inventoryGroup.visible=!1,this.destroyGrid(),this.gameController.setupUseAndThrowButtons(),this.gameController.dropButtonGroup.visible=!1,this.gameController.applyButtonGroup.visible=!1,this.inventoryGuiLayer.visible=!1,e||(this.gameController.logEvent("Input enabled, InventoryPanel hide"),this.gameController.enablePlayerAction()),this.gameController.ui.inventoryPanel.hideMapGUI&&(this.gameController.hudLayer.visible=!0)},show:function(){if(this.gameController.panelStack.push(this),this.inventoryGroup.visible=!0,this.selectedItem=null,this.itemSummaryText&&(this.itemSummaryText.text=""),this.runeSprite.visible=this.gameController.player.hasRune,this.gameController.useButtonGroup.visible=!1,this.gameController.dropButtonGroup.visible=!1,this.gameController.applyButtonGroup.visible=!1,this.addGrid(),this._relocateItemSprites(),this.inventoryGuiLayer.bringToTop(this.inventoryGroup),this.inventoryGuiLayer.visible=!0,this.gameController.ui.inventoryPanel.hideMapGUI&&(this.gameController.hudLayer.visible=!1),this.updatePlayerStats(!0),this.bagItems.length>0)this.selectedPanel="bag",this.selectedItemX=0,this.selectedItemY=0,this.activateSelected();else if(this.equipmentItems.length>0){this.selectedPanel="equipment";e:for(var e=0;e<3;e++)for(var t=0;t<3;t++)if(this.equipmentItems[e][t]){this.selectedItemX=e,this.selectedItemY=t,this.activateSelected();break e}}},removeItem:function(e){this.inventoryGroup.remove(e.menuSprite),this._relocateItemSprites()},reset:function(){this.inventoryGroup?(this.gameController.killAllImagesOnGroup(this.inventoryGroup),this.gameController.usePool||(this.inventoryGroup=this.gameController.phaser.add.group(this.inventoryGuiLayer))):this.inventoryGroup=this.gameController.phaser.add.group(this.inventoryGuiLayer),this.inventoryGroup.visible=!1},addGrid:function(){this.inventoryGridGroup=this.gameController.phaser.add.group(this.inventoryGuiLayer);for(var e=this.gameController.ui.inventoryPanel.grid,t=0,i=0,s=0;s<this.gameController.player.getTotalCarryCapacity();s++)this.gameController.phaser.add.image(t*e.space+e.x-e.padding,i*e.space+e.y-e.padding,e.icon.name,e.icon.index,this.inventoryGridGroup),++t>e.width&&(i++,t=0);if(this.gameController.ui.inventoryPanel.spellsRow){e=this.gameController.ui.inventoryPanel.spellsRow;for(s=0;s<8;s++)this.gameController.phaser.add.image(s*e.space+e.x,e.y,e.icon.name,e.icon.index,this.inventoryGridGroup);this.gameController.ui.inventoryPanel.spellsRow&&(this.selectedSpellBox=this.gameController.getImage(0,0,this.gameController.ui.inventoryPanel.spellsRow.selectedIcon.name,this.gameController.ui.inventoryPanel.spellsRow.selectedIcon.index,this.inventoryGridGroup),this.selectedSpellBox.visible=!1);var l=this.gameController.player.spells;for(s=0;s<l.length;s++){var r=l[s],n=this.gameController.getImage(s*e.space+e.x,e.y,"spells",r.icon,this.inventoryGridGroup);n.inputEnabled=!0;var o=this.gameController;n.events.onInputDown.add(function(e,t){o.interactSpellBridge(this,o.isDoubleTap(t))},r)}}e=this.gameController.ui.inventoryPanel.equipment;for(var a=this.gameController.ui.inventoryPanel.playerIcon.x-32,m=this.gameController.ui.inventoryPanel.playerIcon.y-32,h=0;h<3;h++)for(var u=0;u<3;u++)1==h&&1==u||this.gameController.phaser.add.image(h*e.space+a,u*e.space+m,e.icon.name,e.icon.index,this.inventoryGridGroup);e=this.gameController.ui.inventoryPanel.grid,this.selectedItemBox=this.gameController.getImage(0,0,e.selectedIcon.name,e.selectedIcon.index,this.inventoryGridGroup),this.selectedItemBox.visible=!1,this.secondarySelectedItemBox=this.gameController.getImage(0,0,e.selectedIcon.name,e.selectedIcon.index,this.inventoryGridGroup),this.secondarySelectedItemBox.visible=!1,this.selectedEquipmentBox=this.gameController.getImage(0,0,this.gameController.ui.inventoryPanel.equipment.selectedIcon.name,this.gameController.ui.inventoryPanel.equipment.selectedIcon.index,this.inventoryGridGroup),this.selectedEquipmentBox.visible=!1,this.itemSummaryText&&this.itemSummaryText.bringToTop()},destroyGrid:function(){this.inventoryGridGroup&&this.gameController.killAllImagesOnGroup(this.inventoryGridGroup)},updatePlayerStats:function(){if(this.playerSprite.loadTexture(this.gameController.player.sprite.texture),this.gameController.player.pet){var e=this.gameController.player.pet;this.petSprite.loadTexture(e.sprite.texture),this.petStatsGroup.visible=!0}else this.petStatsGroup.visible=!1},backNavigation:function(){return this.gameController.switchInventory(),!1},selectReagent:function(e){this.firstReagent=e,this.gameController.saveButtonState(),this.gameController.hideAllButtons(),this.chemistryMode=!0,this.itemSummaryText&&(this.itemSummaryText.text="Select mix for "+e.name,this.gameController.centerText(this.itemSummaryText,this.gameController.ui.inventoryPanel.itemSummaryText.x,this.gameController.ui.inventoryPanel.itemSummaryText.width)),this.originalSelectedItemX=this.selectedItemX,this.originalSelectedItemY=this.selectedItemY,this.gameController.cancelApplyButtonGroup.visible=!0,this.gameController.showObjectInfo(e,e.getName(),"Select a reagent to mix with "+e.getName(),!0)},selectSecondReagent:function(e){this.secondReagent=e,this.firstReagent==e?(this.gameController.showObjectInfo(this.firstReagent,this.firstReagent.getName(),"Select a reagent to mix with "+this.firstReagent.getName(),!0),this.gameController.confirmApplyButtonGroup.visible=!1):"applySpirit"===e.onUse?(this.gameController.showObjectInfo(e,this.secondReagent.getName(),"Mix "+this.firstReagent.getName()+" with "+this.secondReagent.getName()+"?",!0),this.itemSummaryText&&(this.itemSummaryText.text="Mix "+this.firstReagent.name+" with "+this.secondReagent.name+"?",this.gameController.centerText(this.itemSummaryText,this.gameController.ui.inventoryPanel.itemSummaryText.x,this.gameController.ui.inventoryPanel.itemSummaryText.width)),this.gameController.confirmApplyButtonGroup.visible=!0):(this.gameController.showObjectInfo(e,this.secondReagent.getName(),this.secondReagent.getName()+" won't mix.",!0),this.itemSummaryText&&(this.itemSummaryText.text="Mixing "+this.firstReagent.name,this.gameController.centerText(this.itemSummaryText,this.gameController.ui.inventoryPanel.itemSummaryText.x,this.gameController.ui.inventoryPanel.itemSummaryText.width)),this.gameController.confirmApplyButtonGroup.visible=!1),this.gameController.playSFX("tap"),this.secondarySelectedItemBox.x=e.menuSprite.x-this.gameController.ui.inventoryPanel.grid.padding,this.secondarySelectedItemBox.y=e.menuSprite.y-this.gameController.ui.inventoryPanel.grid.padding,this.secondarySelectedItemBox.visible=!0},endChemistry:function(){this.itemSummaryText&&(this.itemSummaryText.text=""),this.gameController.confirmApplyButtonGroup.visible=!1,this.gameController.cancelApplyButtonGroup.visible=!1,this.secondarySelectedItemBox.visible=!1,this.gameController.resetButtonState(),this.chemistryMode=!1,this.firstReagent=null,this.secondReagent=null,this.selectedItemX=this.originalSelectedItemX,this.selectedItemY=this.originalSelectedItemY,this.selectedPanel="bag"},activateSelected:function(){var e=("bag"===this.selectedPanel?this.bagItems:this.equipmentItems)[this.selectedItemX][this.selectedItemY];this.chemistryMode?this.selectSecondReagent(e):this.showItemInfo(e)},moveSelected:function(e,t){var i=this.gameController.ui.inventoryPanel.grid;if("bag"===this.selectedPanel)if(0===this.selectedItemX&&-1===e){if(this.equipmentItems.length>0){this.selectedPanel="equipment";for(var s=2;s>=0;s--)for(var l=0;l<3;l++)if(this.equipmentItems[s][l])return this.selectedItemX=s,this.selectedItemY=l,void this.activateSelected();this.selectedPanel="bag"}}else 0===this.selectedItemY&&-1===t||this.selectedItemX===i.width&&1===e||this.selectedItemY===i.height&&1===t||(this.selectedItemX+=e,this.selectedItemY+=t,this.bagItems[this.selectedItemX]&&this.bagItems[this.selectedItemX][this.selectedItemY]?this.activateSelected():(this.selectedItemX-=e,this.selectedItemY-=t));else if("equipment"===this.selectedPanel)if(1===e)if(2===this.selectedItemX)this.bagItems.length>0&&(this.selectedPanel="bag",this.selectedItemX=0,this.selectedItemY=0,this.activateSelected());else if(this.equipmentItems[this.selectedItemX+1][this.selectedItemY])this.selectedItemX++,this.activateSelected();else if(this.equipmentItems[this.selectedItemX+e]&&this.equipmentItems[this.selectedItemX+e][this.selectedItemY-1])this.selectedItemX+=e,this.selectedItemY--,this.activateSelected();else if(this.equipmentItems[this.selectedItemX+e]&&this.equipmentItems[this.selectedItemX+e][this.selectedItemY+1])this.selectedItemX+=e,this.selectedItemY++,this.activateSelected();else{for(;this.selectedItemX<2;){this.selectedItemX++;for(l=0;l<3;l++)if(this.equipmentItems[this.selectedItemX][l])return this.selectedItemY=l,void this.activateSelected()}this.bagItems.length>0&&(this.selectedPanel="bag",this.selectedItemX=0,this.selectedItemY=0,this.activateSelected())}else if(0===this.selectedItemX&&-1===e||0===this.selectedItemY&&-1===t||2===this.selectedItemY&&1===t);else if(this.equipmentItems[this.selectedItemX+e][this.selectedItemY+t])this.selectedItemX+=e,this.selectedItemY+=t,this.activateSelected();else if(0!=t&&this.equipmentItems[this.selectedItemX-1]&&this.equipmentItems[this.selectedItemX-1][this.selectedItemY+t])this.selectedItemX--,this.selectedItemY+=t,this.activateSelected();else if(0!=t&&this.equipmentItems[this.selectedItemX+1]&&this.equipmentItems[this.selectedItemX+1][this.selectedItemY+t])this.selectedItemX++,this.selectedItemY+=t,this.activateSelected();else if(0!=e&&this.equipmentItems[this.selectedItemX+e]&&this.equipmentItems[this.selectedItemX+e][this.selectedItemY-1])this.selectedItemY--,this.selectedItemX+=e,this.activateSelected();else if(0!=e&&this.equipmentItems[this.selectedItemX+e]&&this.equipmentItems[this.selectedItemX+e][this.selectedItemY+1])this.selectedItemY++,this.selectedItemX+=e,this.activateSelected();else{var r=this.selectedItemX,n=this.selectedItemY;if(-1===e)for(;this.selectedItemX>0;){this.selectedItemX--;for(l=0;l<3;l++)if(this.equipmentItems[this.selectedItemX][l])return this.selectedItemY=l,void this.activateSelected()}else if(1===t)for(;this.selectedItemY<3;){this.selectedItemY++;for(s=0;s<3;s++)if(this.equipmentItems[s][this.selectedItemY])return this.selectedItemX=s,void this.activateSelected()}else if(-1===t)for(;this.selectedItemY>=0;){this.selectedItemY--;for(s=0;s<3;s++)if(this.equipmentItems[s][this.selectedItemY])return this.selectedItemX=s,void this.activateSelected()}this.selectedItemX=r,this.selectedItemY=n}}};

},{"../Effects":10,"../Spells":31}],57:[function(require,module,exports){
"use strict";var PlayerClass=require("../PlayerClass.enum");function NewGamePanel(e){this.gameController=e}module.exports=NewGamePanel,NewGamePanel.prototype.init=function(){var e=this.gameController.phaser,t=this.gameController.ui.newGame,s=this.gameController.font;this.newGameLayer=e.add.group(),this.newGameLayer.visible=!1,e.add.image(0,0,"background",null,this.newGameLayer).inputEnabled=!0,e.add.image(t.character.x+4,t.character.y+40,"tileset64",8,this.newGameLayer),this.characterImage=e.add.image(t.character.x,t.character.y,"tileset48-96",0,this.newGameLayer),this.petImage=e.add.image(t.pet.x,t.pet.y-2,"tileset48-96",12,this.newGameLayer);var a=this.createButton(t.prevClass,1,"<");this.prevClassButton=a.button,this.prevClassButton.events.onInputDown.add(function(){this.changeClass(-1)},this),a=this.createButton(t.nextClass,2,">"),this.nextClassButton=a.button,this.nextClassButton.events.onInputDown.add(function(){this.changeClass(1)},this),a=this.createButton(t.prevGender,3,"<"),this.prevGenderButton=a.button,this.prevGenderButton.events.onInputDown.add(function(){this.changeGender()},this),a=this.createButton(t.nextGender,0,">"),this.nextGenderButton=a.button,this.nextGenderButton.events.onInputDown.add(function(){this.changeGender()},this),a=this.createButton(t.prevPet,0,"<"),this.prevPetButton=a.button,this.prevPetButton.events.onInputDown.add(function(){this.changePet(-1)},this),a=this.createButton(t.nextPet,1,">"),this.nextPetButton=a.button,this.nextPetButton.events.onInputDown.add(function(){this.changePet(1)},this),a=this.gameController.createHButton(t.select,"Select",this.newGameLayer),this.selectClassButton=a.button,this.selectClassButtonText=a.label,this.selectClassButton.events.onInputDown.add(this.confirmClassSelection,this),a=this.gameController.createHButton(t.back,"< Back",this.newGameLayer),this.backButton=a.button,this.backButton.events.onInputDown.add(this.backNavigation,this),this.selectedClassText=this.gameController.addText(t.selectedClass.x,t.selectedClass.y,"",this.gameController.fontSpec,this.newGameLayer),t.selectedClassDescription&&(this.selectedClassDescriptionText=this.gameController.addText(t.selectedClassDescription.x,t.selectedClassDescription.y,"",{font:s,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:t.selectedClassDescription.width},this.newGameLayer),this.selectedClassDescriptionText.lineSpacing=-8),this.selectedGenderText=this.gameController.addText(t.selectedGender.x,t.selectedGender.y,"",this.gameController.fontSpec,this.newGameLayer),this.selectedPetText=this.gameController.addText(t.selectedPet.x,t.selectedPet.y,"",this.gameController.fontSpec,this.newGameLayer),this.maxClasses=10},NewGamePanel.prototype.changeClass=function(e){switch(this.currentClass+=e,this.currentClass>this.maxClasses-1&&(this.currentClass=0),this.currentClass<0&&(this.currentClass=this.maxClasses-1),this.currentClass){case 0:this.selectClass(PlayerClass.ALCHEMIST,this.maleSelected);break;case 1:this.selectClass(PlayerClass.ARCANE,this.maleSelected);break;case 2:this.selectClass(PlayerClass.KNIGHT,this.maleSelected);break;case 3:this.selectClass(PlayerClass.ARCHER,this.maleSelected);break;case 4:this.selectClass(PlayerClass.SLAYER,this.maleSelected);break;case 5:this.selectClass(PlayerClass.BARBARIAN,this.maleSelected);break;case 6:this.selectClass(PlayerClass.AILORUS,this.maleSelected);break;case 7:this.selectClass(PlayerClass.DUMERIL,this.maleSelected);break;case 8:this.selectClass(PlayerClass.WITCH,this.maleSelected);break;case 9:this.selectClass(PlayerClass.SHEPHERD,this.maleSelected)}},NewGamePanel.prototype.changePet=function(e){if(void 0===this.normalPet||!1===this.normalPet)switch(this.currentPetIndex+=e,this.currentPetIndex>4&&(this.currentPetIndex=0),this.currentPetIndex<0&&(this.currentPetIndex=4),this.currentPetIndex){case 0:this.selectPet("PUPPY");break;case 1:this.selectPet("KITTEN");break;case 2:this.selectPet("PONY");break;case 3:this.selectPet("FROG");break;case 4:this.selectPet(null)}},NewGamePanel.prototype.selectPet=function(e,t){var s=this.gameController.ui.newGame;switch(this.selectedPetId=e,e){case"PUPPY":this.petImage.loadTexture("tileset48-96",18),this.selectedPetText.text="Dire Wolf";break;case"KITTEN":this.petImage.loadTexture("tileset48-96",19),this.selectedPetText.text="Wild Lynx";break;case"PONY":this.petImage.loadTexture("tileset48-96",20),this.selectedPetText.text="Pony";break;case"FROG":this.petImage.loadTexture("tileset48-96",21),this.selectedPetText.text="Giant Frog";break;case"SHEEP":this.petImage.loadTexture("tileset48-96",22),this.selectedPetText.text="Sheep";break;case null:this.petImage.loadTexture("tileset48-96",25),this.selectedPetText.text="None",this.currentPetIndex=4}this.gameController.centerText(this.selectedPetText,s.selectedPet.x,s.selectedPet.width),t||this.gameController.playSFX("tap"),this.selectedClassDescriptionText&&(s.shortDescriptions?this.selectedClassDescriptionText.text=this.selectedClass.shortDescription:this.selectedClassDescriptionText.text=this.selectedClass.longDescription,this.gameController.isDesktop&&!this.gameController.isGold&&this.selectedClass.isFellowship&&(this.selectedClassDescriptionText.text+="\n\nThis class is available on the Fellowship Edition"),this.selectedClassDescriptionText.text+=this.getSelectedPetDescription())},NewGamePanel.prototype.getSelectedPetDescription=function(){if(!this.gameController.isDesktop)return"";switch(this.selectedPetId){case"PUPPY":return"\n\nDire Wolf: Resilient and loyal, transforms into nerve breaking creatures with special skills.";case"KITTEN":return"\n\nWild Lynx: Agile and unpredictable, transforms into powerful nimble creatures.";case"PONY":return"\n\nPony: Allows you to carry 4 more items.";case"FROG":return"\n\nGiant Frog: Spits acid at your enemies.";case"SHEEP":return"\n\nSheep: Walks around bleating.";case null:return""}},NewGamePanel.prototype.selectClass=function(e,t,s){var a=this.gameController.ui.newGame;switch(this.selectedClass=e,this.selectedClassText.text=e.name,this.selectClassButtonText.text="Select",this.gameController.centerButtonLabel(this.selectClassButtonText,a.select.x),this.fellowshipInfo=!1,this.gameController.centerText(this.selectedClassText,a.selectedClass.x,a.selectedClass.width),this.selectedClassDescriptionText&&(a.shortDescriptions?this.selectedClassDescriptionText.text=e.shortDescription:this.selectedClassDescriptionText.text=e.longDescription,this.gameController.isDesktop&&!this.gameController.isGold&&e.isFellowship&&(this.selectedClassDescriptionText.text+="\n\nThis class is available on the Fellowship Edition"),this.selectedClassDescriptionText.text+=this.getSelectedPetDescription()),this.maleSelected=t,this.selectedGenderText.text=this.maleSelected?"Male":"Female",this.gameController.centerText(this.selectedGenderText,a.selectedGender.x,a.selectedGender.width),e){case PlayerClass.KNIGHT:this.characterImage.loadTexture("tileset48-96",0+(this.maleSelected?0:9));break;case PlayerClass.ARCHER:this.characterImage.loadTexture("tileset48-96",1+(this.maleSelected?0:9));break;case PlayerClass.ARCANE:this.characterImage.loadTexture("tileset48-96",2+(this.maleSelected?0:9));break;case PlayerClass.ALCHEMIST:this.characterImage.loadTexture("tileset48-96",3+(this.maleSelected?0:9));break;case PlayerClass.SLAYER:this.characterImage.loadTexture("tileset48-96",4+(this.maleSelected?0:9));break;case PlayerClass.BARBARIAN:this.characterImage.loadTexture("tileset48-96",5+(this.maleSelected?0:9));break;case PlayerClass.AILORUS:this.characterImage.loadTexture("tileset48-96",6+(this.maleSelected?0:9));break;case PlayerClass.DUMERIL:this.characterImage.loadTexture("tileset48-96",7+(this.maleSelected?0:9));break;case PlayerClass.WITCH:this.characterImage.loadTexture("tileset48-96",23+(this.maleSelected?0:1));break;case PlayerClass.SHEPHERD:this.characterImage.loadTexture("tileset48-96",8+(this.maleSelected?0:9))}e.startingPet?(this.normalPet=this.selectedPetId,this.selectPet(e.startingPet)):null===this.normalPet?(this.selectPet(null),this.normalPet=!1):this.normalPet&&(this.selectPet(this.normalPet),this.normalPet=!1),s||this.gameController.playSFX("tap")},NewGamePanel.prototype.changeGender=function(){this.maleSelected=!this.maleSelected,this.selectClass(this.selectedClass,this.maleSelected)},NewGamePanel.prototype.confirmClassSelection=function(){if(this.gameController.playSFX("tap"),this.selectedClass)if(!this.gameController.isGold&&this.currentClass>3&&9!=this.currentClass)if(this.fellowshipInfo)this.gameController.openURL("http://ananiasgame.com/fellowship.html");else{this.selectedClassDescriptionText&&(this.selectedClassDescriptionText.text='This class is only available in the "Fellowship Edition".\nGet it now!'),this.selectClassButtonText.text="More Info...";var e=this.gameController.ui.newGame;this.gameController.centerButtonLabel(this.selectClassButtonText,e.select.x),this.fellowshipInfo=!0}else this.hide(),this.gameController.characterCreationPanel.setup(this.selectedClass,this.maleSelected,this.selectedPetId),this.gameController.characterCreationPanel.show()},NewGamePanel.prototype.show=function(){this.currentClass=0,this.currentPetIndex=0,this.maleSelected=!0,this.gameController.guiLayer.visible=!1,this.gameController.titlePanel.hide(),this.gameController.panelStack.push(this),this.newGameLayer.visible=!0,this.selectClass(PlayerClass.ALCHEMIST,this.maleSelected,!0),this.selectPet("PUPPY",!0)},NewGamePanel.prototype.hide=function(){this.gameController.panelStack.pop(),this.newGameLayer.visible=!1},NewGamePanel.prototype.backNavigation=function(){return this.gameController.playSFX("tap"),this.hide(),this.gameController.titlePanel.show(),!1},NewGamePanel.prototype.createButton=function(e,t,s){var a=this.gameController.ui.buttonSpecs.small?"tileset32":"tileset64",l=this.gameController.ui.buttonSpecs.small?32:64,i=this.gameController.ui.buttonSpecs.small?7:25,r=e.x,n=e.y,o=this.gameController.ui.buttonSpecs.small?132:t,h=this.gameController.phaser.add.image(r,n,a,o,this.newGameLayer),c=this.gameController.addText(r,n+i,s,this.gameController.fontSpec,this.newGameLayer);return this.gameController.centerText(c,r,l),h.inputEnabled=!0,{button:h,label:c}};

},{"../PlayerClass.enum":25}],58:[function(require,module,exports){
function PlayerProfilePanel(e){this.gameController=e}module.exports=PlayerProfilePanel,PlayerProfilePanel.prototype={init:function(e){var t=this.gameController,i=t.ui.profile;this.connectLayer=t.phaser.add.group(),this.connectLayer.visible=!1,t.phaser.add.image(0,0,"background",null,this.connectLayer).inputEnabled=!0,this.gameController.isDesktop&&this.gameController.ui.title.logo&&t.phaser.add.image(this.gameController.ui.title.logo.x,this.gameController.ui.title.logo.y,"title",null,this.connectLayer),this.backButton=t.phaser.add.image(i.back.x,i.back.y,"horizontalButton",null,this.connectLayer),t.addText(i.back.x+105,i.back.y+25,"< Back",this.gameController.fontSpec,this.connectLayer),this.backButton.inputEnabled=!0,this.backButton.events.onInputDown.add(this.hide,this),t.addText(i.title.x,i.title.y,"Profile",this.gameController.titleSpec,this.connectLayer),this.selectedPlayerName=t.addText(i.selectedPlayer.name.x,i.selectedPlayer.name.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerPIN=t.addText(i.selectedPlayer.pin.x,i.selectedPlayer.pin.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerGames=t.addText(i.selectedPlayer.games.x,i.selectedPlayer.games.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerVictories=t.addText(i.selectedPlayer.victories.x,i.selectedPlayer.victories.y,"",this.gameController.fontSpec,this.connectLayer),this.selectedPlayerFriends=t.addText(i.selectedPlayer.friends.x,i.selectedPlayer.friends.y,"",this.gameController.fontSpec,this.connectLayer),this.friendsList=t.addText(i.selectedPlayer.friendsList.x,i.selectedPlayer.friendsList.y,"",{font:this.gameController.font,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:i.selectedPlayer.friendsList.width},this.connectLayer),this.friendsList.lineSpacing=-8},setPlayerInfo:function(e){this.selectedPlayerName.text=e.name,this.selectedPlayerPIN.text="PIN: "+e.pin,this.selectedPlayerGames.text="Games: "+e.games,this.selectedPlayerVictories.text="Victories: "+e.victories,this.selectedPlayerFriends.text="Friends: "+e.friends;var t="";if(e.friendsList)for(var i=0;i<e.friendsList.length;i++)i>0&&(t+=", "),t+=e.friendsList[i];this.friendsList.text=t},show:function(){this.gameController.panelStack.push(this);var e=this.gameController,t=this;e.communityClient.getProfile({ok:function(e){t.setPlayerInfo(e)},error:function(){}}),this.connectLayer.visible=!0},hide:function(){this.gameController.panelStack.pop(),this.connectLayer.visible=!1},backNavigation:function(){return this.hide(),!1}};

},{}],59:[function(require,module,exports){
function PromoPanel(t){this.gameController=t}module.exports=PromoPanel,PromoPanel.prototype={init:function(){var t=this.gameController,o=t.ui.promo,e=(this.gameController.fontSpec,{font:this.gameController.font,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:o.text.width});this.promoLayer=t.phaser.add.group(),this.promoLayer.visible=!1,t.phaser.add.image(0,0,"background",null,this.promoLayer).inputEnabled=!0,t.addText(o.text.x,o.text.y,"Get the Fellowship Edition!\nPlay with four new classes with outstanding skills.",e,this.promoLayer).lineSpacing=-8;var i=this.gameController._createHButton(o.get,"More info...",this.promoLayer,o.smallButtons);this.getButton=i.button,this.getButton.events.onInputDown.add(this.get,this),i=this.gameController._createHButton(o.soon,"Done",this.promoLayer,o.smallButtons),this.soonButton=i.button,this.soonButton.events.onInputDown.add(this.soon,this),this.coolImage=t.phaser.add.image(o.image.x,o.image.y,"fellowshipClasses",0,this.promoLayer)},show:function(){this.gameController.gameActive=!1,this.gameController.panelStack.push(this),this.promoLayer.visible=!0},hide:function(){this.gameController.panelStack.pop(),this.promoLayer.visible=!1},get:function(){this.gameController.openURL("http://ananiasgame.com/fellowship.html")},soon:function(){this.promoLayer.visible=!1,this.gameController.titlePanel.show()},backNavigation:function(){return this.hide(),!1}};

},{}],60:[function(require,module,exports){
var Upgrades=require("../Upgrades"),Spells=require("../Spells"),Layouts=require("../ui/Layouts");function SelectUpgrade(e){this.gameController=e}module.exports=SelectUpgrade,SelectUpgrade.prototype={init:function(){var e=this.gameController,t=e.phaser;this.font=e.font;var r=this.gameController.fontSpec;this.selectUpgradeGroup=this.gameController.phaser.add.group();var a=t.add.image(0,0,"background",null,this.selectUpgradeGroup);a.inputEnabled=!0,a.events.onInputDown.add(function(){},this);var o=e.ui.selectUpgradePanel;o.x,o.y;o.title&&(this.gameController.addText(o.title.x,o.title.y,"Select a Heavenly Patron",r,this.selectUpgradeGroup).visible=!0);this.upgradeDescriptionText=this.gameController.addText(o.upgradeDescriptionText.x,o.upgradeDescriptionText.y,"",{font:this.font,fill:this.gameController.fontColor,wordWrap:!0,wordWrapWidth:o.upgradeDescriptionText.width},this.selectUpgradeGroup),this.upgradeDescriptionText.lineSpacing=-8,this.upgradeDescriptionText.align="center",o.upgradeIdol.card&&(this.cardImage=this.gameController.getImage(o.upgradeIdol.x-32,o.upgradeIdol.y-32,"cardBground",0,this.selectUpgradeGroup),this.cardImage.visible=!1),this.upgradeIdol=this.gameController.getImage(o.upgradeIdol.x,o.upgradeIdol.y,"cards64",0,this.selectUpgradeGroup),this.upgradeNameText=this.gameController.addText(o.upgradeName.x,o.upgradeName.y,"",o.upgradeIdol.card?{font:this.font,fill:"#000000"}:this.gameController.titleSpec,this.selectUpgradeGroup),this.confirmButtonGroup=this.gameController.phaser.add.group(this.selectUpgradeGroup);var i=!1;o.confirmButton.small?i=this.gameController.createButton(o.confirmButton,0,129,"Ok",this.confirmButtonGroup,!1,!0).button:(i=this.gameController.createButton(o.confirmButton,0,129,"Ok",this.confirmButtonGroup,!1,!0).button,i=this.gameController.createHButton(o.confirmButton,"Select Patron",this.confirmButtonGroup).button),this.confirmButton=i,i.events.onInputDown.add(this.useUpgrade,this),this.confirmButtonGroup.visible=!1,this.selectedUpgradeIcon=this.gameController.getImage(0,0,"tileset64",4,this.selectUpgradeGroup),this.selectedUpgradeIcon.visible=!1,this.selectUpgradeGroup.visible=!1},show:function(e){this.confirmButton.inputEnabled=!0,this.selectUpgrade(!1),this.availableUpgrades=e,this.gameController.panelStack.push(this);var t=this.gameController.ui.selectUpgradePanel,r=t.x,a=t.y;this.upgradesGroup&&this.gameController.killAllImagesOnGroup(this.upgradesGroup),this.upgradesGroup=this.gameController.phaser.add.group(this.selectUpgradeGroup);for(var o=0,i=0,l=this,s=t.spacing?t.spacing:0,n=0;n<this.availableUpgrades.length;n++){var p=this.availableUpgrades[n];if(function(e,t){e.button.events.onInputDown.add(function(){l.selectUpgrade(t)})}(this.gameController.createButton({x:r+o*(64+s),y:a+i*(64+s)},n%4,p.getIndex(),p.getShortName(),this.upgradesGroup,!1,!0,{tileset:p.getTileset(),buttonSpecs:Layouts.COMMON.BUTTON.BIG}),p),p.spell){var g=p.spell.circle;this.gameController.getImage(r+o*(64+s)+2,a+i*(64+s)+4,"tileset16",63+g,this.upgradesGroup);var d=p.spell.school,u=d===Spells.ELEMENTAL?0:d===Spells.LIFE?1:d===Spells.MATTER?2:d===Spells.MIND?3:-1;-1!=u&&this.gameController.getImage(r+o*(64+s)+46,a+i*(64+s)+3,"tileset16",80+u,this.upgradesGroup)}3==++o&&(o=0,i++)}this.selectUpgradeGroup.visible=!0},hide:function(){this.gameController.panelStack.pop(),this.selectUpgradeGroup.visible=!1,this.upgradesGroup&&(this.gameController.killAllImagesOnGroup(this.upgradesGroup),this.upgradesGroup=!1)},selectUpgrade:function(e){var t=this.gameController.ui.selectUpgradePanel;if(e){this.upgradeIdol.loadTexture("cards64",e.getIdolIndex()),this.upgradeDescriptionText.text=e.getDescription(this.gameController.player),this.upgradeNameText.text=e.getName(),this.selectedUpgrade=e,this.confirmButtonGroup.visible=!0;for(var r=t.x,a=t.y,o=t.spacing?t.spacing:0,i=0,l=0,s=0;s<this.availableUpgrades.length;s++){if(e===this.availableUpgrades[s]){this.selectedUpgradeIcon.x=r+i*(64+o),this.selectedUpgradeIcon.y=a+l*(64+o);break}3==++i&&(i=0,l++)}this.cardImage&&(this.cardImage.visible=!0),this.selectedUpgradeIcon.visible=!0,this.selectedUpgradeIcon.bringToTop()}else this.upgradeIdol.loadTexture("cards64",10),this.upgradeDescriptionText.text="Pick a Heavenly Patron Entity to increase your power or learn a new spell.",this.upgradeNameText.text="Level Up",this.selectedUpgrade=!1,this.confirmButtonGroup.visible=!1,this.cardImage&&(this.cardImage.visible=!1),this.selectedUpgradeIcon.visible=!1;this.gameController.centerText(this.upgradeDescriptionText,t.upgradeDescriptionText.x,t.upgradeDescriptionText.width),this.gameController.centerText(this.upgradeNameText,t.upgradeName.x,t.upgradeName.width)},useUpgrade:function(){this.confirmButton.inputEnabled=!1;var e=this.gameController.phaser.add.image(0,0,"background");e.alpha=0;var t=this.gameController.tween(e).to({alpha:1},500),r=this;t.onComplete.add(function(){r.gameController.stampLastAction(),r.hide();var t=r.gameController.tween(e).to({alpha:0},500);t.onComplete.add(function(){e.destroy(),r.gameController.logEvent("Input enabled, useUpgrade"),r.gameController.enablePlayerAction()}),r.gameController.startTween(e,t),r.selectedUpgrade.applyUpgrade(r.gameController.player),r.gameController.player.pet&&(r.gameController.player.pet.tryLevelUp(),r.gameController.updatePlayerStats(!0))}),this.gameController.startTween(e,t)},backNavigation:function(){return!1}};

},{"../Spells":31,"../Upgrades":35,"../ui/Layouts":67}],61:[function(require,module,exports){
function SignupPanel(e){this.gameController=e}module.exports=SignupPanel,SignupPanel.prototype={init:function(e){var t=this.gameController,s=t.ui.signup;if(this.titlePanel=e,this.connectLayer=t.phaser.add.group(),this.connectLayer.visible=!1,this.gameController.isDesktop)var a=t.phaser.add.image(this.gameController.ui.title.backgroundDialog.x,this.gameController.ui.title.backgroundDialog.y,"dialog-v",null,this.connectLayer);else a=t.phaser.add.image(0,0,"background",null,this.connectLayer);a.inputEnabled=!0;var n=!1;n=s.back.small?this.gameController.createHButton(s.back,"< Back",this.connectLayer,{size:128}):this.gameController.createHButton(s.back,"< Back",this.connectLayer),this.backButton=n.button,this.backButton.events.onInputDown.add(this.hide,this),n=this.gameController.createHButton(s.signup,"Create Account",this.connectLayer),this.signupButton=n.button,this.signupButton.events.onInputDown.add(this.signup,this),this.gameController.ui.useTextfields?(this.nameText=t.addText(s.nameLabel.x,s.nameLabel.y,"Username",this.gameController.fontSpec,this.connectLayer),this.emailText=t.addText(s.emailLabel.x,s.emailLabel.y,"Email",this.gameController.fontSpec,this.connectLayer),this.passwordText=t.addText(s.passwordLabel.x,s.passwordLabel.y,"Password",this.gameController.fontSpec,this.connectLayer)):(n=this.gameController.createButton(s.nameButton,0,137,"Name",this.connectLayer,!1,!0),this.nameButton=n.button,this.nameButton.events.onInputDown.add(this.promptName,this),n=this.gameController.createButton(s.passwordButton,1,137,"Password",this.connectLayer,!1,!0),this.passwordButton=n.button,this.passwordButton.events.onInputDown.add(this.promptPassword,this),n=this.gameController.createButton(s.emailButton,2,137,"Email",this.connectLayer,!1,!0),this.emailButton=n.button,this.emailButton.events.onInputDown.add(this.promptEmail,this),this.nameText=t.addText(s.popupNameLabel.x,s.popupNameLabel.y,"Username: Not Set",this.gameController.fontSpec,this.connectLayer),this.emailText=t.addText(s.popupEmailLabel.x,s.popupEmailLabel.y,"Email: Not Set",this.gameController.fontSpec,this.connectLayer),this.passwordText=t.addText(s.popupPasswordLabel.x,s.popupPasswordLabel.y,"Password: Not Set",this.gameController.fontSpec,this.connectLayer))},promptName:function(){var e=this;this.gameController.prompt("Enter your user name","User name",function(t){if(t){e.selectedUsername=t.trim();var s=e.selectedUsername.length>10?e.selectedUsername.substring(0,9)+"...":e.selectedUsername;e.nameText.text="Username: "+s}else e.selectedUsername=!1,e.nameText.text="Username: Not Set"})},promptEmail:function(){var e=this;this.gameController.prompt("Enter your e-mail","E-mail",function(t){if(t){e.selectedEmail=t.trim();var s=e.selectedEmail.length>10?e.selectedEmail.substring(0,9)+"...":e.selectedEmail;e.emailText.text="Email: "+s}else e.selectedEmail=!1,e.emailText.text="Email: Not Set"})},promptPassword:function(){var e=this;this.gameController.prompt("Enter your password","Password",function(t){t&&t.trim().length>0?(e.selectedPassword=t,e.passwordText.text="Password: <Set>"):(e.selectedPassword=!1,e.passwordText.text="Password: Not Set")},"password")},signup:function(){if(this.gameController.playSFX("tap"),this.gameController.ui.useTextfields&&(this.selectedUsername=this.gameController.getTextFieldValue("txtUserName_signupPanel").trim(),this.selectedEmail=this.gameController.getTextFieldValue("txtEmail_signupPanel").trim(),this.selectedPassword=this.gameController.getTextFieldValue("txtPassword_signupPanel").trim()),this.selectedUsername&&0!==this.selectedUsername.length)if(this.selectedEmail&&0!==this.selectedEmail.length)if(this.selectedPassword&&0!==this.selectedPassword.length){this.disableInput();var e=this.gameController,t=this,s={name:this.selectedUsername,password:this.selectedPassword,email:this.selectedEmail};e.communityClient.signup(s,{ok:function(s){e.alert("Your player account has been created, your PIN is "+s.pin,"Welcome!"),t.titlePanel.setPlayerInfo(s),e.persistanceManager.saveLoginInfo(t.selectedUsername,s.loginKey),t.enableInput(),t.hide()},error:function(){t.enableInput()}})}else this.gameController.alert("Please enter your password","Error");else this.gameController.alert("Please enter your e-mail","Error");else this.gameController.alert("Please enter your user name","Error")},show:function(){if(this.gameController.ui.useTextfields){var e=this.gameController.ui.signup;this.gameController.createTextField("txtUserName_signupPanel",e.nameField.x,e.nameField.y,e.nameField.width,e.nameField.height),this.gameController.createTextField("txtEmail_signupPanel",e.emailField.x,e.emailField.y,e.emailField.width,e.emailField.height),this.gameController.createTextField("txtPassword_signupPanel",e.passwordField.x,e.passwordField.y,e.passwordField.width,e.passwordField.height,{type:"password"})}this.gameController.panelStack.push(this),this.connectLayer.visible=!0},hide:function(){this.gameController.playSFX("tap"),this.gameController.ui.useTextfields&&(this.gameController.removeTextField("txtUserName_signupPanel"),this.gameController.removeTextField("txtEmail_signupPanel"),this.gameController.removeTextField("txtPassword_signupPanel")),this.gameController.panelStack.pop(),this.connectLayer.visible=!1},enableInput:function(){this.backButton.inputEnabled=!0,this.signupButton.inputEnabled=!0,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!0,this.emailButton.inputEnabled=!0,this.passwordButton.inputEnabled=!0)},disableInput:function(){this.backButton.inputEnabled=!1,this.signupButton.inputEnabled=!1,this.gameController.ui.useTextfields||(this.nameButton.inputEnabled=!1,this.emailButton.inputEnabled=!1,this.passwordButton.inputEnabled=!1)},backNavigation:function(){return this.hide(),!1}};

},{}],62:[function(require,module,exports){
function SplashPanel(t){this.gameController=t}module.exports=SplashPanel,SplashPanel.prototype={script:[{time:4e3},{texts:[{text1:"The evil serpent Kramora",text2:"has risen from the underworld",time:6e3}],time:6e3},{texts:[{text1:"under its dark fire, all armies and",text2:"cities of men have been destroyed.",time:6e3}],time:6e3},{texts:[{text1:"Our last hope is a nearly ",text2:"forgotten legend...",time:4e3},{text1:"a magic ring, hidden in",text2:"the depths of earth",time:4e3}],time:8e3},{texts:[{text1:"containing the power of the",text2:"ancient king, Ananias.",time:4500}],time:4500,noFadeout:!0},{texts:[{text1:"You have journeyed long in your quest",text2:"for the lost artifact...",time:6e3},{text1:"but... will you survive the perils ahead?",text2:"",time:14e3}],time:16100}],init:function(){var t=this.gameController,e=this.gameController.ui.splash;this.splashLayer=t.phaser.add.group(),this.splashLayer.visible=!0,t.phaser.add.image(0,0,"background",null,this.splashLayer).inputEnabled=!0,this.layers=[];for(var s=0;s<this.script.length;s++)this.layers.push(t.phaser.add.group(this.splashLayer));this._createIntroImage("splashImage",this.layers[0]),this.snakeImage=this._createIntroImage("intro-serpent",this.layers[1]),this._createIntroImage("intro-1",this.layers[2]);var i=this.gameController.phaser.add.image(e.x+245,e.y+69,"fire",null,this.layers[2]);i.animations.add("roar",[0,1,2]),i.animations.play("roar",8,!0,!1),this._createIntroImage("background",this.layers[3]),this.ringSprite=this.gameController.phaser.add.image(e.x+145,e.y,"items-misc",48,this.layers[3]),this._createIntroImage("intro-2",this.layers[4]),this.mapImage=this._createIntroImage("intro-map",this.layers[5]),this.currentImage=-1;for(s=0;s<this.script.length;s++)if(this.layers[s].visible=!1,this.script[s].texts)for(var a=0;a<this.script[s].texts.length;a++)this.script[s].texts[a].label=this.gameController.addText(e.x,e.y+156,this.script[s].texts[a].text1,t.fontSpec,this.layers[s]),this.script[s].texts[a].label.visible=!1,this.script[s].texts[a].label2=this.gameController.addText(e.x,e.y+172,this.script[s].texts[a].text2,t.fontSpec,this.layers[s]),this.script[s].texts[a].label2.visible=!1,this.gameController.centerText(this.script[s].texts[a].label,e.x,320),this.gameController.centerText(this.script[s].texts[a].label2,e.x,320)},_createIntroImage:function(t,e){var s=this.gameController.ui.splash,i=this.gameController.phaser.add.image(s.x,s.y,t,null,e);return i.inputEnabled=!0,i.events.onInputDown.add(this.closeSplash,this),i},show:function(){this.splashLayer.visible=!0,this.visible=!0,this.closing=!1,this.nextImage()},showImage:function(t){var e=this.gameController.ui.splash,s=this.layers[this.currentImage];s.alpha=0,s.visible=!0;var i=this;if(1===this.currentImage){i.gameController.phaser.time.events.add(1500,function(){i.visible&&i.gameController.musicController.playMusic("intro")});var a=new Phaser.Rectangle(0,0,320,150);this.snakeImage.crop(a),(r=this.gameController.tween(a).to({y:e.y+50},7e3,Phaser.Easing.None)).onUpdateCallback(function(){this.snakeImage.exists&&this.snakeImage.updateCrop()},this),r.start()}else if(3===this.currentImage)this.gameController.tween(this.ringSprite).to({y:e.y+116},5500).start();else if(5===this.currentImage){a=new Phaser.Rectangle(0,0,320,150);this.mapImage.crop(a),(r=this.gameController.tween(a).to({x:864,y:705},12e3,Phaser.Easing.Sinusoidal.Out)).onUpdateCallback(function(){this.mapImage.exists&&this.mapImage.updateCrop()},this),r.start()}var r=this.gameController.tween(s).to({alpha:1},1e3);r.onComplete.add(function(){i.currentImage>0&&(i.layers[i.currentImage-1].visible=!1),i.gameController.phaser.time.events.add(t.time-900,function(){i.visible&&i.nextImage()})},this),this.gameController.startTween(s,r),t.texts&&(this.currentText=-1,this.showNextText(t))},showNextText:function(t){this.currentText>=0&&(t.texts[this.currentText].label.visible=!1,t.texts[this.currentText].label2.visible=!1),this.currentText++,this.currentText>=t.texts.length||(t.texts[this.currentText].label.visible=!0,t.texts[this.currentText].label2.visible=!0,this.gameController.phaser.time.events.add(t.texts[this.currentText].time,function(){this.showNextText(t)},this))},nextImage:function(){this.currentImage++,this.currentImage===this.script.length?(this.currentImage--,this.closeSplash()):this.transitionTo(this.script[this.currentImage])},transitionTo:function(t){if(0==this.currentImage||t.noFadeout)this.showImage(t);else{var e=this.layers[this.currentImage-1],s=this.gameController.tween(e).to({alpha:0},1e3);s.onComplete.add(function(){this.showImage(t)},this),this.gameController.startTween(e,s)}},closeSplash:function(){if(!this.closing){this.closing=!0,this.visible=!1;var t=this.layers[this.currentImage],e=this.gameController.tween(t).to({alpha:0},1e3);e.onComplete.add(function(){this.splashLayer.destroy(!0),this.gameController.titlePanel.show()},this),this.gameController.startTween(t,e)}}};

},{}],63:[function(require,module,exports){
function StatuesPanel(t){this.gameController=t}module.exports=StatuesPanel;var StatuesPanel,GraveyardPanel=require("./GraveyardPanel.class");(StatuesPanel=require("./StatuesPanel.class")).statueInfo=[{}],StatuesPanel.prototype={init:function(){var t=this.gameController,a=t.ui.statues;this.statuesLayer=t.phaser.add.group(),this.statuesLayer.visible=!1,t.phaser.add.image(0,0,"background",null,this.statuesLayer).inputEnabled=!0,a.title.hidden||t.addText(a.title.x,a.title.y,"Statues Collection",this.gameController.fontSpec,this.statuesLayer);var e=!1;e=a.back.small?this.gameController.createButton(a.back,0,130,"Back",this.statuesLayer):this.gameController.createHButton(a.back,"< Back",this.statuesLayer),this.backButton=e.button,this.backButton.events.onInputDown.add(this.hide,this),this.statueInfo={},this.addStatue(1,96,2,"Monk","",1),this.addStatue(2,97,3,"Tymall","",1),this.addStatue(3,98,4,"Sage","",1),this.addStatue(4,99,5,"Ruma","",1),this.addStatue(5,100,6,"Emperor","",1),this.addStatue(6,101,8,"Servant","",1),this.addStatue(7,102,9,"Ninja","",2),this.addStatue(8,103,11,"Dancer","",2),this.addStatue(9,104,33,"Green Slime","",2),this.addStatue(10,105,34,"Blue Slime","",2),this.addStatue(11,106,25,"Kobold","",2),this.addStatue(12,107,26,"Orc","",2),this.addStatue(13,108,27,"Fels","",3),this.addStatue(14,109,28,"Goblin","",3),this.addStatue(15,110,29,"Lizardman","",3),this.addStatue(16,111,0,"Ghost Knight","",3),this.addStatue(17,112,15,"Ghost","",3),this.addStatue(18,113,17,"Flaming Knight","",3),this.addStatue(19,114,20,"Borgo","",3),this.addStatue(20,115,40,"Woods Fairy","",4),this.addStatue(21,116,21,"Succubus","",4),this.addStatue(22,117,22,"Pumpkin","",4),this.addStatue(23,118,23,"Vampiress","",4),this.addStatue(24,119,24,"Stagma","",4),this.addStatue(25,96,30,"Hellbull","",4),this.addStatue(26,97,31,"Yabros","",4),this.addStatue(27,98,32,"Okuro","",5),this.addStatue(28,99,36,"Kraken","",5),this.addStatue(29,100,45,"Yomo","",5),this.addStatue(30,101,18,"Fire Demon","",5),this.addStatue(31,102,19,"Ice Demon","",5),this.addStatue(32,103,37,"Water Demon","",5),this.addStatue(33,104,38,"Air Demon","",5),this.addStatue(34,105,35,"Bacteria Demon","",6),this.addStatue(35,106,39,"Myel","",6),this.addStatue(36,107,41,"Keeper","",6),this.addStatue(37,108,42,"Zephko","",6),this.addStatue(38,109,43,"Aylos","",6),this.addStatue(39,110,44,"Pyrion","",6)},addStatue:function(t,a,e,i,s,d){this.statueInfo[t]={spriteIndex:a,bigIndex:e,description:i}},show:function(){var t=this;this.gameController.communityClient.isEnabled()?this.gameController.communityClient.getStatues({ok:function(a){t.showStatues(a.statues)},error:function(){t.gameController.alert("Error obtaining statue collection")}}):alert("You need to login to access your Statues collection")},showStatues:function(t){this.gameController.panelStack.push(this);var a=this.gameController.ui.statues,e=a.grid.x,i=a.grid.y,s=0,d=0;this.gridGroup&&this.gridGroup.destroy(!0);for(var r=[],u=0;u<=t.length;u++)r[t[u]]=!0;this.gridGroup=this.gameController.phaser.add.group(this.statuesLayer);var o=a.grid.cellWidth,n=a.grid.cellHeight,h=0;for(u=1;u<=39;u++){if(r[u]){var l=this.statueInfo[u];this.gameController.phaser.add.image(e+s*o+h,i+d*n,"cards64",l.bigIndex,this.gridGroup)}++s%a.grid.width==0&&(s=0,d++,a.slanted&&(h-=8))}this.statuesLayer.visible=!0},hide:function(){this.gameController.playSFX("tap"),this.gameController.panelStack.pop(),this.statuesLayer.visible=!1},backNavigation:function(){return this.hide(),!1}};

},{"./GraveyardPanel.class":54,"./StatuesPanel.class":63}],64:[function(require,module,exports){
function TitlePanel(t){this.gameController=t}module.exports=TitlePanel;var GraveyardPanel=require("./GraveyardPanel.class"),StatuesPanel=require("./StatuesPanel.class"),ConnectPanel=require("./ConnectPanel.class"),SignupPanel=require("./SignupPanel.class"),AddFriendPanel=require("./AddFriendPanel.class"),PlayerProfilePanel=require("./PlayerProfilePanel.class"),Loc=require("../loc/Loc");TitlePanel.prototype={init:function(){var t=this.gameController,e=t.ui.title,n=this.gameController.fontSpec;if(this.hardcoreMode=!1,this.titleLayer=t.phaser.add.group(),this.titleLayer.visible=!1,this.graveYardPanel=new GraveyardPanel(t),this.graveYardPanel.init(),this.statuesPanel=new StatuesPanel(t),this.statuesPanel.init(),this.connectPanel=new ConnectPanel(t),this.connectPanel.init(this),this.signupPanel=new SignupPanel(t),this.signupPanel.init(this),this.addFriendPanel=new AddFriendPanel(t),this.addFriendPanel.init(this),this.profilePanel=new PlayerProfilePanel(t),this.profilePanel.init(this),this.currentScreen=0,t.phaser.add.image(e.backgroundOffsetX?e.backgroundOffsetX:0,e.backgroundOffsetY?e.backgroundOffsetY:0,e.background,null,this.titleLayer).inputEnabled=!0,e.logo&&t.phaser.add.image(e.logo.x,e.logo.y,e.logo.big?"logo-big":"logo",null,this.titleLayer),t.isGold&&!e.modal&&e.logo&&(e.logo.big?t.addText(e.logo.x+185,e.logo.y+75,"Fellowship Edition",n,this.titleLayer):t.addText(e.logo.x+84,e.logo.y+76,"Fellowship Edition",n,this.titleLayer)),e.characters)t.phaser.add.image(e.characters.x,e.characters.y,"title-characters",null,this.titleLayer);e.credits&&t.addText(e.credits.x,e.credits.y,"v"+t.version+" Copyright 2014-2023 Slashware S.A.S."+(t.isDesktop?" ":"\n")+"Graphics by Denzi",n,this.titleLayer),this.mainLayer=t.phaser.add.group(this.titleLayer),e.backgroundDialog&&(this.menuDialog=t.phaser.add.image(e.backgroundDialog.x,e.backgroundDialog.y,"dialog-v",null,this.titleLayer),this.menuDialog.visible=!1,this.menuDialogH=t.phaser.add.image(e.backgroundDialogH.x,e.backgroundDialogH.y,"dialog",null,this.titleLayer),this.menuDialogH.visible=!1);var i=this.gameController.createHButton(e.newGame,"New Game",this.mainLayer);this.newGameButton=i.button,this.newGameButtonText=i.label,this.newGameButton.events.onInputDown.add(this.newGameEvent,this),e.exitGame&&t.runningOnNWJS()&&(i=this.gameController.createButton(e.exitGame,0,128,"",this.mainLayer),this.exitGameButton=i.button,this.exitGameButton.events.onInputDown.add(this.exitGameEvent,this)),i=this.gameController.createHButton(e.difficulty,"Normal Mode",this.mainLayer,{createGroup:!0}),this.difficultyButtonText=i.label,i.button.events.onInputDown.add(this.toogleDifficulty,this),this.difficultyButtonGroup=i.createdGroup,i=e.settings.small?this.gameController.createButton(e.settings,0,138,"",this.mainLayer):this.gameController.createHButton(e.settings,"Settings",this.mainLayer),this.toogleSettingsText=i.label,i.button.events.onInputDown.add(this.toogleSettings,this);var o=this.titleLayer;i=this.gameController.createHButton(e.fellowship,"Online",this.mainLayer),this.fellowshipButton=i.button,this.fellowshipButtonText=i.label,this.fellowshipButton.events.onInputDown.add(this.showFellowshipOptions,this),this.fellowshipLayer=t.phaser.add.group(this.titleLayer),this.fellowshipLayer.visible=!1,this.menuLayers=[t.phaser.add.group(this.titleLayer),t.phaser.add.group(this.titleLayer)],this.menuLayers[0].visible=!1,this.menuLayers[1].visible=!1,o=this.menuLayers[0],i=e.back.small?this.gameController.createHButton(e.back,"< Back",this.fellowshipLayer,{size:128}):this.gameController.createHButton(e.back,"< Back",this.fellowshipLayer),this.backButton=i.button,this.backButtonText=i.label,this.backButton.events.onInputDown.add(this.backNavigation,this),i=this.gameController.createHButton(e.connect,"Connect",o),this.connectButton=i.button,this.connectButtonText=i.label,this.connectButton.events.onInputDown.add(this.connectEvent,this),i=this.gameController.createHButton(e.signup,"Sign Up",o),this.signupButton=i.button,this.signupButton.events.onInputDown.add(this.signupEvent,this),i=this.gameController.createHButton(e.addFriend,"Add Friend",o),this.addFriendButton=i.button,this.addFriendButtonText=i.label,this.addFriendButton.events.onInputDown.add(this.addFriendEvent,this),i=this.gameController.createHButton(e.graveyard,"Graveyard",o),this.topScoresButton=i.button,this.topScoresText=i.label,this.topScoresButton.events.onInputDown.add(this.graveyardEvent,this),i=this.gameController.createHButton(e.statues,"Statues Collection",o),this.statuesButton=i.button,this.statuesText=i.label,this.statuesButton.events.onInputDown.add(this.statuesEvent,this),this.settingsGroup=t.phaser.add.group(this.titleLayer),this.settingsGroup.visible=!1;var s=e.settingsMenu;this.audioLoaded=this.gameController.preferences.soundEnabled;var a=this.audioLoaded?"Enabled":"Disabled";if(i=this.gameController.createHButton(s.sound,a,this.settingsGroup),this.soundButton=i.button,this.soundButtonText=i.label,this.soundButton.events.onInputDown.add(this.toogleSound,this),t.addText(s.soundLabel.x,s.soundLabel.y,"Sound",n,this.settingsGroup),i=this.gameController.createHButton(s.weaponDeg,this.gameController.preferences.weaponDegEnabled?"Enabled":"Disabled",this.settingsGroup),t.addText(s.weaponDegLabel.x,s.weaponDegLabel.y,"Weapon Deg",n,this.settingsGroup),this.weaponDegButton=i.button,this.weaponDegText=i.label,this.weaponDegButton.events.onInputDown.add(this.toogleWeaponDeg,this),s.display){i=this.gameController.createHButton(s.display,t.isFullScreen()?"Windowed":"Fullscreen",this.settingsGroup),t.addText(s.displayLabel.x,s.displayLabel.y,"Display",n,this.settingsGroup),this.displayText=i.label,i.button.events.onInputDown.add(this.toogleDisplay,this);var l=document.getElementsByTagName("body")[0];l.addEventListener("webkitfullscreenchange",this.updateDisplayLabel.bind(this)),l.addEventListener("mozfullscreenchange",this.updateDisplayLabel.bind(this)),l.addEventListener("fullscreenchange",this.updateDisplayLabel.bind(this))}(i=s.back.small?this.gameController.createButton(s.back,0,128,"",this.settingsGroup):this.gameController.createHButton(s.back,"< Back",this.settingsGroup)).button.events.onInputDown.add(this.toogleSettings,this);var r=e.hidePlayerStatsOnSubMenus?this.mainLayer:this.titleLayer;if(this.playerLabels={name:t.addText(e.currentPlayerInfo.name.x,e.currentPlayerInfo.name.y,"",n,r),games:t.addText(e.currentPlayerInfo.games.x,e.currentPlayerInfo.games.y,"",n,r),victories:t.addText(e.currentPlayerInfo.victories.x,e.currentPlayerInfo.victories.y,"",n,r),friends:t.addText(e.currentPlayerInfo.friends.x,e.currentPlayerInfo.friends.y,"",n,r),lukas:t.addText(e.currentPlayerInfo.lukas.x,e.currentPlayerInfo.lukas.y,"",n,r)},e.modal){var u=t.phaser.add.image(e.backgroundOffsetX?e.backgroundOffsetX:0,e.backgroundOffsetY?e.backgroundOffsetY:0,e.modal,null,this.titleLayer);if(e.version)var h=t.addText(e.version.x,e.version.y,"v"+t.version,n,this.titleLayer);u.inputEnabled=!0,u.events.onInputDown.add(function(){this.destroy(),h&&h.destroy()},u)}else if(e.version)h=t.addText(e.version.x,e.version.y,"v"+t.version,n,this.titleLayer)},showFellowshipOptions:function(){this.menuDialog&&(this.menuDialog.visible=!0),this.gameController.playSFX("tap"),this.mainLayer.visible=!1,this.fellowshipLayer.visible=!0;var t=this.gameController.ui.title;this.gameController.communityClient.token?this.connectButtonText.text="Disconnect":this.connectButtonText.text="Connect",this.gameController.centerButtonLabel(this.connectButtonText,t.connect.x),this.loadCurrentMenu()},hideFellowshipOptions:function(){this.gameController.playSFX("tap"),this.mainLayer.visible=!0,this.fellowshipLayer.visible=!1,this.hideAllMenus()},newGameEvent:function(){this.loadingSounds||this.gameController.restartGame(this.hardcoreMode)},exitGameEvent:function(){this.loadingSounds||(this.gameController.playSFX("tap"),this.gameController.exitGameFromTitle())},graveyardEvent:function(){this.loadingSounds||(this.gameController.communityClient.token?(this.gameController.playSFX("tap"),this.graveYardPanel.show(this.hardcoreMode)):this.gameController.alert("You must connect before checking the graveyard","Connect first!"))},connectEvent:function(){this.loadingSounds||(this.gameController.playSFX("tap"),this.gameController.communityClient.token?this.disconnect():this.connectPanel.show())},signupEvent:function(){this.loadingSounds||(this.gameController.playSFX("tap"),this.signupPanel.show())},addFriendEvent:function(){this.loadingSounds||(this.gameController.communityClient.token?(this.gameController.playSFX("tap"),this.addFriendPanel.show()):this.gameController.alert("You must connect before adding friends to your network","Connect first!"))},profileEvent:function(){this.loadingSounds||(this.gameController.communityClient.token?(this.gameController.playSFX("tap"),this.profilePanel.show()):this.gameController.alert("You must connect before checking your profile","Connect first!"))},statuesEvent:function(){this.loadingSounds||(this.gameController.playSFX("tap"),this.statuesPanel.show())},show:function(){this.menuDialog&&(this.menuDialog.visible=!1),this.gameController.panelStack.push(this),this.gameController.gameOn=!1,this.gameController.gameActive=!1,this.gameController.persistanceManager.existsGame()?(this.newGameButtonText.text="Continue Game",this.difficultyButtonGroup.visible=!1):(this.newGameButtonText.text=Loc.loc("startNewGame"),this.difficultyButtonGroup.visible=!0),this.gameController.centerButtonLabel(this.newGameButtonText,this.gameController.ui.title.newGame.x),this.titleLayer.visible=!0,this.gameController.musicController.playMusic("title");var t=this;if(this.gameController.communityClient.getStatus({ok:function(e){!t.checkedVersion&&e.incrementalVersion>t.gameController.incrementalVersion&&(t.gameController.alert("You are running an outdated version of the game. Please update it.","Update your game!"),t.checkedVersion=!0)},error:function(){}}),!t.gameController.communityClient.token){var e=this.gameController.persistanceManager.getLoginInfo();e?this.gameController.communityClient.tryAutoLogin(e,{ok:function(e){t.setPlayerInfo(e)},error:function(){t.gameController.communityClient.token=!1,t.setPlayerInfo(null)}}):this.setPlayerInfo(null)}},hide:function(){this.gameController.panelStack.pop(),this.titleLayer.visible=!1},toogleDifficulty:function(){this.gameController.playSFX("tap");var t=this.gameController.ui.title;this.hardcoreMode=!this.hardcoreMode,this.hardcoreMode?this.difficultyButtonText.text="Hardcore Mode":this.difficultyButtonText.text="Normal Mode",this.gameController.centerButtonLabel(this.difficultyButtonText,t.difficulty.x)},toogleDisplay:function(){var t=this.gameController.preferences;this.gameController.isFullScreen()?(t.fullscreen=!1,this.gameController.stopFullScreen()):(t.fullscreen=!0,this.gameController.fullScreen()),this.gameController.savePreferences()},updateDisplayLabel:function(){this.displayText.text=this.gameController.isFullScreen()?"Windowed":"Fullscreen"},toogleWeaponDeg:function(){var t=this.gameController.preferences;t.weaponDegEnabled=!t.weaponDegEnabled;var e=this.gameController.ui.title.settingsMenu;this.weaponDegText.text=t.weaponDegEnabled?"Enabled":"Disabled",this.gameController.centerButtonLabel(this.weaponDegText,e.weaponDeg.x),this.gameController.savePreferences()},toogleSound:function(){var t=this.gameController.preferences;t.soundEnabled=!t.soundEnabled,t.soundEnabled&&!this.audioLoaded?this.loadSounds():this._toogleSound()},_toogleSound:function(){var t=this.gameController.ui.title.settingsMenu,e=this.gameController.preferences,n=e.soundEnabled?"Enabled":"Disabled";this.soundButtonText.text=n,this.gameController.centerButtonLabel(this.soundButtonText,t.sound.x),this.gameController.savePreferences(),e.soundEnabled?(this.gameController.musicController.musicEnabled=e.musicEnabled,this.gameController.sfxController.enabled=e.sfxEnabled,this.gameController.soundsDisabled=!1,e.musicEnabled&&this.gameController.musicController.playMusic("title")):(this.gameController.musicController.stopMusic(),this.gameController.musicController.musicEnabled=!1,this.gameController.sfxController.enabled=!1,this.gameController.soundsDisabled=!0)},loadSounds:function(){var t=this.gameController.ui.title.settingsMenu,e=this.gameController.phaser;this.soundButtonText.text="Loading Sounds...",this.gameController.centerButtonLabel(this.soundButtonText,t.sound.x),this.loadingSounds=!0,e.load.reset(!0,!1),e.load.audio("sfx-beep","sfx/beep.wav"),e.load.audio("sfx-hit","sfx/hit.wav"),e.load.audio("sfx-potion","sfx/potion.wav"),e.load.audio("sfx-punch","sfx/punch.wav"),e.load.audio("sfx-shoot","sfx/shoot.wav"),e.load.audio("sfx-slash-1","sfx/slash-1.wav"),e.load.audio("sfx-slash-2","sfx/slash-2.wav"),e.load.audio("sfx-slash-3","sfx/slash-3.wav"),e.load.audio("sfx-spell","sfx/spellEnergy.wav"),e.load.audio("sfx-tap","sfx/tap.wav"),e.load.audio("sfx-step","sfx/step.wav"),e.load.audio("sfx-death","sfx/death.wav"),e.load.audio("sfx-break","sfx/break.wav"),e.load.audio("sfx-explosion","sfx/explosion.wav"),e.load.audio("sfx-magic","sfx/spell.wav");var n=this;e.load.onLoadComplete.add(function(){n._decodeSoundsProgress(),n.gameController.sfxController.init(),n.gameController.musicController.init(),e.load.onLoadComplete.removeAll("titlePanel")},"titlePanel"),this._loadSoundsProgress(),e.load.start(),this.audioLoaded=!0},_loadSoundsProgress:function(){var t=this.gameController.phaser,e=this.gameController.ui.title.settingsMenu;if(this.soundButtonText.text="Loading ("+t.load.progress+"%)",this.gameController.centerButtonLabel(this.soundButtonText,e.sound.x),t.load.isLoading){var n=this;setTimeout(function(){n._loadSoundsProgress()},500)}},_decodeSoundsProgress:function(){this.gameController.phaser;var t=this.gameController.ui.title.settingsMenu;this.gameController.centerButtonLabel(this.soundButtonText,t.sound.x),this.loadingSounds=!1,this._toogleSound()},setPlayerInfo:function(t){var e=!0;null==t?(this.playerLabels.name.text="",this.playerLabels.games.text="",this.playerLabels.victories.text="",this.playerLabels.friends.text="",this.playerLabels.lukas.text="",this.connectButtonText.text="Connect",e=!1):(this.playerLabels.name.text=t.name+" ("+t.pin+")",this.playerLabels.games.text=t.games+" Games",this.playerLabels.victories.text=t.victories+" Victories",void 0===t.lukas&&(t.lukas=0),this.playerLabels.lukas.text=t.lukas+" Lukas",void 0===t.friends&&(t.friends=0),this.playerLabels.friends.text=t.friends+" Friends",this.connectButtonText.text="Disconnect",e=!0),this.currentPlayerInfo=t,this.addFriendButton.visible=e,this.addFriendButtonText.visible=e,this.topScoresButton.visible=e,this.topScoresText.visible=e,this.statuesButton.visible=e,this.statuesText.visible=e,this.gameController.centerButtonLabel(this.connectButtonText,this.gameController.ui.title.connect.x)},increaseFriendsCount:function(){this.currentPlayerInfo.friends?this.currentPlayerInfo.friends++:this.currentPlayerInfo.friends=1,this.setPlayerInfo(this.currentPlayerInfo)},backNavigation:function(){return!!this.mainLayer.visible||(0==this.currentScreen?(this.menuDialog&&(this.menuDialog.visible=!1),this.hideFellowshipOptions(),!1):(this.currentScreen--,this.loadCurrentMenu(),!1))},hideAllMenus:function(){this.menuLayers[0].visible=!1,this.menuLayers[1].visible=!1},loadCurrentMenu:function(){this.hideAllMenus(),this.menuLayers[this.currentScreen].visible=!0},disconnect:function(){var t=this;this.gameController.communityClient.logout({ok:function(e){t.gameController.persistanceManager.clearLoginInfo(),t.setPlayerInfo(null),t.connectButtonText.text="Connect";var n=t.gameController.ui.title;t.gameController.centerButtonLabel(t.connectButtonText,n.connect.x)},error:function(){}})},toogleSettings:function(){this.menuDialogH&&(this.menuDialogH.visible=!this.settingsGroup.visible),this.gameController.playSFX("tap"),this.settingsGroup.visible=!this.settingsGroup.visible,this.mainLayer.visible=!this.settingsGroup.visible,this.toogleSettingsText.text=this.settingsGroup.visible?"Ok":"Settings",this.gameController.centerButtonLabel(this.toogleSettingsText,this.gameController.ui.title.settings.x)}};

},{"../loc/Loc":38,"./AddFriendPanel.class":48,"./ConnectPanel.class":51,"./GraveyardPanel.class":54,"./PlayerProfilePanel.class":58,"./SignupPanel.class":61,"./StatuesPanel.class":63}],65:[function(require,module,exports){
var Layouts=require("../ui/Layouts");function Dialog(t){this.gameController=t}Dialog.prototype={init:function(){var t=this.gameController,o=t.ui.dialog;o.titleText={x:o.x+32,y:o.y+16,width:o.width-64},o.promptText={x:o.x+32,y:o.y+32+8,width:o.width-64};var i=o.x+(o.width-192)/2;o.buttons=[{x:i,y:o.y+o.buttonGap+32+144},{x:i,y:o.y+o.buttonGap+32+96},{x:i,y:o.y+o.buttonGap+32+48},{x:i,y:o.y+o.buttonGap+32}],o.closeButton={x:o.x+o.width-32,y:o.y},this.dialogLayer=t.phaser.add.group(),this.dialogLayer.visible=!1,t.phaser.add.image(0,0,"dialogMask",0,this.dialogLayer).inputEnabled=!0,t.phaser.add.image(o.x,o.y,"dialog",0,this.dialogLayer),this.titleText=t.addText(o.titleText.x,o.titleText.y,"",{font:t.font,fill:t.titleColor},this.dialogLayer),this.promptText=t.addText(o.promptText.x,o.promptText.y,"",{font:t.font,fill:t.fontColor,wordWrap:!0,align:"center",wordWrapWidth:o.promptText.width},this.dialogLayer),this.promptText.longY=o.promptText.y-8,this.promptText.shortY=o.promptText.y,this.promptText.lineSpacing=-8,this.buttons=[];for(var e=0;e<4;e++)this.buttons[e]=t._createHButton(o.buttons[e],"",this.dialogLayer,!0,{createGroup:!0}),this.buttons[e].createdGroup.visible=!1,function(t,o,i){t.events.onInputDown.add(function(){i.doButtonAction(o)},i)}(this.buttons[e].button,e,this);var n=t.createButton(o.closeButton,2,128,"Close",this.dialogLayer,!1,!0,{buttonSpecs:Layouts.COMMON.BUTTON.SMALL,createGroup:!0});this.closeButtonGroup=n.createdGroup,this.closeButtonGroup.visible=!1,n.button.events.onInputDown.add(this.hide,this)},show:function(t,o,i,e){var n=this.gameController,s=n.ui.dialog;this.gameController.inputDisabled=!0,this.titleText.text=t,n.centerText(this.titleText,s.titleText.x,s.titleText.width),this.promptText.text=o,n.centerText(this.promptText,s.promptText.x,s.promptText.width);var r=this.promptText.precalculateWordWrap(this.promptText.text).length;this.promptText.y=r>1?this.promptText.longY:this.promptText.shortY,n.ptf.hideAll(),this._layoutButtons(i),this.dialogLayer.visible=!0,this.closeButtonGroup.visible=!!e,this.type="custom"},_layoutButtons:function(t){var o=this.gameController,i=o.ui.dialog,e=t.length+1,n=i.titleText.y-i.y;t.length>=3&&i.height<=192?n=0:""!==this.promptText.text.trim()&&(n=i.promptText.y-i.y+16);for(var s=i.height-32-48*t.length-n,r=Math.round(s/e),a=0;a<4;a++)t[a]?(this.buttons[a].label.text=t[a].text,o.centerText(this.buttons[a].label,i.buttons[a].x,192),this.buttons[a].action=t[a].action,this.buttons[a].createdGroup.visible=!0,this.buttons[a].button.y=i.y+16+n+r+a*(r+48),this.buttons[a].label.y=this.buttons[a].button.y+15):(this.buttons[a].createdGroup.visible=!1,this.buttons[a].action=!1);!this.buttons[1].action&&i.height<=192&&(this.buttons[0].button.y=i.y+i.height-i.buttonGap-72,this.buttons[0].label.y=this.buttons[0].button.y+15)},hide:function(){this.dialogLayer.visible=!1,this.gameController.player&&(!this.gameController.player.dead||this.gameController.player.won&&this.gameController.showingInventory)&&(this.gameController.inputDisabled=!1,this.gameController.logEvent("Input enabled Dialog.hide")),this.gameController.ptf.showAll()},doButtonAction:function(t){this.buttons[t].action&&this.buttons[t].action()},prompt:function(t,o,i,e){var n=this;this.show(t,o,[{text:"Ok",action:function(){i(),n.hide()}},{text:"Cancel",action:function(){e&&e(),n.hide()}}]),this.type="prompt"},alert:function(t,o,i){var e=this;this.show(t,o,[{text:"Ok",action:function(){e.hide(),i&&i()}}]),this.type="alert"}},module.exports=Dialog;

},{"../ui/Layouts":67}],66:[function(require,module,exports){
function FishAddornment(i){this.gameController=i;var t=this.gameController.player.currentRoom.getSwimmable();if(t){this.x=t.x,this.y=t.y,this.depth=rand(0,8),this.fishSprite=i.getImage(32*this.x+rand(0,16),32*this.y+8+this.depth,"tileset16",16,i.mapGroup),this.fishSprite.visible=!1,this.fishSprite.animations.add("swimLeft",[16,17,18,17]),this.fishSprite.animations.add("swimRight",[19,20,21,20]),this.fishSprite.animations.add("swimUp",[22,23,24,23]),this.fishSprite.animations.add("swimDown",[25,26,27,26]);var s=!1;switch(rand(0,3)){case 0:s="swimLeft";break;case 1:s="swimRight";break;case 2:s="swimUp";break;case 3:s="swimDown"}this.fishSprite.animations.play(s,4,!0),this._act()}else this.dead=!0}FishAddornment.prototype={activate:function(){!this.dead&&this.fishSprite&&(this.fishSprite.visible=!0,this._act())},think:function(){this.gameController.schedule(this._act,rand(600,2e3),this)},_act:function(){if(!this.dead){var i=rand(0,4),t=0,s=0,e=!1;switch(i){case 0:t=-1,e="swimLeft";break;case 1:t=1,e="swimRight";break;case 2:s=-1,e="swimUp";break;case 3:s=1,e="swimDown";break;default:i=!1}if(0!=i){var a=this.gameController.player.currentRoom;if(!a)return;for(var h=rand(1,4),r=1;r<=h;r++)if(!a.isSwimmable(this.x+t*r,this.y+s*r)){r--;break}if(r>h&&(r=h),r>0){chance(30)&&(this.depth=rand(0,4)),this.fishSprite.animations.play(e,4,!0);var n=this.x+t*r,o=this.y+s*r,d=this.gameController.tween(this.fishSprite,!0).to({x:32*n+rand(0,16),y:32*o+8+this.depth},500*r,Phaser.Easing.Linear.None);return d.onComplete.add(function(){this.x=n,this.y=o,this.think()},this),void d.start()}}this.think()}},kill:function(){this.dead=!0}},module.exports=FishAddornment;

},{}],67:[function(require,module,exports){
module.exports={DESKTOP:{levelGen:{roomBounds:{height:10,width:12},baseRooms:10},oldVersionMessage:"This game was started on an older version, scores won't be saved and it may not work properly. Continue at your own risk!",useTextfields:!0,hiRes:!0,settingsOnlyOnInventory:!1,dialog:{x:144,y:32,width:352,height:256,buttonGap:32},playerInfo:{x:144,y:32,width:352,height:256,big:!0,pageSize:11},characterCreation:{useTextfields:!0,smallButtons:!0,portrait:{x:246,y:24},selectedClass:{x:168,y:104,width:200},selectedSkinTone:{x:200,y:132,width:136},selectedHairColor:{x:200,y:164,width:136},selectedHairType:{x:200,y:196,width:136},selectedBeardType:{x:200,y:228,width:136},nameLabel:{x:64,y:80},skinToneLabel:{x:64,y:132},hairColorLabel:{x:64,y:164},hairTypeLabel:{x:64,y:196},beardTypeLabel:{x:64,y:228},skills:{x:240,y:24,width:160},bonusPoints:{x:384,y:24,width:192},combat:{x:416,y:64,width:128},magic:{x:416,y:96,width:128},carry:{x:416,y:128,width:128},hp:{x:416,y:160,width:128},mp:{x:416,y:192,width:128},evade:{x:416,y:224,width:128},prevSkinTone:{x:168,y:128},nextSkinTone:{x:336,y:128},prevHairColor:{x:168,y:160},nextHairColor:{x:336,y:160},prevHairType:{x:168,y:192},nextHairType:{x:336,y:192},prevBeardType:{x:168,y:224},nextBeardType:{x:336,y:224},decreaseCombat:{x:384,y:64},increaseCombat:{x:544,y:64},decreaseMagic:{x:384,y:96},increaseMagic:{x:544,y:96},decreaseCarry:{x:384,y:128},increaseCarry:{x:544,y:128},decreaseHP:{x:384,y:160},increaseHP:{x:544,y:160},decreaseMP:{x:384,y:192},increaseMP:{x:544,y:192},decreaseEvade:{x:384,y:224},increaseEvade:{x:544,y:224},next:{x:384,y:276},back:{x:64,y:276},nameButton:!1,popupNameLabel:!1,nameField:{x:200,y:80,width:136,height:16}},buttonSpecs:{small:!0,tileset:"tileset32",indexes:[132,132,132,132,132,132,132,132],icon:{x:0,y:0},text:{x:34,y:8}},splash:{x:160,y:60},title:{background:"title",logo:{x:64,y:8,big:!0},characters:{x:64,y:8},credits:{x:120,y:336},backgroundDialog:{x:352,y:0},backgroundDialogH:{x:144,y:32},newGame:{x:16,y:272},fellowship:{x:224,y:272},difficulty:{x:432,y:272},settings:{x:600,y:48,small:!0},exitGame:{x:600,y:8},settingsMenu:{soundLabel:{x:176,y:78},sound:{x:276,y:68},weaponDegLabel:{x:176,y:130},weaponDeg:{x:276,y:120},displayLabel:{x:176,y:182},display:{x:276,y:172},back:{x:464,y:32,small:!0}},addFriend:{x:384,y:68},graveyard:{x:384,y:120},signup:{x:384,y:172},statues:{x:384,y:172},connect:{x:384,y:224},back:{x:384,y:276},next:{x:560,y:240},profile:{x:368,y:48},currentPlayerInfo:{name:{x:16,y:176},friends:{x:16,y:192},games:{x:16,y:208},victories:{x:16,y:224},lukas:{x:16,y:240}},welcomeGold:{x:160,y:20,width:320},decodeMonitor:{x:32,y:304}},promo:{text:{x:128,y:128,width:256},get:{x:128,y:208},soon:{x:128,y:280},image:{x:192,y:16}},help:{dialogText:{x:172,y:96,width:200},characterImage:{x:96,y:96},helpImage:{x:412,y:64},next:{x:384,y:224},skip:{x:384,y:276}},mainPanel:{mapOverlay:"uiOverlay-desktop",socialMessage:{x:112,y:276,width:288},lifeBar:{x:24,y:16,width:64},magicBar:{x:24,y:32,width:64},petLifeBar:{x:24,y:120,width:64},spellsRow:{x:64,y:328,space:32,vertical:!1,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105}},useZoomedMovement:!1,portrait:{x:456,y:8}},mapPanel:{x:48,y:20,width:384,height:320},inventoryPanel:{pos:{x:80,y:8},playerIcon:{x:128,y:80},petIcon:{x:128,y:144},grid:{x:194,y:48,space:38,icon:{name:"misc38",index:0},selectedIcon:{name:"misc38",index:1},width:4,padding:2},equipment:{space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},padding:0}},settingsPanel:{insideInventory:!0},selectUpgradePanel:{title:{x:154,y:24},x:122,y:64,spacing:16,upgradeDescriptionText:{x:378,y:176,width:192},upgradeName:{x:378,y:118,width:192,centered:!0},upgradeIdol:{x:442,y:48,card:!0},confirmButton:{x:378,y:256}},hpIcon:{x:8,y:8},mpIcon:{x:8,y:24},weaponIcon:{x:8,y:64},armorIcon:{x:8,y:80},petIcon:{x:8,y:112},skillPointsIcon:{x:8,y:128},inspector:{x:440,y:192,width:192,yOffset:0,titleWrap:!0,titleLines:2,descriptionLines:9},confirmApplyButton:{x:480,y:288},cancelApplyButton:{x:536,y:288},useButton:{x:8,y:160},dropButton:{x:8,y:192},applyButton:{x:8,y:224},switchButton:{x:8,y:192},tacticsButton:{x:8,y:256},petCommandButton:{x:8,y:288},inventoryButton:{x:8,y:320},helpButton:{x:568,y:320,location:"in the bottom right corner"},settingsButton:{x:600,y:320,noTooltip:!0},buttons:{shareCharacter:{x:8,y:256},hideBasicButtonsWhenTargetting:!1},minimap:{x:485,y:80,hideDepth:!0},behaviorButtonsLocation:"next to the ITEMS one.",minimapLocation:"on the top",statsLocation:"on the top left",petStatsLocation:"under your player stats",locationImage:{x:240,y:40},graveyard:{title:{x:0,y:16,width:320},table:{x:64,y:56},personal:{x:384,y:120},friends:{x:384,y:172},global:{x:384,y:224},back:{x:384,y:276},promoText:{x:128,y:64,width:256},promoButton:{x:128,y:128}},connect:{nameLabel:{x:448,y:64},nameField:{x:416,y:84,width:128,height:16},passwordLabel:{x:448,y:114},passwordField:{x:416,y:134,width:128,height:16},nameButton:{x:32,y:48},passwordButton:{x:32,y:112},connect:{x:384,y:172},forgotPassword:{x:384,y:224},back:{x:384,y:276}},signup:{nameLabel:{x:448,y:64},nameField:{x:416,y:84,width:128,height:16},emailLabel:{x:456,y:114},emailField:{x:416,y:134,width:128,height:16},passwordLabel:{x:448,y:164},passwordField:{x:416,y:184,width:128,height:16},nameButton:{x:32,y:48},emailButton:{x:32,y:112},passwordButton:{x:32,y:176},signup:{x:384,y:224},back:{x:384,y:276}},forgotPassword:{emailLabel:{x:448,y:64},emailField:{x:416,y:84,width:128,height:16},emailButton:{x:32,y:48},forgotPassword:{x:384,y:224},back:{x:384,y:276}},addFriend:{nameLabel:{x:448,y:32},nameField:{x:416,y:52,width:128,height:16},nameButton:{x:32,y:48},search:{x:384,y:172},connect:{x:384,y:224},back:{x:384,y:276},selectedPlayer:{name:{x:384,y:90},pin:{x:480,y:90},games:{x:384,y:106},victories:{x:480,y:106},friends:{x:384,y:122}}},profile:{title:{x:432,y:32},back:{x:368,y:240},selectedPlayer:{name:{x:368,y:80},pin:{x:496,y:80},games:{x:368,y:96},victories:{x:496,y:96},friends:{x:368,y:128},friendsList:{x:368,y:144,width:320}}},statues:{slanted:!0,title:{x:248,y:16},back:{x:224,y:276},grid:{x:64,y:48,width:8,cellHeight:36,cellWidth:64}},newGame:{character:{x:448,y:32},pet:{x:462,y:32},selectedClassDescription:{x:64,y:32,width:284},prevClass:{x:384,y:152},nextClass:{x:544,y:152},prevGender:{x:384,y:184},nextGender:{x:544,y:184},prevPet:{x:384,y:216},nextPet:{x:544,y:216},select:{x:384,y:276},back:{x:64,y:276},selectedGender:{x:384,y:192,width:192},selectedClass:{x:384,y:160,width:192},selectedPet:{x:384,y:224,width:192}}},CHIBI:{levelGen:{roomBounds:{height:6,width:9,margin:2,useStickyArrows:!0},baseRooms:16,dontShrink:!0},oldVersionMessage:"This game was started on an older version, scores won't be saved and it may not work properly.",characterCreation:{useTextfields:!1,smallButtons:!0,portrait:{x:38,y:0},doubleScreen:!0,selectedClass:{x:0,y:64,width:128},selectedSkinTone:{x:160,y:8,width:128},selectedHairColor:{x:160,y:40,width:128},selectedHairType:{x:160,y:72,width:128},selectedBeardType:{x:160,y:104,width:128},nameLabel:!1,skinToneLabel:!1,hairColorLabel:!1,hairTypeLabel:!1,beardTypeLabel:!1,bonusPoints:{x:0,y:16,width:320},combat:{x:32,y:48,width:96},magic:{x:32,y:80,width:96},carry:{x:32,y:112,width:96},hp:{x:192,y:48,width:96},mp:{x:192,y:80,width:96},evade:{x:192,y:112,width:96},prevSkinTone:{x:128,y:0},nextSkinTone:{x:288,y:0},prevHairColor:{x:128,y:32},nextHairColor:{x:288,y:32},prevHairType:{x:128,y:64},nextHairType:{x:288,y:64},prevBeardType:{x:128,y:96},nextBeardType:{x:288,y:96},decreaseCombat:{x:0,y:48},increaseCombat:{x:128,y:48},decreaseMagic:{x:0,y:80},increaseMagic:{x:128,y:80},decreaseCarry:{x:0,y:112},increaseCarry:{x:128,y:112},decreaseHP:{x:160,y:48},increaseHP:{x:288,y:48},decreaseMP:{x:160,y:80},increaseMP:{x:288,y:80},decreaseEvade:{x:160,y:112},increaseEvade:{x:288,y:112},next:{x:128,y:144},back:{x:0,y:144,small:!0},nameButton:{x:96,y:0},popupNameLabel:{x:0,y:48,width:128},nameField:!1},useTextfields:!1,hiRes:!0,noTooltips:!0,settingsOnlyOnInventory:!1,buttonSpecs:{small:!0,tileset:"tileset32",indexes:[132,132,132,132,132,132,132,132],icon:{x:0,y:0},text:{x:34,y:8}},splash:{x:0,y:0},title:{background:"menu-chibi",logo:!1,credits:!1,version:{x:16,y:176},modal:"title-chibi",newGame:{x:128,y:0},fellowship:{x:128,y:48},difficulty:{x:128,y:96},settings:{x:128,y:144},settingsMenu:{soundLabel:{x:34,y:10},sound:{x:128,y:0},weaponDegLabel:{x:34,y:74},weaponDeg:{x:128,y:64},back:{x:128,y:144}},hidePlayerStatsOnSubMenus:!0,addFriend:{x:128,y:0},graveyard:{x:128,y:48},signup:{x:128,y:48},connect:{x:128,y:96},statues:{x:128,y:144},back:{x:0,y:144,small:!0},next:{x:560,y:240},profile:{x:368,y:48},currentPlayerInfo:{name:{x:8,y:16},friends:{x:8,y:112},games:{x:8,y:128},victories:{x:8,y:144},lukas:{x:8,y:160}},welcomeGold:{x:160,y:20,width:320},decodeMonitor:{x:32,y:304}},promo:{smallButtons:!0,text:{x:128,y:0,width:192},get:{x:128,y:96},soon:{x:128,y:144},image:{x:0,y:16}},help:{dialogText:{x:128,y:0,width:192},characterImage:{x:32,y:0},next:{x:128,y:96},skip:{x:128,y:144},helpImage:{x:0,y:64}},playerInfo:{x:0,y:0,width:320,height:192,big:!1,pageSize:8},mainPanel:{mapOverlay:!1,socialMessage:{x:36,y:128,width:248},lifeBar:{x:16,y:7,width:96},magicBar:{x:16,y:24,width:64},petLifeBar:{x:304,y:7,reverse:!0,width:96},useZoomedMovement:!1,spellsRow:{x:32,y:160,space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},toogleButton:{x:288,y:128}},portrait:!1},mapPanel:{x:32,y:0,statusAilments:{baseY:160,baseX:{pet:288,player:32}},width:256,height:192},inventoryPanel:{pos:{x:34,y:160},playerIcon:{x:64,y:32},petIcon:{x:64,y:96},background:!1,grid:{x:128,y:0,space:32,padding:0,icon:{name:"tileset32",index:122},selectedIcon:{name:"tileset32",index:121},width:4},equipment:{space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},padding:0},hideMapGUI:!0,itemSummaryText:{x:64,y:166,width:192}},settingsPanel:{save:{x:64,y:0},switchMusic:{x:64,y:48},switchSFX:{x:64,y:96},quit:{x:64,y:144}},selectUpgradePanel:{title:!1,x:0,y:0,upgradeDescriptionText:{x:192,y:88,width:128},upgradeName:{x:192,y:72,width:128,centered:!0},upgradeIdol:{x:224,y:8},confirmButton:{x:288,y:0,small:!0},thin:!0},hpIcon:{x:0,y:0},mpIcon:{x:0,y:16},weaponIcon:{x:0,y:32},armorIcon:{x:0,y:48},petIcon:{x:320,y:0,rightAlign:!0},skillPointsIcon:{x:320,y:16,rightAlign:!0},inspector:{x:36,y:16,width:256,yOffset:0,titleWrap:!0,toogleButton:{x:288,y:64},scrollBackground:!0,titleLines:2,descriptionLines:8},dialog:{x:0,y:0,width:320,height:192,buttonGap:0},confirmApplyButton:{x:0,y:128},cancelApplyButton:{x:0,y:160},selectATargetMessage:{x:32,y:16,width:256},dropButton:{x:0,y:96},applyButton:{x:0,y:128},useButton:{x:0,y:64},switchButton:{x:0,y:96},petCommandButton:{x:0,y:128},tacticsButton:{x:0,y:160},inventoryButton:{x:288,y:160},settingsButton:{x:288,y:96},helpButton:{x:288,y:128,location:"on the right buttons inside the inventory"},buttons:{shareCharacter:{x:8,y:256},hideBasicButtonsWhenTargetting:!0},minimap:{x:176,y:32,micromap:{x:272,y:16},toogleButton:{x:288,y:32}},behaviorButtonsLocation:"next to the ITEMS one.",minimapLocation:"on the top",statsLocation:"on the top left",petStatsLocation:"on the top right",locationImage:{x:80,y:16},graveyard:{bgOffsets:{x:-96,y:0},title:{x:0,y:0,width:224},table:{x:0,y:16,columns:[144,44]},personal:{x:224,y:0},friends:{x:224,y:48},global:{x:224,y:96},back:{x:224,y:144},smallButtons:!0,promoText:{x:128,y:64,width:256},promoButton:{x:128,y:128}},connect:{popupNameLabel:{x:164,y:12},popupPasswordLabel:{x:164,y:60},nameButton:{x:128,y:8},passwordButton:{x:128,y:56},connect:{x:128,y:96},forgotPassword:{x:128,y:144},back:{x:0,y:144,small:!0}},signup:{popupNameLabel:{x:164,y:12},popupPasswordLabel:{x:164,y:60},popupEmailLabel:{x:164,y:108},nameButton:{x:128,y:8},passwordButton:{x:128,y:56},emailButton:{x:128,y:104},signup:{x:128,y:144},back:{x:0,y:144,small:!0}},forgotPassword:{popupEmailLabel:{x:164,y:12},emailButton:{x:128,y:8},forgotPassword:{x:128,y:144},back:{x:0,y:144,small:!0}},addFriend:{popupNameLabel:{x:164,y:12},nameButton:{x:128,y:8},search:{x:128,y:96},connect:{x:128,y:144},back:{x:0,y:144,small:!0},selectedPlayer:{name:{x:16,y:12},pin:{x:16,y:32},games:{x:16,y:52},victories:{x:16,y:72},friends:{x:16,y:92}}},profile:{title:{x:432,y:32},back:{x:368,y:240},selectedPlayer:{name:{x:368,y:80},pin:{x:496,y:80},games:{x:368,y:96},victories:{x:496,y:96},friends:{x:368,y:128},friendsList:{x:368,y:144,width:320}}},statues:{slanted:!0,title:{x:0,y:0,hidden:!0},back:{x:288,y:162,small:!0},grid:{x:20,y:0,width:9,cellHeight:33,cellWidth:32}},newGame:{character:{x:24,y:4},pet:{x:38,y:4},selectedClassDescription:{x:0,y:104,width:128},prevClass:{x:128,y:0},nextClass:{x:288,y:0},prevGender:{x:128,y:32},nextGender:{x:288,y:32},prevPet:{x:128,y:64},nextPet:{x:288,y:64},select:{x:128,y:96},back:{x:128,y:144},selectedClass:{x:160,y:8,width:128},selectedGender:{x:160,y:40,width:128},selectedPet:{x:160,y:72,width:128},shortDescriptions:!0}},COMMON:{BUTTON:{BIG:{small:!1,tileset:"tileset64",indexes:[0,3,3,3,1,2,2,2],icon:{x:16,y:8},text:{x:0,y:40,xCenter:64}},SMALL:{small:!0,tileset:"tileset32",indexes:[132,132,132,132,132,132,132,132],icon:{x:0,y:0},text:{x:34,y:8}}}},LANDSCAPE:{levelGen:{roomBounds:{height:9,width:9},baseRooms:12},oldVersionMessage:"This game was started on an older version, scores won't be saved and it may not work properly. Continue at your own risk!",dialog:{x:80,y:32,width:352,height:256,buttonGap:32},playerInfo:{x:80,y:32,width:352,height:256,big:!0,pageSize:11},characterCreation:{smallButtons:!0,useTextfields:!1,portrait:{x:152,y:8},selectedClass:{x:128,y:100,width:96},selectedSkinTone:{x:128,y:132,width:96},selectedHairColor:{x:128,y:164,width:96},selectedHairType:{x:128,y:196,width:96},selectedBeardType:{x:128,y:228,width:96},nameLabel:{x:8,y:68},classLabel:{x:8,y:100},skinToneLabel:{x:8,y:132},hairColorLabel:{x:8,y:164},hairTypeLabel:{x:8,y:196},beardTypeLabel:{x:8,y:228},bonusPoints:{x:256,y:24,width:256},combat:{x:288,y:68,width:192},magic:{x:288,y:100,width:192},carry:{x:288,y:132,width:192},hp:{x:288,y:164,width:192},mp:{x:288,y:196,width:192},evade:{x:288,y:228,width:192},prevSkinTone:{x:96,y:128},nextSkinTone:{x:224,y:128},prevHairColor:{x:96,y:160},nextHairColor:{x:224,y:160},prevHairType:{x:96,y:192},nextHairType:{x:224,y:192},prevBeardType:{x:96,y:224},nextBeardType:{x:224,y:224},decreaseCombat:{x:256,y:64},increaseCombat:{x:480,y:64},decreaseMagic:{x:256,y:96},increaseMagic:{x:480,y:96},decreaseCarry:{x:256,y:128},increaseCarry:{x:480,y:128},decreaseHP:{x:256,y:160},increaseHP:{x:480,y:160},decreaseMP:{x:256,y:192},increaseMP:{x:480,y:192},decreaseEvade:{x:256,y:224},increaseEvade:{x:480,y:224},next:{x:256,y:256},back:{x:0,y:256},nameButton:{x:224,y:64,small:!0},popupNameLabel:{x:128,y:68,width:96},nameField:!1},useTextfields:!0,hiRes:!1,settingsOnlyOnInventory:!0,buttonSpecs:{small:!1,tileset:"tileset64",indexes:[0,3,3,3,1,2,2,2],icon:{x:16,y:8},text:{x:0,y:40,xCenter:64}},splash:{x:96,y:40},title:{background:"title-tablet",logo:{x:16,y:16},backgroundOffsetX:0,backgroundOffsetY:0,credits:{x:16,y:280},newGame:{x:256,y:0},fellowship:{x:256,y:64},difficulty:{x:256,y:128},settings:{x:256,y:192},connect:{x:256,y:0},signup:{x:256,y:64},addFriend:{x:256,y:64},graveyard:{x:256,y:128},statues:{x:256,y:192},settingsMenu:{soundLabel:{x:360,y:8},sound:{x:256,y:0},weaponDegLabel:{x:343,y:72},weaponDeg:{x:256,y:64},back:{x:256,y:192}},back:{x:256,y:256},next:{x:448,y:256},profile:{x:256,y:48},currentPlayerInfo:{name:{x:16,y:200},games:{x:16,y:216},victories:{x:16,y:232},friends:{x:16,y:248},lukas:{x:16,y:264}},welcomeGold:{x:160,y:20,width:320},decodeMonitor:{x:32,y:304}},promo:{text:{x:192,y:32,width:256},get:{x:128,y:192},soon:{x:128,y:256},image:{x:64,y:32}},help:{dialogText:{x:108,y:32,width:200},characterImage:{x:32,y:32},next:{x:0,y:256},skip:{x:256,y:256},helpImage:{x:348,y:32}},mainPanel:{socialMessage:{x:88,y:252,width:272},mapOverlay:"uiOverlay-landscape",lifeBar:{x:96,y:24,width:48},petLifeBar:{x:300,y:24,width:48},magicBar:{x:96,y:40,width:48},useZoomedMovement:!1},mapPanel:{x:64,y:0,width:320,height:320},inventoryPanel:{pos:{x:80,y:20},playerIcon:{x:112,y:64},petIcon:{x:112,y:128},grid:{x:179,y:24,space:38,icon:{name:"misc38",index:0},selectedIcon:{name:"misc38",index:1},width:4,padding:3},spellsRow:{x:96,y:256,space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105}},equipment:{space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},padding:0},hideMapGUI:!0},settingsPanel:{insideInventory:!0},selectUpgradePanel:{title:{x:56,y:24},x:32,y:64,spacing:16,upgradeDescriptionText:{x:288,y:176,width:192},upgradeName:{x:288,y:118,width:192,centered:!0},upgradeIdol:{x:352,y:48,card:!0},confirmButton:{x:256,y:256}},hpIcon:{x:80,y:16},mpIcon:{x:80,y:32},weaponIcon:{x:80,y:48},armorIcon:{x:80,y:64},petIcon:{x:284,y:16},skillPointsIcon:{x:284,y:32},inspector:{x:384,y:128,width:128,yOffset:0,titleWrap:!0,titleLines:2,descriptionLines:9},inventoryButton:{x:0,y:0},petCommandButton:{x:0,y:192},applyButton:{x:0,y:64},confirmApplyButton:{x:384,y:256},cancelApplyButton:{x:448,y:256},useButton:{x:0,y:128},switchButton:{x:0,y:64},dropButton:{x:0,y:192},settingsButton:{x:0,y:256},helpButton:{x:96,y:176,onlyOnInventory:!0,location:"inside the inventory"},tacticsButton:{x:0,y:256},buttons:{shareCharacter:{x:0,y:64},hideBasicButtonsWhenTargetting:!1},minimap:{x:400,y:16},behaviorButtonsLocation:"next to the ITEMS one.",minimapLocation:"on the top",statsLocation:"on the top left",petStatsLocation:"on the top right",locationImage:{x:176,y:40},graveyard:{title:{x:256,y:32,width:256},table:{x:256,y:56},personal:{x:256,y:256},friends:{x:320,y:256},global:{x:384,y:256},back:{x:448,y:256},promoText:{x:368,y:64,width:256},promoButton:{x:368,y:128}},connect:{nameLabel:{x:8,y:64},passwordLabel:{x:8,y:84},nameField:{x:108,y:64,width:96,height:16},passwordField:{x:108,y:84,width:96,height:16},nameButton:{x:32,y:48},passwordButton:{x:32,y:112},connect:{x:256,y:64},forgotPassword:{x:256,y:128},back:{x:256,y:256}},signup:{nameLabel:{x:8,y:64},emailLabel:{x:8,y:84},passwordLabel:{x:8,y:104},nameField:{x:108,y:64,width:96,height:16},emailField:{x:108,y:84,width:96,height:16},passwordField:{x:108,y:104,width:96,height:16},nameButton:{x:32,y:48},emailButton:{x:32,y:112},passwordButton:{x:32,y:176},signup:{x:256,y:64},back:{x:256,y:256}},forgotPassword:{emailLabel:{x:8,y:64},emailField:{x:108,y:64,width:96,height:16},emailButton:{x:32,y:48},forgotPassword:{x:256,y:64},back:{x:256,y:256}},addFriend:{nameLabel:{x:32,y:64},nameField:{x:132,y:64,width:96,height:16},nameButton:{x:32,y:48},connect:{x:256,y:64},search:{x:256,y:128},back:{x:256,y:256},selectedPlayer:{name:{x:32,y:90},pin:{x:128,y:90},games:{x:32,y:106},victories:{x:128,y:106},friends:{x:32,y:122}}},profile:{title:{x:432,y:32},back:{x:368,y:240},selectedPlayer:{name:{x:368,y:80},pin:{x:496,y:80},games:{x:368,y:96},victories:{x:496,y:96},friends:{x:368,y:128},friendsList:{x:368,y:144,width:320}}},statues:{slanted:!0,title:{x:180,y:16},back:{x:128,y:256},grid:{x:20,y:48,width:8,cellHeight:32,cellWidth:64}},newGame:{character:{x:96,y:32},pet:{x:110,y:32},selectedClassDescription:{x:8,y:144,width:240},prevClass:{x:256,y:0},nextClass:{x:448,y:0},prevGender:{x:256,y:64},nextGender:{x:448,y:64},prevPet:{x:256,y:128},nextPet:{x:448,y:128},select:{x:256,y:192},back:{x:256,y:256},selectedClass:{x:320,y:24,width:128},selectedGender:{x:320,y:88,width:128},selectedPet:{x:320,y:152,width:128}}},PORTRAIT:{levelGen:{roomBounds:{height:9,width:9},baseRooms:12},oldVersionMessage:"This game was started on an older version, scores won't be saved and it may not work properly.",useTextfields:!0,hiRes:!1,settingsOnlyOnInventory:!1,buttonSpecs:{small:!1,tileset:"tileset64",indexes:[0,3,3,3,1,2,2,2],icon:{x:16,y:8},text:{x:0,y:40,xCenter:64}},dialog:{x:0,y:96,width:320,height:192,buttonGap:0},playerInfo:{x:0,y:96,width:320,height:192,big:!1,pageSize:8},splash:{x:0,y:96},characterCreation:{useTextfields:!1,smallButtons:!1,doubleScreen:!0,portrait:{x:40,y:16},selectedClass:{x:96,y:40,width:128},selectedSkinTone:{x:96,y:114,width:128},selectedHairColor:{x:96,y:186,width:128},selectedHairType:{x:96,y:258,width:128},selectedBeardType:{x:96,y:330,width:128},nameLabel:!1,skinToneLabel:{x:96,y:84,width:128},hairColorLabel:{x:96,y:156,width:128},hairTypeLabel:{x:96,y:228,width:128},beardTypeLabel:{x:96,y:300,width:128},bonusPoints:{x:96,y:4,width:128},combat:{x:96,y:56,width:128},magic:{x:96,y:124,width:128},carry:{x:96,y:192,width:128},hp:{x:96,y:260,width:128},mp:{x:96,y:328,width:128},evade:{x:96,y:396,width:128},prevSkinTone:{x:32,y:80},nextSkinTone:{x:224,y:80},prevHairColor:{x:32,y:152},nextHairColor:{x:224,y:152},prevHairType:{x:32,y:224},nextHairType:{x:224,y:224},prevBeardType:{x:32,y:296},nextBeardType:{x:224,y:296},decreaseCombat:{x:32,y:32},increaseCombat:{x:224,y:32},decreaseMagic:{x:32,y:100},increaseMagic:{x:224,y:100},decreaseCarry:{x:32,y:168},increaseCarry:{x:224,y:168},decreaseHP:{x:32,y:236},increaseHP:{x:224,y:236},decreaseMP:{x:32,y:304},increaseMP:{x:224,y:304},decreaseEvade:{x:32,y:372},increaseEvade:{x:224,y:372},next:{x:32,y:448},back:{x:32,y:512},nameButton:{x:224,y:8},popupNameLabel:{x:96,y:16,width:128},nameField:!1},title:{background:"title-portrait",logo:{x:40,y:0},newGame:{x:32,y:288},fellowship:{x:32,y:352},difficulty:{x:32,y:416},settings:{x:32,y:480},connect:{x:32,y:224},signup:{x:32,y:288},addFriend:{x:32,y:288},graveyard:{x:32,y:352},statues:{x:32,y:416},back:{x:32,y:480},hidePlayerStatsOnSubMenus:!0,settingsMenu:{soundLabel:{x:136,y:296},sound:{x:32,y:288},weaponDegLabel:{x:119,y:360},weaponDeg:{x:32,y:352},back:{x:32,y:480}},profile:{x:32,y:288},credits:{x:3,y:544},currentPlayerInfo:{name:{x:32,y:250},games:{x:32,y:266},victories:{x:116,y:266},friends:{x:206,y:266},lukas:{x:206,y:250}},welcomeGold:{x:32,y:32,width:256},decodeMonitor:{x:32,y:176},backgroundOffsetX:0,backgroundOffsetY:0},promo:{text:{x:32,y:32,width:256},get:{x:32,y:320},soon:{x:32,y:384},image:{x:96,y:176}},help:{dialogText:{x:100,y:32,width:184},characterImage:{x:32,y:32},helpImage:{x:128,y:144},next:{x:32,y:448},skip:{x:32,y:512}},newGame:{prevClass:{x:32,y:32},nextClass:{x:224,y:32},prevGender:{x:32,y:104},nextGender:{x:224,y:104},prevPet:{x:32,y:176},nextPet:{x:224,y:176},selectedGender:{x:104,y:132,width:112},selectedClass:{x:104,y:60,width:112},selectedPet:{x:104,y:204,width:112},character:{x:32,y:260},pet:{x:48,y:260},selectedClassDescription:{x:112,y:248,width:176},select:{x:32,y:448},back:{x:32,y:512}},mainPanel:{socialMessage:{x:32,y:256,width:272},mapOverlay:"uiOverlay-portrait",lifeBar:{x:40,y:24,width:48},petLifeBar:{x:254,y:24,width:48},magicBar:{x:40,y:40,width:48},useZoomedMovement:!0,portrait:{x:192,y:328},hideSystemButtonsWhenTargetting:!0},bigDirectionPad:{x:0,y:320},mapPanel:{x:0,y:0,width:320,height:320},inventoryPanel:{pos:{x:0,y:0},playerIcon:{x:48,y:64},petIcon:{x:48,y:128},grid:{x:118,y:32,space:38,icon:{name:"misc38",index:0},selectedIcon:{name:"misc38",index:1},width:4,padding:3},equipment:{space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},padding:0},spellsRow:{x:32,y:260,space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105}},hideMapGUI:!0},settingsPanel:{insideInventory:!0},selectUpgradePanel:{title:{x:72,y:16},x:0,y:48,spacing:0,upgradeDescriptionText:{x:32,y:256,width:256},upgradeName:{x:160,y:150,width:192,centered:!0},upgradeIdol:{x:224,y:80,card:!0},confirmButton:{x:32,y:384}},hpIcon:{x:24,y:16},mpIcon:{x:24,y:32},weaponIcon:{x:24,y:48},armorIcon:{x:24,y:64},petIcon:{x:240,y:16},skillPointsIcon:{x:240,y:32},inventoryButton:{x:0,y:448},petCommandButton:{x:64,y:512},applyButton:{x:64,y:512},confirmApplyButton:{x:64,y:512},cancelApplyButton:{x:192,y:512},useButton:{x:128,y:512},switchButton:{x:192,y:512},dropButton:{x:192,y:512},settingsButton:{x:64,y:448},zoomedMovementButton:{x:256,y:512},helpButton:{x:128,y:448,onlyOnInventory:!1,location:"below this message"},tacticsButton:{x:0,y:512},buttons:{shareCharacter:{x:64,y:512},hideBasicButtonsWhenTargetting:!0},inspector:{x:0,y:320,width:192,yOffset:0,titleWrap:!0,titleLines:2,descriptionLines:5},minimap:{x:208,y:400,hideDepth:!0},behaviorButtonsLocation:"next to Items.",minimapLocation:"on the top right\t",statsLocation:"on the top left",petStatsLocation:"on the top right",locationImage:{x:100,y:40},graveyard:{title:{x:32,y:32,width:256},personal:{x:32,y:480},friends:{x:96,y:480},global:{x:160,y:480},back:{x:224,y:480},table:{x:32,y:64},promoText:{x:32,y:128,width:256},promoButton:{x:32,y:180}},connect:{nameLabel:{x:32,y:32},passwordLabel:{x:32,y:62},nameField:{x:132,y:32,width:128,height:16},passwordField:{x:132,y:62,width:128,height:16},popupNameLabel:{x:32,y:32},popupPasswordLabel:{x:32,y:96},nameButton:{x:224,y:0},passwordButton:{x:224,y:64},connect:{x:32,y:320},forgotPassword:{x:32,y:384},back:{x:32,y:448}},signup:{nameLabel:{x:32,y:32},emailLabel:{x:32,y:62},passwordLabel:{x:32,y:92},nameField:{x:132,y:32,width:128,height:16},emailField:{x:132,y:62,width:128,height:16},passwordField:{x:132,y:92,width:128,height:16},popupNameLabel:{x:32,y:32},popupEmailLabel:{x:32,y:96},popupPasswordLabel:{x:32,y:160},nameButton:{x:224,y:0},emailButton:{x:224,y:64},passwordButton:{x:224,y:128},signup:{x:32,y:384},back:{x:32,y:448}},forgotPassword:{emailLabel:{x:32,y:32},emailField:{x:132,y:32,width:128,height:16},popupEmailLabel:{x:32,y:32},emailButton:{x:224,y:0},forgotPassword:{x:32,y:384},back:{x:32,y:448}},addFriend:{nameLabel:{x:32,y:32},nameField:{x:132,y:32,width:128,height:16},popupNameLabel:{x:32,y:32},nameButton:{x:224,y:0},search:{x:32,y:320},connect:{x:32,y:384},back:{x:32,y:448},selectedPlayer:{name:{x:32,y:80},pin:{x:160,y:80},games:{x:32,y:96},victories:{x:160,y:96},friends:{x:32,y:112}}},profile:{title:{x:32,y:64},back:{x:32,y:448},selectedPlayer:{name:{x:32,y:80},pin:{x:160,y:80},games:{x:32,y:96},victories:{x:160,y:96},friends:{x:32,y:128},friendsList:{x:32,y:144,width:320}}},statues:{slanted:!0,title:{x:90,y:32},back:{x:32,y:480},grid:{x:52,y:56,width:7,cellHeight:48,cellWidth:32}}},TRAILER:{levelGen:{roomBounds:{height:7,width:12,margin:1,useStickyArrows:!0},baseRooms:10},oldVersionMessage:"This game was started on an older version, we cannot ensure it will work properly. Do you want to proceed?",characterCreation:{useTextfields:!1,smallButtons:!0,portrait:{x:38,y:0},doubleScreen:!0,selectedClass:{x:0,y:64,width:128},selectedSkinTone:{x:160,y:8,width:128},selectedHairColor:{x:160,y:40,width:128},selectedHairType:{x:160,y:72,width:128},selectedBeardType:{x:160,y:104,width:128},nameLabel:!1,skinToneLabel:!1,hairColorLabel:!1,hairTypeLabel:!1,beardTypeLabel:!1,bonusPoints:{x:0,y:16,width:320},combat:{x:32,y:48,width:96},magic:{x:32,y:80,width:96},carry:{x:32,y:112,width:96},hp:{x:192,y:48,width:96},mp:{x:192,y:80,width:96},evade:{x:192,y:112,width:96},prevSkinTone:{x:128,y:0},nextSkinTone:{x:288,y:0},prevHairColor:{x:128,y:32},nextHairColor:{x:288,y:32},prevHairType:{x:128,y:64},nextHairType:{x:288,y:64},prevBeardType:{x:128,y:96},nextBeardType:{x:288,y:96},decreaseCombat:{x:0,y:48},increaseCombat:{x:128,y:48},decreaseMagic:{x:0,y:80},increaseMagic:{x:128,y:80},decreaseCarry:{x:0,y:112},increaseCarry:{x:128,y:112},decreaseHP:{x:160,y:48},increaseHP:{x:288,y:48},decreaseMP:{x:160,y:80},increaseMP:{x:288,y:80},decreaseEvade:{x:160,y:112},increaseEvade:{x:288,y:112},next:{x:128,y:144},back:{x:0,y:144,small:!0},nameButton:{x:96,y:0},popupNameLabel:{x:0,y:48,width:128},nameField:!1},useTextfields:!1,hiRes:!0,noTooltips:!0,settingsOnlyOnInventory:!1,buttonSpecs:{small:!0,tileset:"tileset32",indexes:[132,132,132,132,132,132,132,132],icon:{x:0,y:0},text:{x:34,y:8}},splash:{x:0,y:0},title:{background:"menu-chibi",logo:!1,credits:!1,version:{x:16,y:176},modal:"title-chibi",newGame:{x:128,y:0},fellowship:{x:128,y:48},difficulty:{x:128,y:96},settings:{x:128,y:144},settingsMenu:{soundLabel:{x:34,y:10},sound:{x:128,y:0},weaponDegLabel:{x:34,y:74},weaponDeg:{x:128,y:64},back:{x:128,y:144}},hidePlayerStatsOnSubMenus:!0,addFriend:{x:128,y:0},graveyard:{x:128,y:48},signup:{x:128,y:48},connect:{x:128,y:96},statues:{x:128,y:144},back:{x:0,y:144,small:!0},next:{x:560,y:240},profile:{x:368,y:48},currentPlayerInfo:{name:{x:8,y:16},friends:{x:8,y:112},games:{x:8,y:128},victories:{x:8,y:144},lukas:{x:8,y:160}},welcomeGold:{x:160,y:20,width:320},decodeMonitor:{x:32,y:304}},promo:{smallButtons:!0,text:{x:128,y:0,width:192},get:{x:128,y:96},soon:{x:128,y:144},image:{x:0,y:16}},help:{dialogText:{x:128,y:0,width:192},characterImage:{x:32,y:0},next:{x:128,y:96},skip:{x:128,y:144},helpImage:{x:0,y:64}},playerInfo:{x:0,y:0,width:320,height:192,big:!1,pageSize:8},mainPanel:{mapOverlay:!1,socialMessage:{x:36,y:208,width:344},lifeBar:{x:16,y:7,width:96},magicBar:{x:16,y:24,width:64},petLifeBar:{x:400,y:7,reverse:!0,width:96},useZoomedMovement:!1,spellsRow:{x:32,y:208,space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},toogleButton:{x:384,y:176}},portrait:!1},mapPanel:{x:48,y:0,statusAilments:{baseY:208,baseX:{pet:384,player:32}},width:320,height:240},inventoryPanel:{pos:{x:34,y:160},playerIcon:{x:64,y:64},petIcon:{x:64,y:128},background:{x:0,y:0,image:"angelsFrame"},grid:{x:128,y:32,space:32,padding:0,icon:{name:"tileset32",index:122},selectedIcon:{name:"tileset32",index:121},width:4},equipment:{space:32,icon:{name:"tileset32",index:106},selectedIcon:{name:"tileset32",index:105},padding:0},hideMapGUI:!0,itemSummaryText:{x:64,y:13,width:192}},settingsPanel:{save:{x:64,y:0},switchMusic:{x:64,y:48},switchSFX:{x:64,y:96},quit:{x:64,y:144}},selectUpgradePanel:{title:!1,x:0,y:0,upgradeDescriptionText:{x:192,y:88,width:128},upgradeName:{x:192,y:72,width:128,centered:!0},upgradeIdol:{x:224,y:8},confirmButton:{x:288,y:0,small:!0},thin:!0},hpIcon:{x:0,y:0},mpIcon:{x:0,y:16},weaponIcon:{x:0,y:32},armorIcon:{x:0,y:48},petIcon:{x:416,y:0,rightAlign:!0},skillPointsIcon:{x:416,y:16,rightAlign:!0},inspector:{x:36,y:16,width:256,yOffset:0,titleWrap:!0,toogleButton:{x:384,y:112},scrollBackground:!0,titleLines:2,descriptionLines:8},dialog:{x:0,y:0,width:320,height:192,buttonGap:0},confirmApplyButton:{x:0,y:176},cancelApplyButton:{x:0,y:208},selectATargetMessage:{x:32,y:16,width:256},dropButton:{x:0,y:144},applyButton:{x:0,y:176},useButton:{x:0,y:112},switchButton:{x:0,y:144},petCommandButton:{x:0,y:176},tacticsButton:{x:0,y:208},inventoryButton:{x:384,y:208},settingsButton:{x:384,y:144},helpButton:{x:384,y:176,location:"on the right buttons inside the inventory"},buttons:{shareCharacter:{x:8,y:256},hideBasicButtonsWhenTargetting:!0},minimap:{x:600,y:32,toogleButton:{x:288,y:32},micromap:{x:600,y:600}},behaviorButtonsLocation:"next to the ITEMS one.",minimapLocation:"on the top",statsLocation:"on the top left",petStatsLocation:"on the top right",locationImage:{x:80,y:16},graveyard:{bgOffsets:{x:-96,y:0},title:{x:0,y:0,width:224},table:{x:0,y:16,columns:[144,44]},personal:{x:224,y:0},friends:{x:224,y:48},global:{x:224,y:96},back:{x:224,y:144},smallButtons:!0,promoText:{x:128,y:64,width:256},promoButton:{x:128,y:128}},connect:{popupNameLabel:{x:164,y:12},popupPasswordLabel:{x:164,y:60},nameButton:{x:128,y:8},passwordButton:{x:128,y:56},connect:{x:128,y:96},forgotPassword:{x:128,y:144},back:{x:0,y:144,small:!0}},signup:{popupNameLabel:{x:164,y:12},popupPasswordLabel:{x:164,y:60},popupEmailLabel:{x:164,y:108},nameButton:{x:128,y:8},passwordButton:{x:128,y:56},emailButton:{x:128,y:104},signup:{x:128,y:144},back:{x:0,y:144,small:!0}},forgotPassword:{popupEmailLabel:{x:164,y:12},emailButton:{x:128,y:8},forgotPassword:{x:128,y:144},back:{x:0,y:144,small:!0}},addFriend:{popupNameLabel:{x:164,y:12},nameButton:{x:128,y:8},search:{x:128,y:96},connect:{x:128,y:144},back:{x:0,y:144,small:!0},selectedPlayer:{name:{x:16,y:12},pin:{x:16,y:32},games:{x:16,y:52},victories:{x:16,y:72},friends:{x:16,y:92}}},profile:{title:{x:432,y:32},back:{x:368,y:240},selectedPlayer:{name:{x:368,y:80},pin:{x:496,y:80},games:{x:368,y:96},victories:{x:496,y:96},friends:{x:368,y:128},friendsList:{x:368,y:144,width:320}}},statues:{slanted:!0,title:{x:0,y:0,hidden:!0},back:{x:288,y:162,small:!0},grid:{x:20,y:0,width:9,cellHeight:33,cellWidth:32}},newGame:{character:{x:24,y:4},pet:{x:38,y:4},selectedClassDescription:{x:0,y:104,width:128},prevClass:{x:128,y:0},nextClass:{x:288,y:0},prevGender:{x:128,y:32},nextGender:{x:288,y:32},prevPet:{x:128,y:64},nextPet:{x:288,y:64},select:{x:128,y:96},back:{x:128,y:144},selectedClass:{x:160,y:8,width:128},selectedGender:{x:160,y:40,width:128},selectedPet:{x:160,y:72,width:128},shortDescriptions:!0}}};

},{}],68:[function(require,module,exports){
var Util=require("../Util");function LifeBar(i,t,s,h,a){this.stat=null,this.lastValue=-1,this.config=a,a.reverse?this.graphics=h.add.graphics(i-a.width,t):this.graphics=h.add.graphics(i,t),s.add(this.graphics)}LifeBar.prototype={setStat:function(i){this.stat=i,this.lastValue=-1},update:function(){if(this.stat&&this.lastValue!==this.stat.current){this.graphics.clear();var i=this.config.colour;if(!i){var t=100*this.stat.getProportion();i=Util.rgbToHex(255*(t>50?1-2*(t-50)/100:1),255*(t>50?1:2*t/100),0)}this.graphics.beginFill(i),this.graphics.lineStyle(this.config.height,i,1),this.graphics.moveTo(0,-5),this.config.reverse?(this.graphics.moveTo(this.config.width*(1-this.stat.getProportion()),-5),this.graphics.lineTo(this.config.width,-5)):this.graphics.lineTo(this.config.width*this.stat.getProportion(),-5),this.graphics.endFill(),this.lastValue=this.stat.current}},clear:function(){this.graphics.clear()}},module.exports=LifeBar;

},{"../Util":36}]},{},[3]);

})();
